---
name: Bitcoini privaatsus
goal: Mõista ja omandada privaatsuse kaitse põhimõtteid Bitcoini kasutamisel
objectives: 

  - Määratleda teoreetilised mõisted, mis on vajalikud eraelu puutumatuse kaitse panuste mõistmiseks
  - Teadma, kuidas tuvastada ja leevendada kasutajate privaatsuse kaotamisega seotud riske Bitcoini puhul
  - Meetodite ja tööriistade kasutamine Bitcoini privaatsuse kaitsmiseks
  - Mõista ahelaanalüüsi meetodeid ja töötada välja kaitsestrateegiad

---
# Bitcoini privaatsuse kaitsmine

Maailmas, kus finantstehingute privaatsus muutub järk-järgult luksuseks, on oluline mõista ja omandada privaatsuse kaitse põhimõtteid Bitcoini kasutamisel. See koolitus annab teile kõik võtmed, nii teoreetilised kui ka praktilised, et seda eesmärki iseseisvalt saavutada.

Tänapäeval on Bitcoini puhul olemas ettevõtted, mis on spetsialiseerunud ahela analüüsile. Nende põhitegevus on just teie privaatsusse sekkumine, et kahjustada teie tehingute konfidentsiaalsust. Tegelikult ei ole "õigust privaatsusele" Bitcoinis olemas. Seega on teie, kasutaja, ülesanne kaitsta oma loomulikke õigusi ja oma tehingute konfidentsiaalsust, sest keegi teine ei tee seda teie eest.

See koolitus on esitatud tervikliku, üldkoolitusena. Iga tehniline mõiste on üksikasjalik ja seda toetavad selgitavad diagrammid. Eesmärk on teha teadmised kõigile kättesaadavaks. BTC204 on seega kättesaadav nii algajatele kui ka edasijõudnutele. See koolitus pakub lisaväärtust ka kogenumatele bitcoini kasutajatele, kuna me süveneme mõnda sageli tundmatusse tehnilisse mõistesse.

Liitu meiega, et muuta oma Bitcoini kasutamine ja saada teadlikuks kasutajaks, kes suudab mõista konfidentsiaalsusega seotud küsimusi ja kaitsta oma eraelu puutumatust.

+++
# Sissejuhatus

<partId>e17474a8-8899-4bdb-a7f8-bc52ddb01440</partId>

## Sissejuhatus koolitusse

<chapterId>08ba1933-f393-4fb5-8279-777d874caedb</chapterId>

Maailmas, kus finantstehingute privaatsus muutub järk-järgult luksuseks, on oluline mõista ja omandada privaatsuse kaitse põhimõtteid Bitcoini kasutamisel. See koolitus annab teile kõik võtmed, nii teoreetilised kui ka praktilised, et seda eesmärki iseseisvalt saavutada.

Tänapäeval on Bitcoini ökosüsteemis ettevõtted, mis on spetsialiseerunud plokiahela analüüsile. Nende põhitegevus on just teie privaatsusse sekkumine, mis ohustab teie tehingute konfidentsiaalsust. Tegelikult "õigust privaatsusele" Bitcoinis ei ole olemas. Seetõttu on teie, kasutaja, ülesanne oma loomulikke õigusi maksma panna ja kaitsta oma tehingute konfidentsiaalsust, sest keegi teine ei tee seda teie eest.

Bitcoin ei ole ainult "Number Go Up" ja säästude väärtuse säilitamine. Oma ainulaadsete omaduste ja ajaloo tõttu on see eelkõige alternatiivse majanduse vahend. Tänu sellele tähelepanuväärsele leiutisele saate oma raha vabalt hallata, kulutada ja koguda, ilma et keegi saaks teid peatada.

Bitcoin pakub rahumeelset põgenemist riikide ikke alt, võimaldades teil täielikult nautida oma loomulikke õigusi, mida ei saa kehtestatud seadustega vaidlustada. Tänu Satoshi Nakamoto leiutisele on teil võim, et jõustada oma õigus eraomandile ja taastada oma lepinguvabadus.

Bitcoin ei ole aga vaikimisi anonüümne, mis võib kujutada endast ohtu alternatiivse majandusega tegelevatele inimestele, eriti piirkondades, kus valitseb despootlik režiim. Kuid see ei ole ainus oht. Kuna bitcoin on väärtuslik ja tsenseerimata vara, võib see äratada varaste tähelepanu. Seetõttu muutub teie privaatsuse kaitsmine ka turvalisuse küsimuseks: see võib aidata teil vältida küberrünnakuid ja füüsilisi rünnakuid.

Nagu me näeme, kuigi protokoll pakub teatavat eraelu puutumatuse kaitset, on oluline kasutada lisavahendeid, et optimeerida ja kaitsta seda eraelu puutumatust. See kursus on mõeldud tervikliku ja üldistava tee loomiseks Bitcoini privaatsuse mõistmiseks. Iga tehnilist mõistet käsitletakse üksikasjalikult ja seda toetavad selgitavate diagrammidega. Eesmärk on teha teadmised kättesaadavaks kõigile, sealhulgas algajatele ja edasijõudnutele. Kogenumate bitcoin'i kasutajate jaoks käsitleme selle kursuse jooksul ka väga tehnilisi ja mõnikord vähemtuntud mõisteid, et süvendada iga teema mõistmist.

Selle kursuse eesmärk ei ole muuta teid Bitcoini kasutamisel täiesti anonüümseks, vaid pigem anda teile olulised vahendid, et teaksite, kuidas kaitsta oma privaatsust vastavalt oma isiklikele eesmärkidele. Teil on vabadus valida esitatud kontseptsioonide ja vahendite hulgast, et töötada välja oma strateegiad, mis on kohandatud teie konkreetsetele eesmärkidele ja vajadustele.

### 1. jagu: Mõisted ja põhimõisted

Alustuseks vaatame koos põhialuseid, mis reguleerivad Bitcoini toimimist, ja seejärel läheneme rahulikult privaatsusega seotud mõistetele. On oluline omandada mõned põhimõisted, nagu UTXOd, vastuvõtuaadressid või skriptid, enne kui saame täielikult mõista mõisteid, mida käsitleme järgmistes osades. Tutvustame ka Bitcoini üldist privaatsusmudelit, nagu Satoshi Nakamoto seda ette kujutas, mis võimaldab meil mõista probleeme ja nendega seotud riske.

![BTC204](assets/it/11/1.webp)

### 2. jagu: Ahelaanalüüsi mõistmine ja enda kaitsmine

Teises osas uurime plokiahela analüütikafirmade poolt kasutatavaid meetodeid, et jälgida teie tegevust Bitcoinis. Nende meetodite mõistmine on teie eraelu puutumatuse kaitse parandamiseks ülioluline. Selle osa eesmärk on uurida ründajate strateegiaid, et paremini mõista riske ja panna alus tehnikatele, mida uurime järgmistes osades. Analüüsime tehingumustreid, sisemisi ja väliseid heuristikatsioone ning nende mustrite usutavaid tõlgendusi. Lisaks teoreetilisele osale õpime praktiliste näidete ja harjutuste kaudu, kuidas kasutada plokkide uurijat ahelaanalüüsi tegemiseks.

![BTC204](assets/fr/002.webp)

### 3. jagu: Parimate tavade valdamine teie eraelu puutumatuse kaitsmiseks

Meie kursuse kolmandas osas jõuame asja tuumani: praktika! Eesmärk on omandada kõik olulised parimad tavad, mis peaksid saama iga Bitcoini kasutaja jaoks loomulikuks refleksiks. Me käsitleme värskete aadresside kasutamist, märgistamist, konsolideerimist, täisnoodide kasutamist, samuti KYC- ja omandamismeetodeid. Eesmärk on anda teile põhjalik ülevaade lõksudest, mida tuleb vältida, et luua kindel alus meie püüdlustes privaatsuse kaitsmiseks. Mõnede nende tavade puhul juhatatakse teid nende rakendamiseks konkreetse juhendmaterjali juurde.

![BTC204](assets/it/11/3.webp)

### 4. jagu: Coinjoin-tehingute mõistmine

Kuidas me saame rääkida Bitcoini privaatsusest ilma coinjoin'i arutamata? Punktis 4 leiate kõik, mida selle segamismeetodi kohta teada peate. Saate teada, mis on coinjoin, selle ajalugu ja eesmärgid, samuti saate teada, milliseid erinevaid coinjoini tüüpe on olemas. Lõpuks, kogenumatele kasutajatele, saame teada, mis on anonset ja entroopia ning kuidas neid näitajaid arvutada.

![BTC204](assets/it/11/4.webp)

### 5. jagu: Muude täiustatud privaatsustehnikate probleemide mõistmine

Viiendas jaotises anname ülevaate kõigist teistest olemasolevatest tehnikatest, millega saab Bitcoinis lisaks coinjoinile oma privaatsust kaitsta. Aastate jooksul on arendajad näidanud märkimisväärset loovust privaatsusele pühendatud vahendite väljatöötamisel. Uurime kõiki neid meetodeid, nagu payjoin, ühistehingud, Coin Swap ja Atomic Swap, kirjeldades üksikasjalikult nende toimimist, eesmärke ja võimalikke nõrkusi.

Me käsitleme ka privaatsust sõlmede võrgu tasandil ja tehingute levitamist. Samuti arutame erinevaid protokolle, mida on aastate jooksul pakutud kasutajate privaatsuse parandamiseks Bitcoinis, sealhulgas staatilise aadressi protokollid.

![BTC204](assets/fr/005.webp)

# Mõisted ja põhimõisted

<partId>b9bbbde3-34c0-4851-83e8-e2ffb029cf31</partId>

## Bitcoini UTXO mudel

<chapterId>8d6b50c5-bf74-44f4-922b-25204991cb75</chapterId>

Bitcoin on eelkõige valuuta, kuid kas te teate konkreetselt, kuidas BTC on protokollis esindatud?

### UTXOs of Bitcoin: Mis on need?

Bitcoini protokollis põhineb rahaühikute haldamine UTXO-mudelil, mis tähendab "_Unspent Transaction Output_"

See mudel erineb oluliselt traditsioonilistest pangandussüsteemidest, mis tuginevad finantsvoogude jälgimiseks konto- ja saldomehhanismile. Tegelikult hoitakse pangandussüsteemis individuaalseid saldosid kontodel, mis on seotud identiteediga. Näiteks kui te ostate pagarilt baguette'i, debiteerib teie pank lihtsalt teie kontolt ostusumma, vähendades seega teie saldot, samal ajal kui pagari kontole kantakse sama summa, suurendades selle saldot. Selles süsteemis ei ole mingit seost teie kontole saabuva ja kontolt väljaviidava raha vahel, välja arvatud tehingukirjed.

Bitcoini puhul toimivad asjad teisiti. Konto mõistet ei ole olemas ja rahaühikuid ei hallata mitte saldode, vaid UTXOde kaudu. UTXO esindab konkreetset bitcoini summat, mida ei ole veel kulutatud, moodustades seega bitcoini tükikese, mis võib olla suur või väike. Näiteks võib UTXO olla väärtusega `500 BTC` või ainult `700 SATS`.

**> Meeldetuletus:** Satoshi, mida sageli lühendatakse sati, on Bitcoini väikseim ühik, mis on võrreldav penniga fiat-valuutades.

```plaintext
1 BTC = 100,000,000 SATS
```

Teoreetiliselt võib UTXO esindada mis tahes väärtust bitcoinides, alates satist kuni teoreetilise maksimumini, mis on umbes 21 miljonit BTC. Siiski on loogiliselt võimatu omada kõiki 21 miljonit bitcoin'i ning on olemas madalam majanduslik lävi, mida nimetatakse "tolmuks" ja millest allapoole jäävat UTXO-d peetakse majanduslikult ebaökonoomseks kulutada.

**> Kas teadsid?** Bitcoini suurim kunagi loodud UTXO oli väärtusega 500 000 BTC. See loodi MtGoxi platvormil 2011. aasta novembris toimunud konsolideerimisoperatsiooni käigus: [29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf](https://mempool.space/fr/tx/29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf)

### UTXO ja kulutingimused

UTXOd on Bitcoini vahetusvahendid. Iga tehing hõlmab UTXOde kui sisendite tarbimist ja uute UTXOde kui väljundite loomist. Kui tehing tehakse, loetakse sisendina kasutatud UTXOd "kulutatud" ning uued UTXOd luuakse ja määratakse tehingu väljundites märgitud saajatele. Seega kujutab UTXO lihtsalt kulutamata tehingu väljundit ja seega bitcoinide kogust, mis kuulub antud hetkel kasutajale.

![BTC204](assets/it/21/2.webp)

Kõik UTXOd on kaitstud skriptidega, mis määravad kindlaks tingimused, mille alusel neid saab kulutada. UTXO tarbimiseks peab kasutaja tõendama võrgule, et ta vastab UTXOd kaitsvas skriptis sätestatud tingimustele. Üldiselt on UTXOd kaitstud avaliku võtmega (või seda avalikku võtit esindava vastuvõtuaadressiga). Selle avaliku võtmega seotud UTXO kasutamiseks peab kasutaja tõendama, et tal on vastav privaatne võti, andes selle võtmega tehtud digitaalallkirja. Seepärast öeldakse, et teie Bitcoini rahakott ei sisalda tegelikult bitcoin'e, vaid hoopis teie privaatvõtmeid, mis omakorda annavad teile juurdepääsu teie UTXOdele ja seega ka bitcoin'idele, mida need esindavad.

![BTC204](assets/it/21/3.webp)

Kuna Bitcoinis puudub konto mõiste, on rahakoti saldo lihtsalt kõigi UTXOde väärtuste summa, mida ta saab kulutada. Näiteks kui teie Bitcoini rahakott saab kulutada järgmised 4 UTXO-d:

```plaintext
- 2 BTC
- 8 BTC
- 5 BTC
- 2 BTC
```

Teie rahakoti kogusaldo oleks `17 BTC`.

![BTC204](assets/it/21/4.webp)

## Bitcoini tehingute struktuur

<chapterId>29d3aaab-de2e-4746-ab40-c9748898850c</chapterId>

### Tehingu sisendid ja väljundid

Bitcoini tehing on plokiahelas salvestatud tehing, mis võimaldab bitcoinide omandiõiguse üleandmist ühelt inimeselt teisele. Täpsemalt, kuna me oleme UTXO-mudelis ja kontosid ei ole, täidab tehing kulutustingimusi, mis kaitsevad ühte või mitut UTXO-d, tarbib neid ja loob samaväärselt uusi UTXO-sid, mis on varustatud uute kulutustingimustega. Lühidalt öeldes liigutab tehing bitcoin'id rahuldatud skriptist uude skripti, mis on mõeldud nende kaitsmiseks.

![BTC204](assets/it/22/1.webp)

Iga Bitcoini tehing koosneb seega ühest või mitmest sisendist ja ühest või mitmest väljundist. Sisendid on UTXOd, mida tehing tarbib väljundite loomiseks. Väljundid on uued UTXOd, mida saab kasutada tulevaste tehingute sisenditena.

![BTC204](assets/it/22/2.webp)

**> Kas teadsid?** Teoreetiliselt võib bitcoini tehingul olla lõpmatu arv sisendeid ja väljundeid. Seda arvu piirab ainult maksimaalne plokisuurus. Iga bitcoin-tehingu sisend viitab eelmisele kasutamata UTXO-le (Unspent Transaction Output). Et kasutada UTXO-d sisendina, peab selle omanik tõestama, et ta on selle õigustatud omanik, valideerides sellega seotud skripti, st rahuldades kehtestatud kulutamistingimuse. Üldiselt hõlmab see digitaalallkirja esitamist, mis on toodetud selle UTXO algselt tagatud avaliku võtmega vastava eravõti abil. Seejärel kontrollib skript, kas allkiri vastab raha saamisel kasutatud avalikule võtmele.

Iga väljundi puhul määratakse kindlaks nii ülekantav bitcoinide summa kui ka saaja. Viimane määratakse uue skripti abil, mis üldjuhul lukustab äsja loodud UTXO vastuvõtva aadressi või uue avaliku võtmega.

Selleks, et tehingut saaks konsensuseeskirjade kohaselt lugeda kehtivaks, peab väljundite kogusumma olema väiksem või võrdne sisendite kogusummaga. Teisisõnu ei tohi tehingu käigus loodud uute UTXOde summa ületada sisenditena tarbitud UTXOde summat. See põhimõte on loogiline: kui teil on ainult "500 000 SATS", ei saa te teha "700 000 SATS" suurust ostu.

### Vahetamine ja konsolideerimine Bitcoini tehingus

Bitcoini tehingu toimumist UTXOs võib seega võrrelda kuldmündi sulatamisega. Tegelikult ei ole UTXO jagatav, vaid ainult ühendatud. See tähendab, et kasutaja ei saa lihtsalt jagada teatud bitcoini kogust esindavat UTXO-d mitmeks väiksemaks UTXO-ks. Ta peab selle tehingu käigus täielikult ära tarbima, et luua väljundites üks või mitu uut UTXOd suvalise väärtusega, mis peavad olema väiksemad või võrdsed algväärtusega.

See mehhanism on sarnane kuldmündi omaga. Kujutage ette, et teil on 2 untsi suurune münt ja te soovite maksta 1 untsi eest, eeldades, et müüja ei saa teile vahetusraha anda. Peaksite oma mündi sulatama ja vermima 2 uut münti, millest kumbki on 1 unts.

Bitcoini puhul on toiming sarnane. Oletame, et Alice'il on UTXO 10 000 SATS ja ta soovib osta baguette'i, mis maksab 4000 SATS. Alice teeb tehingu, mille sisendiks on 1 UTXO väärtusega `10,000 SATS`, mille ta tarbib täielikult, ja väljundites loob ta 2 UTXO-d väärtusega `4,000 SATS` ja `6,000 SATS`. UTXO väärtusega `4,000 SATS` saadetakse pagarile baguette'i eest tasumiseks, samas kui UTXO väärtusega `6,000 SATS` jõuab tagasi Alice'ile vahetusena. Seda tehingu algsele saatjale tagastatavat UTXO-d nimetatakse Bitcoini žargoonis "vahetusrahaks".

Nüüd kujutage ette, et Alice'il ei ole mitte üks UTXO 10 000 SATS, vaid kaks UTXO-d 3000 SATS. Sellises olukorras ei ole ükski üksikutest UTXOdest piisav, et katta 4 000 SATSi eest baguette'i. Seetõttu peab Alice kasutama oma tehingu sisendina samaaegselt mõlemat UTXOd summas "3 000 SATS". Sel viisil jõuab kogusisend 6 000 SATSini, mis võimaldab tal katta pagarile 4000 SATSi suuruse makse. Seda meetodit, mis hõlmab mitmete UTXOde rühmitamist tehingu sisenditeks, nimetatakse sageli "konsolideerimiseks".

### Tehingutasud

Intuitiivselt võiks arvata, et ka tehingutasu on tehingu väljund. Kuid tegelikkuses ei ole see nii. Tehingutasud kujutavad endast sisendite ja väljundite kogusumma vahet. See tähendab, et pärast seda, kui osa sisendite väärtusest on kasutatud tehingu soovitud väljundite katmiseks, jääb teatav summa sisenditest kasutamata. See ülejäänud summa moodustab tehingutasu.

```plaintext
Commissioni = input totali - output totali
```

Tuleme tagasi Alice'i näite juurde, kelle UTXO on 10 000 SATS ja kes soovib osta baguette'i 4000 SATS eest. Alice loob tehingu, mille sisendiks on tema UTXO 10 000 SATS. Seejärel genereerib ta väljundiks 4 000 SATS, mis on mõeldud pagarile pagari eest maksmiseks. Et julgustada kaevandajaid tema tehingut plokki lisama, määrab Alice komisjonitasuks 200 SATS. Seejuures loob ta teise toodangu, mis on talle tagastatav jääk ja mille suurus on `5,800 SATS`.

Kohaldades komisjonitasu valemit, näeme, et kaevuritele on jäänud "200 SATSi":

```plaintext
Commissioni = input totali - output totali
Spese = 10.000 - (4.000 + 5.800)
Spese = 10.000 - 9.800
Spese = 200
```

Kui kaevandaja kinnitab edukalt ploki, on tal õigus koguda neid tasusid kõigi oma plokis sisalduvate tehingute eest nn coinbase'i tehingu kaudu.

### UTXO loomine Bitcoini kohta

Kui olete eelmisi lõike hoolikalt jälginud, siis teate nüüd, et UTXOsid saab luua ainult teisi olemasolevaid UTXOsid tarbides. Seega moodustavad Bitcoini mündid pideva ahela. Te võite aga küsida, kuidas tekkisid selles ahelas esimesed UTXOd. See tõstatab sarnase probleemi nagu kana ja muna: kust need algsed UTXO-d pärit on?

Vastus peitub **coinbase'i tehingus**.

Coinbase on teatud tüüpi Bitcoini tehing, mis on igas plokis ainulaadne ja alati esimene. See võimaldab kaevandajal, kes on leidnud kehtiva töötõendi, saada oma ploki tasu. See tasu koosneb kahest elemendist: **plokktoetus** ja **tehingutasu**, mida käsitleti eelmises osas.

Coinbase'i tehingu unikaalne omadus on see, et see on ainus, mis suudab luua bitcoin'e tühjalt kohalt, ilma et oleks vaja tarbida sisendeid oma väljundite genereerimiseks. Need äsja loodud bitcoinid moodustavad selle, mida võiks nimetada "algseteks UTXOdeks"

Blokkrahadest saadud bitcoinid on uued BTC-d, mis luuakse õhust, järgides konsensuse reeglites etteantud emissiooniplaani. Plokkide toetus vähendatakse poole võrra iga 210 000 ploki järel, umbes iga nelja aasta tagant, protsessis, mida nimetatakse "poolitamiseks" Esialgu loodi 50 bitcoin'i ühe plokkitoetuse kohta, kuid see summa on järk-järgult vähenenud; praegu on see 3 125 bitcoin'i ühe ploki kohta.

Mis puutub tehingutasu osasse, siis kuigi see kujutab endast vastloodud BTC-d, ei tohi need ületada kõigi ploki tehingute sisendite ja väljundite kogusumma erinevust. Nägime varem, et need tasud esindavad sisendite osa, mida ei kasutata tehingute väljundites. See osa on tehniliselt "kadunud" tehingu käigus ja kaevandajal on õigus see väärtus ühe või mitme uue UTXO kujul uuesti luua. Seega on tegemist väärtuse ülekandmisega tehingu saatjalt kaevandajale, kes lisab selle plokiahelasse.

**> Kas teadsid?** Coinbase'i tehingust genereeritud bitcoinide suhtes kehtib 100 bloki küpsemisperiood, mille jooksul kaevandaja ei saa neid kulutada. Selle reegli eesmärk on vältida komplikatsioone, mis on seotud äsja loodud bitcoinide kasutamisega ahelas, mis võib hiljem vananeda.

### UTXO mudeli mõju

Esiteks mõjutab UTXO mudel otseselt Bitcoini tehingutasusid. Kuna iga ploki mahutavus on piiratud, eelistavad kaevandajad tehinguid, mis pakuvad parimaid tasusid võrreldes plokis hõivatud kohaga. Mida rohkem UTXO-d sisaldab tehing sisendiks ja väljundiks, seda raskem on see ja nõuab seega kõrgemaid tasusid. See on üks põhjusi, miks sageli püütakse vähendada UTXOde arvu meie portfellis, mis võib mõjutada ka privaatsust, teemat, mida uurime üksikasjalikult selle koolituse kolmandas osas.

Nagu eelmistes osades mainitud, on Bitcoini mündid sisuliselt UTXOde ahel. Seega loob iga tehing seose ühe eelmise UTXO ja ühe tulevase UTXO vahel. UTXOd võimaldavad seega jälgida bitcoinide teekonda alates nende loomisest kuni nende praeguse kulutamiseni. Sellist läbipaistvust võib pidada positiivseks, sest see võimaldab igal kasutajal tagada saadud bitcoinide autentsuse. Sellele jälgitavuse ja kontrollitavuse põhimõttele tugineb aga ka ahelate analüüs, mis on mõeldud teie privaatsuse kahjustamiseks. Seda praktikat uurime põhjalikult koolituse teises osas.

## Bitcoini privaatsusmudel

<chapterId>769d8963-3ed5-4094-b21d-9203c7d9e465</chapterId>

### Valuuta: Autentsus, terviklikkus ja topeltkulutused: autentsus, terviklikkus ja topeltkulutused

Üks valuuta funktsioonidest on lahendada vajaduste kahekordse kokkulangevuse probleem. Vahetuskaubandusel põhinevas süsteemis on vaja mitte ainult leida isik, kes pakub minu vajadust rahuldavat kaupa, vaid ka pakkuda talle samaväärse väärtusega kaupa, mis rahuldab tema vajadust. Selle tasakaalu leidmine osutub keeruliseks.

Seetõttu kasutatakse valuutat, mis võimaldab väärtuse ülekandmist nii ruumis kui ka ajas.

Valuuta probleemi lahendamiseks on oluline, et kaupa või teenust pakkuv osapool oleks veendunud, et ta suudab hiljem selle summa ära kulutada. Seetõttu tagab iga ratsionaalne inimene, kes soovib võtta vastu mingi valuuta, olgu see siis digitaalne või füüsiline, et see vastab kahele põhikriteeriumile:


- Mündi peab olema puutumatu ja ehtne;**- **ja seda ei tohi kulutada kaks korda

Füüsilise raha kasutamisel on esimene omadus kõige keerulisem kinnitada. Erinevatel ajaloolistel perioodidel on metallmüntide puutumatust sageli kahjustatud näiteks lõikamise või löömise teel. Näiteks antiik-Rooma ajal oli tavaline, et kodanikud kraapisid kuldmüntide servi, et koguda osa väärismetallist, säilitades neid samal ajal tulevaste tehingute jaoks. Nii vähendati mündi sisemist väärtust, kuid selle nimiväärtus jäi samaks. See on tähelepanuväärne põhjus, miks hiljem mündi servale hakati vermima triipe.

Autentsust on raske kontrollida ka füüsiliste rahaliste vahenditega. Tänapäeval on võltsimise vastu võitlemise meetodid üha keerulisemad, mis sunnib kaupmehi investeerima kallidesse kontrollsüsteemidesse.

Teisest küljest ei ole füüsiliste valuutade puhul nende olemuse tõttu topeltmaksed probleemiks. Kui ma annan teile 10-eurose pangatähe, läheb see minu valdusest pöördumatult teie valdusesse, mis loomulikult välistab võimaluse kulutada samu rahaühikuid mitu korda. Lühidalt öeldes ei saa ma seda 10-eurost rahatähte enam kulutada.

Digitaalse valuuta puhul on raskused teised. Mündi ehtsuse ja terviklikkuse tagamine on sageli lihtsam. Nagu nägime eelmises punktis, võimaldab Bitcoini UTXO-mudel jälgida mündi päritolu ja seega kontrollida, et see on tõepoolest loodud konsensuse reeglite kohaselt kaevandaja poolt.

Topeltmaksete puudumise tagamine on aga keerulisem, sest iga digitaalne kaup on sisuliselt teave. Erinevalt füüsilistest kaupadest ei jagune teave vahetuse käigus, vaid levib mitmekordistumise teel. Näiteks kui ma saadan teile dokumendi e-postiga, siis see dubleerub. Te omalt poolt ei saa kindlalt kontrollida, kas ma olen originaaldokumendi kustutanud.

### Bitcoini topeltmaksete vältimine

Ainus viis vältida digitaalse vara dubleerimist on olla teadlik kõigist süsteemis toimuvatest vahetustest. Nii saate teada, kellele mis kuulub, ja ajakohastada igaühe omandiõigust tehtud tehingute põhjal. Seda tehakse näiteks pangasüsteemis käsikirjalise rahaga. Kui te maksate kaupmehele krediitkaardiga 10 eurot, registreerib pank selle vahetuse ja ajakohastab pearaamatu.

Bitcoini puhul toimub topeltmaksete vältimine samamoodi. Eesmärgiks on kinnitada, et ei ole toimunud tehingut, mille käigus on juba kulutatud asjaomased mündid. Kui neid münte ei ole kunagi kasutatud, siis võime olla kindlad, et topeltmakset ei toimu. Seda põhimõtet kirjeldas Satoshi Nakamoto valges raamatus selle kuulsa lausega:

**"Ainus viis kinnitada tehingu puudumist on olla teadlik kõigist tehingutest." **

Erinevalt pangandusmudelist ei ole aga soovi Bitcoini puhul usaldada keskset üksust. On vaja, et kõik kasutajad saaksid seda topeltmaksete puudumist kinnitada, ilma et nad peaksid toetuma kolmandale osapoolele. Seetõttu peavad kõik olema teadlikud kõigist Bitcoini tehingutest. Seepärast edastatakse Bitcoini tehingud avalikult kõigis võrgu sõlmedes ja salvestatakse plokiahelas lihtsas tekstis.

Just selline teabe avalik levitamine muudab Bitcoini privaatsuse kaitse keeruliseks. Traditsioonilises pangandussüsteemis on tehtud tehingutest teoorias teadlik ainult finantsasutus. Bitcoinis seevastu on kõik kasutajad oma sõlmede kaudu kõigist tehingutest informeeritud.

### Privaatsusmudel: pangandussüsteem vs. Bitcoin

Traditsioonilises süsteemis on teie pangakonto seotud teie identiteediga. Pankur on võimeline teadma, milline klient millisele pangakontole kuulub ja millised tehingud on sellega seotud. See teabevoog on aga panga ja avalikkuse vahel katkenud. Teisisõnu, teisele isikule kuuluva pangakonto saldot ja tehinguid ei ole võimalik teada saada. Ainult pangal on juurdepääs sellele teabele.

Näiteks teab teie pankur, et te ostate igal hommikul naabruses asuvast pagariärist baguette'i, kuid teie naaber ei tea sellest tehingust. Seega on infovoog huvitatud isikutele, eelkõige pangale, kättesaadav, kuid jääb kõrvalistele isikutele kättesaamatuks.

Eelmises osas kirjeldatud tehingute avaliku levitamise piirangu tõttu ei saa Bitcoini privaatsusmudel järgida pangandussüsteemi mudelit. Kuna Bitcoini puhul ei saa teabevoolu katkestada tehingute ja avalikkuse vahel, põhineb **privaatsusmudel kasutaja identiteedi ja tehingute endi** eraldamisel.

Näiteks kui te ostate pagarilt BTC-ga makstes baguette'i, näeb teie naaber, kes omab oma täielikku sõlme, teie tehingu toimumist, nagu ta näeb ka kõiki teisi tehinguid süsteemis. Kui aga järgitakse privaatsuspõhimõtteid, ei tohiks nad seda konkreetset tehingut teie identiteediga siduda.

Kuid kuna Bitcoini tehingud on avalikustatud, on siiski võimalik luua nendevahelisi seoseid, et teha järeldusi asjaosaliste kohta. See tegevus moodustab isegi omaette eriala, mida nimetatakse "ahelaanalüüsiks" Kursuse järgmises osas kutsun teid üles uurima ahelaanalüüsi põhialuseid, et mõista, kuidas teie bitcoin'e jälgitakse, ja osata end paremini kaitsta.

# Ahelaanalüüsi mõistmine ja enda kaitsmine

<partId>4739371e-9fef-45b0-bcaa-b7a4df6b4470</partId>

## Mis on ahelanalüüs Bitcoini kohta?

<chapterId>7d198ba6-4af2-4f24-86cb-3c79cb25627e</chapterId>

### Määratlus ja toimimine

Ahelanalüüs on praktika, mis hõlmab kõiki meetodeid, mida kasutatakse bitcoinide liikumise jälgimiseks plokiahelas. Üldiselt põhineb ahelaanalüüs varasemate tehingute näidiste omaduste jälgimisel. Seejärel hõlmab see samade tunnuste tuvastamist tehingus, mida soovitakse analüüsida, ja usutavate tõlgenduste tuletamist. Seda probleemi lahendamise meetodit praktilisest lähenemisest lähtuvalt piisavalt hea lahenduse leidmiseks nimetatakse "heuristikaks"

Lihtsustamise eesmärgil toimub ahelanalüüs kolmes peamises etapis:

1. **Blokiahela jälgimine;**

2. **Tuvastage teadaolevad omadused;**

3. **Ettearvamuste dedutseerimine.**

Blockchaini analüüsi saab teha igaüks. Tehingute liikumise jälgimiseks ja oletuste tegemiseks piisab sellest, kui on juurdepääs plokiahela avalikule teabele täieliku sõlme kaudu. On olemas ka tasuta vahendeid, mis hõlbustavad seda analüüsi, näiteks veebisait [OXT.me](https://oxt.me/), mida uurime üksikasjalikult käesoleva osa kahes viimases peatükis. Peamine privaatsusrisk tuleneb siiski ettevõtetest, mis on spetsialiseerunud ahelate analüüsile. Need ettevõtted on viinud ahelanalüüsi tööstuslikule tasemele ja müüvad oma teenuseid finantsasutustele või valitsustele. Nendest ettevõtetest on Chainalysis ilmselt kõige tuntum.

### Ahelaanalüüsi eesmärgid

Üks ahelaanalüüsi eesmärk on grupeerida erinevaid tegevusi Bitcoinis, et teha kindlaks, milline kasutaja neid sooritas. Seejärel on võimalik püüda siduda see tegevuste kogum tegeliku identiteediga.

Tuletage meelde eelmist peatükki. Selgitasin, miks Bitcoini privaatsusmudel algselt põhines kasutajate identiteedi eraldamisel nende tehingutest. Seetõttu oleks ahvatlev arvata, et ahelasisene analüüs on kasutu, sest isegi kui saab rühmitada ahelasisesed tegevused, ei saa neid seostada tegeliku identiteediga.

Teoreetiliselt on see väide õige. Selle koolituse esimeses osas nägime, et UTXO tingimuste kehtestamiseks kasutatakse krüptograafilisi võtmepaare. Sisuliselt ei avalda need võtmepaarid mingit teavet nende omanike identiteedi kohta. Seega, isegi kui me suudame rühmitada erinevate võtmepaaridega seotud tegevusi, ei ütle see meile midagi nende tegevuste taga oleva üksuse kohta.

Praktiline tegelikkus on siiski palju keerulisem. On olemas hulk käitumisviise, mis ohustavad tegeliku identiteedi sidumist ahelas toimuvaga. Analüüsis nimetatakse seda sisenemispunktiks ja neid on palju.

Kõige tavalisem on muidugi KYC (_Know Your Customer_). Kui te võtate oma bitcoinid välja reguleeritud platvormilt ühele oma isiklikule vastuvõtuaadressile, siis on mõned inimesed võimelised teie identiteeti selle aadressiga seostama. Üldisemalt võib sisenemiskohaks olla igasugune suhtlus teie reaalse elu ja bitcoin-tehingu vahel. Näiteks kui te avaldate vastuvõtuaadressi oma suhtlusvõrgustikes, võib see olla sisenemispunktiks analüüsiks. Kui teete oma pagarile bitcoin-makse, võivad nad seostada teie näo (mis on osa teie identiteedist) Bitcoin-aadressiga.

Need sisenemiskohad on Bitcoini kasutamisel peaaegu vältimatud. Kuigi võite püüda nende ulatust piirata, jäävad nad siiski alles. Seetõttu on väga oluline kombineerida meetodeid, mille eesmärk on teie privaatsuse säilitamine. Kuigi teie tegeliku identiteedi ja tehingute eraldamine on atraktiivne lähenemisviis, jääb see tänapäeval ebapiisavaks. Tõepoolest, kui kõik teie ahelasisesed tegevused saab rühmitada kokku, siis on tõenäoline, et vähimgi sisenemiskoht ohustab teie kehtestatud privaatsuse ühe kihi.

### Kaitsmine ahelanalüüsi vastu

Seetõttu on vaja ka Bitcoini kasutamisel tegeleda plokiahela analüüsiga. Selliselt toimides saame minimeerida meie tegevuse koondumist ja piirata sisenemispunkti mõju meie privaatsusele.

Tegelikult, et paremini võidelda plokiahela analüüsi vastu, mis oleks parem lähenemine kui tutvuda plokiahela analüüsis kasutatavate meetoditega? Kui soovite teada, kuidas parandada oma privaatsust Bitcoinis, peate neid meetodeid mõistma. See võimaldab teil paremini mõista selliseid tehnikaid nagu coinjoin või payjoin (tehnikaid, mida õpime koolituse lõpuosas) ja vähendada vigu, mida võite teha.

Selles kontekstis võime teha analoogia krüptograafia ja krüptoanalüüsiga. Hea krüptograaf on eelkõige hea krüptoanalüütik. Uue krüptograafilise algoritmi väljatöötamiseks on vaja teada, milliste rünnakutega see silmitsi seisab, ja uurida ka seda, miks eelmisi algoritme on häkitud. Sama põhimõte kehtib ka Bitcoini privaatsuse kohta. Plokiahela analüüsimeetodite mõistmine on selle vastu kaitsmise võti. Seepärast pakun selles koolituses välja terve plokiahela analüüsi käsitleva osa.

https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/fr/tutorials/privacy/on-chain/payjoin-848b6a23-deb2-4c5f-a27e-93e2f842140f
### Blockchaini analüüsi meetodid

Oluline on mõista, et plokiahela analüüs ei ole täpne teadus. See tugineb varasematest tähelepanekutest või loogilistest tõlgendustest tuletatud heuristikale. Need reeglid võimaldavad küllaltki usaldusväärseid tulemusi, kuid mitte kunagi absoluutse täpsusega. Teisisõnu, **plokiahelaanalüüs sisaldab alati tõenäosuse mõõdet väljastatud järeldustes**. Näiteks saab suurema või väiksema kindlusega hinnata, et kaks aadressi kuuluvad samale üksusele, kuid täielik kindlus on alati kättesaamatu.

Plokiahela analüüsi peamine eesmärk seisneb just erinevate heuristikate koondamises, et minimeerida veaohtu. Tegemist on teatud mõttes tõendite kogumisega, mis võimaldab meil tegelikkusele lähemale jõuda.

Need kuulsad heuristikud võib rühmitada mitmesse kategooriasse, mida me koos üksikasjalikult kirjeldame:


- Tehingumudelid (või tehingumudelid);**
- Tehingu sisemine heuristika;**
- Tehinguväline heuristika**

### Satoshi Nakamoto ja plokiahela analüüs

Tuleb märkida, et kaks esimest heuristikat ahelanalüüsi jaoks avastas Satoshi Nakamoto ise. Ta arutab neid Bitcoini valge raamatu 10. osas. Need on järgmised:


- ühine sisendomaduste heuristika (Common Input Property Heuristics, CIOH);
- ja aadresside korduvkasutamine.

![BTC204](assets/fr/031.webp)

Allikas: S. Nakamoto, "Bitcoin: Peer-to-Peer Electronic Cash System," https://bitcoin.org/bitcoin.pdf, 2009.

Järgmistes peatükkides uurime, mida see kõik tähendab, kuid juba praegu on huvitav märkida, et need kaks heuristikat on ahelanalüüsis endiselt tähtsal kohal.

## Tehingu mallid

<chapterId>d365a101-2d37-46a5-bfb9-3c51e37bf96b</chapterId>

Tehingumudel on lihtsalt tüüpilise tehingu üldine muster või struktuur, mida võib leida plokiahelas, mille tõlgendamine on eeldatavasti teada. Kui me uurime mustreid, keskendume ühele tehingule, mida analüüsime kõrgel tasemel.

Teisisõnu, me vaatame ainult UTXOde arvu sisendites ja UTXOde arvu väljundites, ilma et me peatuksime tehingu täpsematel üksikasjadel või keskkonnas. Jälgitud mustri põhjal saame tõlgendada tehingu olemust. Seejärel otsime selle struktuuris eripärasid ja järeldame tõlgenduse.

![BTC204](assets/it/32/01.webp)

Selles osas avastame koos peamised tehingumustrid, mida võib ahelanalüüsis kohata, ja iga mustri puhul annan teile selle struktuuri tõenäolise tõlgenduse koos konkreetse näitega.

### Lihtne saatmine (või lihtne maksmine)

Alustame väga populaarsest mudelist, sest see on see, mis esineb enamikus bitcoin-maksetes. Lihtsat maksemudelit iseloomustab see, et sisendites tarbitakse ühte või mitut UTXOd ja väljundites toodetakse 2 UTXOd. See mudel näeb seega välja järgmiselt:

![BTC204](assets/it/32/02.webp)

Kui me tuvastame selle tehingu struktuuri plokiahelas, saame juba teha tõlgenduse. Nagu nimigi ütleb, näitab see muster, et tegemist on saatmis- või maksetehinguga. Kasutaja on tarbinud oma UTXO-d sisendina, et rahuldada väljundis makse UTXO ja muutus UTXO (samale kasutajale tagastatud raha).

Seega teame, et vaadeldav kasutaja tõenäoliselt ei oma enam ühte kahest väljundi UTXOst (makse), kuid omab endiselt teist UTXOd (muutuse UTXO).

Praegu ei ole meil võimalik täpsustada, milline väljund esindab millist UTXO-d, sest see ei ole mudelite uurimise eesmärk. Me saavutame selle eesmärgi, tuginedes heuristikale, mida uurime järgmistes osades. Praeguses etapis piirdub meie eesmärk kõnealuse tehingu olemuse tuvastamisega, mis antud juhul on lihtne saatmine.

Näiteks siin on Bitcoini tehing, mis võtab vastu lihtsa saatmise mudeli:

```plaintext
b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769
```

![BTC204](assets/it/32/03.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769)

Pärast seda esimest näidet peaks teil olema parem arusaam sellest, mida tähendab "tehingumudeli" uurimine Me uurime tehingut, keskendudes ainult selle struktuurile, võtmata arvesse selle keskkonda või tehinguspetsiifilisi üksikasju. Selles esimeses etapis vaatleme seda ainult globaalselt.

Nüüd, kui te mõistate, mis on mudel, liigume edasi teiste olemasolevate mudelite juurde.

### Pühkimine

Seda teist mudelit iseloomustab see, et see tarbib sisendina ühte UTXO-d ja toodab väljundina ühte UTXO-d.

![BTC204](assets/it/32/04.webp)

Selle mudeli tõlgendus on, et tegemist on automaatse ülekandega. Kasutaja on oma bitcoinid üle kandnud iseendale, teisele talle kuuluvale aadressile. Kuna tehingus puudub jääk, on väga ebatõenäoline, et tegemist on maksega. Tegelikult on maksmise korral peaaegu võimatu, et maksja UTXO oleks täpselt sama suur kui müüja poolt nõutud summa, millele lisanduvad tehingutasud. Üldiselt on maksja seetõttu sunnitud tootma jääkväljundit.

Seega teame, et vaadeldav kasutaja on tõenäoliselt endiselt selle UTXO valduses. Kui me teame ahelanalüüsi kontekstis, et tehingus sisendina kasutatud UTXO kuulub Alice'ile, võime eeldada, et ka väljundis olev UTXO kuulub talle. Hiljem muutub huvitavaks leida tehingusiseseid heuristikatsioone, mis võivad seda eeldust tugevdada (neid heuristikatsioone uurime punktis 3.3).

Siin on näiteks Bitcoini tehing, mis võtab kasutusele pühkimismudeli:

```plaintext
35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d
```

![BTC204](assets/it/32/05.webp)

Allikas: [Mempool.space](https://mempool.space/fr/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d) Selline muster võib aga paljastada ka enda ülekande krüptovaluutavahetus platvormi kontole. See on teadaolevate aadresside uurimine ja tehingu kontekst, mis võimaldab meil teada saada, kas tegemist on konsolideerimisega isevahetusrahakotti või väljavõtmisega platvormile. Vahetusplatvormide aadressid on tõepoolest sageli kergesti tuvastatavad.

Tuleme tagasi Alice'i näite juurde: kui konsolideerimine viib tuntud platvormi (näiteks Binance'i) aadressile, võib see tähendada, et bitcoinid viidi Alice'i otsesest valdusest välja, tõenäoliselt kavatsusega neid müüa või hoiustada sellel platvormil. Teisalt, kui sihtaadress on tundmatu, on mõistlik eeldada, et tegemist on lihtsalt teise rahakotiga, mis kuulub endiselt Alice'ile. Kuid selline uuring kuulub pigem heuristika, mitte mustrite uurimise alla.

### Konsolideerimine

Sellele mudelile on iseloomulik, et see tarbib sisendina mitu UTXO-d ja toodab väljundina ühe UTXO-d.

![BTC204](assets/it/32/06.webp)

Selle mustri tõlgendus on see, et me oleme konsolideerumise ees. See on Bitcoini kasutajate seas tavaline tava, et nad ühendavad mitu UTXOd, et oodata võimalikku tehingutasude tõusu. Tehes selle operatsiooni ajal, mil tasud on madalad, on võimalik säästa tulevaste tasude pealt. Sellest tavast räägime lähemalt peatükis 4.3.

Me võime järeldada, et selle tehingumudeli taga olev kasutaja valdas tõenäoliselt kõiki sisend-TTXOsid ja valdab endiselt väljund-TTXOd. Tegemist on kindlasti automaatse ülekandega.

Nii nagu konsolideerimine, võib ka selline muster paljastada enese ülekandmist vahetusplatvormi kontole. See on teadaolevate aadresside uurimine ja tehingu kontekst, mis võimaldab meil teada saada, kas tegemist on konsolideerimisega enesehalduse rahakotti või väljavõtmisega platvormile.

Näiteks siin on Bitcoini tehing, mis võtab vastu konsolideerimisskeemi:

```plaintext
77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94
```

![BTC204](assets/it/32/07.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)

Ahelaanalüüsi kontekstis võib see mudel paljastada palju teavet. Näiteks kui me teame, et üks sisenditest kuulub Alice'ile, võime eeldada, et kõik teised selle tehingu sisendid ja väljundid kuuluvad talle. See eeldus võimaldab meil seejärel jälgida eelmisi tehinguahelaid, et leida ja analüüsida teisi tehinguid, mis tõenäoliselt on seotud Alice'iga.

![BTC204](assets/it/32/08.webp)

### Grupeeritud kulutused

Seda mudelit iseloomustab mõne UTXO tarbimine sisendina (sageli ainult üks) ja arvukate UTXOde tootmine väljundina.

![BTC204](assets/it/32/09.webp)

Selle mustri tõlgendus on, et tegemist on komplekteeritud kulutustega. See on tava, mis tõenäoliselt näitab märkimisväärset majandustegevust, näiteks vahetusplatvormi. Grupeeritud kulutused võimaldavad neil üksustel säästa tasude pealt, koondades oma kulutused ühte tehingusse.

Sellest mudelist võime järeldada, et UTXO sisend pärineb märkimisväärse majandustegevusega ettevõttest ja et UTXO väljundid hajuvad. Paljud neist kuuluvad ettevõtte klientidele, kes võtsid platvormilt bitcoin'e välja. Teised võivad minna partnerettevõtetele. Lõpuks on kindlasti üks või mitu vahetust, mis lähevad tagasi väljaandnud ettevõttele.

Siin on näiteks Bitcoini tehing, mis võtab kasutusele rühmitatud kulutuste mudeli (tõenäoliselt on tegemist Bybit platvormi poolt väljastatud tehinguga):

```plaintext
8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43
```

![BTC204](assets/it/32/10.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Protokolliga seotud tehingud

Tehingumustrite hulgas saame tuvastada ka mustreid, mis näitavad konkreetse protokolli kasutamist. Näiteks Whirlpool coinjoins (mida arutame 5. osas) on kergesti tuvastatav struktuur, mis võimaldab neid eristada teistest traditsioonilisematest tehingutest.

![BTC204](assets/it/32/11.webp)

Selle mustri analüüs viitab sellele, et tõenäoliselt on tegemist koostööga. Samuti on võimalik täheldada kaasühendust. Kui viimane hüpotees osutub õigeks, siis võib väljundite arv anda meile ligikaudse hinnangu coinjoin'is osalejate arvu kohta.

Siin on näiteks Bitcoini tehing, mis võtab kasutusele coinjoin'i ühistehingu tüüpi mudeli:

```plaintext
00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea
```

![BTC204](assets/it/32/12.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)

On palju teisi protokolle, millel on oma spetsiifilised struktuurid. Nii võiksime näiteks eristada Wabisabi tüüpi tehinguid, Stamps tehinguid või isegi Runes'i tehinguid.

Tänu nendele tehingumudelitele saame me juba tõlgendada teatavat teavet konkreetse tehingu kohta. Kuid tehingu struktuur ei ole ainus teabeallikas, mida analüüsida. Me saame uurida ka selle üksikasju. Neid tehingusiseseid üksikasju nimetan ma "sisemisteks heuristikateks" ja me uurime neid järgmises peatükis.

## Sisemine heuristika

<chapterId>c54b5abe-872f-40f4-a0d0-c59faff228ba</chapterId>

Sisemine heuristika on konkreetne tunnusjoon, mis on tuvastatud tehingus endas, ilma et oleks vaja uurida selle keskkonda, mis võimaldab meil teha järeldusi. Erinevalt mudelitest, mis keskenduvad tehingu üldisele struktuurile kõrgel tasemel, põhinevad sisemised heuristikud ekstraheeritavate andmete kogumil. See hõlmab järgmist:


- Erinevate UTXOde sisse- ja väljamineku kogused;
- Kõik, mis puudutab skripte: aadresside vastuvõtmine, versioonimine, lukuaeg jne.

Üldiselt võimaldab selline heuristika tuvastada konkreetse tehingu ülejäänu. Seda tehes saame seejärel jätkata üksuse jälgimist mitme tehingu jooksul. Kui me tuvastame UTXO, mis kuulub kasutajale, keda me tahame jälgida, siis on väga oluline kindlaks teha, millised väljundid on tehingu tegemisel üle antud teisele kasutajale ja millised väljundid kujutavad endast jääki, mis jääb seega tema valdusesse.

![BTC204](assets/it/33/01.webp)

Tuletan veelkord meelde, et need heuristikud ei ole mingil juhul täpsed. Üksikult võttes võimaldavad nad meil ainult tuvastada usutavaid stsenaariume. Just erinevate heuristikate kogunemine aitab vähendada ebakindlust, kuid ei kõrvalda seda kunagi täielikult.

### Sisemine sarnasus

See heuristika hõlmab sama tehingu sisendite ja väljundite sarnasuste uurimist. Kui me täheldame sama tunnust tehingu sisenditel ja ainult ühel väljundil, siis on tõenäoline, et see väljund moodustab ülejäänud osa.

Kõige ilmsem omadus on vastuvõtva aadressi korduvkasutamine samas tehingus.

![BTC204](assets/it/33/02.webp)

See heuristika jätab vähe ruumi kahtlustele. Välja arvatud juhul, kui isiku privaatne võti on häkitud, paljastab sama vastuvõtuaadress paratamatult ühe kasutaja tegevuse. Sellest tulenev tõlgendus on, et ülejäänud tehing on väljund sama aadressiga kui sisend. See võimaldab isiku pidevat jälgimist selle ülejäänu põhjal.

Siin on näiteks üks tehing, mille puhul saab seda heuristikat mõistlikult rakendada:

```plaintext
54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0
```

![BTC204](assets/fr/046.webp)

Fonte: [Mempool.space](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Need sarnasused sisendi ja väljundi vahel ei lõpe aadressi korduvkasutamisega. Igasugune sarnasus skriptide kasutamisel võib võimaldada heuristikate rakendamist. Näiteks võib mõnikord täheldada sama versioonimist sisendi ja ühe tehingu väljundi vahel.

![BTC204](assets/it/33/04.webp)

Sellel diagrammil näeme, et sisend nr 0 avab P2WPKH skripti (SegWit V0, mis algab `bc1q`). Väljund nr 0 kasutab sama tüüpi skripti. Väljund nr 1 kasutab aga P2TR-skripti (SegWit V1, mis algab numbriga `bc1p`). Selle tunnuse tõlgendus on see, et tõenäoliselt on ülejäänud aadressiks sama versiooniga aadress, mis on sisendil. Seega kuuluks see ikkagi samale kasutajale.

Siin on üks tehing, mille puhul seda heuristikat saab mõistlikult rakendada:

```plaintext
db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578
```

![BTC204](assets/fr/048.webp)

Fonte: [Mempool.space](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)

Antud juhul näeme, et sisend nr 0 ja väljund nr 1 kasutavad P2WPKH skripte (SegWit V0), samas kui väljund nr 0 kasutab teist tüüpi skripte, P2PKH (Legacy). 2010. aastate alguses oli see skripti versioonil põhinev heuristika suhteliselt vähe kasulik, sest olemasolevad skripti tüübid olid piiratud. Aja jooksul ja Bitcoini hilisemate uuendustega on aga kasutusele võetud üha rohkem erinevaid skripttüüpe. See heuristika muutub üha asjakohasemaks, sest skripttüüpide suurema hulga puhul jagunevad kasutajad väiksemateks rühmadeks, mis suurendab selle sisemise versiooni taaskasutamise heuristika rakendamise võimalusi. Seetõttu on juba ainuüksi privaatsuse seisukohast soovitatav valida kõige levinum skripttüüp. Näiteks, kui ma neid ridu kirjutan, kasutatakse Taproot-skripte (`bc1p`) harvemini kui SegWit V0-skripte (`bc1q`). Kuigi esimesed pakuvad teatud spetsiifilistes kontekstides majanduslikke ja privaatsuse eeliseid, võib traditsioonilisemate ühe allkirja kasutusalade puhul olla mõistlik jääda privaatsuse huvides vanema standardi juurde, kuni uus standard on laialdasemalt kasutusele võetud.

### Ümardatud arvudega maksed

Teine sisemine heuristika, mis võib aidata meil kindlaks teha jäägi, on ümardatud arvu puhul. Üldiselt, kui lihtsa makseskeemiga (1 sisend ja 2 väljundit) silmitsi seistes, siis kui üks väljunditest kulutab ümardatud summa, siis kujutab see endast makset.

![BTC204](assets/it/33/06.webp)

Kui üks väljund kujutab endast makset, siis teine kujutab endast muutust. Seega võib järeldada, et tõenäoliselt on tehingu sisestanud kasutaja endiselt valduses väljund, mis on identifitseeritud kui muutus.

Tuleb märkida, et see heuristika ei ole alati kohaldatav, sest enamik makseid tehakse ikka veel fiat-valuutaühikutes. Tegelikult, kui kaupmees Prantsusmaal aktsepteerib bitcoin'e, ei näita ta tavaliselt stabiilset hinda satsides. Ta valib pigem eurodes väljendatud hinna ja bitcoinis makstava summa ümberarvestuse. Seetõttu ei tohiks tehingu väljundis olla ümardatud numbrit.

Analüütik võib siiski üritada seda ümberarvestust teha, võttes arvesse tehingu võrgu kaudu edastamise ajal kehtinud vahetuskurssi. Võtame näiteks tehingu, mille sisendiks on "97,552 sats" ja kaks väljundit, millest üks on "31,085 sats" ja teine "64,152 sats". Esmapilgul ei tundu, et see tehing sisaldaks ümardatud summasid. Kui aga kohaldada tehingu toimumise ajal kehtinud vahetuskurssi 64,339 eurot, saame eurodeks ümberarvestuse, mis näeb välja järgmiselt:


- Sissemakse 62,76 eurot;
- Väljund 20 eurot;
- Väljund 41,27 eurot.

Kui see tehing on konverteeritud fiat-valuutaks, võimaldab see tehing kohaldada ümardatud summadega maksete heuristikat. Väljund 20 eurot oli tõenäoliselt mõeldud kaupmehele või muudeti muul viisil omanikku. Järelikult jäi 41,27 euro suurune väljund tõenäoliselt algse kasutaja valdusesse.

![BTC204](assets/it/33/07.webp)

Kui ühel päeval muutub Bitcoin meie tehingute eelistatud arvestusühikuks, võib see heuristika muutuda analüüsiks veelgi kasulikumaks.

Siin on näiteks üks tehing, mille puhul seda heuristikat võib tõenäoliselt rakendada:

```plaintext
2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a
```

![BTC204](assets/fr/051.webp)

Fonte: [Mempool.space](https://mempool.space/tx/2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a)

### Suurim väljund

Kui tehingu kahe väljundi vahel on lihtsa maksemudeli puhul märkimisväärselt suur erinevus, võib hinnata, et suurem väljund on tõenäoliselt jääk.

![BTC204](assets/it/33/09.webp)

See suurim väljundheuristik on tõenäoliselt kõige ebatäpsem kõigist. Kui see tuvastatakse üksi, on see üsna nõrk. Siiski saab seda omadust kombineerida teiste heuristikaga, et vähendada meie tõlgenduse ebakindlust.

Näiteks kui me uurime tehingut, mille üks väljund on ümmarguse summaga ja teine väljund suurema summaga, võimaldab ümmarguste maksete heuristikate ja suurema väljundiga seotud heuristikate ühine rakendamine vähendada meie ebakindluse taset.

Siin on näiteks üks tehing, mille puhul seda heuristikat võib tõenäoliselt rakendada:

```plaintext
b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf
```

![BTC204](assets/fr/053.webp)

Fonte: [Mempool.space](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Väline heuristika

<chapterId>4a170e3b-200d-431a-8285-18a23ff617ba</chapterId>

Välise heuristika uurimine hõlmab teatud elementide sarnasuste, mustrite ja omaduste analüüsimist, mis ei ole tehingu enda sisemised. Teisisõnu, kui varem piirdusime tehingule omaste elementide ärakasutamisega sisemise heuristikaga, siis nüüd laiendame oma analüüsi valdkonda tehingu keskkonnale välise heuristika abil.

### Aadresside korduvkasutamine

See on Bitcoini entusiastide seas üks tuntumaid heuristikuid. Aadressi korduvkasutamine võimaldab luua ühenduse erinevate tehingute ja erinevate UTXOde vahel. Seda täheldatakse, kui Bitcoini vastuvõtuaadressi kasutatakse mitu korda.

Seega on võimalik kasutada aadressi korduvkasutamist sama tehingu sees sisemise heuristikana, et tuvastada ülejäänud (nagu nägime eelmises peatükis). Kuid aadressi korduvkasutamine võib olla ka väline heuristika, et tuvastada üksuse ainulaadsust mitme tehingu taga.

Aadressi korduvkasutust tõlgendatakse nii, et kõik sellele aadressile lukustatud UTXOd kuuluvad (või on kuulunud) samale üksusele. See heuristika jätab vähe ruumi ebakindlusele. Kui seda on võimalik tuvastada, vastab järgnev tõlgendus kõige tõenäolisemalt tegelikkusele. Seega võimaldab see erinevate onchain-tegevuste rühmitamist.

![BTC204](assets/it/34/01.webp)

Nagu on selgitatud käesoleva 3. osa sissejuhatuses, avastas selle heuristika Satoshi Nakamoto ise. Valges raamatus mainib ta konkreetselt lahendust, kuidas kasutajad seda vältida, mis seisneb lihtsalt selles, et iga uue tehingu puhul tuleb kasutada uut aadressi:

"_A täiendava kaitsena võiks iga tehingu puhul kasutada uut võtmepaari, et vältida nende seostamist ühise omanikuga."

![BTC204](assets/fr/055.webp)

Allikas: S. Nakamoto, "Bitcoin: Peer-to-Peer Electronic Cash System," https://bitcoin.org/bitcoin.pdf, 2009.

Näiteks siin on aadress, mida kasutatakse korduvalt mitmes tehingus:

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

Allikas:[Mempool.space](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Skriptide sarnasus ja rahakottide sõrmejäljed

Lisaks aadresside korduvkasutamisele on olemas ka mitmeid muid heuristilisi meetodeid, mille abil saab aktsiaid siduda sama portfelliga või aadresside klastriga.

Esiteks saab analüütik ära kasutada sarnasusi skriptide kasutamisel. Näiteks on teatud vähemuste skriptid, näiteks multisig, kergemini tuvastatavad kui SegWit V0 skriptid. Mida suuremasse gruppi me end varjame, seda raskem on meid tuvastada. Seepärast kasutavad heades Coinjoin-protokollides kõik osalejad täpselt sama tüüpi skripte.

Üldisemalt võib analüütik keskenduda ka portfelli sõrmejälje omadustele. Need on konkreetsed kasutamisega seotud protsessid, mida võiks püüda tuvastada eesmärgiga kasutada neid jälgimisheuristikana. Teisisõnu, kui jälgitavale üksusele omistatud tehingute puhul täheldatakse samade sisemiste tunnuste kuhjumist, võib püüda tuvastada samu tunnuseid ka teiste tehingute puhul.

Näiteks on võimalik tuvastada, et jälgitav kasutaja saadab oma ülejäänu süstemaatiliselt P2TR-aadressidele (`bc1p...`). Kui see protsess kordub, saab seda kasutada heuristikana meie analüüsi jätkamisel. Võib kasutada ka muid sõrmejälgi, näiteks UTXOde järjekorda, jääkide paigutust väljundites, RBF (Replace-by-Fee) signalisatsiooni või isegi versiooni numbrit, `nSequence`-välja ja `nLockTime`-välja.

Nagu [@LaurentMT](https://twitter.com/LaurentMT) täpsustab [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (prantsuskeelne podcast), suureneb rahakoti sõrmejälgede kasulikkus ahela analüüsis aja jooksul märkimisväärselt. Tõepoolest, erinevusi rõhutavad skriptitüüpide arvu suurenemine ja nende uute võimaluste üha järkjärgulisem kasutuselevõtt rahakoti tarkvara poolt. Võib isegi juhtuda, et jälgitava üksuse poolt kasutatav tarkvara saab täpselt tuvastada. Seetõttu on oluline mõista, et rahakoti digitaalse jalajälje uurimine osutub eriti oluliseks hiljutiste tehingute puhul, rohkem kui 2010. aastate alguses algatatud tehingute puhul.

Kokkuvõttes võib sõrmejälg olla mis tahes konkreetne, rahakoti poolt automaatselt või kasutaja poolt käsitsi sooritatud tegevus, mida võib leida teistest tehingutest, et aidata meie analüüsil.

### Sisendite ühise omandiõiguse heuristika (CIOH)

CIOH (inglise keeles "Common Input Ownership Heuristic") on heuristika, mis väidab, et kui tehing sisaldab mitut sisendit, on tõenäoline, et need pärinevad ühelt üksuselt. Selle tulemusena on nende omandiõigus ühine.

Sisendite ühise omandiõiguse heuristika (Common Ownership Heuristics of Inputs, CIOH) kohaldamiseks vaatleme kõigepealt tehingut, millel on mitu sisendit. See võib olla minimaalselt 2 sisendit kuni maksimaalselt 30 sisendit. Kui see tunnus on tuvastatud, kontrollime, kas tehing ei sobi teadaoleva tehingumudeli alla. Näiteks kui sellel on 5 ligikaudu võrdse suurusega sisendit ja 5 täpselt sama suurusega väljundit, siis teame, et tegemist on coinjoin'i struktuuriga. Seetõttu ei saa me IOCH-i kohaldada.

Kui aga tehing ei sobi ühegi teadaoleva ühistehingu mudeliga, siis võime järeldada, et kõik sisendid pärinevad tõenäoliselt samast üksusest. See võib olla väga kasulik teadaoleva klastri laiendamiseks või jälgimise jätkamiseks.

CIOH avastas Satoshi Nakamoto. Ta arutab seda valge raamatu 10. osas:

"_[...] seos on vältimatu mitme sisendi tehingutega, mis ilmselgelt näitavad, et nende sisendid kuulusid ühele ja samale omanikule. Oht on selles, et kui võtme omanik paljastub, võivad lingid paljastada teised tehingud, mis kuulusid samale omanikule._"

Eriti põnev on märkida, et Satoshi Nakamoto oli juba enne Bitcoini ametlikku käivitamist tuvastanud kaks peamist kasutajate privaatsuse haavatavust, nimelt IOCH ja aadressi korduvkasutamine. Selline ennustus on üsna tähelepanuväärne, sest need kaks heuristikat on tänaseni kõige kasulikumad plokiahela analüüsis.

Näitena on siin üks tehing, mille puhul me saame tõenäoliselt kohaldada IOCHi:

```plaintext
20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712
```

Fonte: [Mempool.space](https://mempool.space/tx/20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712)

### Offchain andmed

Loomulikult ei piirdu ahelasisene analüüs ainult ahelasisestele andmetele. Analüüsi täpsustamiseks võib kasutada ka varasematest analüüsidest saadud või Internetis kättesaadavaid andmeid.

Näiteks kui täheldatakse, et jälgitavad tehingud edastatakse süstemaatiliselt samast Bitcoini sõlme ja selle IP-aadressi saab tuvastada, võib olla võimalik tuvastada teisi sama üksuse tehinguid ning määrata kindlaks osa saatja identiteedist. Kuigi seda praktikat ei ole lihtne teostada, kuna see nõuab paljude sõlmede toimimist, on võimalik, et mõned ahelate analüüsile spetsialiseerunud ettevõtted kasutavad seda.

Analüütikul on ka võimalus tugineda varem avaldatud analüüsidele või oma varasematele analüüsidele. Võib-olla võib leida väljundi, mis viitab juba tuvastatud aadressiklastrile. Mõnikord on võimalik tugineda ka väljundile, mis osutab vahetusplatvormile, mille aadressid on üldiselt teada.

Samamoodi võib teha analüüsi kõrvaldamise teel. Näiteks kui kahe väljundiga tehingu analüüsimisel on üks neist seotud juba teadaoleva, kuid jälgitavast üksusest erineva aadressikogumiga, siis võib tõlgendada, et teine väljund esindab tõenäoliselt ülejäänud üksust.

Ahelanalüüs hõlmab ka OSINT (_Open Source Intelligence_) osa, mis on veidi üldisemalt seotud internetiotsingutega. Seetõttu ei ole soovitatav otse sotsiaalmeedias või veebilehel pseudonüümi all või ilma pseudonüümita saamisaadresside avaldamine.

![BTC204](assets/fr/063.webp)

### Ajalised mustrid

Seda võetakse vähem arvesse, kuid teatud inimkäitumised on ahelas äratuntavad. Kõige kasulikum analüüsis võib olla teie magamisviis! Jah, kui sa magad, siis sa eeldatavasti ei edasta Bitcoini tehinguid. Kuna te üldiselt magate samadel aegadel, siis on ahelasiseses analüüsis tavaline kasutada ajalist analüüsi. See tähendab lihtsalt seda, et katalogiseeritakse ajad, mil konkreetse üksuse tehinguid Bitcoini võrku edastatakse. Nende ajaliste mustrite analüüsimine võimaldab palju teavet tuletada.

Kõigepealt tuvastab ajaline analüüs mõnikord jälgitava üksuse olemuse olemuse. Kui täheldatakse, et tehinguid edastatakse järjepidevalt 24 tunni jooksul, siis näitab see tugevat majandustegevust. Nende tehingute taga olev üksus on tõenäoliselt ettevõte, mis võib olla rahvusvaheline ja millel on võib-olla ettevõttesiseselt automatiseeritud menetlused.

Näiteks [olin selle mustri ära tundnud paar kuud tagasi](https://twitter.com/Loic_Pandul/status/1701127409712452072), analüüsides [tehingut, mille puhul oli ekslikult eraldatud 19 bitcoin'i tasud](https://mempool.space/tx/d5392d474b4c436e1c9d1f4ff4be5f5f9bb0eb2e26b61d2781751474b7e870fd). Lihtne ajaline analüüs oli võimaldanud mul oletada, et tegemist on automatiseeritud teenusega ja seega tõenäoliselt suure üksusega, näiteks vahetusplatvormiga.

Tegelikult selgus paar päeva hiljem, et raha kuulus Paxose vahetusplatvormi kaudu PayPalile.

Seevastu kui näeme, et ajamuster on pigem jaotunud 16 väga konkreetse tunni peale, siis võime hinnata, et tegemist on üksiku kasutajaga või ehk kohaliku ettevõttega, sõltuvalt kaubeldavatest mahtudest.

Lisaks vaadeldava üksuse olemusele võib ajaline mudel anda meile ka kasutaja ligikaudse asukoha ajavööndite kaudu. Seejärel saame seostada teisi tehinguid ja kasutada nende ajatemplite abil täiendavaid heuristilisi andmeid, mida saab meie analüüsile lisada.

Näiteks eespool mainitud korduvkasutatava aadressi puhul võime täheldada, et nii sissetulevad kui ka väljaminevad tehingud on koondunud 13-tunnisele ajavahemikule.

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

![BTC204](assets/fr/064.webp)

Allikas: OXT.me

See vahemik vastab tõenäoliselt Euroopale, Aafrikale või Lähis-Idale. Seega võime järeldada, et nende tehingute taga olev kasutaja elab seal.

Erinevas registris on ka selline ajaanalüüs, mis võimaldas oletada, et Satoshi Nakamoto ei tegutsenud mitte Jaapanist, vaid tegelikult Ameerika Ühendriikidest: [_The time-zones of Satoshi Nakamoto_](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

## Praktiline rakendus koos Block Exploreriga

<chapterId>6493cf2f-225c-405f-9375-c4304f1087ed</chapterId>

Selles viimases peatükis hakkame seni õpitud mõisteid konkreetselt rakendama. Esitan näiteid reaalsetest Bitcoini tehingutest ja teil tuleb minu poolt küsitud teave välja võtta.

Ideaaljuhul oleks nende harjutuste puhul soovitav kasutada professionaalset ahelaanalüüsi vahendit. Kuid pärast Samourai rahakoti loojate tegevuse lõpetamist ei ole ainus tasuta analüüsivahend OXT.me enam kättesaadav. Seetõttu valime nende harjutuste jaoks klassikalise plokkide uurija. Soovitan kasutada [Mempool.space](https://mempool.space/) selle paljude funktsioonide ja ahelate analüüsitööriistade valiku tõttu, kuid võite valida ka mõne muu exploreri, näiteks [Bitcoin Explorer](https://bitcoinexplorer.org/). Alustuseks tutvustan harjutusi. Kasutage nende täitmiseks oma plokkide ekspluateerija ja kirjutage oma vastused paberile. Seejärel annan selle peatüki lõpus vastused, et saaksite oma tulemusi kontrollida ja parandada.

_Tehingud, mis valiti nende jaoks välja, valiti üksnes nende omaduste tõttu mõnevõrra juhuslikult. See peatükk on mõeldud ainult hariduslikel ja informatiivsetel eesmärkidel. Tahan selgeks teha, et ma ei propageeri ega julgusta nende vahendite kasutamist pahatahtlikel eesmärkidel. Eesmärk on õpetada teid, kuidas kaitsta end ahelanalüüsi eest, mitte viia läbi analüüsi, et paljastada teiste inimeste privaatset teavet _

### Harjutus 1

Analüüsitava tehingu ID:

```plaintext
3769d3b124e47ef4ffb5b52d11df64b0a3f0b82bb10fd6b98c0fd5111789bef7
```

Milline on selle tehingu mudelinimi ja milliseid usutavaid tõlgendusi saab teha, kui uurida ainult selle mudelit, st tehingu struktuuri?

### Harjutus 2

Analüüsitava tehingu ID:

```plaintext
baa228f6859ca63e6b8eea24ffad7e871713749d693ebd85343859173b8d5c20
```

Milline on selle tehingu mudelinimi ja milliseid usutavaid tõlgendusi saab teha, kui uurida ainult selle mudelit, st tehingu struktuuri?

### Harjutus 3

Analüüsitava tehingu ID:

```plaintext
3a9eb9ccc3517cc25d1860924c66109262a4b68f4ed2d847f079b084da0cd32b
```

Milline on selle tehingu muster?

Pärast selle mudeli tuvastamist, kasutades tehingu sisemist heuristikat, millist väljundit esindab tõenäoliselt ülejäänud?

### Harjutus 4

Analüüsitava tehingu ID:

```plaintext
35f0b31c05503ebfdf7311df47f68a048e992e5cf4c97ec34aa2833cc0122a12
```

Milline on selle tehingu muster?

Pärast selle mudeli tuvastamist, kasutades tehingu sisemist heuristikat, millist väljundit esindab tõenäoliselt ülejäänud?

### Harjutus 5

Kujutage ette, et Loïc postitas ühe oma Bitcoini aadressi, et saada makseid sotsiaalvõrgustikus Twitter:

![BTC204](assets/fr/065.webp)

```plaintext
bc1qja0hycrv7g9ww00jcqanhfpqmzx7luqalum3vu
```

Kasutades **ainult aadressi taaskasutamise heuristikat**, milliseid Bitcoini tehinguid saame seostada Loïci identiteediga?

_Se on selge, et ma ei ole selle vastuvõtuaadressi tegelik omanik ja ma ei ole seda sotsiaalmeedias avaldanud. See on aadress, mille ma valisin juhuslikult plokiahelast._

### Harjutus 6

Pärast harjutust 5, kasutades aadressi taaskasutamise heuristikat, suutsite tuvastada mitu Bitcoini tehingut, milles Loïc näib olevat seotud. Tavaliselt oleksite tuvastatavate tehingute hulgast pidanud tuvastama selle ühe:

See tehing on esimene, mis saadab raha Loïci aadressile. Mis te arvate, kust Loïci poolt selle tehingu kaudu saadud bitcoinid pärinevad?

### Harjutus 7

Pärast harjutust 5, kasutades aadressi taaskasutamise heuristikat, suutsite tuvastada mitu Bitcoini tehingut, milles Loïc näib olevat seotud. Nüüd soovite teada saada, kust Loïc pärit on. Viige leitud tehingute põhjal läbi ajaanalüüs, et leida Loïci poolt tõenäoliselt kasutatud ajavöönd. Selle ajavööndi põhjal määrake kindlaks asukoht, kus Loïc näib elavat (riik, osariik/piirkond, linn...).

### Harjutus 8

Siin on Bitcoini tehing, mida uurida:

```plaintext
bb346dae645d09d32ed6eca1391d2ee97c57e11b4c31ae4325bcffdec40afd4f
```

Kui vaadata ainult seda tehingut, siis millist teavet saame tõlgendada?

### Harjutuste lahendused

**_Harjutus 1:_**

Selle tehingu mudel on lihtne makse. Kui me uurime ainult selle struktuuri, saame tõlgendada, et üks väljund kujutab muutust ja teine väljund kujutab tegelikku makset. Siis teame, et vaadeldav kasutaja ei oma tõenäoliselt enam ühte väljundite kahest UTXOst (makset tähistavat), kuid teine UTXO (muutust tähistav) on endiselt tema valduses.

**_Harjutus 2:_**

Selle tehingu puhul on tegemist partiide kaupa tehtavate kulutustega. See muster viitab tõenäoliselt olulisele majandustegevusele, näiteks vahetusplatvormile. Me võime järeldada, et sisendiks olev UTXO pärineb märkimisväärse majandustegevusega ettevõttest ja et väljundiks olev UTXO hajub. Osa neist kuulub ettevõtte klientidele, kes on oma bitcoinid välja võtnud isehoidvatesse rahakottidesse. Teised võivad minna partnerettevõtetele. Lõpuks jääb kindlasti ka ülejäänu, mis naaseb väljaandnud ettevõttele.

**_Harjutus 3:_**

Selle tehingu mudel on lihtne makse. Seetõttu võime kohaldada tehingu suhtes sisemist heuristikat, et püüda tuvastada ülejäänu.

Mina isiklikult olen tuvastanud vähemalt kaks sisemist heuristikat, mis toetavad sama hüpoteesi:


- Sama tüüpi käsikirja taaskasutamine;
- Suurim toodang.

Kõige ilmsem heuristika on sama tüüpi skriptide korduvkasutamine. Tegelikult on väljund `0` on `P2SH`, mis on äratuntav selle vastuvõtuaadressi järgi, mis algab `3`-ga:

```plaintext
3Lcdauq6eqCWwQ3UzgNb4cu9bs88sz3mKD
```

Samas kui väljund `1` on `P2WPKH`, mis on identifitseeritav selle aadressi järgi, mis algab `bc1q`:

```plaintext
bc1qya6sw6sta0mfr698n9jpd3j3nrkltdtwvelywa
```

UTXO, mida kasutatakse selle tehingu sisendina, kasutab samuti skripti `P2WPKH`:

```plaintext
bc1qyfuytw8pcvg5vx37kkgwjspg73rpt56l5mx89k
```

Seega võime eeldada, et väljund `0` vastab maksele ja väljund `1` on ülejäänud tehing, mis tähendab, et väljund `1` kuulub endiselt sisendkasutajale.

Selle hüpoteesi toetamiseks või ümberlükkamiseks võime otsida teisi heuristilisi tunnuseid, mis kinnitavad meie mõtlemist või vähendavad tõenäosust, et meie hüpotees on õige.

Olen tuvastanud vähemalt ühe teise heuristliku elemendi. See on suurim väljund. Väljund "0" mõõdab "123,689 sats", samas kui "1" väljund mõõdab "505,839 sats". Seega on nende kahe väljundi vahel märkimisväärne erinevus. Suurema väljundi heuristika näitab, et mahukam väljund on tõenäoliselt ülejäänu. See heuristika tugevdab seega veelgi meie esialgset hüpoteesi.

Tundub tõenäoline, et kasutaja, kes andis sisendi UTXO, omab endiselt väljundit `1`, mis näib esindavat ülejäänud tehingut.

**_Harjutus 4:_**

Selle tehingu mudel on lihtne makse. Seetõttu võime kohaldada tehingu suhtes sisemist heuristikat, et püüda tuvastada ülejäänu.

Olen isiklikult tuvastanud vähemalt kaks sisemist heuristikat, mis toetavad sama hüpoteesi:


- Sama tüüpi käsikirja taaskasutamine;
- Ümmarguse summa väljund.

Kõige ilmsem heuristika on sama tüüpi skriptide korduvkasutamine. Tegelikult on väljund `0` on `P2SH`, mis on äratuntav selle vastuvõtuaadressi järgi, mis algab `3`-ga:

```plaintext
3FSH5Mnq6S5FyQoKR9Yjakk3X4KCGxeaD4
```

Samas kui väljund `1` on `P2WPKH`, mis on identifitseeritav selle aadressi järgi, mis algab `bc1q`:

```plaintext
bc1qvdywdcfsyavt4v8uxmmrdt6meu4vgeg439n7sg
```

UTXO, mida kasutatakse selle tehingu sisendina, kasutab samuti skripti `P2WPKH`:

```plaintext
bc1qku3f2y294h3ks5eusv63dslcua2xnlzxx0k6kp
```

Seega võime eeldada, et väljund "0" vastab maksele ja väljund "1" on ülejäänud tehing, mis tähendab, et sisendkasutajal on endiselt väljund "1".

Selle hüpoteesi toetamiseks või ümberlükkamiseks võime otsida teisi heuristilisi tunnuseid, mis kinnitavad meie mõtlemist või vähendavad tõenäosust, et meie hüpotees on õige.

Olen tuvastanud vähemalt ühe teise heuristliku elemendi. See on ümmarguse summa väljund. Väljund `0` mõõdab `70,000 sats`, samas kui väljund `1` mõõdab `22,962 sats`. Seega on tegemist täiesti ümmarguse väljundiga BTC arvestusühikutes. Ümmarguse väljundi heuristika näitab, et UTXO ühe ümmarguse summaga on tõenäoliselt makse, ja kõrvaldamise teel kujutab teine summa ülejäänud summat. See heuristika tugevdab seega veelgi meie esialgset hüpoteesi.

Selle näite puhul võib aga veel üks heuristika meie esialgse eelduse kahtluse alla seada. Tegelikult on väljund "0" suurem kui väljund "1". Kui me lähtume heuristikast, et suurim väljund on tavaliselt jääk, võime järeldada, et väljund `0` on jääk. See vastuhüpotees tundub aga ebatõenäoline, kuna kaks muud heuristikat tunduvad oluliselt veenvamad kui suurima väljundi heuristika. Järelikult tundub mõistlik säilitada meie esialgne hüpotees vaatamata sellele ilmsele vastuolule.

Seetõttu tundub tõenäoline, et UTXO sisendiks andnud kasutaja käes on endiselt väljund "1", mis näib kujutavat endast ülejäänud tehingu osa.

**_Harjutus 5:_**

Näeme, et Loïci identiteediga saab seostada 8 tehingut. Neist 4 on seotud bitcoinide vastuvõtmisega:

```plaintext
2d9575553c99578268ffba49a1b2adc3b85a29926728bd0280703a04d051eace
8b70bd322e6118b8a002dbdb731d16b59c4a729c2379af376ae230cf8cdde0dd
d5864ea93e7a8db9d3fb113651d2131567e284e868021e114a67c3f5fb616ac4
bc4dcf2200c88ac1f976b8c9018ce70f9007e949435841fc5681fd33308dd762
```

Teised 4 on bitcoinide saatmise kohta:

```plaintext
8b52fe3c2cf8bef60828399d1c776c0e9e99e7aaeeff721fff70f4b68145d540
c12499e9a865b9e920012e39b4b9867ea821e44c047d022ebb5c9113f2910ed6
a6dbebebca119af3d05c0196b76f80fdbf78f20368ebef1b7fd3476d0814517d
3aeb7ce02c35eaecccc0a97a771d92c3e65e86bedff42a8185edd12ce89d89cc
```

**_Harjutus 6:_**

Kui me uurime selle tehingu mustrit, siis on ilmne, et tegemist on grupiviisiliste kuludega. Tegelikult on tehingul üks sisend ja 51 väljundit, mis viitab märkimisväärsele majandustegevusele. Seega võime oletada, et Loïc tegi bitcoini väljavõtte vahetusplatvormilt.

Seda hüpoteesi kinnitavad mitmed elemendid. Esiteks on UTXO sisendi kaitsmiseks kasutatav skript tüüp P2SH multisig 2/3 skript, mis viitab vahetusplatvormidele iseloomulikule kõrgetasemelisele turvalisusele:

```plaintext
OP_PUSHNUM_2
OP_PUSHBYTES_33 03eae02975918af86577e1d8a257773118fd6ceaf43f1a543a4a04a410e9af4a59
OP_PUSHBYTES_33 03ba37b6c04aaf7099edc389e22eeb5eae643ce0ab89ac5afa4fb934f575f24b4e
OP_PUSHBYTES_33 03d95ef2dc0749859929f3ed4aa5668c7a95baa47133d3abec25896411321d2d2d
OP_PUSHNUM_3
OP_CHECKMULTISIG
```

Lisaks kasutati analüüsitud aadressi `3PUv9tQMSDCEPSMsYSopA5wDW86pwRFbNF` enam kui 220 000 erinevas tehingus, mis on sageli iseloomulik vahetusplatvormidele, mis üldiselt ei hooli oma privaatsusest. Selle aadressi suhtes kohaldatud ajaline heuristika näitab samuti tehingute regulaarset levikut peaaegu iga päev kolme kuu jooksul, kusjuures pikemad tunnid on üle 24 tunni, mis viitab vahetusplatvormi pidevale tegevusele.

Lõpuks on selle üksuse poolt töödeldavad mahud tohutud. Tegelikult sai ja saatis aadress 2022. aasta detsembrist kuni 2023. aasta märtsini 222 262 tehingu jooksul 44 BTC. Need märkimisväärsed mahud kinnitavad veelgi vahetusplatvormi tegevuse tõenäolist olemust.

**_Harjutus 7:_**

Analüüsides tehingu kinnitamise aega, on näha järgmised UTC-ajad:

```plaintext
05:43
20:51
18:12
17:16
04:28
23:38
07:45
21:55
```

Neid kellaaegu analüüsides selgub, et UTC-7 ja UTC-8 ajavööndid on enamiku aegade puhul kooskõlas tavaliste inimtegevuste vahemikuga (vahemikus 8.00-23.00):

```plaintext
05:43 UTC > 22:43 UTC-7
20:51 UTC > 13:51 UTC-7
18:12 UTC > 11:12 UTC-7
17:16 UTC > 10:16 UTC-7
04:28 UTC > 21:28 UTC-7
23:38 UTC > 16:38 UTC-7
07:45 UTC > 00:45 UTC-7
21:55 UTC > 14:55 UTC-7
05:43 UTC > 21:43 UTC-8
20:51 UTC > 12:51 UTC-8
18:12 UTC > 10:12 UTC-8
17:16 UTC > 09:16 UTC-8
04:28 UTC > 20:28 UTC-8
23:38 UTC > 15:38 UTC-8
07:45 UTC > 23:45 UTC-8
21:55 UTC > 13:55 UTC-8
```

UTC-7 ajavöönd on eriti oluline suvel, kuna see hõlmab selliseid riike ja piirkondi nagu:


- California (sellised linnad nagu Los Angeles, San Francisco ja San Diego);
- Nevada (koos Las Vegasiga);
- Oregon (koos Portlandiga);
- Washington (koos Seattle'iga);
- Kanada piirkond British Columbia (kus asuvad sellised linnad nagu Vancouver ja Victoria).

Selle teabe põhjal võib oletada, et Loïc võib elada Ameerika Ühendriikide läänerannikul või Kanadas.

**_Harjutus 8:_**

Selle tehingu analüüs näitab 5 sisendit ja ühte väljundit, mis näib viitavat konsolideerimisele. CIOH heuristika rakendamine näitab, et kõik sisendite UTXOd kuuluvad ühele üksusele ja et ka väljundis olev UTXO kuulub sellele üksusele. Tundub, et kasutaja otsustas koondada mitu talle kuuluvat UTXOd üheks UTXOks väljundis, eesmärgiga konsolideerida oma münte. Seda lähenemisviisi ajendas tõenäoliselt soov kasutada ära praeguseid madalaid tehingutasusid, et vähendada tulevasi tasusid.

---
_Käesoleva 3. osa kirjutamisel ahelanalüüsi kohta tuginesin järgmistele allikatele:_


- _Nelja artikli seeria pealkirjaga: [Understanding Bitcoin Privacy with OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923), toodetud Samourai rahakoti poolt 2021;_
- [OXT Research] (https://medium.com/oxt-research) erinevad aruanded, samuti nende tasuta ahelate analüüsi tööriist (mis ei ole praegu pärast Samourai rahakoti asutajate vahistamist enam kättesaadav);_
- _Üldisemalt pärinevad minu teadmised [@LaurentMT](https://twitter.com/LaurentMT) ja [@ErgoBTC](https://twitter.com/ErgoBTC) erinevatest tweettidest ja sisust;_
- \_The [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji), milles osalesin koos [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene\_\_\_](https://twitter.com/Sosthene___) ja [@LaurentMT](https://twitter.com/LaurentMT).\_

ma soovin tänada nende autoreid, arendajaid ja tootjaid. Tänan ka retsensente, kes parandasid põhjalikult artikli, mis oli selle 3. osa aluseks, ja austasid mind oma asjatundlike nõuannetega:_


- _[Gilles Cadignan](https://twitter.com/gillesCadignan);_
- _[Ludovic Lars](https://viresinnumeris.fr/)._

# Parimate tavade omandamine teie eraelu puutumatuse kaitsmiseks

<partId>9bd04b63-f1af-4e50-9061-6bc90009df68</partId>

## Aadresside korduvkasutamine

<chapterId>f3e97645-3df3-41bc-a4ed-d2c740113d96</chapterId>

Olles uurinud meetodeid, mis võivad teie privaatsust Bitcoinis ohustada, uurime nüüd selles kolmandas osas parimaid tavasid, mida saate enda kaitsmiseks kasutusele võtta. Selle osa eesmärk ei ole uurida meetodeid privaatsuse parandamiseks - seda teemat käsitletakse hiljem -, vaid pigem mõista, kuidas Bitcoiniga õigesti suhelda, et säilitada selle loomulikul viisil pakutav privaatsus, ilma et peaks kasutama lisatehnikaid.

Loomulikult räägime selle kolmanda osa alguses aadressi korduvkasutamisest. See nähtus on peamine oht kasutajate privaatsusele. Seetõttu on see peatükk ilmselt kõige olulisem kogu kursuse jooksul.

### Mis on vastuvõtuaadress?

Bitcoini vastuvõtuaadress on tähemärgijada või identifikaator, mida kasutatakse bitcoinide vastuvõtmiseks rahakotti.

Tehniliselt ei "võta" bitcoini vastuvõtuaadress sõna otseses mõttes bitcoine vastu, vaid määrab pigem tingimused, mille alusel bitcoine saab kulutada. Täpsemalt öeldes, kui teile saadetakse makse, loob saatja tehing sisendites tarbitud UTXOdest uus UTXO, mis on ette nähtud teie jaoks väljundis. Sellele väljundile rakendatakse skripti, mis määrab, kuidas seda UTXO-d saab hiljem kulutada. Seda skripti nimetatakse "_ScriptPubKey_" või "_Locking Script_" Teie vastuvõtuaadress, täpsemalt selle kasutamiskoormus, on sellesse skripti sisse põimitud. Lihtsustatult ütleb see skript sisuliselt järgmist:

> "_Uue UTXO kulutamiseks tuleb esitada digitaalallkiri, kasutades selle vastuvõtva aadressiga seotud privaatvõtit._"
![BTC204](assets/fr/067.webp)

Bitcoini aadressid on erinevat tüüpi sõltuvalt kasutatavast skripti mudelist. Esimesed mudelid, mida tuntakse kui "_Legacy_", hõlmavad `P2PKH` (_Pay-to-PubKey-Hash_) ja `P2SH` (_Pay-to-Script-Hash_) aadresse. P2PKH-aadressid algavad alati numbriga `1` ja P2SH-aadressid numbriga `3`. Kuigi need formaadid on endiselt turvalised, on need nüüdseks vananenud, sest nende puhul on tehingutasud kõrgemad ja need pakuvad vähem privaatsust kui uued standardid.

SegWit V0 (`P2WPKH` ja `P2WSH`) ja Taproot / SegWit V1 (`P2TR`) aadressid esindavad kaasaegseid formaate. SegWit-aadressid algavad tähega `bc1q` ja 2021. aastal kasutusele võetud Taproot-aadressid algavad tähega `bc1p`.

Näiteks siin on Taproot'i vastuvõtu aadress:

```text
bc1ps5gd2ys8kllz9alpmcwxqegn7kl3elrpnnlegwkm3xpq2h8da07spxwtf5
```

See, kuidas ScriptPubKey konstrueeritakse, sõltub kasutatavast standardist:

| Script Template | ScriptPubKey || ---------------- | ----------------------------------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------- |

| P2PKH | OP_DUP OP_HASH160 `<pubKeyHash>` OP_EQUALVERIFY OP_CHECKSIG |

| P2SH | OP_HASH160 `<scriptHash>` OP_EQUAL |

| P2WPKH | 0 `<pubKeyHash>` |

| P2WSH | 0 `<<witnessScriptHash>` |

| P2SH - P2WPKH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2SH - P2WSH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2TR | 1 `<pubKey>` |

Mis puutub vastuvõtvate aadresside ehitusse, siis see sõltub samuti valitud skripti mallist:


- "P2PKH" ja "P2WPKH" aadresside puhul kujutab kasuliku koormuse ehk aadressi tuuma avaliku võtme hash-ühendust;
- P2SH- ja P2WSH-aadresside puhul kujutab kasulik koormus endast skripti hash'i;
- Nagu ka "P2TR" aadresside puhul, on kasuliku koormuse puhul tegemist muudetud avaliku võtmega. `P2TR` väljundid kombineerivad _Pay-to-PubKey_ ja _Pay-to-Script_ aspekte. Muudetud avalik võti on klassikalise kulutamise avaliku võtme lisamise tulemus koos "modifikatsiooniga", mis on tuletatud skriptide kogumi Merkle-juurest, mida saab kasutada ka bitcoinide kulutamiseks.

![BTC204](assets/it/67/01.webp)

Teie rahakoti tarkvaras kuvatavad aadressid sisaldavad ka HRP (_Human-Readable Part_), tavaliselt `bc` post-SegWit aadresside puhul, eraldusmärk `1` ja versiooninumber `q` SegWit V0 ja `p` Taproot/SegWit V1 puhul. Samuti lisatakse kontrollsumma, et tagada aadressi terviklikkus ja kehtivus selle edastamise ajal.

Lõpuks pannakse aadressid standardvormingusse:


- Base58check vanade Legacy-aadresside jaoks;
- Bech32 SegWit-aadresside jaoks;
- Bech32m Taproot-aadresside jaoks.

Siin on bech32 ja bech32m formaatide (SegWit ja Taproot) liitmismaatriks baasist 10:

| + | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |

| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| 0 | q | p | z | r | y | 9 | x | 8 | 8

| 8 | g | f | 2 | t | v | d | w | 0 |

| 16 | s | 3 | j | n | 5 | 4 | k | h | 24 | c | e | 6 | m | u | a | 7 | l | l

### Mis on aadressi korduvkasutamine?

Aadressi korduvkasutamine tähendab, et sama vastuvõtuaadressi kasutatakse mitme erineva UTXO blokeerimiseks.

Nagu nägime eelmises jaotises, on igal UTXO-l oma ScriptPubKey, mis lukustab selle ja peab olema täidetud, et UTXO-d saaks kasutada uue tehingu sisendina. Selle ScriptPubKey sees ongi vastuvõtuaadressid (payloads) sisse põimitud.

Kui mitu ScriptPubKey'd sisaldavad sama vastuvõtuaadressi, nimetatakse seda aadressi korduvkasutamiseks. Praktikas tähendab see, et kasutaja on andnud sama aadressi mitu korda saatjatele, et saada bitcoine mitme makse kaudu. Ja tõepoolest, see praktika on teie privaatsuse jaoks katastroofiline.

### Miks on aadressi korduvkasutamine probleem?

Kuna plokiahel on avalik, on lihtne näha, millised aadressid milliseid UTXOsid blokeerivad ja kui palju bitcoine. Kui sama aadressi kasutatakse mitme tehingu puhul, on võimalik järeldada, et kõik selle aadressiga seotud bitcoinid kuuluvad samale isikule. Selline praktika ohustab kasutajate privaatsust, võimaldades erinevate tehingute vahel deterministlikke seoseid luua ja bitcoinide jälgimist plokiahelas. Satoshi Nakamoto ise rõhutas seda probleemi Bitcoini valges raamatus:

> _Tuletõkkena võiks iga tehingu jaoks kasutada uut võtmepaari, et vältida nende seostamist ühise omanikuga
![BTC204](assets/fr/055.webp)

Allikas: S. Nakamoto, "Bitcoin: Peer-to-Peer Electronic Cash System," https://bitcoin.org/bitcoin.pdf, 2009.

Satoshi eesmärk, mida ta selle avaldusega taotles, oli luua täiendav tulemüür kasutaja identiteedi ja Bitcoini võtmepaari vahelise seose korral, et vältida kogu nende tegevuse avalikku seostamist nende identiteediga. Tänapäeval, kui plokiahela analüütikafirmad ja KYC-eeskirjad on üha enam levinud, ei ole unikaalsete aadresside kasutamine enam "täiendav tulemüür", vaid vajalik tava kõigile, kes soovivad oma privaatsust minimaalselt säilitada.

Kui te kasutate aadressi uuesti, loote peaaegu vaieldamatu seose kõigi selle aadressiga seotud tehingute vahel. Kuigi see ei ohusta otseselt teie raha, sest elliptiliste kõverate krüpteerimine tagab teie isiklike võtmete turvalisuse, muudab see teie tegevuse jälgimise lihtsamaks. Tegelikult võib igaüks, kellel on sõlme, jälgida teie tehinguid ja aadresside saldosid, ohustades täielikult teie anonüümsust.

![BTC204](assets/it/34/01.webp)

Selle punkti illustreerimiseks võtame näiteks Bobi, kasutaja, kes ostab regulaarselt bitcoin'eid väikestes kogustes DCA (Dollar Cost Averaging) kaudu ja saadab need alati samale aadressile. Kahe aasta pärast on sellel aadressil märkimisväärne kogus bitcoine. Kui Bob kasutab seda aadressi, et teha makse kohalikule kaupmehele, võib kaupmees näha kõiki sellega seotud vahendeid ja arvata Bobi varanduse maha. See võib kaasa tuua isiklikke turvariske, sealhulgas vargus- või väljapressimiskatseid. Kui Bob oleks kasutanud iga perioodilise ostu vastuvõtmiseks uut aadressi, oleks ta avaldanud kaupmehele lõpmatult vähem teavet.

Ahelaanalüüsis eristame 2 tüüpi aadressi korduvkasutust:


- Väline taaskasutus;
- Tehingusisene korduvkasutamine.

Esimest täheldatakse, kui aadressi kasutatakse uuesti mitmes erinevas Bitcoini tehingus. Seda arutasime varem: see heuristika võimaldab järeldada, et kõik UTXOd, mis läbivad seda aadressi, kuuluvad ühele üksusele.

Siseaadresside korduvkasutust ei täheldata mitte siis, kui korduvkasutamine toimub mitme tehingu vahel, vaid siis, kui see toimub ühe ja sama tehingu sees. Tõepoolest, kui sama aadressi, mida kasutati sisendi lukustamiseks, kasutatakse ühes tehingus väljundina, siis võime järeldada, et see väljund kuulub endiselt samale kasutajale (jääk) ja et teine väljund kujutab endast tegelikku makset. See teine heuristika võimaldab raha jälgida mitme tehingu lõikes.

![BTC204](assets/it/33/02.webp)

Aadressi korduvkasutamine on Bitcoini tõeline nuhtlus. Veebisaidi OXT.me (praegu kättesaamatu) andmetel oli aadresside taaskasutamise üldine määr Bitcoinis 2022. aastal umbes 52 protsenti:

![BTC204](assets/fr/069.webp)

See määr on tohutu, kuid see pärineb valdavalt vahetusplatvormidelt, mitte üksikutelt kasutajatelt.

### Kuidas vältida aadressi korduvkasutust?

Aadressi korduvkasutamise vältimine on üsna lihtne: **Kasutage lihtsalt uut aadressi iga uue rahakotti saabuva makse jaoks**.

Tänu BIP32-le on kaasaegsed portfellid nüüd deterministlikud ja hierarhilised. See tähendab, et kasutaja saab luua suure hulga aadresse ühest algteabest: seemnest. Selle üheainsa teabe salvestamisega saab taastada kõik rahakoti privaatvõtmed ja seega pääseda ligi vastavate aadressidega tagatud rahalistele vahenditele.

![BTC204](assets/fr/070.webp)

Seepärast pakutakse teile iga kord, kui vajutate rahakoti tarkvaras nuppu "_saa_", kasutamata vastuvõtuaadressi. Pärast bitcoinide vastuvõtmist sellele aadressile pakub tarkvara automaatselt uut aadressi.

> _PS: Hiljuti teatas mõni rahakoti tarkvara oma kavatsusest lõpetada tühjade aadresside genereerimine, kuna kardavad, et ametiasutused võivad seda pidada rahapesuks. Kui teie tarkvara kuulub nende hulka, siis soovitan tungivalt, et vahetaksite selle kohe välja, sest see ei ole kasutajale vastuvõetav
Kui teil on maksete vastuvõtmiseks vaja staatilist identifikaatorit, näiteks annetuste vastuvõtmiseks, ei ole klassikalise Bitcoini aadressi kasutamine taaskasutamise ohu tõttu soovitatav. Eelistate Lightning-aadressi kasutamist või staatilise ahelasisese makse identifikaatori jaoks võite valida BIP47 või Silent Payments. Kuidas need protokollid toimivad, on üksikasjalikult kirjeldatud käesoleva koolituse 6. osas.

## Mündi märgistamine ja kontroll

<chapterId>fbdb07cd-c025-48f2-97b0-bd1bc21c68a8</chapterId>

Nagu me avastasime ahelanalüüsi käsitlevas osas, on olemas hulk heuristikat ja mustreid, mida saab kasutada tehingu kohta teabe tuletamiseks. Kasutajana on oluline olla neist tehnikatest teadlik, et end paremini kaitsta.

See hõlmab suuresti isikliku rahakoti ranget haldamist, mis hõlmab nii oma UTXOde päritolu teadmist kui ka maksete ajal tarbitavate UTXOde läbimõeldud valikut. Selline tõhus rahakoti haldamine tugineb heade Bitcoini rahakottide kahele olulisele omadusele: märgistamine ja mündikontroll.

Selles peatükis uurime neid funktsioone ja vaatame, kuidas saaksite neid nutikalt kasutada, lisamata liiga suurt töökoormust, et optimeerida oma privaatsust Bitcoinis.

### Mis on märgistamine?

Märgistamine on tava, mis hõlmab märkuse või sildi määramist konkreetsele UTXO-le Bitcoini rahakotis. Neid märkusi salvestatakse lokaalselt rahakoti tarkvara poolt ja neid ei edastata kunagi Bitcoini võrgu kaudu. Märgistamine on seega isikliku haldamise vahend.

Näiteks, kui ma oman UTXO-d, mis on saadud Bisqi P2P-ostustelt koos Charlesiga, võin anda sellele sildi "`Non-KYC Bisq Charles`".

Märgistamine on hea tava, mis aitab meeles pidada UTXO päritolu või sihtkohta, hõlbustades seeläbi vahendite haldamist ja optimeerides privaatsust. Tegelikult sisaldab teie Bitcoini rahakott tõenäoliselt mitut UTXO-d. Kui nende UTXOde allikad on erinevad, ei pruugi te neid UTXOsid tulevikus ühendada, sest vastasel juhul võite paljastada nende ühise omandiõiguse. Kõikide oma müntide nõuetekohase märgistamisega tagate, et mäletate nende päritolu, kui neid vajate, isegi kui see juhtub alles mitme aasta pärast.

### Mis on mündikontroll?

Sildistamise aktiivne kasutamine muutub veelgi atraktiivsemaks, kui seda kombineerida rahakoti tarkvara mündikontrolli võimalusega.

Mündikontroll on hea Bitcoini rahakoti tarkvara funktsioon, mis võimaldab teil käsitsi valida konkreetseid UTXOsid, mida kasutada tehingu sooritamiseks sisendina. Tegelikult peate väljamineva makse rahuldamiseks tarbima vastutasuks sissetuleva UTXO. Mitmel põhjusel, mida näeme hiljem, võite soovida täpselt valida, milliseid münte tarbida sisendina konkreetse makse rahuldamiseks. Just seda võimaldab mündikontroll. Analoogia mõttes on see funktsionaalsus sarnane tegevusega, mille puhul valite oma rahakotis konkreetse mündi, kui maksate oma baguette'i eest.

Mündi kontrollitava rahakoti tarkvara kasutamine koos UTXOde märgistamisega võimaldab kasutajatel täpselt eristada ja valida UTXOd oma tehinguteks.

### Kuidas märgistada oma UTXO-d õigesti?

UTXOde märgistamiseks ei ole olemas universaalset meetodit, mis sobiks kõigile. Teie ülesanne on määratleda märgistamissüsteem, et saaksite oma portfellis hõlpsasti orienteeruda. Igal juhul pidage meeles, et hea märgistus on see, millest te saate aru, kui seda vajate. Kui teie Bitcoini rahakott on peamiselt säästmiseks, võib juhtuda, et sildid ei ole teile kasulikud enne mitme aastakümne möödumist. Seepärast veenduge, et need on selged, täpsed ja kõikehõlmavad.

Oluline on, et teie lähedased saaksid hõlpsasti tuvastada vahendite päritolu, kui nad ühel päeval vajavad juurdepääsu teie portfellile. See võib aidata neid nii privaatsuse kui ka juriidiliste vajaduste tõttu, kui nad peaksid ametiasutuse ees raha päritolu põhjendama.

Märgistuse kõige olulisem aspekt on märkida UTXO allikas. Te peaksite lihtsalt märkima, kuidas see münt teie rahakotti sattus. Kas see tuli ostu teel vahetusplatvormilt? Kliendi poolt tehtud maksest? Peer-to-peer-vahetusest? Või on see ostu jääk? Nii et te võiksite täpsustada:


- `Pickup Exchange.com`;
- "Makseklient David";
- "Osta P2P Charles";
- `Sohva ostmisest kinnipidamine`

Et täiustada UTXOde haldamist ja järgida oma fondide eraldamise strateegiaid portfelli sees, võiksite oma märgiseid rikastada täiendava märgistusega, mis kajastaks neid eraldamisi. Kui teie portfell sisaldab kahte liiki UTXOsid, mida te ei soovi segada, võiksite lisada märgistuse, et neid rühmi selgelt eristada. Need eraldusmärgised sõltuvad teie kriteeriumidest, näiteks KYCiga seotud omandamisprotsessist pärit UTXOde või professionaalsete ja isiklike fondide eristamine. Võttes eelnevalt mainitud märgiste näiteid, võiks see väljenduda järgmiselt:


- `KYC - Exchange.com väljavõtmine`;
- "KYC - kliendi makse David";
- `NO KYC - ostu P2P Charles`;
- "NO KYC - Ülejäänu diivanite ostmisest

Samuti on soovitav mündi märgistus tehingute ajal jäädvustada. Näiteks UTXOde konsolideerimisel ilma KYC-ta, märgistage saadud UTXOd mitte ainult kui "konsolideerimine", vaid konkreetselt kui "no-KYC konsolideerimine", et säilitada selge jälg mündi päritolu.

Lõpuks ei ole kuupäeva märkimine etiketile kohustuslik. Enamik rahakoti tarkvara näitab juba tehingu kuupäeva ja seda teavet on alati võimalik välja otsida plokkide uurija abil, kasutades selle TXID-d.

### Kuidas valida oma mündid õigesti?

Kui teete tehingu, võimaldab mündikontroll teil konkreetselt valida, milliseid UTXOsid kasutada sisendina, et rahuldada makse väljund. Selle valiku tegemisel tuleks arvesse võtta kahte aspekti:


- Makse saaja võimalus siduda osa teie identiteedist sisendina kasutatud UTXOdega;
- Välise vaatleja võime luua seoseid kõigi sisendina tarbitavate UTXOde vahel.

Esimese punkti illustreerimiseks võtame konkreetse näite. Oletame, et ostate oma kohalikult pagarilt bitcoinidega baguette'i. Te kasutate sisendina ühte või mitut oma UTXOd, et katta vähemalt baguette'i hind väljundina, millele lisanduvad tehingutasud. Seejärel võib pagar potentsiaalselt seostada teie näo või mis tahes muu teie identiteedi osa, mida ta teab, sisendina kasutatud müntidega. Teades selle seose olemasolu, võite makse tegemisel eelistada ühe konkreetse UTXO-d teisele.

Näiteks kui üks teie UTXO on pärit vahetusplatvormilt ja te eelistate, et pagariäri ei oleks teadlik teie kontost sellel platvormil, siis vältige selle UTXO kasutamist maksmiseks. Kui teil on suure väärtusega UTXO, mis paljastab märkimisväärse bitcoinide summa, võite samuti otsustada seda mitte kasutada, et pagar ei saaks teada teie BTC-vara.

Selle esimese punkti puhul kasutatavate UTXOde valik põhineb seega isiklikul otsusel, mida mõjutab see, mida olete valmis avalikustama või mitte. Sildid, mille olete oma UTXOdele nende kättesaamisel määranud, aitavad teil valida need, mis kulutamisel näitavad ainult seda teavet, mida te olete nõus vastuvõtjale avaldama.

Lisaks teabe potentsiaalsele avalikustamisele vastuvõtjale mõjutab teie sisendite valik ka seda, mida te avalikustate kõigile plokiahela vaatlejatele. Kasutades oma tehingu sisenditena mitut UTXO-d, paljastate te tegelikult, et need kuuluvad samale üksusele, vastavalt sisendite ühisele omandiõiguse heuristikale (Common Ownership Heuristics of Inputs, CIOH).

Kui te valite oma münte, peaksite seetõttu olema teadlik, et tehing, mida te kavatsete edastada, loob seose kõigi kasutatavate UTXOde vahel. See seos võib teie isikliku privaatsuse seisukohast olla problemaatiline, eriti kui UTXOd pärinevad erinevatest allikatest.

Tulles tagasi oma UTXO ilma KYC-ta Bisqist; ma tahan vältida selle kombineerimist UTXOga näiteks reguleeritud vahetusplatvormilt, mis teab minu identiteeti. Kui ma kasutaksin neid 2 UTXOd sisendina samas tehingus, saaks reguleeritud platvorm tegelikult minu identiteedi siduda Bisqist ostetud UTXOga, samas kui varem ei olnud see minu identiteediga seotud.

Lõpuks, et valida õigesti, milliseid UTXOsid tehingu sisendiks tarbida, on kõige olulisem vältida mitme UTXO kasutamist. Kui võimalik, valige üks mündi, mis on piisavalt suur, et katta teie makse. Seda tehes väldite täielikult COINJOINiga seotud riske. Kui aga teie makse jaoks ei piisa ühest UTXO-st ja teil on vaja tarbida mitut, veenduge, et need pärinevad sarnastest allikatest, et vähendada soovimatute ühenduste riske. Samuti pidage meeles, et saaja võib seostada teie kohta olemasolevat teavet sisendina kasutatud müntide ajalooga.

### Automaatse mündi valiku mõistmine

Eelmistes punktides käsitleti UTXOde käsitsi valimist tehingu jaoks. Aga mis juhtub siis, kui rahakoti tarkvara teeb selle valiku automaatselt? Kulutatavate müntide kindlaksmääramiseks on mitmeid meetodeid ja UTXOde valimine on Bitcoinis tõeline uurimisvaldkond. Selle automaatse protsessi peamine eesmärk on sageli vähendada kasutaja jaoks tehingutasusid.

UTXO valikumeetodid nagu FIFO (_First In First Out_) ja LIFO (_Last In First Out_) on ühed lihtsaimad, kuid ka kõige vähem tõhusad. FIFO puhul kasutatakse kõigepealt portfelli vanimaid münte. See lähenemisviis on üldiselt ebatõhus nii tehingutasude minimeerimiseks kui ka privaatsuse säilitamiseks, välja arvatud juhul, kui kasutatakse suhtelisi ajamäärasid, mida tuleb regulaarselt uuendada. Seevastu LIFO puhul eelistatakse kõige uuemate UTXOde kasutamist. Kuigi need kaks meetodit on lihtsad, osutuvad need sageli ebatõhusaks.

Edasijõudnud meetod on _Knapsack Solver_. Seda meetodit kasutati Bitcoin Core'i rahakotis kuni versioonini 0.17. See hõlmab rahakoti UTXOde iteratiivset ja juhuslikku valimist, nende summeerimist alagruppidesse ja selle lahenduse säilitamist, mis vähendab tehingu kaalu võimalikult palju, et vähendada kasutustasusid.

_Branch-and-Bound_ (BNB), mida sageli nimetatakse "Murchi algoritmiks", viidates selle leiutajale, asendas alates versioonist 0.17 Bitcoin Core'is _Knapsack Solver_. Selle arenenuma meetodi eesmärk on leida UTXOde kogum, mis vastab täpselt tehingu väljundite rahuldamiseks vajalikule summale. BNB eesmärk on minimeerida nii jääkide kogust kui ka tasusid, vähendades nn raiskamiskriteeriumi, mis võtab arvesse nii koheseid kulusid kui ka oodatavaid tulevasi kulusid jääkide eest. See meetod on tuletatud Ailsa Landi ja Alison Harcourti 1960. aastal loodud algsest _Branch-and-Bound_-kontseptsioonist ning pakub täpsemat vahendustasude optimeerimist kui _Knapsack Solver_.

Kõik need automaatsed UTXO valikumeetodid võivad olla tõhusad tehingutasude vähendamisel, kuid sageli ei ole need tõhusad kasutaja privaatsuse säilitamisel. Tegelikult võivad need algoritmid ühendada mitu UTXOd sisendiks, paljastades seega nende UTXOde ühise omandiõiguse COH tõttu. On selge, et need meetodid ei saa arvesse võtta UTXOdele lisatud märgiseid, mis on olulised, et teadlikult valida, milliseid münte tehingu saajale avaldada. Praegu on ainus lahendus müntide valiku privaatsuse optimeerimiseks see, et seda tehakse käsitsi.

### UTXO märgistamise õpetus

Kui soovite teada saada, kuidas oma UTXO-d märgistada, oleme koostanud põhjaliku õpetuse peamise olemasoleva Bitcoini rahakoti tarkvara kohta:

https://planb.network/tutorials/privacy/on-chain/utxo-labelling-d997f80f-8a96-45b5-8a4e-a3e1b7788c52
## KYC ja võtme identifitseerimine

<chapterId>cec6b9d9-0eed-4f85-bc4e-1e9aa59ca605</chapterId>

KYC tähendab "tunne oma klienti", mis on regulatiivne menetlus, mida mõned Bitcoini tööstuses tegutsevad ettevõtted rakendavad. Selle menetluse eesmärk on kontrollida ja registreerida oma klientide identiteeti, mille eesmärgiks on võidelda rahapesu ja terrorismi rahastamise vastu.

Konkreetselt hõlmab KYC mitmesuguste isikuandmete kogumist kliendilt, mis võivad sõltuvalt jurisdiktsioonist erineda, kuid üldjuhul hõlmab isikut tõendavat dokumenti, fotot ja elukohatõendit. Seejärel kontrollitakse ja säilitatakse need andmed edaspidiseks kasutamiseks.

See menetlus on enamikus lääneriikides muutunud kohustuslikuks kõigi reguleeritud vahetusplatvormide jaoks. See tähendab, et igaüks, kes soovib nende platvormide kaudu fiatvaluutat bitcoini vastu vahetada, peab täitma KYC nõudeid.

See menetlus ei ole riskivaba kasutaja privaatsusele ja turvalisusele. Käesolevas peatükis uurime neid riske üksikasjalikult ning analüüsime KYC- ja identifitseerimisprotsesside konkreetseid mõjusid Bitcoini kasutajate privaatsusele.

### Onchain jälgimise hõlbustamine

Esimene risk, mis on seotud KYCiga, on see, et see annab eelistatud sisenemispunkti plokiahela analüüsile. Nagu nägime eelmises punktis, saavad analüütikud rühmitada ja jälgida tegevust plokiahelas, kasutades tehingumustreid ja heuristikat. Kui neil on õnnestunud kasutaja plokiahelas toimuv tegevus rühmitada, piisab kõigi tema tehingute ja võtmete hulgast vaid ühe sisenemispunkti leidmisest, et täielikult ohtu seada privaatsus.

![BTC204](assets/fr/078.webp)

Kui te esitate KYC-i, annate väga kvaliteetse sisenemispunkti ahela analüüsiks, kuna te seostate oma bitcoinide väljavõtmisel vahetusplatvormilt kasutatavad vastuvõtuaadressid teie täieliku ja kontrollitud identiteediga. Teoreetiliselt on see teave teada ainult ettevõttele, kellele te selle andsite, kuid nagu me hiljem näeme, on andmete kadumise oht reaalne. Lisaks võib juba ainuüksi asjaolu, et ettevõte seda teavet omab, olla problemaatiline, isegi kui ta seda ei jaga.

Seega, kui ei võeta muid meetmeid, et piirata oma tegevuse koondamist plokiahelas, võib igaüks, kes on teadlik KYC-i sisenemispunktist, potentsiaalselt siduda kogu oma tegevuse Bitcoinis oma identiteediga. Selle ettevõtte seisukohast kaotab Bitcoini kasutamine seega igasuguse konfidentsiaalsuse.

![BTC204](assets/fr/079.webp)

Võrdlusega illustreerimiseks võib öelda, et kui pangatöötaja _Pangas X_ oleks juurdepääs mitte ainult kõikidele tehingutele, mis on tehtud _Pangas X_, vaid saaks jälgida ka tehinguid _Pangas Y_ ja kõiki omaenda sularahatehinguid.

Tuletame meelde selle koolituse esimesest osast: Satoshi Nakamoto loodud Bitcoini privaatsusmudel põhineb kasutaja identiteedi ja tema võtmepaaride eraldamisel. Kuigi see privaatsuse kiht ei ole tänapäeval enam piisav, on siiski mõistlik piirata selle lagunemist nii palju kui võimalik.

### Kokkupuude riikliku järelevalvega

Teine suur probleem KYCi puhul on see, et see näitab riigile, et keegi on mingil ajal bitcoin'i omanud. Kui te ostate bitcoin'e reguleeritud toimija kaudu, saab riik sellest valdusest teada. Praegu võib see tunduda triviaalne, kuid on oluline meeles pidada, et oma riigi poliitiline ja majanduslik tulevik ei ole enda käes.

Esiteks võib riik kiiresti võtta autoritaarse hoiaku. Ajalugu on täis näiteid, kus poliitika on järsult muutunud. Täna võivad Bitcoini entusiastid Euroopas kirjutada artikleid Bitcoini kohta, osaleda konverentsidel ja hallata omaenda enesehoiu rahakotte. Kuid kes oskab öelda, mida toob homne päev? Kui Bitcoinist saab äkki avalik vaenlane number üks, võib sellega seostamine riiklikes registrites osutuda problemaatiliseks.

Hiljem, tõsise majanduskriisi korral võib riik kaaluda kodanike valduses olevate bitcoinide konfiskeerimist. Võib-olla peetakse homme bitcoin'iomanikke kriisi ära kasutavateks ja nende kapitalitulu tõttu fiatvaluuta devalveerimise tõttu üle maksustatakse.

Te võite arvata, et see ei ole probleem, sest teie bitcoinid on segatud ja seega jälgimatud. Kuid jälgitavus ei ole siinkohal probleemiks. Tegelik probleem on see, et riik teab, et teil on bitcoinid olemas. Sellest lihtsast teabest võib piisata, et teid süüdistada või nõuda kontot. Te võite üritada väita, et olete bitcoinid ära kulutanud, kuid see peaks kajastuma teie maksudeklaratsioonis ja teid avastataks. Võiksite ka öelda, et kaotasite oma võtmed laevaõnnetuses, kuid kas te tõesti arvate, et peale Twitteri nalja piisab sellest, et teid õigeks mõista?

Seetõttu on oluline kaaluda riski, mis on seotud lihtsa asjaoluga, et riik võib teada saada, et te omate BTC-d, kuigi see risk võib täna tunduda kaugel.

Teine küsimus, mida KYC tekitab riikliku järelevalve osas, on reguleeritud platvormide kohustuslik aruandlus. Kuigi ma ei tunne teiste jurisdiktsioonide regulatsioone, on Prantsusmaal _digitaalsete varade teenusepakkujad_ (PSAN) kohustatud teatama finantsjärelevalvele igast rahaliste vahendite liikumisest, mida nad peavad kahtlaseks.

Seega teatasid PSANid Prantsusmaal 2023. aastal 1449 kahtlastest tegudest. Praegu on enamik neist tegudest seotud kuritegevusega. Kuid ametiasutused paluvad ka reguleeritud platvormidel teatada kõigist kahtlastest Bitcoini tehingutest, mis põhinevad üksnes selle struktuuril. Kui te teete ühistehingu või isegi lihtsalt tehingu, millel on mõnevõrra ebatüüpiline muster, ja see tehing toimub nende platvormide bitcoinide väljavõtmise läheduses, võite sattuda ametiasutustele teatada. Isegi kui te ei ole rikkunud midagi ja kasutate oma õigusi seaduslikult, võib see teatamine kaasa tuua suurema kontrolli ja järelevalve, mis on ebamugavused, mida te oleksite ilma KYC-ta vältinud.

### Isikuandmete kadumise oht

Teine probleem KYCi puhul seisneb selles, et see nõuab kõigi teie isikuandmete säilitamist eraettevõtte serverites. Hiljutised sündmused on meile meelde tuletanud, et keegi ei ole kaitstud ebaõnnestumiste eest, olgu need siis finants- või IT-ga seotud. Aastal 2022 kannatasid Celsiuse kliendid selle tagajärgede all. Ettevõtte pankroti tagajärjel avalikustas USA õigussüsteem haldusmenetluse käigus võlausaldajate nimed ja nende varade suuruse.

Veidi üle kahe aasta tagasi varastati ühe juhtiva küberturvalisuse üksuse krüptovaluutade valdkonnas klientide isikuandmeid. Kuigi see juhtum ei olnud otseselt seotud bitcoini ostmisega, jääb see risk ka vahetusplatvormide jaoks. Seega on nende isikuandmetega seotud risk kindlalt olemas.

On tõsi, et me usaldame juba praegu suure osa oma isikuandmetest eraettevõtetele. Kuid siin on oht kahekordne, sest need andmed ei võimalda teid mitte ainult tuvastada, vaid on seotud ka bitcoini tegevusega. Tõepoolest, kui häkkeril on võimalik pääseda ligi vahetusplatvormi klientide andmetele, võib ta põhjendatult eeldada, et need kliendid on bitcoinide omanikud. Seda riski suurendab seega asjaolu, et bitcoin, nagu iga muu väärtuslik vara, äratab varaste huvi.

Andmekaitserikkumise korral võite parimal juhul olla sihtotstarbeliste andmepüügikatsete sihtmärgiks. Halvemal juhul võite sattuda oma kodu füüsilise ohu keskmesse.

Lisaks Bitcoiniga seotud spetsiifilistele riskidele tuleb arvestada ka isikut tõendavate dokumentide edastamisega seotud ohtudega. Nimelt on andmete lekkimise korral võimalik sattuda identiteedivarguse ohvriks. Seega ei piirdu kaalul olevad küsimused ainult tehingute konfidentsiaalsuse kaitsmisega, vaid mõjutavad ka iga üksikisiku isiklikku turvalisust.

### Levinud vääritimõistmised seoses KYCiga

Oluline on hajutada mõned levinud väärarusaamad KYCi kohta, mida sageli Twitteris või meie aruteludes bitcoin'i kasutajate seas leidub.

Esiteks on vale arvata, et KYC (Know Your Customer) kaudu omandatud bitcoinide privaatsuse kaitsmine on kasutu. Bitcoini privaatsuse tagamise vahendid ja meetodid on mitmekesised ja teenivad erinevaid eesmärke. Näiteks KYCist bitcoini tehingute kasutamine coinjoiniga ei ole halb mõte. Loomulikult peate olema ettevaatlik reguleeritud vahetusplatvormide puhul, et vältida oma konto külmutamist või keelustamist, kuid rangelt tehnilisest vaatenurgast ei ole need tavad ühildamatud. Coinjoinil on müntide ajaloo katkestamine, mis aitab võidelda mõne KYC-ga seotud ahelanalüüsi riski vastu. Kuigi see ei kõrvalda kõiki riske, on see juba märkimisväärne eelis.

Bitcoini privaatsust ei tohiks vaadelda binaarselt, eristades "anonüümseid" bitcoine ja teisi, mis ei ole seda. KYCi kaudu omandatud bitcoinide omamine ei tähenda, et kõik on kadunud; vastupidi, privaatsusvahendite kasutamine võib osutuda isegi kasulikumaks.

Seevastu bitcoinide omandamine mitte-KYC-meetodi kaudu ei taga täiuslikku privaatsust ega vabasta teid vajadusest võtta muid kaitsemeetmeid. Kui te omate mitte-KYC bitcoin'e, kuid kasutate vastuvõtuaadresse mitu korda uuesti, võidakse teie tehinguid jälgida ja rühmitada. Väikseimgi ühendus bitcoini välise maailmaga võib ohustada teie ainukest privaatsuskihti. Seetõttu on oluline pidada kõiki vahendeid ja meetodeid, mis parandavad Bitcoini privaatsust, üksteist täiendavaks. Iga tehnika tegeleb konkreetse riskiga ja võib lisada täiendava kaitsekihi. Seega ei vabasta KYC-väliste bitcoinide omamine teid absoluutselt teiste ettevaatusabinõude võtmisest.

### Kas KYC-i saab tühistada?

Minult küsitakse mõnikord, kas pärast KYCi lõpetamist on võimalik "tagasi minna", ja nagu eelnevatest lõikudest võite ette kujutada, on vastus nüansirikas. KYC-ga seotud riskide vältimiseks on kõige lihtsam meetod, kui seda bitcoinide omandamisel ei kasutata. Seda teemat käsitleme lähemalt järgmises peatükis. Kui aga KYC on juba tehtud ja bitcoinid on ostetud, siis kas on võimalusi tekkinud riskide vähendamiseks?

Mis puutub tehingute jälgimise riski, siis üks lahendus on coinjoini kasutamine. Seda meetodit käsitleme üksikasjalikult hiljem koolituse käigus, kuid teadke, et coinjoin võib häirida mündi ajalugu ja takistada selle mineviku- oleviku ja oleviku- mineviku jälgitavust. Isegi BTC puhul, mis on saadud reguleeritud platvormi kaudu, võib see meetod takistada selle jälgitavust.

Kuid coinjoin ei kõrvalda teist KYC-ga seotud riski: asjaolu, et riik on teie bitcoinide valdustest informeeritud. Tegelikult, isegi kui teie mündid ei ole enam jälgitavad, võib riigil sõltuvalt jurisdiktsioonist olla juurdepääs teie krüptoaktiivsetele võõrandamisaruannetele. Kuna see risk ei ole tehniline, vaid halduslik, ei ole bitcoin-spetsiifilisi lahendusi selle kõrvaldamiseks, välja arvatud esialgu KYC-ga kokkupuute vältimine. Ainus seaduslik lähenemisviis selle riski vähendamiseks on müüa oma reguleeritud platvormide kaudu omandatud bitcoinid reguleeritud platvormidel ja seejärel osta need tagasi ilma KYC-ta vahendite abil. Müües ja deklareerides võõrandamise, peaks administratsioon märkima, et te ei ole enam nende omanik.

Mis puutub teie isikuandmete ja isikut tõendavate dokumentide avalikustamise ohtu, siis see on Bitcoini väline oht ja selle vältimiseks ei ole tehnilist lahendust. Kui teie andmed on avalikustatud, on seda raske tagasi pöörata. Võite proovida oma konto platvormil sulgeda, kuid see ei garanteeri teie KYC-andmete kõrvaldamist, eriti kui identiteedi kontroll on sisse ostetud. Teie andmete täieliku kõrvaldamise kontrollimine on võimatu. Seetõttu ei ole võimalik seda riski täielikult ära hoida ja tagada, et seda enam ei eksisteeriks.

### Erinevus KYC ja võtme identifitseerimise vahel

Mõnikord kalduvad mõned bitcoin'i kasutajad laiendama terminit "KYC" mis tahes BTC-vahetusele, mis hõlmab ülekannet või krediitkaardimakseid, kuna need vahendid võivad samuti paljastada makse päritolu, nagu KYC. Siiski on oluline mitte segi ajada KYCi ja võtme tuvastamist. Isiklikult pean tunnistama, et minu arusaam sellest teemast on aja jooksul muutunud.

KYC viitab konkreetselt regulatiivsele menetlusele, mida mõned ettevõtted rakendavad oma klientide isikusamasuse kontrollimiseks ja registreerimiseks. See on binaarne küsimus: kui te omandate bitcoin'e, siis kas allute KYC-le või ei allu. Kuid võtme tuvastamine, mille eesmärk on siduda kasutaja identiteedi aspekt ahelas toimuva tegevusega, ei ole nii binaarne, vaid kujutab endast pigem kontiinumit. Bitcoini ostmise või müümise kontekstis on see identifitseerimine tõepoolest alati erineval määral võimalik.

Näiteks kui ostate bitcoini Šveitsis reguleeritud platvormilt, ei ole KYC (Know Your Customer) nõutav. Siiski võib olla teie võtmete tuvastamine, kuna ost toimus teie pangakonto kaudu. Siinkohal tekivad kaks esimest KYC-ga seotud riski - ahela jälgimise hõlbustamine ja kokkupuude valitsuse jälgimisega -, mis võivad ilmneda ka KYC-ga mitteseotud vahetuses. Kui Šveitsi üksus teatab teie riigi ametiasutustele kahtlastest tehingutest, võivad nad teie isiku tuvastamiseks lihtsalt kontrollida ostuks kasutatud pangakontot. Seega on ilma KYC-ta ostmine reguleeritud platvormidel võtme tuvastamise riskiskaalal üsna kõrge.

Reguleeritud platvormide vältimine ja P2P (Peer-to-Peer) omandamismeetodite valimine ei kõrvalda siiski täielikult võtmete tuvastamise riski, vaid vähendab seda lihtsalt. Võtame näiteks ostu Bisqi või mõne muu P2P-platvormi kaudu. Vastaspoolega arveldamiseks kasutate tõenäoliselt oma pangakontot. Kui ametiasutused küsitlevad isikut, kellega te kauplesite, ja küsivad teie nime, puutume kokku eespool nimetatud riskidega 1 ja 2. Need riskid on kindlasti palju väiksemad kui platvormil ilma KYC-ga ostmisel ja isegi väiksemad kui KYC-ga ostmisel, kuid need on siiski vähesel määral olemas.

Lõpuks, isegi kui ostate bitcoinid füüsilise rahavahetuse kaudu, ei ole te täiesti anonüümne. Isik, kellega te äri tegite, nägi teie nägu, mis on osa teie identiteedist. Kuigi selle näite puhul on tuvastamisvõtme võimalus minimaalne, on see siiski olemas.

Kokkuvõtteks, bitcoini vahetamise ajal teiste varade vastu, olgu see siis fiat-valuuta ost või müük reaalse vara vastu, on alati olemas mingi võtme identifitseerimise vorm. Sõltuvalt valitud vahetusmeetodist võib see identifitseerimine olla erineva intensiivsusega. Oluline on mitte segi ajada seda identifitseerimist KYCiga, mis on täpselt määratletud regulatiivne protsess. Küll aga on KYC ja identifitseerimisspektri vahel seos, sest KYC on selle spektri ülemises otsas, kuna see hõlbustab süstemaatiliselt kasutajate võtmete tuvastamist ametiasutuste poolt.

## Müügi- ja omandamismeetodid

<chapterId>756598af-95aa-4c77-ac48-243c7ad89530</chapterId>

Pärast eelmise peatüki lugemist võite mõelda, kuidas osta või müüa bitcoin'e, ilma et peaksite läbima isikusamasuse kontrollimise protsessi, et vältida KYC-ga seotud riske. Vahetuste tegemiseks on mitmeid meetodeid.

### P2P-vahetused sularahas

Nagu me nägime, on privaatsuse seisukohast parim meetod endiselt P2P (peer-to-peer) vahetus koos sularahaarveldusega. See meetod võimaldab vähendada maha jäävaid jälgi ja vähendab oluliselt võtme tuvastamise võimalust, olgu te siis ostja või müüja.

See praktika toob aga kaasa isiklikke julgeolekuriske. Peamine oht seisneb selles, et vahetuse ajal saab vastaspool teada, et teil on märkimisväärne summa kas sularahas või bitcoinides. See teave võib äratada pahatahtlike isikute tähelepanu. Tegelikult soovitatakse üldiselt jääda bitcoinide omamise osas diskreetseks. Seda nõuannet võib kohaldada ka sularaha suhtes. Isikliku vahetuse ajal on aga vältimatu avaldada, et te omate bitcoin'e, mis võib tekitada ahnust.

Selle riski piiramiseks soovitan teil eelistada sularahatehinguid usaldusväärsete inimestega, näiteks pereliikmete või lähedaste sõpradega. Alternatiivina võite kaaluda ka [kohalikel Bitcoini kohtumistel] (https://btcmap.org/communities/map) tehtavaid vahetusi, kui olete seal mitu korda osalenud. See võimaldab teil teisi osalejaid paremini tundma õppida ja mitte olla füüsilise vahetuse ajal üksi. Oluline on siiski tunnistada, et P2P-sularahavahetusega kaasnevad olemuslikult riskid teie isiklikule turvalisusele, mida ei ole olemas, kui teete oste reguleeritud platvormi ja pangakonto kaudu.

Samuti võib sõltuvalt elukohast suurte rahasummade transportimine ja hoiustamine kujutada endast ohtu, olenemata sellest, kas tegemist on bitcoini või sularahaga.

Sularaha vahetamine võib politsei- või muude kontrollide käigus tekitada ka õiguslikke riske. Kuigi enamikus riikides ei ole sularahasumma kaasaskandmisele piiranguid, võivad liiga suured summad tekitada kahtlusi. Seepärast olge ettevaatlik, eriti kui peate reisima pikemaid vahemaid, ja vältige korraga liiga suuri tehinguid, et te ei peaks põhjendama märkimisväärsete summade omamist.

Lõpuks on P2P-ostude teine puudus see, et hind on sageli kõrgem kui reguleeritud platvormidel täheldatud hind. Müüjad kehtestavad sageli lisatasu, mis ulatub 1%-st kuni mõnikord üle 10%. Seda hinnavahe on seletatav mitmel põhjusel. Esiteks on see P2P-müüjate seas levinud tava, mis on aja jooksul välja kujunenud. Lisaks sellele on müüjatel ostjale raha saatmisega seotud tehingutasud. Samuti on P2P-müügi puhul suurem vargusrisk kui platvormitehingute puhul, mis õigustab tasu võtmise riski eest. Lõpuks võib lisatasu olla seotud nõudluse ja börsi kvaliteediga seoses privaatsusega. Ostjana hinnatakse privaatsustasu sisse müüja poolt nõutavasse lisatasu. Mõned bitcoin'i kasutajad usuvad ka, et P2P-s ostetud BTC-de kõrgem hind peegeldab nende tegelikku väärtust, ja väidavad, et reguleeritud platvormidel kehtivad madalamad hinnad on teie isikliku teabe privaatsuse kompromissi tulemus.

### P2P-vahetused sobitusplatvormi kaudu

Isikliku turvalisuse seisukohalt on vähem riskantne alternatiiv P2P-vahetuste tegemine ainult internetis, kasutades elektroonilisi makseviise, nagu PayPal, pangaülekanded või Revolut.

Selline lähenemine aitab vältida paljusid sularahatehingutega seotud riske. Siiski on suurem risk, et vastaspool ei täida oma kohustusi veebipõhise vahetuse ajal. Kui te füüsilise vahetuse ajal annate raha üle müüjale, kes ei saada teile bitcoine vastutasuks, saate teda kohe välja kutsuda, sest ta seisab teie ees. Internetis seevastu on sageli võimatu leida inimest, kes on sinult varastanud.

Selle riski vähendamiseks võib P2P-vahetuseks kasutada spetsiaalseid sobitusplatvorme. Need platvormid kasutavad konfliktide lahendamise mehhanisme, et kaitsta kahjustatud kasutajaid. Üldiselt pakuvad nad eskrovisüsteemi, kus bitcoine hoitakse seni, kuni müüja on kinnitanud makse fiat-valuutas.

Isikliku turvalisuse seisukohalt on see ostumeetod oluliselt turvalisem kui füüsiline sularaha vahetamine. Kuid nagu varem mainitud, jätavad veebipõhised P2P-vahetused rohkem jälgi kui füüsiline vahetus, mis võib kahjustada Bitcoini privaatsust. Kasutades veebipõhist fiat-makseviisi, näiteks pangas, paljastate rohkem teavet, mis võib hõlbustada võtme tuvastamist.

Veel kord, ma soovitan nende platvormide puhul vältida suuri tehinguid ühe tehinguga. Tehinguid jagades hajutate vastaspoole võimaliku vargusega seotud riske.

Teine P2P-ostude puudus on see, et hind on sageli kõrgem kui reguleeritud platvormidel täheldatud hind. Müüjad kehtestavad sageli lisatasu, mis ulatub 1%-st kuni mõnikord üle 10%. Seda hinnavahe on seletatav mitmel põhjusel. Esiteks on see P2P-müüjate seas levinud tava, mis on aja jooksul välja kujunenud. Lisaks sellele on müüjatel ostjale raha saatmisega seotud tehingutasud. Samuti on P2P-müügi puhul suurem vargusrisk kui platvormitehingute puhul, mis õigustab tasu võtmise riski eest. Lõpuks võib lisatasu olla seotud nõudluse ja börsi kvaliteediga seoses privaatsusega. Ostjana hinnatakse privaatsustasu sisse müüja poolt nõutavasse lisatasu. Mõned bitcoin'i kasutajad usuvad ka, et P2P kaudu ostetud BTC kõrgem hind peegeldab selle tegelikku väärtust, ja väidavad, et reguleeritud platvormidel kehtivad madalamad hinnad on teie isikliku teabe privaatsuse kompromissi tulemus.

Mis puutub lahendustesse, siis mina isiklikult olen alati kasutanud [Bisq](https://bisq.network/) ja olen nendega väga rahul. Nende süsteem on hästi tõestatud ja tundub usaldusväärne. Bisq on siiski saadaval ainult arvutis ja selle kasutajaliides võib olla algajatele liiga keeruline. Teine puudus on see, et Bisq töötab ainult onchain-tehingutega, mis võib Bitcoini kõrgete tehingutasude ajal muutuda kalliks.

-> Tutvuge meie õpetusega Bisq.

https://planb.network/tutorials/exchange/peer-to-peer/bisq-fe244bfa-dcc4-4522-8ec7-92223373ed04
Lihtsama võimaluse saamiseks võite proovida [Peach] (https://peachbitcoin.com/), mobiilirakendust, mis hõlbustab ostjate ja müüjate vahelist ühendust koos integreeritud vaidluste lahendamise süsteemiga. Protsess on intuitiivsem kui Bisqi oma.

-> Tutvu meie õpetusega Peach'i kohta.

Teine online-võimalus on [HodlHodl](https://hodlhodl.com/), mis on tuntud platvorm, mis pakub head likviidsust, kuigi ma isiklikult ei ole seda testinud.

-> Tutvu meie HodlHodli õpetusega.

https://planb.network/tutorials/exchange/peer-to-peer/peach-wallet-db64fe42-17ca-4b24-abb8-e7d4c03b2028
https://planb.network/tutorials/exchange/peer-to-peer/hodlhodl-d7344cd5-6b18-40f5-8e78-2574a93a3879
Lightning Networkil põhinevate lahenduste puhul võite proovida [RoboSats](https://learn.robosats.com/) ja [LNP2PBot](https://lnp2pbot.com/). RoboSats on kättesaadav veebisaidi kaudu ja seda on suhteliselt lihtne kasutada. LNP2PBot on ebatüüpilisem, sest see toimib sõnumivahetussüsteemi Telegram kaudu.

-> Vaadake meie õpetust RoboSatsi kohta.

-> Vaadake meie õpetust LNP2PBoti kohta.

https://planb.network/tutorials/exchange/peer-to-peer/robosats-b60e4f7c-533a-4295-9f6d-5368152e8c06
https://planb.network/tutorials/exchange/peer-to-peer/lnp2pbot-v2-e6bcb210-610b-487d-970c-7cce85273e3c
### Reguleeritud platvormid ilma KYC-ta

Sõltuvalt sellest, millises riigis te elate, võib teil olla juurdepääs reguleeritud platvormidele, mis ei nõua bitcoini ostmiseks või müümiseks KYC-protseduuri. Näiteks Šveitsis saate kasutada selliseid platvorme nagu [Relai](https://relai.app/) ja [MtPelerin](https://www.mtpelerin.com/).

-> Tutvu meie õpetusega Relai.

Nagu nägime eelmises peatükis, säästab seda tüüpi platvorm teid KYC-menetlustega seotud riskidest, kuid need kujutavad endast suuremat riski võtmete tuvastamisel. Bitcoini privaatsuse seisukohast pakuvad need platvormid seega paremat kaitset kui KYC-ostumeetodid, kuid on vähem atraktiivsed kui P2P-vahetused.

Isikliku turvalisuse seisukohast on nende platvormide kasutamine siiski oluliselt vähem riskantne kui P2P-börside kasutamine. Samuti on neid sageli lihtsam kasutada kui P2P-vahetust hõlbustavaid platvorme.

https://planb.network/tutorials/exchange/centralized/relai-v2-30a9671d-e407-459d-9203-4c3eae15b30e
### ATM

Teine võimalus bitcoini ostmiseks või müümiseks ilma KYC-ta on krüptoraha sularahaautomaadid (ATM). Minul isiklikult ei ole kunagi olnud võimalust seda lahendust katsetada, sest minu riigis ei ole neid olemas. Kuid see meetod võib olla väga huvitav, sõltuvalt sellest, kus te elate.

Probleem sularahaautomaatidega on see, et mõnes riigis on need keelatud või teistes rangelt reguleeritud. Kui sularahaautomaat nõuab isikusamasuse kontrollimist, siis on sellega seotud samad riskid, mis on seotud reguleeritud KYC-platvormidega. Kui aga sularahaautomaat võimaldab väikeste summade puhul tehinguid ilma isikusamasuse kontrollimiseta, siis võib selle kasutamine pakkuda sularahapõhise P2P-vahetuse tasemega võrreldavat privaatsust, vältides suurema osa selle tüüpi vahetusega seotud riskidest.

Pangaautomaatide peamine puudus seisneb nende sageli kõrgetes valuutavahetustasudes, mis ulatuvad mõnest protsendist mõnikord kuni 15 protsendini vahetatavast summast.

### Kinkekaardid

Lõpuks tahtsin esitada ka lahenduse, mis sobib hästi neile, kes soovivad kasutada oma bitcoin'eid igapäevaselt ostude tegemiseks, mitte müüa neid fiat-valuutade eest.

Parim viis BTC kulutamiseks on ilmselgelt kasutada Bitcoini otse või Lightning Networki kaudu kaupade või teenuste ostmiseks. Paljudes riikides on aga bitcoini aktsepteerivate kaupmeeste arv endiselt piiratud. Praktiline alternatiiv on seega kinkekaartide kasutamine.

Mitmed platvormid, mis ei nõua KYC-protseduuri, pakuvad võimalust vahetada bitcoine kinkekaartide vastu, mida saab kasutada suuremates kauplustes. Nende platvormide hulka kuuluvad [CoinsBee](https://www.coinsbee.com/), [The Bitcoin Company](https://thebitcoincompany.com/) ja [Bitrefill](https://www.bitrefill.com/). Need platvormid lihtsustavad oluliselt teie bitcoinide igapäevast kasutamist, võimaldades teil kasutada paljusid tooteid ja teenuseid, ilma et peaksite läbima fiat-valuuta konverteerimise.

https://planb.network/tutorials/exchange/centralized/bitrefill-8c588412-1bfc-465b-9bca-e647a647fbc1
### Muud omandamismeetodid

Muude meetodite hulgas, kuidas bitcoini omandada, kaitstes samal ajal oma privaatsust, on muidugi kaevandamine. Sati kaevandamise alustamiseks ei pea te oma identiteeti paljastama; leidke lihtsalt kehtiv töötõend ja esitage see võrku. Kui otsustate koondatud kaevandamise kasuks, nõuavad mõned poolid mingisugust isikut tõendavat dokumenti, näiteks KYC, teised aga mitte.

Teine meetod on töötada bitcoini vastu. See omandamisviis võib olla atraktiivne, kuid nõutav identifitseerimise tase varieerub suuresti sõltuvalt asjaoludest.

\_ Selle peatüki kirjutamiseks kasutasin Plan ₿ Network'is [@pivi\_\__](https://x.com/pivi___) loodud BTC205 kursust (esialgu ainult prantsuse keeles).\_

## Konsolideerimine, UTXO ja CIOH juhtimine

<chapterId>d0486c8f-332d-402b-ae2e-949416752b9c</chapterId>

Üks kõige keerukamaid aspekte, mida hallata, kui teil on oma enesekorterite portfell, on kahtlemata konsolideerimine. Kas peaksite konsolideerima? Mis on selle eesmärk? Millist UTXO suurust peaksite püüdma saavutada? Millised on kompromissid eraelu puutumatuse osas? Seda püüame käesolevas osas uurida.

### Mis on konsolideerimine?

Bitcoini toimimine sarnaneb oksjonituruga, kus kaevandajad eelistavad parimaid tasusid pakkuvaid tehinguid. Igal plokil on siiski maksimaalne kaal, mis piirab tehingute arvu, mida saab kaasata. Kuna plokki toodetakse keskmiselt iga 10 minuti tagant, on igas plokis olemasolev ruum haruldane ressurss.

Kaevandajad, kelle tegevus on seotud märkimisväärsete elektri-, kapitali- ja hoolduskuludega, püüavad loomulikult maksimeerida oma kasumlikkust. Nad kipuvad eelistama tehinguid, mis pakuvad neile nende kaalu suhtes kõige kõrgemaid tasusid.

Tegelikult ei ole kõik Bitcoini tehingud ühesuguse kaaluga. Need, millel on rohkem sisendit ja väljundit, kaaluvad rohkem. Võtame näiteks 2 tehingut:


- Tehing A sisaldab 1 sisendit ja 1 väljundit. See määrab 1,994 sats tasu ja selle kaal on 141 vB;
- Keerukam tehing B, millel on 2 sisendit ja 2 väljundit, jaotab 2640 sati komisjonitasu, mille kaal on 220 vB.

Kuigi tehing B pakub kõrgemat komisjonitasu, eelistavad kaevurid näites tehingut A, sest see pakub paremat komisjonitasu suhet. Siin on iga tehingu arvutused, väljendatuna satsides virtuaalse baidi kohta (sat/vB):

```text
TXA: 1994 / 141 = 14 sat/vB
TXB: 2640 / 220 = 12 sat / vB
```

See tähendab, et tehing A pakub iga kaaluühiku eest rohkem tasu kui tehing B, kuigi viimane pakub absoluutväärtuses rohkem tasu.

Seetõttu on kasutaja jaoks üha atraktiivsem tarbida oma tehingutes võimalikult vähe sisendit. Siiski on vaja tarbida piisavas koguses, et rahuldada väljundmakse. Oma portfelli haldamisel on seega vaja piisavalt suuri UTXOsid.

Konsolideerimise põhimõte seisneb just selles, et kasutada ära perioodid, mil Bitcoini tasud on madalad, et ühendada oma väikesed UTXOd üheks suuremaks UTXOks. Seega, kui Bitcoini tasud tõusevad, saab teha tehinguid minimaalse sisendiga ja seega kulutada vähem absoluutseid tasusid. Eesmärk on planeerida kohustuslike tehingute tegemine kõrgete tasude perioodidel.

Lisaks tehingutasude kokkuhoiule aitab UTXOde konsolideerimine vältida "tolmu" tekkimist Tolmu all mõeldakse UTXOsid, mille väärtus satsides on nii väike, et sellest ei piisa nende kulutamiseks vajalike tehingutasude katmiseks. See muudab nende UTXOde kasutamise majanduslikult ebamõistlikuks, kuni tehingutasud on kõrged. Kui te rühmitate oma UTXO-d ennetavalt, takistate nende tolmuks muutumist, tagades, et kõik teie rahalised vahendid jäävad kasutuskõlblikuks.

### Milline on teie UTXOde minimaalne suurus?

Mõnikord küsitakse minult, milline on UTXO minimaalne soovitatav väärtus. Kahjuks ei ole universaalset vastust, sest see sõltub teie eelistustest ja turutingimustest komisjonitasude osas. Siin on siiski valem, mis aitab teil määrata teie vajadustele vastava künnise:

$$
\frac {P \times F}T = M
$$

Kus:


- $P$ on tehingu kaal;
- $F$ tähistab maksimaalset määra satoshi vbyte'i kohta (sats/vB), mida olete valmis katma;
- $T$ on tehingutasu protsent, mida olete valmis maksma UTXO koguväärtusest;
- $M$ on iga UTXO minimaalne summa satoshides.

Eeldades, et soovite katta 1 sisendi ja 2 väljundiga standardse SegWit-tehingu komisjonitasud, kaalub 141 vB. Kui te katate kuni 800 sats/vB ja olete valmis kulutama maksimaalselt kuni 12 protsenti UTXO väärtusest komisjonitasudeks, siis oleks arvutus järgmine:

$$
\frac{141 \times 800}{0.12} = 940\ 000
$$

Selle näite puhul oleks mõistlik säilitada UTXOde miinimumväärtus 940 000 sat oma portfellis.

### Konsolideerimine ja COIH

Üks kõige laialdasemalt kasutatav heuristika plokiahela analüüsis on COIH (_Common Input Ownership Heuristic_), mis võimaldab meil eeldada, et kõik Bitcoini tehingu sisendid kuuluvad samale üksusele. Täpsemalt on konsolideerimise põhimõte see, et sisendina tarbitakse mitu UTXOd ja väljundina luuakse üks UTXO. Seetõttu võimaldab konsolideerimine COIHi kohaldamist.

![BTC204](assets/fr/097.webp)

Praktikas tähendab see, et väline vaatleja võib järeldada, et kõik konsolideeritud UTXOd kuuluvad tõenäoliselt samale isikule ja et ainus genereeritud väljund kuulub samuti talle. Selline olukord võib ohustada teie privaatsust, kuna erinevaid tehingulugusid seotakse omavahel. Näiteks ütleme, et ma konsolideerin 3 P2P kaudu omandatud UTXOd ühe UTXOga, mis on saadud KYCi nõudva platvormi kaudu:

![BTC204](assets/fr/098.webp)

Seda tehes saab iga üksus, kellel on juurdepääs vahetusplatvormi andmetele, sealhulgas potentsiaalselt valitsusasutused, tuvastada, et mul on muid summasid BTC-s. Varem ei olnud need UTXOd otseselt minu identiteediga seotud; nüüd on nad seda. Peale selle paljastab see kõigile allikatele, et mul on teatud summa bitcoine.

TÜKide haldamisel on majanduslikud kaalutlused, mis nõuavad konsolideerimist tasude vähendamiseks, seega vastuolus heade privaatsustavadega, mis soovitavad mitte kunagi oma TÜKe ühendada. Valik majanduse ja eraelu puutumatuse vahel sõltub seega iga kasutaja prioriteetidest.

Kui saate vältida konsolideerimist, säilitades samal ajal UTXOde märkimisväärse suuruse, on see ideaalne. Selleks optimeerige oma omandamismeetodeid. Kui ostate oma bitcoinid DCA-s, püüdke oma ühekordsed ostud võimalikult laialt paigutada, et koondada väärtus vähemasse UTXOsse. Lihtsam on hallata 1000 euro suurust ühekordset ostu iga kahe kuu tagant kui 120 euro suurust ostu iga nädal. See minimeerib loodud UTXOde arvu ja lihtsustab teie portfelli haldamist, säilitades samal ajal teie privaatsust.

Kui teil on vaja oma bitcoine konsolideerida, siis seadke prioriteediks samast allikast pärit UTXOde konsolideerimine. Näiteks 10 UTXO ühendamine ühelt platvormilt mõjutab teie privaatsust vähem kui 5 UTXO ühendamine platvormilt A ja 5 UTXO platvormilt B. Kui eri allikatest pärit konsolideerimine on vältimatu, püüdke neid eraldada vastavalt nende omadustele. Näiteks grupeerige KYCi kaudu saadud UTXOd ühte tehingusse ja P2P kaudu saadud UTXOd teise tehingusse.

Igal juhul pidage meeles, et igasugune konsolideerimine toob paratamatult kaasa eraelu puutumatuse kaotuse. Seetõttu hinnake hoolikalt selle vajadust ja võimalikku mõju teie eraelu puutumatusele, võttes arvesse riski.

## Muud head tavad

<chapterId>b5216965-7d13-4ea1-9b7c-e292966a487b</chapterId>

Uurime koos mõningaid teisi parimaid tavasid, mis aitavad teil Bitcoini privaatsust optimeerida.

### Täielik sõlm

Oma bitcoinide hoidmine on hea, kuid oma täieliku sõlme kasutamine on parem! Seepärast on oma sõlme omamine bitcoini täiesti suveräänseks kasutamiseks ülioluline:


- Vastupanu tsensuurile**: Teie tehinguid ei saa keegi blokeerida;
- Sõltumatus kolmandatest isikutest**: Te ei sõltu enam ühestki välisest teenusest, et kontrollida plokiahela andmeid;
- Aktiivne osalemine**: Teil on võimalus kehtestada oma valideerimisreeglid ja osaleda otse konsensuses;
- Panus võrgustikku**: Kasutades sõlme, aitate tugevdada ja levitada Bitcoini võrgustikku;
- Tehniline haridus**: Täieliku sõlme käivitamine on suurepärane võimalus süvendada oma tehnilisi teadmisi Bitcoini kohta.

Lisaks nendele eelistele parandab täieliku sõlme kasutamine ka teie privaatsust tehingute edastamisel. Kui te annate tehingu välja, luuakse ja allkirjastatakse see kõigepealt teie rahakoti kaudu. Selle edastamiseks Bitcoini võrgus peab see olema teada vähemalt ühele sõlmpunktile. Kasutades oma sõlme, kontrollite seda edastamist otse, parandades seega oma privaatsust ja piirates andmekaotuse ohtu.

![BTC204](assets/fr/099.webp)

Kui teil ei ole oma Bitcoini sõlme, olete sunnitud kasutama kolmanda osapoole sõlme, näiteks rahakoti tarkvara pakkuja pakutavat sõlme. Lisaks tehingute edastamisele vajab teie rahakott juurdepääsu erinevatele andmetele, nagu näiteks pooleliolevad tehingud, teie aadressidega seotud saldod või teie tehingute kinnituste arv. Kõigile nendele andmetele juurdepääsuks peate tegema päringu sõlme.

![BTC204](assets/fr/100.webp)

Peamine risk, kui te ei kasuta oma Bitcoini sõlme, on see, et kolmanda osapoole sõlme operaator võib jälgida teie tegevust plokiahelas või isegi jagada seda teavet teiste üksustega. Selle riski piiramiseks on vahepealne lahendus kasutada rahakoti tarkvara, mis võimaldab teil oma ühendusi Tori kaudu maskeerida. See võib vähendada teie andmete paljastamist. Optimaalne lahendus on siiski endiselt oma Bitcoini sõlme omamine ja selle kasutamine oma tehingute edastamiseks. Loomulikult peate ka tagama, et teie sõlme kaudu ei lekiks mingit teavet, kuid see on teine teema, mida käsitleme järgmistes punktides.

Lisaks ilmselgele kasule teie privaatsusele tagab oma täieliku sõlme omamine ka andmete tõepärasuse plokiahelas, kaitseb tsensuuri eest ja võimaldab teil aktiivselt osaleda Bitcoini juhtimises. Kasutades oma sõlme, panustate oma majandusliku kaalu valitud plokiahelasse, mis on oluline kogukonnas toimuvate konfliktide ajal, nagu näiteks aastatel 2015-2017 toimunud plokisõja ajal. Kahvli korral võib kolmanda osapoole sõlme kasutamine viia selleni, et toetate ahelat, mida te ei soovi eelistada, sest sõlme operaator teeb teie eest valiku. Nagu saate aru, on privaatsuse ja üldisemalt individuaalse suveräänsuse seisukohast oluline käivitada ja kasutada oma täielikku sõlme!

### Petturanalüüsi heuristika

Üldisemalt on oluline mõista eelmises punktis käsitletud heuristikat, et neid paremini vältida või petta. Mitmete parimate tavade omaksvõtmine võib osutuda kasulikuks, isegi kui need ei ole hädavajalikud. Need pakuvad täiendavat kaitsekihti, mis võib olla oluline hea privaatsuse säilitamiseks Bitcoini kasutamisel.

Esimene nõuanne, mida ma võiksin anda, on sulanduda kõige tihedamasse rahvamassi. Bitcoini puhul tähendab see kõige laialdasemalt kasutatavate skripti mallide kasutamist. Näiteks P2WSH skriptid, mida kasutatakse sageli multisig SegWit V0 konfiguratsioonide jaoks, on väga haruldased. Need ei võimalda teil varjuda suures koguses anonüümsust. Sama kehtib ka vanemate mudelite, näiteks P2PKH või P2SH kohta. Kuigi need on UTXO komplektis laialdaselt esindatud, kasutatakse neid üha vähem uute tehingute puhul.

Üldiselt on turvalisem liikuda uusima skriptistandardi suunas, kui see on piisavalt omaks võetud. Seega, kui 2022. aastal oleksin soovitanud mitte kasutada P2TR-i (Taproot), kuna see on vähe levinud, siis 2024. aastaks soovitaksin valida seda tüüpi skripti või selle puudumisel SegWit V0 skripti, kuna P2TR-i kasutavate tehingute arv hakkab moodustama väga märkimisväärse osa.

Allikas:[txstats.com](https://txstats.com/d/000000054/utxo-set-repartition-by-output-type)

Veel üks nõuanne privaatsuse säilitamiseks on püüda mööda hiilida sisemist tehinguheuristikat. Näiteks makse tegemisel võiksite püüda vältida ümmarguse summaga väljundi loomist, sest see võib anda märku, et teine väljund kujutab endast muutust. Kui teil on vaja saata sõbrale 100k satoshi, kaaluge selle heuristika vältimiseks veidi suurema summa ülekandmist. Samamoodi püüdke mitte luua jäägi väljundeid, mis on ebaproportsionaalselt suured võrreldes tehtud maksega, sest see võib samuti paljastada, milline väljund kujutab endast jääki.

Lõpuks, kui teete regulaarselt Bitcoin-tehinguid, veenduge, et te ei edasta neid alati samal ajal. Kui jaotate oma tehingute edastamise üle päeva ja nädala, väldite seda, et välised vaatlejad saaksid tuvastada ajavöönditel põhinevat ajamustrit, mis võiks nende analüüsi parandada.

Lisaks kõigile neile parimatele tavadele, mida igapäevaselt rakendada, on veelgi tõhusamaid meetodeid, et täielikult katkestada oma bitcoinide jälgitavus. Nende hulka kuuluvad muidugi coinjoin-tehingud, mida uurime põhjalikult järgmises jaotises.

# Coinjoin-tehingute mõistmine

<partId>6d0bbf16-3714-4db1-9897-2d45019f6bdc</partId>

## Mis on Coinjoin-tehing?

<chapterId>0862bc6b-1c48-4aa4-b76d-4f547b469008</chapterId>

Olles uurinud privaatsuse kaitse põhitõdesid, arutame nüüd keerukamaid tehnikaid, mille eesmärk on aktiivselt kaitsta teie privaatsust, eelkõige bitcoinide ajaloo lahtiseletamise kaudu. Järgmises osas uurime mitmeid väiksemaid tehnikaid, kuid kõigepealt tahan teile rääkida coinjoinist.

Coinjoini peetakse sageli kõige tõhusamaks viisiks Bitcoini kasutajate privaatsuse kaitsmiseks. Kuid mis on täpselt coinjoin-tehing? Uurime seda koos.

### Coinjoini põhiprintsiibid

Coinjoin on tehnika, mis häirib bitcoinide jälgimist plokiahelas. Selle aluseks on koostöötehing, millel on samanimeline eriline struktuur: coinjoin-tehing.

Nagu me nägime selle koolituse esimestes osades, on Bitcoini tehingud kõigile kasutajatele teada nende sõlme kaudu. Seetõttu on lihtne kontrollida iga mündi elektroonilise allkirja ahelat ja jälgida selle ajalugu. See tähendab, et kõik kasutajad saavad proovida analüüsida teiste kasutajate tehinguid. Selle tulemusena on anonüümsus tehingu tasandil võimatu. Anonüümsus säilib aga individuaalse identifitseerimise tasandil. Erinevalt traditsioonilisest pangandusest, kus iga konto on seotud isikliku identiteediga, on Bitcoinis raha seotud krüptograafiliste võtmepaaridega (või skriptidega), pakkudes seega kasutajatele krüptograafiliste identifikaatorite taga pseudonüümsust.

![BTC204](assets/it/51/01.webp)

Seega on bitcoini konfidentsiaalsus ohus, kui välised vaatlejad saavad seostada konkreetseid UTXOsid tuvastatud kasutajatega. Kui see seos on loodud, on võimalik jälgida nende tehinguid ja analüüsida nende bitcoinide ajalugu. Coinjoin on just UTXOde jälgimise häirimiseks välja töötatud tehnika, et tagada Bitcoini kasutajatele teatud tasemel konfidentsiaalsus tehingu tasandil.

Coinjoins parandab Bitcoini kasutajate konfidentsiaalsust, raskendades ahela analüüsi kõrvaliste vaatlejate jaoks. Nende struktuur võimaldab ühendada mitu eri kasutajate münti üheks tehinguks, mis muudab jäljed ebaselgeks ja raskendab seoste kindlaksmääramist sisend- ja väljundaadresside vahel.

Oluline on mõista, et coinjoin-tehingu eesmärk on katkestada mündi ajalugu. Vastupidiselt sellele, mida võiks arvata, ei anna see tehnika püsivat anonüümsust ega lõpeta lõplikult bitcoinide jälgitavust. Coinjoin'i eesmärk on katkestada ajalugu vaid hetkel, mil coinjoin-tehing tehakse. Kuid enne ja pärast seda tehingut on mündi suhtes endiselt samad privaatsusriskid.

![BTC204](assets/fr/104.webp)

### Kuidas toimivad ühisliited?

Coinjoin'i põhimõte põhineb koostööl: mitu kasutajat, kes soovivad oma bitcoin'eid segada, hoiustavad ühesuguseid summasid sama tehingu sisenditesse. Seejärel jaotatakse need summad igale kasutajale võrdse väärtusega väljunditeks ümber.

![BTC204](assets/fr/105.webp)

Tehingu lõpus on võimatu seostada konkreetset väljundit teadaoleva kasutaja sisendiga. Sisendite ja väljundite vahel puudub otsene seos, mis katkestab seose kasutajate ja nende UTXOde vahel, samuti iga mündi ajaloo.

![BTC204](assets/fr/106.webp)

Võtame näiteks Alice'i. Ta soovib saata oma õele Eve'ile sünnipäevaks umbes 100 000 satoshi (sats). Alice ei taha aga, et Eve saaks jälgida tema tehingulugu, sest ta ei taha avaldada, kui palju bitcoine ta omab või kuidas ta need sai. Selleks otsustab Alice katkestada oma UTXO ajaloo coinjoin-tehinguga. Ta lepib Bobi, Charlesi, Davidi ja Frankiga kokku, et nad teevad ühistehingu: Alice, Bob, Charles, David ja Frank lubavad igaüks tehingu sisendiks 105 000 sati UTXO (koos 5000 sati kaevandamistasuga):

![BTC204](assets/fr/107.webp)


- Vastutasuks nende sisendite kasutamise eest genereerib igaüks uue aadressi, et luua viis identset väljundit 100 000 satsiga igaüks. Iga osaleja saab ühe väljundi:

![BTC204](assets/fr/108.webp)


- Alice jõuab 100 000 satelliidi UTXO-ga, mille ajalugu on segane. Ta kasutab seda UTXO-d uues tehingus, et saata summa Eve'ile tema sünnipäevaks:

![BTC204](assets/fr/109.webp)


- Kui Eve üritab seda tehingut analüüsida, et saada teavet, siis satub ta kokku coinjoin-tehinguga, mis hõlmab Alice'i, Bobi, Charlesi, Davidit ja Franki. Kuna Eve ei saa summade ühetaolisuse tõttu eristada, kellele iga sisend kuulub, ei saa ta jälgida Alice'i UTXO ajalugu ega kindlaks teha, kui palju bitcoin'e tema õde omab või kuidas ta need omandas:

![BTC204](assets/fr/110.webp)

Selles stsenaariumis kasutas Alice coinjoin-tehnikat, et suurendada oma privaatsust tagurpidi analüüsi vastu. Tegelikult kaitseb Alice end Eve'i võimaliku analüüsi eest, mis lähtuks konkreetsest tehingust, et jälgida UTXO ajalugu tagasi. Sellist kaitset analüüside eest olevikust minevikku nimetame tagasiulatuvaks anonüümseks (retrospective anonset). Uurime seda mõistet üksikasjalikumalt selle osa viimastes peatükkides.

Siiski pakub coinjoin ka võimalust parandada privaatsust minevikust olevikku analüüsi vastu, mida nimetatakse prospektiivseks anonsetiks. Tuleme tagasi meie näite juurde, kus Alice saatis Eve'ile 98 000 sati tema sünnipäeval, kuid vahetame rollid ümber. Kujutame nüüd ette, et see on Eve, kes on mures oma privaatsuse pärast. Tegelikult võib Alice'il tekkida kiusatus jälgida tema poolt Eve'ile saadetud münti, et koguda teavet. Eve võiks seda äsja saadud UTXO-d konsolideerida kõigi oma teiste UTXO-dega, mis võiks Alice'ile paljastada, kui palju bitcoin'e ta oma rahakotis hoiab. Selle vältimiseks võib Eve häirida ka äsja saadud mündi ajalugu.


- Eve, Grace, Mallory, Oscar ja Victor panid igaüks 98 000 sati UTXO-d Bitcoini tehingu sisendiks:

![BTC204](assets/fr/111.webp)


- Vastutasuks nende sisendite kasutamise eest annab igaüks uue aadressi, et luua 5 väljundit 97 500 sati kohta, mis on täiesti võrdsed. Iga kasutaja saab ühe väljundi:

![BTC204](assets/fr/112.webp)


- Eve omab nüüd 97 500 sati UTXO-d, mille ajalugu on katkenud. Ta võib seda kartuseta kasutada tulevaste tehingute tegemiseks. Tegelikult, kui Alice üritab jälgida tema poolt Eve'ile saadetud bitcoine, satub ta coinjoin-tehingule. Ta ei suuda kindlaks teha, millisesse UTXO väljundisse Eve kuulub. Analüüs muutub siis võimatuks:

![BTC204](assets/fr/113.webp)

Esimeses näites nägime, kuidas coinjoin võib kaitsta mündi privaatsust seoses selle minevikuga ja teises näites, kuidas see võib kindlustada mündi ajalugu ka seoses selle tulevikuga. Seepärast mainisin, et coinjoin'i tuleks vaadelda kui ühekordset sündmust, mis segmenteerib mündi ajalugu mõlemas suunas:

![BTC204](assets/fr/104.webp)

### Segamine, koosliitmised, segajad... Mis vahe on?

Mõnikord kasutatakse terminit "segamine", mida mõned bitcoin'id ei kasuta, sest kardavad segiajamist hoiusegajatega. Minu arvates on see kartus siiski alusetu, sest matemaatilises kontekstis kehastab coinjoin just segamise mõistet.

Üldises matemaatikas tähendab segunemine dünaamilise süsteemi omadust, mille puhul teatava aja möödudes võivad kõik algruumi osad teoreetiliselt seguneda mis tahes muu osaga. Segunemine tähendab, et osakese asukoht või süsteemi olek areneb nii, et selle tulevane jaotus ei sõltu selle algjaotusest, saavutades seega seisundi, kus algseisundi omadused on süsteemi ruumis ühtlaselt jaotunud. Just see juhtub bitcoinidega seotud mündiühenduses. Seega on minu arvates coinjoin tegelikult mündi segamise meetod.

![BTC204](assets/fr/114.webp)

Oluline on siiski eristada koosliiteid segajatest. Mikser on teenus, kuhu kasutajad saadavad oma bitcoinid segamiseks. Need teenused olid 2010. aastatel populaarsed, kuid nende kasutamine on kahanenud kahe peamise puuduse tõttu võrreldes coinjoiniga:


- Nad nõuavad, et kasutajad loovutaksid oma rahaliste vahendite hoidmise segamise ajal, mis tähendab, et nad on avatud varguse ohule;
- Ei ole mingit garantiid, et mikser ei salvesta tehingu üksikasju või isegi ei müü seda teavet plokiahela analüütikafirmadele.

![BTC204](assets/fr/115.webp)

Seetõttu eelistavad kasutajad tänapäeval coinjoin'i, kuna see võimaldab neil säilitada kogu protsessi jooksul täieliku kontrolli oma raha üle. Coinjoinis osalejad ei riski, et nende bitcoinid varastatakse teiste osapoolte poolt. Uurime üheskoos, kuidas see on võimalik järgmises peatükis.

## Zerolink ja Chaumian Coinjoins

<chapterId>326c9654-b359-4906-b23d-d6518dd5dc3e</chapterId>

Koondise poolt pakutav privaatsus põhineb selle rühma suurusel, kuhu meie tükk on peidetud. Seetõttu on vaja leida võimalikult palju osalejaid. On täiesti võimalik käivitada coinjoin käsitsi, sõltumatult leitud kasutajatega, kuid see meetod on keeruline ja ei võimalda suuri anonüümide kogumeid.

Seetõttu on Bitcoini kohta välja töötatud coinjoin-koordinaatorid. Nende ülesanne on ühendada erinevad kasutajad ja edastada ühistehingu edukaks lõpuleviimiseks vajalikku teavet.

![BTC204](assets/fr/116.webp)

Kuid kuidas saame tagada, et koordinaatoril ei ole kunagi kontrolli kasutajate bitcoinide üle, ja kuigi ta on isik, kes konstrueerib coinjoin-tehingu, kuidas saame tagada, et ta ei saa ühendada kasutajate sisendeid ja väljundeid, mis võib tähendada privaatsuse kaotamist?

### Chaumi pimedad allkirjad

Kaasaegsed coinjoin rakendused kasutavad David Chaumi pimesi allkirju, et vältida teabe lekkimist. Uurime koos kiiresti, kuidas need pimedad allkirjad töötavad.

Chaumi pimedad allkirjad on digitaalallkirja vorm, mille puhul allkirja andja ei tea allkirjastatava sõnumi sisu. Allkirja saab aga hiljem kontrollida originaalsõnumi abil. Selle tehnika töötas 1983. aastal välja krüptograaf David Chaum.

Võtame näiteks ettevõtte, kes soovib autentida konfidentsiaalset dokumenti, näiteks lepingut, paljastamata selle sisu. Ettevõte rakendab maskeerimisprotsessi, mis muudab originaaldokumenti krüptograafiliselt pöördvõrreldes. See muudetud dokument saadetakse sertifitseerimisasutusele, kes annab pimesi allkirja, teadmata selle sisu. Pärast allkirjastatud dokumendi kättesaamist eemaldab ettevõte allkirjast maskeeringu. Tulemuseks on originaaldokument, mis on kinnitatud asutuse allkirjaga, ilma et asutus oleks kunagi näinud algset sisu.

Chaumi pimedad allkirjad võimaldavad seega dokumendi autentsuse tõendamist ilma selle sisu tundmata, tagades nii kasutaja andmete konfidentsiaalsuse kui ka allkirjastatud dokumendi terviklikkuse.

### Chaumian Coinjoins

Chaumian CoinJoins'i puhul kombineeritakse Tor ja David Chaumi pimedad allkirjad, et koordinaator ei saaks teada, millisele kasutajale iga väljund kuulub. Coinjoin-tehingute loomise protsess koosneb kolmest peamisest etapist: sisendi registreerimine, väljundi registreerimine ja tehingu allkirjastamine. Vaatleme seda protsessi ühe coinjoin'i osaleja Alice'i näitel. Kõik teised osalejad järgivad samu samu samme nagu Alice, igaüks omaette.

**Samm 1: Sisendite registreerimine.**


- Alice saadab koordinaatorile UTXO, mida ta soovib kasutada tehingu sisendina, ning maskeeritud vastuvõtu aadressi, mida ta soovib kasutada väljundina oma bitcoinide vastuvõtmiseks. Seetõttu ei saa koordinaator teada Alice'i aadressi. Ta näeb ainult tema maskeeritud versiooni.
- Koordinaator kontrollib sisendite kehtivust, seejärel allkirjastab Alice'i maskeeritud aadressi tema isikliku võtmega. Seejärel saadab ta Alice'ile pimeallkirja.

**Samm 2: Väljundite salvestamine.**


- Alice saab nüüd eemaldada maskeeringu oma aadressilt, mis on allkirjastatud koordinaatori privaatvõtmega. Ta loob uue ühenduse teise Tori identiteedi all. Koordinaator ei saa tuvastada, et see on Alice, kes ühendub selle uue identiteedi all.
- Alice saadab varjatud aadressi ja allkirja koordinaatorile (kes ei tea endiselt, et tegemist on Alice'iga).

**Samm 3: allkirjastage tehing.**


- Koordinaator hangib samamoodi kõigilt osalejatelt maskeerimata väljundid. Seotud allkirjade abil saab ta kontrollida, et iga anonüümselt saadetud väljund on tegelikult eelnevalt tema isikliku võtmega allkirjastatud, tagades selle õiguspärasuse. Seejärel on ta valmis koostama mündiühendustehingu ja saadab selle osalejatele allkirjastamiseks.
- Alice, nagu ka teised osalejad, kontrollib, et tema sisend ja väljund on korrektselt lisatud koordinaatori koostatud tehingusse. Kui kõik on rahuldav, saadab ta koordinaatorile allkirja, mis avab tema sisendi käsikirja.
- Pärast allkirjade kogumist kõigilt coinjoin'i osalejatelt saab koordinaator edastada tehingu Bitcoini võrgu kaudu, et see saaks lisada blokki.

Selles süsteemis ei ole koordinaatoril võimalik sisendit konkreetse väljundiga siduda. Lisaks sellele ei saa ta osalejate rahalisi vahendeid enda valdusesse võtta, kuna tal ei ole kunagi juurdepääsu nende UTXOde avamiseks vajalikele isiklikele võtmetele. Kogu protsessi jooksul ja kuni 3. etapi lõpuni ei ole tal isegi juurdepääsu allkirjadele. Kui Alice ja teised osalejad allkirjastavad üldise tehingu, ei saa koordinaator pärast selle õigsuse kontrollimist enam seda tehingut, sealhulgas väljundeid, muuta, ilma et see kehtetuks muutuks. See takistab seega bitcoinide vargust koordinaatori poolt.

Lõpuks, kui nad registreerivad oma toodangu tehingus, soovib coinjoin kasutaja tagatisi, mis sarnanevad valimistel hääletava kodaniku tagatistega. Nende tegevuste avaliku ja erasektori aspektide vahel on kaksikmõju. Ühelt poolt on see, mida tahetakse hoida privaatsena: valija puhul ei taha ta, et tema hääletussedelit seostatakse tema identiteediga; coinjoin-kasutajal ei taha ta, et tema väljundit seostatakse tema sisendiga. Tegelikult, kui koordinaator või mõni muu osapool suudab luua seose sisendi ja väljundi vahel, kaotab coinjoin kogu oma eesmärgi. Nagu varem selgitatud, peab coinjoin toimima kui katkestus mündi ajaloos. See paus tekib just seetõttu, et coinjoin-tehingus ei ole võimalik seostada konkreetset sisendit konkreetse väljundiga (prospektiivne anonset) ja vastupidi (retrospektiivne anonset).

Teisest küljest on olemas avalik aspekt: valija tahab veenduda, et tema hääletussedel on hääletuskasti lisatud; samamoodi tahab coinjoin'i kasutaja veenduda, et tema väljund on lisatud coinjoin'i tehingusse. Tegelikult on absoluutselt vajalik, et coinjoinis osalejad saaksid enne tehingu allkirjastamist kontrollida oma väljundi olemasolu, sest vastasel juhul võib koordinaator raha varastada.

Just need 2 avalikku ja privaatset aspekti, mis on võimalik David Chaumi pimedate allkirjade abil, tagavad Chaumians coinjoin'i osalejatele, et nende bitcoine ei varastata ja et nende raha ei ole võimalik jälgida.

### Kes leiutas mõiste coinjoin?

On raske kindlalt kindlaks teha, kes esimesena tutvustas Bitcoini mündiühenduste ideed ja kes tuli välja ideega kasutada David Chaumi pimedat allkirja selles kontekstis. Sageli arvatakse, et Gregory Maxwell mainis seda esimesena [2013. aasta postituses BitcoinTalkis](https://bitcointalk.org/index.php?topic=279249.0):

Chaumi pimedate allkirjade kasutamine: Kasutajad ühenduvad ja esitavad sisendi (ja aadressid muu hulgas) ning krüptograafiliselt varjatud versiooni aadressist, kuhu nad soovivad saata oma privaatseid münte; server allkirjastab märgid ja saadab need kasutajatele tagasi. Kasutajad ühenduvad uuesti anonüümselt, paljastavad oma väljundaadressid ja saadavad need serverile tagasi. Server näeb, et kõik väljundid on tema poolt allkirjastatud ja seega on kõik väljundid pärit kehtivatelt osalejatelt. Hiljem ühenduvad inimesed uuesti ja allkirjastavad.

Maxwell, G. (2013, 22. august). _CoinJoin: Bitcoini privaatsus reaalses maailmas_. BitcoinTalk Forum. https://bitcointalk.org/index.php?topic=279249.0

Siiski on varem mainitud mõlemat Chaumi allkirja segunemise ja kaasühenduste kontekstis. [2011. aasta juunis tutvustas Duncan Townsend BitcoinTalkis](https://bitcointalk.org/index.php?topic=12751.0) segajat, mis kasutab Chaumi allkirju üsna sarnaselt tänapäeva Chaumi coinjoinidega.

Samas teemas on [hashcoini sõnum vastuseks Duncan Townsendile](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793), et parandada tema mikserit. Selles sõnumis kirjeldatud protsess kujutab endast just seda, mis on kõige lähemal coinjoinile. Sarnast süsteemi mainitakse ka [Alex Mizrahi sõnumis 2012. aastal](https://gist.github.com/killerstorm/6f843e1d3ffc38191aebca67d483bd88#file-laundry), kuna ta nõustas Tenebrixi loojaid, mis oli üks esimesi altcoin'e, mis hiljem oli aluseks Litecoini loomisele. Isegi terminit "coinjoin" ise ei leiutanud Greg Maxwell, vaid see tulenes Peter Toddi ideest.

![BTC204](assets/fr/125.webp)

### Zerolink

Zerolink on terviklik seguprotokoll, mis integreerib Chaumiani mündiühendused ja erinevad strateegiad, et kaitsta kasutaja anonüümsust erinevate ahelate analüüsi vormide eest, vähendades oluliselt rahakoti haldamisega seotud vigu. Selle protokolli [tutvustasid 2017. aastal nopara73 ja TDevD](https://github.com/nopara73/ZeroLink/blob/master/README.md).

![BTC204](assets/fr/126.webp)

Nagu nimigi ütleb, on Zerolinki põhimõte teha coinjoin-tehinguid, mis tagavad, et sisendite ja väljundite vahelisi seoseid ei ole võimalik jälgida. See omadus saavutatakse tagades, et kõik väljundid on täiesti identsed.

![BTC204](assets/fr/127.webp)

Zerolinki oluline ennetav meede hõlmab segamata UTXOde täielikku eraldamist segatud UTXOdest, kasutades selleks eraldi krüptograafilisi võtmekomplekte või isegi eraldi rahakotte. Sel viisil eristatakse "segamiseelne" rahakott, mis on mõeldud müntidele enne segamist, "segamisjärgsest" rahakotist, mis on reserveeritud segatud müntidele.

![BTC204](assets/fr/128.webp)

Selline UTXOde range eraldamine on eelkõige selleks, et vältida juhuslikke assotsiatsioone segatud ja segamata UTXOde vahel. Tegelikult, kui sellised seosed tekivad, muutub coinjoin'i tõhusus segatud UTXOs kasutaja teadmata olematuks, ohustades seega sellise UTXO konfidentsiaalsust, mille ajalugu arvati olevat rikutud. Sellised seosed võivad tekkida kas aadressi taaskasutamise kaudu, et kindlustada segatud UTXO segamata UTXOga, või ühise sisendi omandiõiguse heuristika (Common Input Ownership Heuristics, CIOH) rakendamise kaudu, kui kasutaja kasutab segatud ja segamata UTXOd sama tehingu sisenditena. Segamiseelsete ja segamisejärgsete portfellide eraldamisega välditakse selliseid juhuslikke ühendusi ja kaitstakse kasutajat tahtmatute vigade eest.

![BTC204](assets/fr/129.webp)

Selline eraldamine annab ka võimaluse kohaldada portfelli tarkvara tasandil erinevaid eeskirju portfellide segunemiseelse ja segunemisejärgse segunemise vahel. Näiteks võib tarkvara segunemisjärgse portfelli puhul keelata sisendiks olevate UTXOde ühendamise, et vältida CIOHi kohaldamist, mis kahjustaks kasutaja anonset. Samuti on võimalik standardiseerida skriptide ja tehinguvalikute (näiteks RBF-signalisatsioon) kasutamist, et vältida tuvastamist rahakoti sõrmejälgede abil.

Hetkel on Whirlpool ainus coinjoini rakendus, mis järgib rangelt Zerolinki protokolli. Järgnevas peatükis uurime erinevaid olemasolevaid coinjoini rakendusi ning nende eeliseid ja puudusi.

## Coinjoin rakendused

<chapterId>e37ed073-9498-4e4f-820b-30951e829596</chapterId>

_2024. aastal näeme olulisi muudatusi tööriistades, mis on kättesaadavad kasutajatele, kes soovivad Bitcoini mündiühendusi käivitada. Oleme praegu otsustaval perioodil ja coinjoin-turul toimub suur ümberstruktureerimine. Seetõttu ajakohastatakse seda peatükki tõenäoliselt aja jooksul._

Hetkel on Bitcoinis peamiselt 3 erinevat coinjoin'i rakendust:


- Whirlpool;
- Wabisabi;
- JoinMarket.

Kõigi nende rakenduste eesmärk on murda UTXOde ajalugu coinjoin-tehingute kaudu. Nende mehhanismid erinevad siiski märkimisväärselt. Seetõttu on oluline mõista, kuidas iga neist töötab, et valida teie vajadustele kõige paremini sobiv variant.

### JoinMarket

2015. aastal Adam Gibsoni ja Chris Belcheri poolt loodud JoinMarket erineb teistest coinjoin'i rakendustest oma ainulaadse kasutaja sobitusmudeli poolest. See süsteem põhineb P2P-vahetusturul, kus mõned kasutajad, "tegijad", teevad oma bitcoinid segamiseks kättesaadavaks, samas kui teised, "võtjad", kasutavad neid vahendeid tasu eest coinjoinide teostamiseks.

![BTC204](assets/fr/130.webp)

Selle mudeli puhul jätavad "tegijad" oma bitcoinid "võtjatele" kättesaadavaks ja saavad oma teenuse eest tasu. Teisalt maksavad "võtjad" "tegijate" bitcoinide kasutamise eest, et teha oma coinjoin-tehinguid. Teenustasud varieeruvad vastavalt rollile: "tegijad" koguvad tasu oma likviidsuse pakkumise eest, samas kui "võtjad" maksavad komisjonitasu. See turg toimib vabalt ilma kasutustingimusteta.

JoinMarketi peamine puudus on selle kasutamise keerukus, mis eeldab selle tõhusaks kasutamiseks mõningaid teadmisi terminalidest. Kuigi see keerukus ei ole kogenud kasutajale takistuseks, võib see piirata üldsuse juurdepääsu. Hiljuti kasutusele võetud veebiliides nimega JAM on siiski mõnevõrra lihtsustanud selle kasutamist.

![BTC204](assets/fr/131.webp)

Allikas: [JAM](https://github.com/joinmarket-webui/jam/blob/devel/docs/assets/screenshot-dark.webp)

Tehnilised takistused on siiski endiselt suur takistus. Coinjoini ökosüsteemis, kus konfidentsiaalsust suurendab osalejate arv, mõjutab igasugune piirang, mis vähendab ligipääsetavust, otseselt kättesaadavat likviidsust, mis on oluline tegur segunemise tõhususe seisukohast. Bitcoin, mis on juba nišši finantstehingute valdkonnas, näeb coinjoinide kasutamist alamnišina ning JoinMarket esindab veelgi spetsialiseeritumat osa, piirates seega selle potentsiaali kasutajate anonüümsuse suurendamiseks.

Hoolimata oma uuenduslikust P2P-mudelist, mis sobib mündiühenduste jaoks, on JoinMarketil mõned olulised puudused, eriti tehingustruktuuri osas. Erinevalt teistest rakendustest, nagu Whirlpool, ei taga JoinMarket täiuslikku võrdsust väljundite vahel ning sisendite ja väljundite vahel saab luua deterministlikke seoseid. Samuti puuduvad vahendid, mis takistaksid juba segatud müntide uuesti segamist, mis võib ohustada kasutajate soovitud konfidentsiaalsust. Lõpuks, kuigi JoinMarketi kontseptsioon on atraktiivne, eriti neile, kes on huvitatud dünaamilisest likviidsusturust, muudavad selle struktuurilised puudused ja tehniline keerukus selle minu arvates vähem atraktiivseks nii algajatele kui ka ekspertidele, kes otsivad coinjoini rakendamist.

### Wabisabi

Wabisabi on veel üks coinjoini rakendus, mille puhul on tehingute koordineerimine tsentraliseeritud. Selle mudeli kavandasid Ádám Ficsór (nopara73), Yuval Kogman, Lucas Ontivero ja István András Seres 2021. aastal ning see integreeriti Wasabi 2.0 tarkvarasse järgmisel aastal. Wabisabi kujutab endast täpselt 2018. aastal käivitatud Wasabi tarkvara coinjoin-mudeli edasiarendust.

2010. aastate lõpus võttis Wasabi kasutusele oma coinjoinide tehingustruktuuri, mis erines radikaalselt Whirlpooli omast. Osalejate anonüümsuse suurendamiseks kasutas Wasabi väga suuri coinjoin-tehinguid, mis koondasid kümneid osalejaid. Seevastu Whirlpool valis mitu väikest tehingut, mis võimaldas iga tsükliga anonüümide arvu eksponentsiaalset suurenemist.

Ülejäänu käsitlemise meetodid eristasid samuti kahte rakendust. Whirlpooli puhul jäeti jääk välja ja isoleeriti UTXOdest enne coinjoin'i tsüklit TX0 abil, mida ma selgitan lähemalt järgmises peatükis. Seevastu Wasabi puhul moodustas jäägid ühe coinjoin-tehingu väljundi, säilitades deterministlikke seoseid mõnede sisendite ja väljundite vahel.

Wabisabi versioon 2.0 on kohandanud oma lähenemist coinjoins'ile nii, et see oleks lähedane Whirlpooli omale. Kuigi coinjoin-tehingud on endiselt väga suured, on nüüd võimalik mitu järjestikust vooru aheldada, järgides seega Whirlpooli mudelit. Erilist tähelepanu on pööratud ka vahetusraha haldamisele: erinevalt Wasabi 1.0-st, kus vahetusraha oli otseselt seotud kasutaja sisestusega, püüab Wabisabi vahetusraha jagada mitmeks väikeseks summaks, mis jagatakse kõigile osalejatele võrdsete nimiväärtustega.

Illustreerime seda lihtsustatud näite abil, mis hõlmab ainult 2 kasutajat: Alice soovib segada 115 000 sati ja Bob 210 000 sati. Ignoreerides komisjonitasusid, oleks Wasabi 1.0 puhul coinjoin-tehing tekitanud 3 väljundit 100 000 satsist, pluss 1 jääk 15 000 satsist Alice'ile ja 1 jääk 10 000 satsist Bobile. Ülejäänud väljundid oleksid alati seotud sisenditega:

Wabisabi puhul toodaks sama tehing 3 väljundit 100 000 satsist ja 5 väljundit 5000 satsist, hajutades seega ülejäänu nii, et see ei ole otseselt seostatav konkreetse sisendiga:

Mina isiklikult usun, et muudatuste haldamine Wabisabis kätkeb endas mitmeid riske, mis võivad ohustada selle tõhusust eraelu puutumatuse osas:


- Kui kasutaja panustab teiste osalejate omast oluliselt suurema UTXO, siis jõuab ta paratamatult muutuste summa, mis on seotud tema panusega. See on vastuolus protokolli algse eesmärgiga, mille eesmärk on kõrvaldada igasugune tuvastatav muutus;
- Nimetuste paljundamine, et ülejäänud killustada, võib paradoksaalselt kahjustada segamise tõhusust. See protsess võib viia teatud väljundite anonüümide vähenemiseni, kuna need muutuvad kergemini identifitseeritavaks;
- See meetod tekitab ka madala väärtusega UTXOsid, mis tekitavad kasutajale haldusprobleeme. Need väikesed UTXOd võivad muutuda "tolmuks", kui nende kulutamine muutub nende väärtuse suhtes liiga kalliks See nähtus sunnib kasutajat oma tulevastes tehingutes mitu sisendtuletatud UTXOd ühendama või neid konsolideerima. Mõlemal juhul võib see COH tõttu vähendada saadud anonüümseid summasid või tühistada täielikult esialgsest mündiühendusest saadud privaatsuse eelised.

Erinevalt Whirlpoolist, mis rakendab ZeroLink-protokolli, tagades UTXO eelsegude ja järelsegude range eraldatuse, ei säilita Wabisabi sellist ranget eraldatust. Samuti on esinenud probleeme aadresside korduvkasutamisega mõnede Wasabi klientide poolt, mis on ilmselgelt väga kahjulik kasutajale.

Wasabi versioonis 2.0 võeti kasutusele uus coinjoin-hinnakujunduspoliitika. Nüüd on koordinaatoritasud määratud 0,3 protsendile UTXOde puhul, mis on suuremad kui 0,01 bitcoini, samas kui väiksemate UTXOde puhul on need tasud täielikult nullis. Lisaks on nende väiksemate UTXOde puhul remixid tasuta, kuigi kaevandamistasud jäävad kõigi tehingute, sealhulgas remixide eest.

See poliitika erineb Whirlpooli omast, kus komisjonitasud jäävad fikseerituks, sõltumata saadud anonüümide suurusest. Wasabi 2.0 puhul, kuigi koordinaatorite komisjonitasud on väikeste UTXOde puhul nullistatud, peab kasutaja ikkagi maksma kaevandamise komisjonitasu kõigi tehingute, sealhulgas remixide eest.

Käesoleva artikli kirjutamise ajal on Wabisabi kasutamine muutunud hiljutiste sündmuste tõttu märkimisväärselt keerulisemaks. Tõepoolest, pärast Samourai rahakoti asutajate vahistamist teatas Wasabi arendamist rahastav ja haldav ettevõte zkSNACKs, et lõpetab 1. juunil 2024 oma mündiühenduse koordineerimisteenuse. See koordineerija, mis oli määratud Wasabile vaikimisi, omas valdavat osa likviidsusest.

Pärast selle peamise koordinaatori sulgemist peavad kasutajad nüüd ühendust võtma uute sõltumatute koordinaatoritega. See muudatus tekitab probleeme: ühelt poolt ei pruugi uutel koordinaatoritel olla piisavat likviidsust, mis vähendab koosliitumise tõhusust privaatsuse seisukohast. Teisest küljest on oht, et võib tekkida pahatahtlik koordinaator. Selline olukord lisab olulisi uusi riske neile, kes soovivad Wabisabi kasutada.

Lisaks tehnilistele küsimustele tõstatab Wasabi taga oleva ettevõtte zkSNACKs otsus kasutada plokiahela analüütikaettevõtte teenuseid, et filtreerida osalejaid mündiühendustesse, tõsiseid eetilisi ja strateegilisi küsimusi. Esialgne idee oli takistada kurjategijate poolt Wasabil coinjoinide kasutamist, mis võib tunduda õiguspärane samm. Siiski tekitab see paradoksi: tasude maksmine koordinaatorile, kelle peamine ülesanne on suurendada kasutajate privaatsust, ainult selleks, et seejärel rahastada ettevõtet, mille eesmärk on kahjustada sama privaatsust.

Veelgi murettekitavam on filtreerimise põhimõte, mis on teravas vastuolus Bitcoini filosoofiaga pakkuda avatud ja tsenseerimata finantssüsteemi. Kuigi võib tunduda õigustatud soov välistada kuritegelik tegevus, võib selline filtreerimine olla suunatud ka üksikisikutele, kelle tegevus võib olla moraalselt õigustatud või sotsiaalselt kasulik, ehkki see on mõnes kontekstis ebaseaduslikuks liigitatud. Edward Snowdeni näide illustreerib seda dihhotoomiat suurepäraselt: mõned valitsused peavad teda oma paljastuste tõttu kurjategijaks, teised aga näevad teda kui informaatorit, kes tegutses avalikes huvides. See keerukus rõhutab filtreerimise võimalikku ohtu, mis võib hoolimata heast kavatsusest kahjustada õiguspärase kasutaja õigusi ja turvalisust. Oleksin võinud mainida ka teatud autoritaarsete režiimide all tagakiusatud aktiviste ja ajakirjanikke. Nagu te olete võib-olla arvanud, on minu eelistus kahtlemata Whirlpool-mudel Bitcoini mündiühenduste läbiviimiseks. See süsteem paistab silma oma ranguse poolest ja pakub paremaid tagatisi privaatsuse osas. Samuti on see ainus, mis pakub välja matemaatilises kontekstis täiuslikuks peetava segunemise. Minu arvates esindab see mudel Bitcoini mündiliitude tulevikku. Seetõttu kutsun teid üles seda mudelit järgmises peatükis põhjalikumalt uurima.

## Whirlpooli tegevus

<chapterId>bdbd7109-e36d-4b4f-a3c6-928df4e9bfda</chapterId>

Whirlpool erineb teistest coinjoin meetoditest selle poolest, et kasutab "_ZeroLink_" tehinguid, mis tagavad, et kõigi sisendite ja väljundite vahel ei ole tehniliselt võimalik mingit ühendust. Selline täiuslik segunemine saavutatakse struktuuri abil, kus iga osaleja panustab sisendina ühesuguse summa (välja arvatud kaevandamistasud), tekitades seega täiesti võrdseid väljundeid.

Selline piirav lähenemine sisenditele annab Whirlpooli coinjoin-tehingutele ainulaadse omaduse: sisendite ja väljundite vaheliste deterministlike seoste täielik puudumine. Teisisõnu on igal väljundil võrdne tõenäosus, et see omistatakse mis tahes osalejale, võrreldes kõigi teiste tehingu väljunditega.

![BTC204](assets/fr/136.webp)

### Whirlpooli üldine tegevus

Esialgu oli igas Whirlpool coinjoin'is osalejate arv piiratud 5 osalejaga, kellest 2 olid uued osalejad ja 3 remixer (selgitame neid mõisteid hiljem). Kuid 2023. aastal täheldatud ahelas toimuvate tehingute tasude suurenemine ajendas Samourai meeskondi oma mudelit ümber mõtlema, et parandada privaatsust ja vähendada samal ajal kulusid. Seega, võttes arvesse komisjonitasu turuolukorda ja osalejate arvu, võib koordinaator nüüd korraldada mündiühendusi, mis hõlmavad 6, 7 või 8 osalejat. Need täiustatud seansid on tähistatud nime "_Surge Cycles_" all Oluline on märkida, et olenemata konfiguratsioonist on Whirlpool coinjoinides alati ainult 2 uut osalejat.

Seega iseloomustab Whirlpooli tehinguid identne arv sisendeid ja väljundeid, mis võivad olla:


- 5 sisendit ja 5 väljundit;

![BTC204](assets/fr/137.webp)


- 6 sisendit ja 6 väljundit;

![BTC204](assets/fr/138.webp)


- 7 sisendit ja 7 väljundit;

![BTC204](assets/fr/139.webp)


- 8 sisendit ja 8 väljundit.

![BTC204](assets/fr/140.webp)

Whirlpooli pakutud mudel põhineb seega väikestel coinjoin-tehingutel. Erinevalt Wabisabist ja JoinMarketist, kus anonüümide tugevus põhineb ühe tsükli (või mõne tsükli) osalejate mahul, tugineb Whirlpool mitme väikese tsükli liitmisele. Selle mudeli puhul tekivad kasutajatele kulud ainult nende esmasel sisenemisel ühisesse kogumisse, mis võimaldab neil ilma lisakuludeta osaleda mitmetes remixides. Uued osalejad katavad remixerite kaevandamiskulud.

Iga täiendava coinjoiniga, milles münt osaleb, koos varem kohatud eakaaslastega, kasvavad anonsetid eksponentsiaalselt. Eesmärk on seega kasutada ära neid tasuta remixe, mis iga esinemisega aitavad tugevdada iga mündiseguga seotud anonsettide tihedust.

Whirlpooli projekteerimisel on silmas peetud kahte olulist nõuet:


- Rakendamise kättesaadavus mobiilseadmetes, kuna Samourai Wallet on peamiselt nutitelefonirakendus;
- Remissioonitsüklite kiirus, et soodustada anonüümide märkimisväärset suurenemist.

Samourai rahakoti arendajad lähtusid Whirlpooli kujundamisel nendest nõudmistest, mistõttu nad piirasid osalejate arvu tsükli kohta. Liiga vähe osalejaid oleks ohustanud coinjoini tõhusust, vähendades drastiliselt igas tsüklis loodud anonsette, samas kui liiga palju osalejaid oleks tekitanud haldusprobleeme mobiilirakendustes ja takistanud tsüklite kulgemist.

Lõppkokkuvõttes ei ole Whirlpoolis coinjoinimiseks vaja suurt arvu osalejaid, kuna anonsetid realiseeruvad mitme coinjoinitsükli kogunemisel. Kõige olulisem põhimõte on siinkohal kõigi osalejate UTXOde homogeensus, kuna see võimaldab täiuslikku segunemist ja seega saada täielikku kasu segunemis- ja remixing-tsüklitest.

### Coinjoin basseinid ja tariifid

Selleks, et need mitmekordsed tsüklid suurendaksid tõhusalt segamüntide anonüümsust, tuleb kehtestada mingi raamistik, et piirata kasutatava UTXO koguseid. Whirlpool määratleb seetõttu mitu basseinit.

Pool kujutab endast rühma kasutajaid, kes soovivad koos segada, kes lepivad kokku UTXO koguses, et optimeerida coinjoin-protsessi, säilitades samal ajal täiusliku mündi homogeensuse. Iga koondis määrab kindlaks UTXO fikseeritud summa, mida kasutaja peab osalemiseks täitma. Seega tuleb Whirlpooliga coinjoin'ide tegemiseks valida bassein. Praegu on saadaval järgmised basseinid:


- 0.5 bitcoin;
- 0.05 bitcoin;
- 0.01 bitcoin;
- 0.001 bitcoin (= 100 000 sats).

Kui liitute oma bitcoin'idega, jagatakse need nii, et tekivad UTXO-d, mis on täiesti homogeensed teiste osalejate omadega. Igal basseinil on maksimaalne piir; seetõttu olete seda piiri ületavate summade puhul sunnitud kas tegema kaks eraldi sissekannet samasse basseini või pöörduma teise, suurema summaga basseini:

| Pool (bitcoin) | Maksimaalne summa kirje kohta (bitcoin) |

|----------------|----------------------------------------|

| 0,5 | 35 |

| 0,05 | 3,5 |

| 0,01 | 0,7 |

| 0,001 | 0,025 |

UTXO loetakse koondisse kuuluvaks siis, kui see on valmis ühendusse integreeritavaks. See ei tähenda siiski, et kasutaja kaotab selle valduse. Nagu me nägime selle osa esimestes peatükkides, säilitate te erinevate segunemistsüklite kaudu täieliku kontrolli oma võtmete ja seega ka bitcoinide üle. See ongi see, mis eristab coinjoin-tehnikat teistest tsentraliseeritud segamistehnikatest.

Coinjoin-pooliga liitumiseks tuleb maksta nii teenustasusid kui ka kaevandamistasusid. Teenustasu on iga basseini puhul fikseeritud ja selle eesmärk on kompenseerida Whirlpooli arendamise ja hoolduse eest vastutavad meeskonnad.

Whirlpooli kasutamise teenustasu tuleb maksta ühekordselt basseini sisenemisel. Kui see samm on tehtud, on teil võimalus osaleda piiramatul arvul remixides ilma lisatasudeta. Siin on esitatud iga basseini praegused fikseeritud tasud:

| Pool (bitcoin) | Sisendtasu (bitcoin) |

| -------------- | --------------------------------- |

| 0.5 | 0.0175 |

| 0.05 | 0.00175 |

| 0,01 | 0,0005 (50 000 sats) |

| 0,001 | 0,00005 (5000 sats) |

Need tasud toimivad sisuliselt nagu pilet valitud basseini, sõltumata summast, mille sisestate coinjoin'i. Nii et olenemata sellest, kas sisenete 0,01 BTC basseini täpselt 0,01 BTC-ga või sisenete 0,5 BTC-ga, jäävad tasud absoluutväärtuselt samaks.

Enne Whirlpool-ühenduste jätkamist on kasutajal valida 2 strateegia vahel:


- Valivad väiksema fondi, et vähendada teenustasusid, teades, et nad saavad vastutasuks mitu väiksemat UTXO-d;
- Või eelistavad suuremat kogumit, nõustudes maksma suuremaid tasusid, et saada lõpuks väike arv suurema väärtusega UTXOsid.

Üldiselt ei ole soovitatav mitu segatud UTXOd pärast coinjoin'i tsüklit ühendada, kuna see võib ohustada saavutatud privaatsust, eriti ühise sisendi omandiõiguse heuristiku (CIOH: _Common-Input-Ownership-Heuristic_) tõttu. Seetõttu võib olla mõistlik valida suurem bassein, isegi kui see tähendab, et tuleb maksta rohkem, et vältida liiga paljude väikese väärtusega UTXOde saamist väljundiks. Kasutaja peab hindama neid kompromisse, et valida talle meelepärane bassein.

Lisaks teenustasudele tuleb arvestada ka iga Bitcoini tehinguga kaasnevaid kaevandamistasusid. Whirlpooli kasutajana peate maksma kaevandamistasusid nii ettevalmistustehingu (`Tx0`) kui ka esimese mündiühendusega seotud tasu. Kõik edasised taasühendused on tasuta, kuna Whirlpooli mudel on uute sisenejate jaoks tasuline.

Tegelikult on igas Whirlpool coinjoin'is 2 kasutajat sisendite hulgas uued osalejad. Ülejäänud sisendid pärinevad remixeritelt. Selle tulemusena katavad kõigi tehingus osalejate kaevandamistasud need 2 uut osalejat, kes saavad seejärel ka tasuta remixe:

![BTC204](assets/it/54/07.webp)

Selle tasusüsteemi tõttu erineb Whirlpool tõepoolest teistest coinjoini rakendustest, sest UTXOde anonsetid ei ole proportsionaalsed kasutaja poolt makstud hinnaga. Seega on võimalik saavutada märkimisväärselt kõrge anonüümsuse tase, makstes ainult basseini sisenemistasu ja kaevandamistasu 2 tehingu eest (`Tx0` ja algsegu).

Oluline on märkida, et kasutaja peab ka katma kaevandamistasud oma UTXOde väljavõtmise eest basseinist pärast mitme coinjoini käivitamist, välja arvatud juhul, kui ta on valinud võimaluse "mix to", mis võimaldab tal anda välise aadressi, mis saab raha otse coinjoini väljundina, ilma täiendava tehinguta.

### HD Wallet kontod

Whirlpooli kaudu coinjoini tegemiseks peab rahakott looma mitu eraldi kontot. See on ZeroLink-protokolli põhimõte. Konto moodustab HD (_Hierarhical Deterministic_) rahakoti kontekstis teistest täielikult isoleeritud osa, see eraldamine toimub rahakoti hierarhia kolmandal sügavustasemel, st `xpub` tasandil.

![BTC204](assets/it/54/08.webp)

HD rahakott võib teoreetiliselt tuletada kuni `2^(32/2)` erinevaid kontosid. Algne konto, mida kasutatakse vaikimisi kõigis Bitcoini rahakottides, vastab `0'`indeksile.

Whirlpoolile kohandatud portfellide puhul kasutatakse 4 kontot, et täita ZeroLink protsessi nõudeid:


- **Hoiustuskonto**, mida tähistab indeks "0";
- **Paha pangakonto** (või "mürgine börs"), mida tähistab indeks `2 147 483 644'`;
- **premix-konto**, mida tähistatakse indeksiga "2 147 483 645";
- **postmix-konto**, mis on identifitseeritud indeksiga "2 147 483 646".

Igaüks neist kontodest täidab ühisliitmise protsessis konkreetset funktsiooni, mida me uurime järgmistes punktides.

Kõik need kontod on seotud ühe seemnega, mis võimaldab kasutajal taastada juurdepääsu kõigile oma bitcoinidele, kasutades oma taastamislauset ja vajaduse korral oma salasõna. Selle taastamisoperatsiooni käigus tuleb aga tarkvarale täpsustada kasutatud kontode erinevad indeksid.

Uurime nüüd nende kontode raames Whirlpool-koosliitumise eri etappe.

### TX0

Mis tahes Whirlpooli mündiühenduse lähtepunktiks on **deposiitkonto**. Seda kontot kasutate automaatselt, kui loote uue bitcoini rahakoti. Sellele kontole tuleb krediteerida bitcoinid, mida soovite segada.

Tx0 kujutab endast esimest sammu Whirlpooli segamisprotsessis. Selle eesmärk on valmistada ette ja ühtlustada UTXOd koosmõjude ühendamiseks, jagades need valitud basseini kogusele vastavateks ühikuteks, et tagada segamise homogeensus. Seejärel saadetakse ühtlustatud UTXOd **eelsegamise kontole**. Mis puutub vahe, mis ei saa koondada, siis see eraldatakse spetsiaalsele kontole: **paha pank** (või "mürgine vahetus").

See esialgne "Tx0" tehing on ühtlasi ka mündiühenduse koordinaatorile makstavate teenustasude tasumiseks. Erinevalt järgmistest etappidest ei ole see tehing koostööpõhine; seega peab kasutaja kandma kaevandamistasude kulud täies ulatuses:

![BTC204](assets/it/54/09.webp)

Selles `Tx0` tehingu näites jagatakse meie **deposiidikontolt** saadud 372 000 sati suurune sisend mitmeks UTXO väljundiks, mis jagunevad järgmiselt:


- 5 000 sati suurune summa, mis on eraldatud koordinaatorile teenustasudeks, mis vastab 100 000 sati koondisesse kandmisele;
- 3 UTXO-d on segamiseks ette valmistatud, suunatud meie **premix-kontole** ja registreeritud koordinaatori juures. Need UTXOd on võrdsustatud hinnaga `108 000 sats` igaüks, et katta nende tulevase algse segamise kaevandamistasud;
- Ülejääk, mis ei saa basseini siseneda, kuna see on liiga väike, loetakse mürgiseks vahetuseks. See saadetakse oma konkreetsele kontole. Siinkohal on see vahetus 40 000 sati suurune;
- Lõpuks on veel "3000 sati", mis ei kujuta endast väljundit, vaid on "Tx0" kinnitamiseks vajalikud kaevandamistasud.

Siin on näiteks tõeline Tx0 Whirlpool (mitte minu):[edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/fr/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

![BTC204](assets/fr/145.webp)

### Mürgine muutus

Ülejääk, mida ei suudetud koondada reservi, mis vastab siinkohal 40 000 satsile, suunatakse ümber **paha pangakontole**, mida nimetatakse ka "toksiliseks vahetuseks", et tagada range eraldatus portfelli teistest UTXOdest.

See UTXO on ohtlik kasutaja privaatsusele, sest see ei ole mitte ainult seotud kasutaja minevikuga ja seega võimalik, et ka selle omaniku identiteediga, vaid see on ka tähistatud kui kasutaja, kes on osalenud coinjoin'is.

![BTC204](assets/fr/146.webp)

Kui see UTXO ühendatakse segatud väljunditega, kaotavad nad kogu privaatsuse, mis on saadud coinjoin'i tsüklite ajal, suuresti CIOH (Common-Input-Ownership-Heuristic_) tõttu. Kui see liidetakse teiste mürgiste muudatustega, riskib kasutaja privaatsuse kaotamisega, kuna see ühendab erinevaid sisendeid coinjoin'i tsüklitest. Seetõttu tuleks seda käsitleda ettevaatlikult. Nende toksiliste UTXOde haldamist arutame üksikasjalikumalt selle peatüki viimases osas.

### Esialgne segu

Pärast `Tx0` lõpuleviimist saadetakse tasandatud UTXOd meie portfelli **premix** kontole, mis on valmis oma esimesse mündiühendustsüklisse, mida nimetatakse ka "esmaseks seguks" Kui, nagu meie näites, `Tx0` tekitab mitu segamiseks mõeldud UTXOd, integreeritakse igaüks neist eraldi algsesse segusse.

Nende esimeste segude lõpus on **premix** konto tühi, samas kui meie mündid, mis on maksnud kaevandamistasud selle esimese mündiühingu eest, arveldatakse täpselt valitud basseini poolt määratud summa ulatuses. Meie näites on meie esialgne UTXOs `108,000 sats` vähenenud täpselt `100,000 sats`ni.

![BTC204](assets/fr/147.webp)

### Remiksid

Pärast esialgset segamist kantakse UTXOd üle **postmix** kontole. Sellele kontole kogutakse nii juba segatud UTXOd kui ka need, mis ootavad uuesti segamist. Kui Whirlpool-klient on aktiivne, on **postmix**-kontol olevad UTXOd automaatselt saadaval remiximiseks ja need valitakse juhuslikult välja uutes voorudes osalemiseks.

Meeldetuletuseks, et remixid on siis täiesti tasuta: täiendavaid teenustasusid või kaevandamistasusid ei nõuta. UTXOde hoidmine **postmix** kontol hoiab seega nende väärtuse puutumatuna ja parandab samal ajal nende anonsetid. Seepärast on oluline, et need mündid saaksid osaleda mitmes coinjoin'i tsüklis. See ei maksa teile absoluutselt midagi ja suurendab nende anonset taset.

Kui te otsustate kulutada segatud UTXOd, saate seda teha otse sellelt **postmix**-kontolt. Soovitatav on hoida segatud UTXOd sellel kontol, et saada kasu tasuta remixidest ja vältida nende lahkumist Whirlpooli ringkonnast, mis võib vähendada nende privaatsust.

### Kuidas oma postmixi kontot õigesti hallata?

Pärast coinjoin'i tsüklite käivitamist on parim strateegia hoida oma UTXO-d **postmix** kontol, oodates nende edaspidist kasutamist. Soovitav on isegi lasta neil lõputult remixida, kuni teil on vaja neid kulutada.

Mõned kasutajad võivad kaaluda oma segatud bitcoinide ülekandmist kaitstud riistvara rahakotti. See on võimalik, kuid oluline on hoolikalt järgida Samourai Walleti soovitusi, et mitte ohustada saavutatud konfidentsiaalsust.

Kõige sagedamini tehtud viga on UTXOde kombineerimine. Tuleb vältida segatud UTXOde kombineerimist segamata UTXOdega samas tehingus, et vältida CIOH (Common-Input-Ownership) heuristikat. See nõuab oma UTXOde hoolikat haldamist portfelli sees, eriti märgistamise osas.

![BTC204](assets/fr/148.webp)

Samuti on oluline olla ettevaatlik segatud UTXOde konsolideerimisel. Mõõdukad konsolideerimised on mõeldavad, kui teie segatud UTXO-del on märkimisväärne anonset, kuid see vähendab paratamatult teie müntide konfidentsiaalsust. Veenduge, et konsolideerimised ei ole liiga märkimisväärsed või et neid ei tehta pärast ebapiisavat arvu taasühendamisi, riskides sellega, et teie UTXOde vahel tekivad tuletatud seosed enne ja pärast mündiühendamistsükleid. Nende manipulatsioonide kahtluse korral on parim tava mitte konsolideerida UTXOsid pärast segamist ja kanda need ükshaaval üle oma riistvara rahakotti, luues iga kord uue tühja aadressi. Ärge unustage siiski, et iga saadud UTXO korralikult märgistada.

Samuti ei ole soovitatav kanda oma UTXO postmixe üle rahakotti, mis kasutab ebatavalisi skripte. Näiteks kui sisestate Whirlpooli multisigiga rahakotist, mis kasutab `P2WSH` skripte, on väike võimalus, et teid segatakse teiste kasutajatega, kellel on algselt sama tüüpi rahakott. Kui te võtate oma postmixid välja selles samas multisig rahakotis, väheneb teie segatud bitcoinide privaatsuse tase oluliselt. Lisaks skriptidele on palju muid rahakoti sõrmejälgi, mis võivad teid petta.

Nagu iga Bitcoini tehingu puhul, on ka siin oluline mitte kasutada vastuvõtuaadresse uuesti. Iga uus tehing tuleks vastu võtta uuele, tühjale aadressile.

Kõige lihtsam ja turvalisem lahendus on lasta oma segatud UTXO-del puhata oma **postmix** kontol, lubades neid remixida ja puudutada neid ainult kulutamiseks. Samourai ja Sparrow portfellidel on täiendav kaitse kõigi nende ahelanalüüsi riskide vastu. Need kaitsed aitavad teil vältida vigu.

### Kuidas oma mürgiseid muutusi korralikult hallata?

Järgmisena peate olema ettevaatlik oma mürgise vahetusraha käitlemisel - vahetusraha, mis ei saanud siseneda mündiühenduste kogumisse. Need mürgised UTXOd, mis tulenevad Whirlpooli kasutamisest, kujutavad endast ohtu teie privaatsusele, sest need loovad seose teie ja coinjoin'i kasutamise vahel. Seetõttu on hädavajalik neid käsitleda ettevaatlikult ja mitte kombineerida neid teiste UTXOdega, eriti segatud UTXOdega.

Siin on mitu strateegiat, mida nende kasutamiseks kaaluda:


- Segage neid väiksemates basseinides:** Kui teie mürgine UTXO on piisavalt suur, et mahutada seda üksi väiksemasse basseini, kaaluge selle segamist. See on sageli parim variant. Mitme mürgise UTXO kokku segamine basseini pääsemiseks ei ole siiski soovitatav, sest see võib teie erinevaid sissepääse ühendada.
- Märgista need "mittekasutatavaks":** Teine lähenemisviis on lõpetada nende kasutamine, märkida need "mittekasutatavaks" nende spetsiaalsel kontol ja lihtsalt hodlida. See tagab, et te ei kuluta neid kogemata. Kui bitcoinide väärtus tõuseb, võivad tekkida uued, teie mürgiste UTXOde jaoks sobivamad basseinid;
- Annetuste tegemine:** Kaaluge isegi tagasihoidlike annetuste tegemist Bitcoini ja sellega seotud tarkvara arendajatele. Võite annetada ka organisatsioonidele, kes aktsepteerivad BTC-d. Kui oma mürgiste UTXOde haldamine tundub liiga keeruline, võite neist lihtsalt annetusega vabaneda.
- Osta kinkekaarte:** Platvormid nagu [Bitrefill](https://www.bitrefill.com/) võimaldavad vahetada bitcoine kinkekaartide vastu, mida saab kasutada erinevates kauplustes. See võib olla viis, kuidas oma mürgiseid UTXOsid ära kasutada, ilma et kaotaksite sellega seotud väärtust.
- Konsolideerige need Monero:** Samourai rahakott pakub BTC ja XMR vahelist aatomivahetusteenust. See on ideaalne mürgiste UTXO-de haldamiseks, konsolideerides need Monero's, ilma et teie privaatsust KYC-i kaudu ohustataks, enne nende saatmist tagasi Bitcoin'ile. See võimalus võib siiski olla kulukas kaevandamistasude ja preemiate osas likviidsuspiirangute tõttu.
- Saatke need Lightning-võrku:** Nende UTXOde ülekandmine Lightning-võrku, et saada kasu vähendatud tehingutasudest, on atraktiivne võimalus. See meetod võib aga sõltuvalt Lightningi kasutamisest avaldada mõningaid andmeid ja seetõttu tuleks seda kasutada ettevaatlikult.

### Kuidas kasutada Whirlpooli?

Pärast Samourai rahakoti asutajate vahistamist ja nende serverite konfiskeerimist 24. aprillil 2024 ei tööta enam Whirlpool tööriist, isegi nende jaoks, kellel on oma Dojo. Varem oli see saadaval Samourai Walletis ja Sparrow Walletis.

![BTC204](assets/fr/149.webp)

Siiski on võimalik, et see vahend võetakse lähinädalatel uuesti kasutusele, sõltuvalt katsete tulemustest, või taaskäivitatakse muul viisil. Igal juhul usun, et Bitcoini coinjoin-turg ei jää kaua ilma pakkumiseta, sest nõudlus on selgelt olemas. Lisaks sellele kasutatakse Whirlpooli mudelit, mis on privaatsuse osas kõige arenenum, tulevikus kindlasti ka teiste rakenduste puhul.

Jälgime tähelepanelikult nii selle juhtumi arengut kui ka sellega seotud vahenditega seotud arenguid. Võite olla kindel, et uuendame seda koolitust, kui uus teave muutub kättesaadavaks.

Järgmises peatükis saame teada, mis on "anonsetid", kuidas neid näitajaid arvutatakse ja kuidas need aitavad meil hinnata coinjoin'i tsüklite tõhusust.

https://planb.network/tutorials/privacy/on-chain/coinjoin-sparrow-wallet-84def86d-faf5-4589-807a-83be60720c8b
https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/tutorials/privacy/on-chain/coinjoin-dojo-c4b20263-5b30-4c74-ae59-dc8d0f8715c2
## Anonüümsuse komplekt

<chapterId>be1093dc-1a74-40e5-9545-2b97a7d7d431</chapterId>

Olles uurinud, kuidas koosliitmised toimivad ja millised on tõhusa segamisega seotud probleemid, õpime nüüd, kuidas seda tõhusust mõõta. Kuidas teha kindlaks, kas coinjoin-protsess oli tõhus ja millise anonüümsuse astme saavutas coinjoin? Seda uurime selles peatükis anonüümsuse komplektide ehk inglise keeles "anonsets" abil.

### Meeldetuletus Coinjoini kasulikkuse kohta

CoinJoin'i kasulikkus seisneb selle võimes luua usutav eitatavus, asetades oma mündi eristamatute müntide rühma. Selle tegevuse eesmärk on katkestada jälgitavuse seosed nii minevikust olevikku kui ka olevikust minevikku.

Teisisõnu, analüütik, kes teab teie esialgset tehingut (`Tx0`) CoinJoin tsüklite sisenemisel, ei tohiks olla võimeline kindlalt tuvastama teie UTXO-d remix-tsüklite väljumisel (analüüs tsükli sisenemisest tsüklist väljumiseni).

![BTC204](assets/it/55/01.webp)

Seevastu analüütik, kes teab teie UTXO-d CoinJoin-tsüklite väljundis, ei tohiks olla võimeline määrama algset tehingut tsüklite sisendil (analüüs tsükli väljundist tsükli sisendini).

![BTC204](assets/it/55/02.webp)

Et hinnata, kui raske on analüütikul siduda minevikku ja olevikku ning vastupidi, on vaja kvantifitseerida nende homogeensete müntide rühmade suurust, mille sees teie münt on peidetud. See meede ütleb meile, kui suur on nende analüüside arv, mille tõenäosus on identne. Seega, kui õige analüüs hukkub 3 teise võrdse tõenäosusega analüüsi vahel, on teie peitmise tase väga madal. Kui aga õige analüüs on 20 000 analüüsi hulgas, mis kõik on võrdse tõenäosusega, on teie münt väga hästi peidetud. Ja just nende kogude suurus kujutab endast näitajaid, mida nimetatakse anonsettideks.

### Anonüümide mõistmine

Anonsetid on näitajad, mille abil saab hinnata konkreetse UTXO privaatsuse astet. Täpsemalt öeldes mõõdavad nad eristamatute UTXOde arvu kogumis, mis sisaldab uuritavat mündi. Homogeense UTXO kogumi nõue tähendab, et anonsetid arvutatakse tavaliselt CoinJoini tsüklite alusel. Nende näitajate kasutamine on eriti oluline Whirlpool CoinJoins'i puhul, sest need on ühetaolised.

Anonsetid võimaldavad vajaduse korral hinnata CoinJoins'i kvaliteeti. Suur anonseti suurus tähendab kõrget anonüümsuse taset, kuna homogeenses kogumis on raske eristada konkreetset UTXO-d.

On olemas 2 tüüpi anonüümide tüüpe:


- Tulevane anonset;**
- Retrospektiivne anonset.**

### Tulevane Anonset

Tulevikku suunatud anonset näitab selle rühma suurust, mille hulgas uuritav UTXO on tsükli väljumisel peidetud, teades UTXO-d sisenemisel, st selles rühmas olevate eristamatute müntide arvu. Inglise keeles on selle näitaja nimi "forward anonset" ehk "forward-looking metrics"

See näitaja näitab valuuta privaatsuskindlust minevikust tänasesse (sisendist väljundisse) analüüsiga võrreldes.

![BTC204](assets/it/55/03.webp)

See mõõdik hindab, mil määral on teie UTXO kaitstud katsete eest rekonstrueerida selle ajalugu alates selle sisenemispunktist kuni selle väljumispunktini coinjoin-protsessis.

Näiteks kui teie tehing osales esimeses mündiühendustsüklis ja kaks täiendavat langevat tsüklit on lõpetatud, oleks teie mündi eeldatav anonset `13`:

![BTC204](assets/fr/153.webp)

Kujutame näiteks ette, et meie mündi mündiühendustsükli alguses on võimalik saada anonset "86,871". Praktiliselt tähendab see, et see on peidetud `86,871` eristamatute müntide hulka. Väline vaatleja, kes teab seda münti mündiühendustsükli alguses ja üritab jälgida selle väljumist, seisab silmitsi `86,871` võimaliku UTXOga, millest igaühe puhul on tõenäosus, et tegemist on otsitava mündiga, identne.

![BTC204](assets/it/55/05.webp)

### Retrospektiivne Anonset

Retrospektiivne anonset näitab antud mündi võimalike allikate arvu, teades UTXO-d tsükli väljumisel. See näitaja mõõdab mündi privaatsuskindlust praegusest minevikusse analüüsi (väljumise ja sisenemise vahel), st kui raske on analüütikul jälgida teie mündi päritolu, enne mündiühendustsükleid. Inglise keeles on selle näitaja nimi "backward anonset" ehk "tagasiulatuv meetrika"

Teades teie UTXO-d tsüklitest väljumisel, määrab retrospektiivne anonset kindlaks potentsiaalsete Tx0 tehingute arvu, mis oleksid võinud moodustada teie sisenemise mündiühendustsüklitesse. Allpool esitatud joonisel vastab see kõigi oranžide kuplite summale.

Kujutame näiteks ette, et meie mündi mündiühendustsükli väljumisel saab tagantjärele anonset "42,185". Praktiliselt tähendab see, et selle UTXO jaoks on `42,185` võimalikku allikat. Kui väline vaatleja tuvastab selle mündi tsükli lõpus ja püüab selle päritolu jälgida, siis on tema ees `42,185` võimalikku allikat, mis kõik on võrdse tõenäosusega otsitava päritoluga.

### Kuidas konkreetselt arvutada anonsetid?

Väikeste komplektide puhul saate oma anonsetid käsitsi arvutada, kasutades plokkide otsingumootorit. Suuremate anonsettide puhul on aga hädavajalik kasutada spetsiaalset tööriista. Minu teada on ainus tarkvara, mis on võimeline seda ülesannet täitma, _Whirlpool Stats Tool_, mis on Samourai ja OXT meeskondade poolt välja töötatud Pythoni tööriist. Kahjuks on see tööriist praegu pärast Samourai asutajate vahistamist ja OXT tegevuse lõpetamist, mida kasutati plokiahela andmete väljavõtmiseks, kasutusest kõrvaldatud.

Nagu me selles peatükis nägime, saab anonüüme arvutada ainult siis, kui ühisliidete struktuuris on mingi homogeensus. Ja täpselt, järgmises peatükis selgitame välja, kuidas seda homogeensust Bitcoini tehingus kvantifitseerida, olgu see siis coinjoin või traditsioonilisem tehing.

https://planb.network/tutorials/privacy/analysis/wst-anonsets-0354b793-c301-48af-af75-f87569756375
## Entroopia

<chapterId>e4fe289d-618b-49a2-84c9-68c562e708b4</chapterId>

Nagu me nägime selles mündiühendusi käsitlevas osas, mängib UTXOde sisendite ja väljundite homogeensus olulist rolli Bitcoini tehingu konfidentsiaalsuse parandamisel. See parameeter võimaldab usutavat eitamist ahela analüüsi vastu. Seda homogeensust saab mõõta mitmete meetoditega, kuid minu arvates on üks tõhusamaid OXT ja Samourai rahakoti meeskondade poolt välja töötatud _Boltzmanni_ tööriista pakutavate näitajate kasutamine, täpsemalt tehingu entroopia. Seda uurime käesolevas peatükis üksikasjalikult.

Erinevalt anonsettidest, mida arvutatakse tehingute kogumi põhjal, keskenduvad siin esitatud näitajad ainult ühele tehingule, olgu see siis coinjoin või traditsiooniline tehing.

### Tõlgenduste arv

Esimene näitaja, mida saab Bitcoini tehingu puhul jälgida, on tehingut analüüsiva välise vaatleja silmis võimalike tõlgenduste koguarv. Võttes arvesse tehinguga seotud UTXOde väärtusi, näitab see näitaja, kui palju on võimalusi, kuidas sisendeid saab väljunditega seostada. Teisisõnu, see määrab kindlaks võimalike tõlgenduste arvu, mida tehing võib bitcoinide voos tekitada seda analüüsiva välise vaatleja seisukohast.

Näiteks lihtsal maksetehingul, millel on 1 sisend ja 2 väljundit, on ainult üks tõlgendus, nimelt et sisend #0 rahastab väljundit #0 ja väljund #1. Muid võimalikke tõlgendusi ei ole:

![BTC204](assets/fr/159.webp)

Seevastu Whirlpooli 5x5 mudeli järgi struktureeritud mündiühendusel on 1496 võimalikku kombinatsiooni:

![BTC204](assets/fr/160.webp)

Whirlpool Surge Cycle 8x8 mündiühendusega tuleb välja 9 934 563 dollarit võimalikke tõlgendusi:

![BTC204](assets/fr/161.webp)

### Entroopia

Bitcoini tehingu tõlgenduste arvu põhjal saame arvutada selle entroopiat.

Krüptograafia ja teabe üldises kontekstis on entroopia andmeallikaga või juhusliku protsessiga seotud ebakindluse või ettearvamatuse kvantitatiivne mõõt. Teisisõnu, entroopia on viis mõõta, kui raske on teavet ennustada või ära arvata.

Konkreetses ahelanalüüsi kontekstis on entroopia ka Shannoni entropiast tuletatud ja [LaurentMT poolt leiutatud](https://gist.github.com/LaurentMT/e758767ca4038ac40aaf) näitaja nimi, mida saab arvutada Bitcoini tehingu kohta.

Kui tehingul on suur arv võimalikke tõlgendusi, on sageli asjakohasem viidata selle entroopiale. See näitaja näitab analüütikute teadmatust tehingu täpse konfiguratsiooni kohta. Teisisõnu, mida suurem on entroopia, seda raskem on analüütikutel tuvastada bitcoinide voogusid sisendite ja väljundite vahel.

Praktikas näitab entroopia, kas välise vaatleja seisukohast on tehingul mitu võimalikku tõlgendust, mis põhinevad ainult sisend- ja väljundkogustel, arvestamata muid väliseid või sisemisi mustreid ja heuristikat. Kõrge entroopia on seega sünonüümiks tehingu suuremale konfidentsiaalsusele.

Entroopia on defineeritud kui võimalike kombinatsioonide arvu binaarne logaritm. Siin on kasutatud valemit, kus $E$ tähistab tehingu entroopiat ja $C$ võimalike tõlgenduste arvu:

$$
E = \log_2(C)
$$

Matemaatikas vastab binaarne logaritm (logaritm baasini 2) pöördvõrrandile, mille puhul 2 tõstetakse teatud potentsile. Teisisõnu, $x$ binaarne logaritm on eksponent, millele $2$ tuleb tõsta, et saada $x$. Seda näitajat väljendatakse seega bittides.

Võtame näiteks 5x5 Whirlpool-mudeli järgi struktureeritud coinjoin-tehingu entroopia arvutamise, mille tõlgendamisvõimaluste arv on, nagu eelmises punktis mainitud, 1496 dollarit:

$$
\begin{align*}
C &= 1.496 \\
E &= \log_2(1.496) \\
E &= 10.5469 \text{ bit}
\end{align*}
$$

Seega on selle mündiühendustehingu entroopia 10,5469$ bitti, mida peetakse väga rahuldavaks. Mida suurem on see väärtus, seda rohkem erinevaid tõlgendusi on tehingule lubatud, parandades seega selle privaatsustaset.

8x8 mündiühendustehingu puhul, millel on 9 934 563 dollarit tõlgendusi, oleks entroopia järgmine:

$$
\begin{align*}
C &= 9.934.563 \\
E &= \log_2(9.934.563) \\
E &= 23,244 \text{ bit}
\end{align*}
$$

Võtame teise näite standardse maksetehinguga, millel on 1 sisend ja 2 väljundit: [1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce](https://mempool.space/tx/1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce)

![BTC204](assets/fr/162.webp)

Selle tehingu puhul on ainus võimalik tõlgendus: `(In.0) > (Out.0 ; Out.1)`. Järelikult on selle entroopia väärtus $0$:

$$
\begin{align*}
C &= 1 \\
E &= \log_2(1) \\
E &= 0 \text{ bit}
\end{align*}
$$

### Efektiivsus

Tehingu entroopia põhjal saame arvutada ka selle privaatsuse tõhususe. See näitaja hindab tehingu tõhusust, võrreldes seda optimaalse tehinguga, mis on mõeldav samasuguse konfiguratsiooni korral.

See viib meid arutlema maksimaalse entroopia mõiste üle, mis vastab suurimale entroopiale, mida konkreetne tehingustruktuur teoreetiliselt saavutada võiks. Seejärel arvutatakse tehingu tõhusus, võrreldes seda maksimaalset entroopiat analüüsitud tehingu tegeliku entroopiaga.

Kasutatakse järgmist valemit:


- $E_R$: tehingu tegelik entroopia bittides;
- $E_M$: tehingu struktuuri maksimaalne võimalik entroopia, mis on samuti väljendatud bittides;
- $Ef$: tehingu tõhusus bittides:

$$
Ef = E_R - E_M
$$

Näiteks Whirlpool 5x5 tüüpi coinjoin struktuuri puhul on maksimaalne entroopia $10.5469$:

$$
\begin{align*}
E_R &= 10,5469 \\
E_M &= 10,5469 \\
Ef &= E_R - E_M \\
Ef &= 10,5469 - 10,5469 \\
Ef &= 0 \text{ bit}
\end{align*}
$$

Seda näitajat väljendatakse samuti protsentides. Kasutatakse järgmist valemit:


- $C_R$: võimalike reaalsete tõlgenduste arv;
- $C_M$: sama struktuuriga võimalike tõlgenduste maksimaalne arv;
- $Ef$: tõhusus väljendatuna protsentides:

$$
\begin{align*}
E_f &= \frac{C_R}{C_M} \\
E_f &= \frac{1.496}{1.496} \\
E_f &= 100\%
\end{align*}
$$

Seega näitab tõhusus $100\%$, et tehing maksimeerib oma struktuurist lähtuvalt oma privaatsuspotentsiaali.

### Entroopia tihedus

Entroopia on hea näitaja tehingu privaatsuse mõõtmiseks, kuid see sõltub osaliselt tehingu sisendite ja väljundite arvust. Et võrrelda 2 erineva tehingu, mille sisendite ja väljundite arv ei ole sama, entroopiat, saab arvutada entroopia tihedust. See näitaja annab ülevaate entroopiast iga tehingu sisendi või väljundi suhtes. Tihedus on kasulik eri suurusega tehingute tõhususe hindamisel ja võrdlemisel.

Selle arvutamiseks tuleb lihtsalt jagada tehingu kogu entroopia tehingus osalevate sisendite ja väljundite koguarvuga:


- $E_D$: entroopia tihedus väljendatuna bittides;
- $E$: tehingu entroopia väljendatuna bittides;
- $T$: tehingu sisendite ja väljundite koguarv:

$$
E_D = \frac{E}{T}
$$

Võtame näiteks 5x5 Whirlpooli koosliitumise:

$$
\begin{align*}
T &= 5 + 5 = 10 \\
E &= 10.5469 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{10.5469}{10} \\
E_D &= 1.054 \text{ bit}
\end{align*}
$$

Arvutame ka 8x8 Whirlpool coinjoin'i entroopia tiheduse:

$$
\begin{align*}
T &= 8 + 8 = 16 \\
E &= 23.244 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{23.244}{16} \\
E_D &= 1.453 \text{ bit}
\end{align*}
$$

Analüüsides nende kahe koosliidutüübi entroopiatihedust, selgub, et isegi kui entroopiat normaliseerida elementide arvu järgi, tekitab "Surge Cycle 8x8" koosliitmine analüüsi jaoks rohkem ebakindlust.

### Boltzmanni tulemus

Teine tehingus analüüsitav teave on iga elemendi Boltzmanni skoor teise elemendi suhtes. See on tabel, mis näitab sisendite ja väljundite vastavuse tõenäosust. See tabel näitab Boltzmanni skoori kaudu tingimuslikku tõenäosust, et konkreetne sisend on seotud konkreetse väljundiga. Seega on see tingimusliku tõenäosuse kvantitatiivne näitaja, et seos sisendi ja väljundi vahel esineb tehingus, mis määratakse selle sündmuse soodsate esinemiste arvu ja võimalike esinemiste koguarvu suhte alusel tõlgenduste kogumis.

Kui võtta Whirlpool coinjoin'i näide, siis tingimusliku tõenäosuse tabel tõstaks esile iga sisendi ja väljundi vahelise seose võimalused, andes kvantitatiivse mõõtme tehingu seoste mitmetähenduslikkusele:

| % | Väljund 0 | Väljund 1 | Väljund 2 | Väljund 3 | Väljund 4 |

| ------- | -------- | -------- | -------- | -------- | -------- |

Siinkohal on selge, et iga sisend on sama suure tõenäosusega seotud mis tahes väljundiga, mis suurendab tehingu konfidentsiaalsust.

Boltzmanni skoori arvutamisel jagatakse tõlgenduste arv, milles teatav sündmus esineb, olemasolevate tõlgenduste koguarvuga. Seega, et määrata skoor, seostades sisend #0 väljundiga #3 (sündmus, mis esineb 512$ tõlgenduses), on protsess järgmine:

$$
\begin{align*}
\text{Interpretazioni (IN.0 > OUT.3)} &= 512 \\
\text{Interpretazioni Totali} &= 1496 \\
\text{Punteggio} &= \frac{512}{1496} \\
\text{Punteggio} &= 34\%
\end{align*}
$$

Kui me vaatame uuesti üle näite Surge 8x8 Whirlpool coinjoin tsükli kohta, siis Boltzmanni tabel näeb välja selline:

| | OUT.0 | OUT.1 | OUT.2 | OUT.3 | OUT.4 | OUT.5 | OUT.6 | OUT.7 | OUT.7 | OUT.7 |

| ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |

| IN.0 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.1 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.2 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.3 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.4 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.5 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.6 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.7 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

Kuid lihtsa tehingu puhul, mis hõlmab ühte sisendit ja kahte väljundit, on olukord teistsugune:

| % | Väljund 0 | Väljund 1 |

| ------- | -------- | -------- |

| Sisend 0 | 100% | 100% | 100% |

Siinkohal täheldame, et iga sisendist #0 pärineva väljundi tõenäosus on 100%. Väiksem tõenäosus toob seega kaasa suurema privaatsuse, kuna lahjendab otseseid seoseid sisendite ja väljundite vahel.

### Deterministlikud lingid

Samuti on võimalik arvutada tehingu deterministlike linkide arvu. See näitaja näitab, kui palju analüütilise tehingu sisendite ja väljundite vahelisi seoseid on 100%-lise tõenäosusega vaieldamatult olemas. Seda näitajat saab seejärel täiendada, arvutades deterministlike linkide suhtarvu. Suhtarv annab ülevaate nende deterministlike linkide osakaalust tehingu kõigi linkide hulgas.

Näiteks Whirlpooli coinjoin-tehingu puhul ei ole sisendite ja väljundite vahel mingit deterministlikku seost, seega on näitaja 0 seost ja suhtarv 0%. Seevastu meie teise vaadeldud lihtsa maksetehingu puhul (ühe sisendi ja 2 väljundiga) näitab näitaja, et on 2 deterministlikku seost ja suhtarv ulatub 100%-ni. Seega annab null näitaja märku suurepärasest privaatsusest, sest sisendite ja väljundite vahel puuduvad otsesed ja vaieldamatud seosed.

### Kuidas neid näitajaid arvutada?

Nende näitajate arvutamine käsitsi, kasutades minu esitatud võrrandeid, on suhteliselt lihtne. Peamine raskus seisneb tehingu võimalike tõlgenduste arvu kindlaksmääramises. Standardse tehingu puhul saab selle arvutuse teha käsitsi. Koondtehingu puhul on see ülesanne aga oluliselt keerulisem.

Varem oli OXT ja Samourai meeskondade poolt välja töötatud Pythoni tööriist nimega _Boltzmann Calculator_, mis võimaldas kõigi nende näitajate automaatset arvutamist Bitcoini tehingu jaoks:

![BTC204](assets/fr/163.webp)

Nende analüüside tegemiseks oli võimalik kasutada ka KYCP.org veebilehte:

![BTC204](assets/fr/164.webp)

Kahjuks ei ole need vahendid pärast Samourai asutajate vahistamist praegu töökorras.

Nüüd, kui me oleme arutanud üksikasjalikult coinjoine'i, uurime meie koolituse viimases osas teisi Bitcoini privaatsustehnikaid. Me uurime payjoin-tehinguid, konkreetseid pseudocoinjoin-tehingutüüpe, staatilisi aadressiprotokolle, samuti meetmeid privaatsuse parandamiseks mitte tehingu tasandil, vaid sõlmede võrgu tasandil.

https://planb.network/tutorials/privacy/analysis/boltzmann-entropy-738e45af-18a6-4ce6-af1a-1bf58e15f1fe
# Mõista muude täiustatud privaatsustehnikate panuseid

<partId>19989ae6-d608-4acf-b698-2cf1e7e5e6ae</partId>

## Payjoin tehingud

<chapterId>c1e90b95-f709-4574-837b-2ec26b11286f</chapterId>

Praegu on mündiühendus kõige tõhusam meetod, et tuua ebakindlust mündi jälgimisse ahelanalüüsi käigus. Nagu eelmistes peatükkides nägime, peavad sisendid ja väljundid tõhusa segamise saavutamiseks olema võimalikult homogeensed. Lisaks on oluline, et coinjoins oleks integreeritud võimalikult suurde gruppi, et maksimeerida anonsetid. Seega, et coinjoins oleks tõhus, peavad need hõlmama suurt hulka ühtlasi ka münte. Selline nõuete paljusus tähendab, et mündiliitude tehingutel on väga jäik struktuur: summad on eelnevalt kindlaks määratud ja kõik osalejad peavad neist kinni pidama, et tagada protsessi ühtsus. Lisaks nõuavad coinjoinid tehingu ülesehituse ajal kõigi osalejate ja koordinaatori vahelist sünkroniseerimist.

Need nõuded muudavad coinjoin'i otsetoetuste puhul ebasobivaks. Näiteks kui teil on 1 miljoni sati suurune tükk coinjoin-poolis, oleks selle otsene kasutamine maksetena keeruline. See nõuaks sünkroniseerimist teiste osalejatega ja koordinaatoriga, et luua täpselt ajal, mil teil on vaja makse sooritada, ühistehing, ning ostusumma peaks täpselt vastama teie tüki väärtusele, mis on praktiliselt teostamatu. Seetõttu on coinjoin-tehing oma olemuselt koostööl põhinev puhastustehing, mis tähendab, et üldjuhul on väljundites samad sisendite omanikud.

Siiski oleks huvitav, kui tehingustruktuurid võimaldaksid praktilisi makseid, tuues ahelaanalüüsi sisse kahtluse. Just seda uurime käesolevas ja järgmises peatükis.

### Mis on payjoin-tehing?

Payjoin on konkreetne Bitcoini tehingustruktuur, mis suurendab kasutaja privaatsust kulutuste ajal, tehes koostööd makse saajaga.

2015. aastal mainis LaurentMT seda meetodit esmakordselt "steganograafiliste tehingute" nime all, vastavalt kättesaadavale dokumendile [siin](https://gist.githubusercontent.com/LaurentMT/e758767ca4038ac40aaf/raw/c8125f6a3c3d0e90246dc96d3b603690ab6f1dcc/gistfile1.txt). Hiljem võttis selle tehnika kasutusele Samourai Wallet, mis 2018. aastal oli esimene klient, kes rakendas seda Stowaway tööriistaga. Payjoin'i kontseptsiooni leiab ka töödest [BIP79](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki) ja [BIP78](https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki). Payjoini tähistamiseks kasutatakse seega mitmeid termineid:


- Payjoin;
- Stowaway;
- P2EP (_Pay-to-End-Point_);
- Steganograafiline tehing.

Payjoin'i ainulaadsus seisneb selles, et ta suudab luua tehingu, mis esmapilgul tundub tavaline, kuid tegelikult on tegemist kahe inimese vahelise mini Coinjoin'iga. Selleks on tehingu struktuuris sisenditesse kaasatud makse saaja koos tegeliku saatjaga. Seejärel lisab vastuvõtja tehingu keskel endale makse, mis võimaldab talle maksta.

Võtame selle protsessi paremaks mõistmiseks näite. Alice ostab baguette 4000 sati eest, kasutades UTXO 10 000 sati ja valib payjoin'i. Tema pagar, Bob, lisab oma UTXO 15 000 satsiga sisendiks, mille ta lisaks Alice'i 4000 satsile täielikult tagasi saab väljundina.

Näites, kus pagar Bob sisestab 15 000 sati ja saab välja 19 000 sati, on vahe täpselt 4000 sati, mis on baguette'i hind. Alice omalt poolt sisestab 10 000 sati ja saab väljundiks 6 000 sati, mis moodustab saldo -4 000 sati, mis on baguette'i hind. Näite lihtsustamiseks jätsin selle tehingu puhul tahtlikult välja kaevandamistasud.

### Mis on payjoini eesmärk?

Payjoin-tehing täidab kaks eesmärki, mis võimaldavad kasutajatel parandada makse privaatsust.

Esiteks on payjoin'i eesmärk petta välist vaatlejat, luues ahelaanalüüsis kõrvalekalde. See on võimalik tänu _Common Input Ownership Heuristic_ (CIOH). Nagu me nägime 3. osas, eeldatakse tavaliselt, et kui plokiahelas toimuval tehingul on mitu sisendit, et kõik need sisendid kuuluvad ühele ja samale üksusele või kasutajale.

Seega, kui analüütik uurib payjoin-tehingut, usub ta, et kõik sisendid pärinevad ühelt ja samalt isikult. See arusaam on aga vale, sest koos tegeliku maksjaga annab sisendeid ka makse saaja. Seega on ahelanalüüs kallutatud tõlgenduse suunas, mis osutub valeks.

Tuleme tagasi meie näite juurde, mis käsitleb payjoin-tehingut, et maksta baguette'i eest:

Seda tehingut plokiahelas nähes tõlgendaks väline vaatleja, kes järgib tavapäraseid ahelaanalüüsi heuristikat, seda nii: "Alice liitus 2 UTXOga tehingu sisendiks, et maksta Bobile 19 000 sati."

See tõlgendus on selgelt vale; nagu te juba teate, ei kuulu kaks UTXOd sisendiks olevale isikule. Üks on Alice'ilt, baguette'i ostjalt, ja teine on Bobilt, pagarilt.

Seega on välise vaatleja analüüs suunatud ekslikule järeldusele, mis tagab sidusrühmade konfidentsiaalsuse säilimise.

### Steganograafiline tehing

Teine eesmärk on petta kõrvalist vaatlejat tehtud makse tegeliku summa osas. Tehingu struktuuri uurides võib analüütik uskuda, et makse on võrdne ühe väljundi summaga.

Kui võtame meie näite baguette'i ostmisest, siis analüütik arvab, et maksesumma vastab kas 6000 sati UTXO-le või 19 000 sati UTXO-le. Antud juhul arvab analüütik pigem, et maksesumma on 19 000 sati, sest väljundis on 2 UTXOd, millest vähemalt üks on suurem kui 6000 sati (ei ole mingit loogilist põhjust kasutada 2000 sati maksmiseks 2 UTXOd, kui selle makse jaoks oleks piisanud ühest UTXOst).

Kuid tegelikkuses on see analüüs vale. Maksesumma ei vasta ühelegi väljundile. Tegelikult on see väljundi saaja UTXO ja sisendi saaja UTXO vahe.

Seejuures kuulub payjoin-tehing steganograafia valdkonda. See võimaldab tehingu tegelikku summat varjata võltsitud tehingu sisse, mis toimib kõrvalekaldumiseks.

Steganograafia on tehnika, mille abil saab teavet teiste andmete või objektide sisse peita nii, et peidetud teabe olemasolu ei ole märgatav. Näiteks võib salajase sõnumi peita mitteseotud teksti punkti sisse, muutes selle palja silmaga avastamatuks (see on [micropoint](https://fr.wikipedia.org/wiki/Micropoint) tehnika).

Erinevalt krüpteerimisest, mis muudab teabe ilma dekrüpteerimisvõtmeta arusaamatuks, ei muuda steganograafia teavet. Need jäävad nähtavaks. Pigem on selle eesmärk varjata salajase sõnumi olemasolu, samas kui krüptograafia paljastab selgelt varjatud teabe olemasolu, kuigi see on ilma võtmeta kättesaamatu. Seetõttu oli payjoini esialgne nimetus "steganograafilised tehingud"

Analoogia võib teha krüptograafia ja coinjoin'i ning steganograafia ja payjoin'i vahel. Tegelikult on coinjoin'il sarnased omadused nagu krüptograafial: meetod on äratuntav, kuid teave on salastamatu. Seevastu payjoin on sarnane steganograafiale: teave on teoreetiliselt kättesaadav, kuid kuna selle varjamise meetod ei ole äratuntav, muutub see kättesaamatuks.

### Kuidas kasutada payjoin'i?

Tuntud tarkvara, mis toetab payjoin'i, on Sparrow Wallet, Wasabi Wallet, Mutiny, BitMask, BlueWallet ja JoinMarket, samuti BTCPay makseprotsessor.

Kõige arenenum rakendamine payjoin oli ainult Stowaway on Samourai rahakott. Kuid alates tarkvara asutajate sulgemisest töötab see tööriist nüüd ainult osaliselt. Stowaway eelis on see, et tegemist on täieliku ja väga lihtsasti kasutatava protokolliga, mis toetab nii payjoini vastuvõtmist kui ka saatmist. Osaliselt allkirjastatud tehinguid saab vahetada käsitsi, skaneerides mitut QR-koodi, või automaatselt Tori kaudu Sorobani kaudu. Just viimane suhtlusvõimalus ei ole praegu kasutusel.

Payjoini kasutamise raskuseks on selle sõltuvus kaupmehe osalusest. Kliendina on payjoini kasutamine võimatu, kui kaupmees seda ei toeta. See lisab ostu sooritamisel täiendava raskuse: mitte ainult ei ole keeruline leida kaupmehi, kes aktsepteerivad bitcoine, vaid kui otsida ka neid, kes toetavad payjoini, muutub see veelgi keerulisemaks.

Üheks lahenduseks võiks olla tehingustruktuuride kasutamine, mis lisavad ahelaanalüüsi mitmetähenduslikkust, ilma et see nõuaks vastuvõtja koostööd. See võimaldaks parandada maksete privaatsust, sõltumata kaupmeeste aktiivsest osalusest. Just seda uurime järgmises peatükis.

https://planb.network/tutorials/privacy/on-chain/payjoin-sparrow-wallet-087a0e49-61cd-41f5-8440-ac7b157bdd62
https://planb.network/tutorials/privacy/on-chain/payjoin-samourai-wallet-48a5c711-ee3d-44db-b812-c55913080eab
## Mini-coinjoin makse

<chapterId>300777ee-30ae-43d7-ab00-479dac3522c1</chapterId>

Kui soovite teha maksetehinguid, säilitades samal ajal teatud privaatsust, on payjoin hea valik. Kuid nagu me nägime, nõuab payjoin vastuvõtja kaasamist. Mida siis teha, kui viimane keeldub payjoinis osalemast või kui te lihtsalt eelistate teda mitte kaasata? Üks alternatiiv on kasutada Stonewall- või Stonewall x2-tehingut. Vaatame neid kahte tüüpi tehinguid lähemalt.

### Stonewalli tehing

Stonewall on konkreetne Bitcoini tehingu vorm, mille eesmärk on suurendada kasutaja privaatsust osturetke ajal, jäljendades pseudo-coinjoin'i kahe inimese vahel, kuid ilma, et see tegelikult oleks üks neist. Tegelikult ei ole see tehing ühiselt sooritatav. Kasutaja võib selle ise ehitada, kaasates sisendina ainult talle kuuluvad UTXOd. Seejärel saab luua Stonewall-tehingu mis tahes korral, ilma et oleks vaja teise kasutaja või saajaga sünkroniseerida.

Stonewall-tehingu toimimine on järgmine: tehingu sisendiks kasutab saatja 2 talle kuuluvat UTXO-d. Väljundis toodab tehing 4 UTXOd, millest 2 on täpselt sama palju. Ülejäänud 2 UTXOd moodustavad ülejäänu. Neist 2 sama summa suurusest väljundist läheb tegelikult ainult üks makse saajale.

Stonewall-tehingu puhul on ainult 2 rolli:


- Saatja, kes teeb makse;
- Saaja, kes ei pruugi olla teadlik tehingu konkreetsest olemusest ja lihtsalt ootab saatjalt makset.

Võtame selle tehingustruktuuri mõistmiseks näite. Alice on pagar Bobi juures, et osta oma baguette'i, mis maksab 4000 sati. Ta soovib maksta bitcoiniga, säilitades samal ajal oma makse suhtes teatud privaatsuse. Seetõttu otsustab ta maksmiseks konstrueerida Stonewall-tehingu.

Analüüsides seda tehingut, näeme, et pagar Bob sai tegelikult 4000 sati tasu baguette'i eest. Alice kasutas sisendina 2 UTXO-d: üks 10 000 sati ja üks 15 000 sati. Väljundina sai ta 3 UTXOd: ühe 4000 sati, ühe 6000 sati ja ühe 11 000 sati. Seega on Alice'i netosaldo selle tehingu puhul -4 000 sati, mis on täpselt sama palju kui baguette'i hind.

Selles näites olen arusaadavuse huvides tahtlikult jätnud kõrvale kaevandamistasud. Tegelikkuses kannab tehingutasud täielikult saatja.

### Millised on Stonewall-tehingu eesmärgid?

Stonewalli struktuur lisab tehingule palju entroopiat ja segab ahelanalüüsi jälgi. Väljastpoolt võib sellist tehingut tõlgendada kui kahe inimese vahelist mini-mündiühendust. Tegelikult on see aga makse. Seega tekitab see meetod ahelaanalüüsis ebakindlust või viib isegi valede jälgede tekkimiseni.

Tuleme tagasi Alice'i näite juurde Bobi pagari juures. Tehing plokiahelas näeks välja järgmiselt:

![BTC204](assets/fr/174.webp)

Väline vaatleja, kes tugineb ahelanalüüsi üldisele heuristikale, võib ekslikult järeldada, et "_kaks inimest tegid väikese mündiühenduse, mille sisendiks oli üks UTXO ja väljundiks kaks UTXOd" Selle tehingu analüüs väljastpoolt ei vii sisendi ühise omandiõiguse heuristika (CIOH) kohaldamiseni, sest kahe sama suure väljundi olemasolu viitab coinjoin-mustrile. Väljastpoolt vaadatuna ei ole CIOH seega antud juhul kohaldatav.

![BTC204](assets/fr/175.webp)

See tõlgendus on ebatäpne, sest, nagu te teate, üks UTXO saadeti Bob Bakerile, 2 UTXOd sisendiks tulid Alice'ilt ja ta sai 3 ülejäänud väljundit.

![BTC204](assets/fr/176.webp)

Ja mis on Stonewalli tehingu struktuuri puhul eriti huvitav, on see, et välise vaatleja seisukohast näeb see välja täpselt nagu Stonewall x2 tehing.

### Stonewall-tehing x2

Stonewall x2 on veel üks konkreetne Bitcoini tehingu vorm, mille eesmärk on samuti suurendada kasutaja privaatsust kulutuste ajal, kuid seekord koostöös kolmanda osapoolega, kes ei ole kulutustega seotud. See meetod toimib kahe osaleja vahelise pseudocoin-ühendusena, tehes samal ajal makse kolmandale osapoolele.

Stonewall x2 tehingu toimimine on suhteliselt lihtne: makse tegemiseks kasutatakse enda valduses olevat UTXOd ja kasutatakse kolmanda isiku abi, kes samuti panustab oma UTXOd. Tehing lõpeb nelja väljundiga: kaks võrdset summat, millest üks läheb makse saaja aadressile, teine maksjale kuuluvale aadressile. Kolmas UTXO saadetakse teisele panustajale kuuluvale aadressile, mis võimaldab tal esialgset summat tagasi saada (tema jaoks neutraalne tegevus, millest on maha arvatud kaevandamistasud), ning viimane UTXO jõuab tagasi meile kuuluvale aadressile, mis moodustab ülejäänud makse.

Seega on Stonewall x2 tehingutes määratletud kolm erinevat rolli:


- Saatja, kes teeb tegeliku makse;
- Vastuvõtja, kes ei pruugi olla teadlik tehingu eripärast ja lihtsalt ootab saatjalt makset;
- Koostööpartner, kes annab bitcoini, et tekitada kahtlusi tehingu analüüsis, taastab oma raha täielikult lõpus (neutraalne tegevus nende jaoks, ilma kaevandamistasudeta).

Tuleme tagasi meie näite juurde Alice'iga, kes on pagar Bobi juures, et osta oma baguette'i, mis maksab 4000 sati. Ta soovib maksta bitcoiniga, säilitades samal ajal oma makse suhtes teatava privaatsuse. Seega helistab ta oma sõbrale Charlesile, kes teda selles protsessis aitab.

![BTC204](assets/fr/177.webp)

Analüüsides seda tehingut, näeme, et pagar Bob sai tegelikult 4000 sati tasu baguette'i eest. Alice kasutas sisendina 10 000 sati ja sai väljundina tagasi 6 000 sati, mille tulemuseks on netosaldo -4 000 sati, mis vastab baguette'i hinnale. Charles andis sisendiks 15 000 sati ja sai kaks väljundit: ühe 4000 sati ja teise 11 000 sati, mille tulemuseks on saldo 0.

Selles näites olen tahtlikult jätnud välja komisjonid, et hõlbustada mõistmist. Tegelikkuses jagunevad kaevandamistasud üldiselt võrdselt makse väljastaja ja maksja vahel.

### Millised on Stonewall x2 tehingu eesmärgid?

Sarnaselt Stonewalli struktuuriga lisab ka Stonewall x2 struktuur tehingule märkimisväärse hulga entroopiat ja varjab ahelanalüüsi jäljed. Väljastpoolt vaadatuna võiks sellist tehingut tõlgendada kui väikest mündiühendust kahe inimese vahel. Tegelikkuses on see aga makse. Seega tekitab see meetod ahelanalüüsis ebakindlust, mis viib ka valede jälgedeni.

Vaatame üle Alice'i, pagar Bobi ja Charlesi näite. Tehing plokiahelas näeks välja järgmiselt:

![BTC204](assets/fr/178.webp)

Väline vaatleja, kes tugineb ahelanalüüsi üldisele heuristikale, võib ekslikult järeldada, et "_Alice ja Charles viisid läbi väikese coinjoini, mille sisendiks oli kummalgi üks UTXO ja väljundiks kaks UTXOd_" Jällegi, seda tehingut väljastpoolt analüüsides ei saa rakendada sisendi ühise omandiõiguse heuristikat (CIOH), sest kahe sama suure väljundi olemasolu viitab coinjoin-mustrile. Väljastpoolt vaadatuna ei ole CIOH seega antud juhul kohaldatav.

![BTC204](assets/fr/179.webp)

See tõlgendus on ebatäpne, sest nagu te teate, saadeti üks UTXO Bakerile Bobile, Alice'il on ainult üks puhkeallikas ja Charlesil on kaks.

![BTC204](assets/fr/180.webp)

Ja jällegi, mis on Stonewall x2 tehingu struktuuri puhul eriti huvitav, on see, et välise vaatleja seisukohast näeb see välja täpselt nagu Stonewalli tehing.

### Mis vahe on Stonewalli ja Stonewall x2 vahel?

StonewallX2-tehing toimib täpselt nagu Stonewall-tehing, ainult et esimene on koostööl põhinev, teine aga mitte. Nagu me nägime, osaleb StonewallX2-tehingus kolmas osapool (Charles), kes on makse suhtes väline ja kes annab oma bitcoinid, et suurendada tehingu konfidentsiaalsust. Klassikalise Stonewall-tehingu puhul võtab panustaja rolli üle saatja.

![BTC204](assets/fr/181.webp)

Väliselt vaadatuna on tehingumudel seega täpselt sama.

Asjaolu, et need kaks tehingustruktuuri jagavad täpselt sama mustrit, tähendab, et isegi kui väline vaatleja suudab tuvastada "Stonewall(x2)" mustri, ei ole tal kogu teave olemas. Ta ei suuda kindlaks teha, milline kahest samade summade UTXOst vastab maksele. Samuti ei suuda ta kindlaks teha, kas kaks sisestatud UTXOd pärinevad kahelt erinevalt inimeselt (Stonewall x2) või kuulusid nad ühele ja samale isikule, kes neid ühendas (Stonewall).

Viimane punkt tuleneb asjaolust, et Stonewall x2 tehingud järgivad täpselt sama skeemi kui Stonewall tehingud. Väljastpoolt ja ilma täiendava kontekstiteabeta on võimatu eristada Stonewall-tehingut Stonewall x2-tehingust. Siiski ei ole esimesed tehingud koostöövõimalused, samas kui viimased on. See lisab ühe sellise tehingu analüüsile veelgi rohkem kahtlusi.

### Millal kasutada Stonewall ja Stonewall x2 tehinguid?

Loogika peaks olema järgmine, kui soovite kasutada privaatsusvahendit tehingu jaoks:


- Esmajärjekorras saate valida, kas soovite teha tasulise liitumise;
- Kui kaupmees ei toeta payjoins'i, saab teha ühistehingu teise isikuga väljaspool makset, kasutades Stonewall x2 struktuuri;
- Kui te ei leia kedagi, kellega Stonewall x2 tehingut teha, võite ise teha Stonewall-tehingu, mis imiteerib Stonewall x2 tehingu käitumist.

### Kuidas kasutada Stonewall ja Stonewall x2 tehinguid?

Stonewall ja Stonewall x2 tehingud on saadaval nii Samourai Walleti rakenduses kui ka Sparrow Walleti tarkvaras.

Kuid nagu ka Payjoini puhul, toimivad Stonewall x2 tehingud pärast Samourai asutajate vahistamist nüüd ainult käsitsi PSBT-de vahetamise teel osapoolte vahel. Automaatne vahetamine Sorobani kaudu ei ole hetkel kahjuks võimalik.

Seda tüüpi tehinguid saab teha ka käsitsi mis tahes Bitcoini rahakoti tarkvarast.

Järgmises peatükis uurime lisaks juba uuritud tehnikale veel üht suhteliselt tundmatut, kuid väga kasulikku privaatsustehnikat.

https://planb.network/tutorials/privacy/on-chain/stonewall-033daa45-d42c-40e1-9511-cea89751c3d4
https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b
## Reboundid

<chapterId>db9a20ac-a149-443d-884b-ea6c03f28499</chapterId>

Bitcoini tehingustruktuuride kasutamine, mis lisavad ahela analüüsis ebaselgust, nagu näiteks coinjoin, on eriti kasulik privaatsuse kaitsmiseks. Kuid nagu me arutasime payjoini peatükis, on coinjoini tehingud ahelas loomulikult tuvastatavad. Tuletage meelde analoogiat, mille me krüptograafia ja coinjoin'ide vahel kindlaks tegime: kui faili krüpteeritakse, ei saa kolmas isik, kes avastab selle krüpteeritud faili, selle sisule ligi, kuid ta saab selgelt tuvastada, et faili on muudetud, et selle sisu varjata. Sama kehtib ka coinjoini puhul: kui analüütik uurib coinjoini tehingut, siis isegi kui ta ei suuda tuvastada otseseid seoseid sisendite ja väljundite vahel (ja vastupidi), saab ta siiski tuvastada, et vaadeldav tehing on coinjoin.

Sõltuvalt mündi kasutusotstarbest pärast mündiühendust võib selle protsessi läbimine olla problemaatiline. Näiteks kui te kavatsete müüa oma mündi reguleeritud vahetusplatvormil, kuid see on hiljuti läbinud coinjoini, tuvastab platvormi ahelaanalüüsi tööriist selle asjaolu. Platvorm võib siis keelduda teie UTXO-d, mis on läbinud coinjoini, vastu võtmast või isegi nõuda teilt selgitusi, millega kaasneb oht, et teie konto peatatakse või raha külmutatakse. Mõnel juhul võib platvorm teatada teie käitumisest ka riigiasutustele (näiteks nõuab seda TRACFIN Prantsusmaal digitaalsete varade teenusepakkujatelt (PSAN)).

Selle vältimiseks oleks vaja vahendit, mis suudaks Bitcoini mündi mineviku jäljed hägustada, et taastada mingi vahetatavus. Just see ongi rikošeti eesmärk.

### Mis on rikošett?

Ricochet on tehnika, mis hõlmab mitme fiktiivse tehingu sooritamist iseendale (pühkimine), et simuleerida bitcoinide omandiõiguse üleandmist. See vahend erineb teistest käsitletud tehingustruktuuridest, sest see ei võimalda prospektiivset anonüümsust, vaid pigem tagantjärele anonüümsust. Tegelikult võimaldab ricochet hägustada erisusi, mis võivad ohustada bitcoini mündi vahetatavust selle mineviku tõttu.

Selleks, et hägustada müntidele minevikus toimunud sündmuse, näiteks mündiühendustsüklite, jäetud jäljendit, teostab ricochet neli järjestikust tehingut, mille käigus kasutaja kannab endale raha üle erinevatel aadressidel.

Pärast seda tehingute jada suunab ricochet tööriist bitcoinid lõpuks nende lõppsihtkohta kui vahetusplatvormi.

Eesmärk on luua vahemaa, mis mõjutab mündi vahetatavust, näiteks mündiühendustehingu ja lõpliku kulutuse, mis võib selle mündi mineviku tõttu tagasi lükata. Seega võivad ahelanalüüsi vahendid järeldada, et tõenäoliselt toimus pärast sündmust omanikuvahetus, ja pidada seda münti asendatavaks. Coinjoini puhul võiksid ahelanalüüsi tööriistad seejärel eeldada, et tegemist ei ole sama isikuga, kes bitcoinid saatis ja coinjoini teostas, ning seega on mõttetu algatada meetmeid saatja vastu.

### Miks see toimib?

Sellise rikošeti meetodi puhul võiks ette kujutada, et ahelate analüüsi tarkvara süvendaks nende uurimist kaugemale kui neli hüpet. Siiski seisavad need platvormid avastamislävendi optimeerimisel dilemma ees. Nad peavad seadma piiri hüppete arvule, mille järel nad tunnistavad, et tõenäoliselt on toimunud omanikuvahetus ja et seos varasema sündmusega (nt coinjoin) tuleks ignoreerida.

Selle lävendi kindlaksmääramine osutub siiski riskantseks: iga vaadeldava vahelejäämiste arvu pikendamine suurendab eksponentsiaalselt valepositiivsete andmete hulka, st isikuid, kes on valesti märgitud sündmuses osalejateks, kuigi tehingu sooritas keegi teine. See stsenaarium kujutab endast suuremat riski nendele ettevõtetele, kuna valepositiivsed tulemused põhjustavad rahulolematust, mis võib mõjutada kliente konkurentide poole. Pikemas perspektiivis viib liiga suur tuvastamise künnis selleni, et platvorm kaotab rohkem kliente kui tema konkurendid, mis võib ohustada tema püsimajäämist. Seetõttu on nende platvormide jaoks keeruline suurendada täheldatud hüpete arvu ja 4 on sageli piisav arv, et nende analüüsile vastu astuda.

Siin täheldatud nähtus on mõnevõrra analoogne kuue eraldusastme teooriale.

Kuue eraldusastme teooria kohaselt on iga inimene Maal seotud iga teisega teadmiste ahela kaudu, mis hõlmab mitte rohkem kui kuus vahendajat. Piisab, kui läbida kuus inimest, kellest igaüks tunneb järgmist isiklikult, et jõuda ükskõik millise inimeseni maailmas.

Bitcoini tehingute puhul on sarnane nähtus. Jälgides piisaval arvul Bitcoini tehinguid, satutakse paratamatult coinjoin'ile. Ricochet-meetod kasutab seda põhimõtet ära, kasutades rohkem hüppeid, kui vahetusplatvormid suudavad mõistlikult jälgida. Kui platvormid otsustavad jälgida rohkem tehinguid, siis on võimalik lihtsalt lisada täiendav hüpe, et sellest meetmest mööda minna.

### Millal ja kuidas kasutada rikošetti?

Kõige tavalisem rikošeti kasutusjuhtum on see, kui on vaja varjata varasemat osalemist UTXOs, mis on teie omanduses, toimunud mündiühenduses. Ideaalis on kõige parem vältida coinjoini läbinud bitcoinide ülekandmist reguleeritud üksustele. Juhul, kui keegi leiab, et tal puuduvad muud võimalused, eriti kui on vaja bitcoinid kiiresti fiat-valuutaks likvideerida, pakub ricochet siiski tõhusat lahendust.

See meetod on tõhus mitte ainult mündiühenduste puhul, vaid ka mis tahes muude märkide puhul, mis võivad ohustada mündi vahetatavust.

Selle rikošeti meetodi idee pärineb algselt Samourai Wallet'i meeskonnalt, kes integreeris selle oma rakendusse, et automatiseerida protsessi. Samourai teenus on tasuline, kuna rikošeti eest tuleb lisaks kaevandamistasudele maksta 100 000 sati teenustasu. Seetõttu on selle kasutamine pigem soovitatav märkimisväärsete summade ülekannete puhul.

Samourai rakendus pakub kahte varianti rikošetist:


- Täiustatud rikošett ehk "etapiviisiline tarne", mille eeliseks on Samourai teenustasude jaotamine viie järjestikuse tehingu peale. See võimalus tagab ka selle, et iga tehing edastatakse eraldi ajal ja salvestatakse erinevas plokis, mis võimaldab jäljendada võimalikult täpselt omaniku vahetuse käitumist. Kuigi see meetod on aeglasem, on see eelistatav neile, kes ei kiirusta, sest see maksimeerib rikošeti tõhusust, tugevdades selle vastupidavust ahelanalüüsile;
- Klassikaline rikošet, mis on mõeldud operatsiooni kiireks teostamiseks, edastades kõik tehingud lühikese aja jooksul. Seetõttu pakub see meetod vähem privaatsust ja vähem vastupidavust analüüsile kui täiustatud meetod. Seda tuleks kasutada ainult kiireloomuliste esitamiste puhul.

Recochet seisneb lihtsalt bitcoini saatmises endale. On täiesti võimalik teha ricochet käsitsi mis tahes rahakoti tarkvaraga, ilma spetsiaalset tööriista kasutamata. Lihtsalt kandke sama münt endale hiljem üle, kasutades iga kord uut tühja aadressi.

Järgnevas peatükis uurime mitmeid salajase omandi üleandmise meetodeid. Need meetodid erinevad radikaalselt seni uuritud meetoditest nii nende tööpõhimõtete kui ka tulemuste poolest.

https://planb.network/tutorials/privacy/on-chain/ricochet-e0bb1afe-becd-44a6-a940-88a463756589
## Salajased kinnisvaraülekanded

<chapterId>a2067036-849c-4d6b-87d2-44235cfae7a1</chapterId>

Bitcoini privaatsustehnikate hulka kuulub ka salajane omandiõiguse üleandmine. Selle meetodi eesmärk on bitcoinide omandiõiguse ülekandmine ühelt isikult teisele ja vastupidi, ilma et see tehing oleks plokiahelas selgelt nähtav. Uurime koos erinevaid olemasolevaid tehnikaid ning nende eeliseid ja puudusi.

### CoinSwap

CoinSwap põhineb suhteliselt lihtsal kontseptsioonil: see kasutab arukaid lepinguid, et hõlbustada bitcoinide omandiõiguse ülekandmist kahe kasutaja vahel, ilma et oleks vaja usaldust ja ilma et see ülekanne oleks plokiahelas selgelt nähtav.

Kujutame ette lihtsustatud näidet Alice'i ja Bobiga. Alice'il on 1 BTC, mis on kaitstud privaatvõtmega $A$, ja Bobil on samuti 1 BTC, mis on kaitstud privaatvõtmega $B$. Teoreetiliselt võiksid nad salajase ülekande tegemiseks vahetada oma isiklikke võtmeid välise sidekanali kaudu.

Selline naiivne meetod kujutab endast siiski suurt riski usalduse osas. Mitte miski ei takista Alice'il pärast vahetust $A$ privaatvõtme koopiat hoida ja seda hiljem bitcoinide varastamiseks kasutada, kui võti on Bobi valduses.

Lisaks ei ole mingit garantiid, mis takistaks Alice'il saada Bobi privaatvõtit $B$ ja mitte kunagi saata vastutasuks oma privaatvõtit $A$. Seega põhineb see andmevahetus osapoolte vahelisel ülemäärasel usaldusel ja osutub ebatõhusaks, et tagada salajane omandiõiguse üleandmine turvalisel viisil.

Nende probleemide lahendamiseks ja selleks, et võimaldada vahetusi selliste osapoolte vahel, kes üksteist ei usalda, saame kasutada hoopis arukaid lepingusüsteeme. Arukas leping on programm, mis käivitub automaatselt, kui eelnevalt määratletud tingimused on täidetud, mis meie puhul tagab, et vara vahetamine toimub automaatselt, ilma et oleks vaja vastastikust usaldust.

Selleks võime kasutada HTLC (_Hash Time-Locked Contracts_) või PTLC (_Point Time-Locked Contracts_). Need kaks protokolli töötavad sarnaselt, kasutades ajalukustussüsteemi, mis tagab, et vahetus on edukalt lõpetatud või täielikult tühistatud, kaitstes seega mõlema osapoole vahendite terviklikkust. Peamine erinevus HTLC ja PTLC vahel seisneb selles, et HTLC-d kasutavad tehingu kindlustamiseks hashes'e ja eelkujutisi, PTLC-d aga Adaptive Signatures'e.

CoinSwap stsenaariumis, kus kasutatakse HTLC või PTLC abil Alice'i ja Bobi vahel, toimub vahetus turvaliselt: kas see õnnestub ja kumbki saab teise BTC, või ebaõnnestub ja kumbki jätab oma BTC endale. Seega ei saa kumbki osapool petta ega varastada teise BTC-d.

> hTLC-d on ka mehhanism, mida kasutatakse maksete turvaliseks suunamiseks Lightning Networki kahesuunaliste kanalite kaudu
> Kohandatavate allkirjade kasutamine on selles kontekstis eriti huvitav, kuna see võimaldab traditsioonilisi skripte vältida (seda mehhanismi nimetatakse mõnikord "_skriptideta skriptideks_"). See funktsioon aitab vähendada vahetusega seotud tasusid. Adaptive Signatures'i teine oluline eelis on see, et nad ei nõua tehingu mõlema poole jaoks ühise hash'i kasutamist, vältides seega teatud tüüpi vahetuste puhul otsese seose paljastamist.
### Kohanduvad allkirjad

Kohanduvad allkirjad on krüptograafiline meetod, mis ühendab kehtiva allkirja täiendava allkirjaga, mida nimetatakse "_kohanduvaks allkirjaks_", et paljastada salajane andmestik. See mehhanism on kavandatud nii, et kolme järgmise elemendi - kehtiva allkirja, adaptiivse allkirja ja saladuse - teadmine võimaldab tuletada kolmanda puuduva elemendi. Selle meetodi huvitav omadus on see, et kui me teame oma vastaspoole adaptiivset allkirja ja konkreetset punkti elliptilisel kõveral, mis on seotud selle adaptiivse allkirja arvutamiseks kasutatud saladusega, saame tuletada oma adaptiivse allkirja, mis on kooskõlas sama saladusega, ilma et meil oleks otsene juurdepääs saladusele endale.

Mündivahetuses võimaldab kohanduvate allkirjade kasutamine kahe tundliku teabe üheaegset avalikustamist osalejate vahel, vältides seega vajadust vastastikuse usalduse järele. Võtame selle protsessi illustreerimiseks näite Alice'i ja Bobiga, kes soovivad vahetada kumbki 1 BTC omanikuks, kuid ei usalda teineteist. Nad kasutavad Adaptive Signatures'i, et kaotada selle vahetuse puhul vajadus usalduse järele. Nad toimivad järgmiselt:


- Alice algatab vahetuse, luues tehingu $m_A$, mis saadab Bobile 1 BTC. Ta genereerib allkirja $s_A$, mis kinnitab selle tehingu, kasutades oma isiklikku võtit $p_A$ ($P_A = p_A \cdot G$), nonce $n_A$ ($N_A = n_A \cdot G$) ja saladust $t$ ($T = t \cdot G$):

$$s_A = n_A + t + H(N_A + T \paralleel P_A \paralleel m_A) \cdot p_A$$$


- Alice arvutab adaptiivse allkirja $s_A'$, lahutades salajase $t$ tema tegelikust allkirjast $s_A$:

$$s_A' = s_A - t$$$


- Alice saadab Bobile oma adaptiivse allkirja $s'_A$, oma allkirjastamata tehingu $m_A$, punkti, mis vastab saladusele ($T$), ja punkti, mis vastab nonce'ile ($N_A$). Need elemendid moodustavad nn "_adapteri_" Oluline on märkida, et ainult selle teabega ei saa Bob Alice'i BTC-d kätte.
- Bobil on aga võimalus kontrollida, et Alice ei ürita temalt midagi varastada. Selleks kontrollib ta, kas Alice'i kohanduv allkiri $s_A'$ vastab tegelikult kavandatavale tehingule $m_A$. Kui järgmine võrrand on õige, võib ta olla kindel, et Alice'i kohanduv allkiri on kehtiv:

$$s_A' \cdot G = N_A + H(N_A + T \paralleel P_A \paralleel m_A) \cdot P_A$$$


- See kontrollimine annab Bobile piisava kindluse, et vahetusega kindlalt jätkata. Seejärel loob ta oma tehingu $m_B$, mille eesmärk on saata Alice'ile 1 BTC, ja genereerib oma adaptiivse allkirja $s_B'$, mis on samuti seotud sama saladusega $t$. Sel hetkel teab ainult Alice väärtust $t$; Bob teab ainult vastavat punkti $T$, mille Alice talle edastas:

$$s_B' = n_B + H(N_B + T \paralleel P_B \paralleel m_B) \cdot p_B$$$


- Bob edastab Alice'ile oma adaptiivse allkirja $s_B'$, oma allkirjastamata tehingu $m_B$, samuti punkti, mis vastab saladusele ($T$) ja punkti, mis vastab nonce'ile ($N_B$). Alice, kes teab saladust $t$, saab nüüd kombineerida Bobi adaptiivset allkirja $s_B'$ selle saladusega, et luua kehtiv allkiri $s_B$ tehingu $m_B$ jaoks, millega Bobi BTC-d talle üle kantakse:

$$s_B = s_B' + t$$$

$$(s_B' + t) \cdot G = N_B + T + H(N_B + T \paralleel P_B \paralleel m_B) \cdot P_B$$$


- Alice edastab selle allkirjastatud tehingu $m_B$ Bitcoini plokiahelas, et saada Bobi poolt lubatud BTC. Kui Bob näeb seda tehingut plokiahelas, saab ta välja võtta allkirja $s_B = s_B' + t$. Selle teabe abil saab Bob seejärel eraldada talle vajaliku kuulsa $t$ saladuse:

$$t = (s_B' + t) - s_B' = s_B - s_B'$$$


- Ja tegelikult oli see salajane $t$ ainus puuduv element, mille abil Bob sai Alice'i adapteri allkirjast $s_A'$ luua kehtiva allkirja $s_A$. See allkiri võimaldab valideerida tehingu $m_A$, mis saadab BTC-d Alice'ilt Bobile. Seejärel arvutab Bob $s_A$ ja edastab omakorda tehingu $m_A$ plokiahelas:

$$s_A = s_A' + t$$$

$$(s_A' + t) \cdot G = N_A + T + H(N_A + T \paralleel P_A \paralleel m_A) \cdot P_A$$

Võtame kokku, kuidas allkirjaadapter töötab mündivahetuses. Esialgu saadab Alice Bobile allkirjastamata tehingu koos adapteriga, mis võimaldab Bobil kontrollida, et hiljem avalikustatud saladus annab talle juurdepääsu bitcoinidele. Vastutasuks saadab Bob Alice'ile oma allkirjastamata tehingu ja adapteri. Seejärel saab Alice Bobi tehingu lõplikult vormistada ja bitcoinid tagasi saada, edastades kehtiva tehingu, milles kasutatakse saladust. Kui see tehing avaldatakse plokiahelas, on Bobil võimalik saladus välja võtta ja seega Alice'i tehing lahti lukustada. Järelikult, kui Alice algatab Bobi bitcoinide ülekande, saab ta omakorda juurdepääsu Alice'i bitcoinidele, ilma et oleks vaja vastastikust usaldust.

Oluline on märkida, et mündivahetust pakkus esimesena välja [Gregory Maxwell oktoobris 2013 BitcoinTalkis](https://bitcointalk.org/index.php?topic=321228.0).

### Aatomivahetus

Sarnaselt mündivahetusega ja kasutades samalaadseid arukaid lepinguid, on võimalik teostada ka aatomivahetust. Aatomivahetus võimaldab erinevate krüptovaluutade, näiteks BTC ja XMR, otsevahetust kahe kasutaja vahel, ilma et oleks vaja usaldust või vahendaja sekkumist. Neid vahetusi nimetatakse "aatomivahetusteks", sest neil on ainult kaks võimalikku tulemust: kas vahetus õnnestub ja mõlemad pooled on rahul või ebaõnnestub ja kumbki jätab oma algsed krüptovaluutad alles, seega ei ole vaja usaldust teise osapoole vastu.

![BTC204](assets/fr/197.webp)

Aatomivahetusel ja mündivahetusel on sarnane töömeetod ja neil on samad eelised ja puudused privaatsuse osas. Tegelikult on aatomivahetus Bitcoini seisukohast võrreldav mündivahetusega, mis toimub kahes etapis. Kõigepealt vahetame oma BTC teise krüptovaluuta vastu ja seejärel saab seda krüptovaluutat vahetada teiste BTCde vastu. Lõpuks saame tagasi teise kasutaja BTC. Seepärast liigitan need kaks protokolli privaatsusküsimuste analüüsis salajase varade vahetamise kategooriasse.

![BTC204](assets/fr/198.webp)

Kuid erinevalt mündivahetusest võib aatomivahetusel olla tasakaalustamatus olemasoleva likviidsuse osas, eriti BTC/XMR-vahetuses. Üldiselt on bitcoini vahetamine altcoini vastu lihtsam, sest bitcoini järele on suur nõudlus, mis hoiab selle konverteerimissuuna preemiad madalad. Altcoini vahetamine BTC saamiseks võib aga väiksema nõudluse tõttu olla keerulisem, mille tulemuseks on sageli väga kõrged preemiad.

Lõpuks, kui aatomivahetuses osalevad Lightning-võrgus olevad bitcoinid ja bitcoinid, nimetame seda "_submersible exchange_"

### Kas see on tõesti kasulik?

Salajased omandiõiguse ülekanded, nagu mündivahetused ja aatomivahetused, on eeliseks ahelanalüüsi heuristikate lollitamisel. Need meetodid võivad jätta mulje, et tehingud hõlmavad sama kasutajat, isegi kui tegelik omanik on vahetanud omanikku. Nende meetodite peamine puudus on aga see, et need on väga riskantsed, kui ei kasutata täiendavat tehnikat mündi ajaloo häirimiseks.

Kui Alice teeb mündivahetuse või aatomivahetuse Bobiga, siis vahetab ta oma bitcoinide omandiõiguse Bobi bitcoinide vastu. Aatomivahetuse puhul hõlmab vahetus ka altcoini, kuid põhimõte jääb samaks. Seega saab Alice lõpuks mündi $B$ ja Bob mündi $A$. See lisab ahela analüüsile kahtlusi, kuid müntide ajalugu jääb jälgitavaks. Kui analüütik uurib münti $A$, saab ta jälgida Alice'i varasemat tegevust ja vastupidi mündi $B$ puhul.

Alice'i seisukohalt on oht, et teatud üksused võivad $B$ mündi ajalugu pidada kahtlaseks. Kui Bob oleks näiteks omandanud $B$ mündi kuritegeliku teo, näiteks häkkimise käigus, jääks see münt tema ebaseadusliku tegevusega seotuks. Alice võib siis sattuda mündi valdusesse, mida ta ei saa üle kanda reguleeritud kauplemisplatvormidele, ilma et ta riskiks oma vahendite külmutamisega või isegi sellega, et teda süüdistatakse Bobi kuritegudes, kuigi tal ei ole nendega midagi pistmist.

Ja muidugi eelistavad kurjategijad, kelle vahendeid ametiasutused jälgivad, selliseid privaatsusmeetodeid nagu mündivahetus või aatomivahetus. Need protokollid annavad neile võimaluse võõrandada oma jälgitud bitcoinid täiesti asendatavate bitcoinide vastu. See võimaldab neil luua ka diversiooni, suunates ametiasutused teistele kasutajatele. Seega on neil inimestel kahekordne kasu.

Coinjoiniga on mündi ajalugu katki, isegi kui teie münt on segatud jälgitavate bitcoinidega, mis tagab usutava eitatavuse, mida ei ole olemas salajase vara üleandmise protokollides, nagu mündivahetus või aatomivahetus.

Kui Alice tahab vältida igasugust riski, peab ta tingimata kasutama meetodit, mis häirib $B$ mündi ajalugu, näiteks jooksutades seda läbi coinjoins'i. See tõstatab küsimuse, kas salajase omandiõiguse üleandmise ja coinjoin'i kombineerimine on kasulik. Coinjoin, katkestades mündi ajaloo, tagab Alice'ile juba piisava salastatuse taseme. Seega olen seisukohal, et kui Alice soovib kaitsta oma privaatsust, oleks mõistlikum jätkata otse coinjoiniga kui tegeleda mündivahetusega, millele järgneb coinjoin.

Selleks, et salajase omandiõiguse üleandmise meetodid oleksid tõeliselt tõhusad ja väldiksid riski, et $A$ kasutaja ajalugu seostatakse $B$ kasutajaga, oleks paradoksaalselt vajalik, et nende kasutamine oleks laialdaselt teada. Kui mündivahetust kasutatakse massiliselt ja ametiasutused on sellest levinud praktikast teadlikud, siis on võimalik luua usutav eitamisvõimalus. Kuid seni, kuni nende ülekannete kasutamine jääb marginaalseks, jäävad need meetodid minu arvates kasutajate jaoks liiga riskantseks.

Seni oleme uurinud peamiselt privaatsusmeetodeid tehingu tasandil. Järgmises peatükis uurime küsimusi võrgustiku tasandil ja tehingu levikut.

## Privaatsus P2P-võrgus

<chapterId>04a2467b-db84-4076-a9ff-919be5135106</chapterId>

Neljandas osas arutasime, kui oluline on kasutada täielikku sõlme, et kaitsta oma tehingute privaatsust. Siiski on oluline mõista, et teie sõlme ise võidakse rünnata, et saada teavet teie tegevuse kohta. Käesolevas peatükis vaatleme seetõttu erinevaid privaatsuskaitsemeetmeid mitte tehingute endi või bitcoinide voogude tasandil, vaid võrgu tasandil.

### Võilill

Üks võimalus vältida erinevaid deanonümiseerimisrünnakuid on kasutada pakutud Dandelion'i. See ülekandeprotokoll vormistati BIP156s, kuid seda ei ole kunagi Bitcoinis rakendatud. Dandelioni idee on parandada tehingu marsruutimise privaatsust Bitcoini võrgus, et nurjata erinevaid rünnakuid. Selle peamine eesmärk on varjata võrgus tehingu algselt edastav lähtesõlm. Selle sõlme avalikustamine võib siduda Bitcoini tehingu konkreetse IP-aadressiga (kui sõlm tegutseb krüpteerimata võrgus), pakkudes seega sisenemispunkti ahela analüüsiks.

Selline seos Bitcoini tegevuse ja IP-aadressi vahel kujutab endast märkimisväärset ohtu kasutaja privaatsusele. Tegelikult saavad paljud üksused kergesti seostada IP-aadressi isikliku identiteediga. See hõlmab märkimisväärselt valitsusi ja Interneti-teenuste pakkujaid. Lisaks võib see teave muutuda avalikult kättesaadavaks, näiteks kui teie IP-aadress ja isikuandmed satuvad veebilehe andmebaasi häkkimise käigus toimuva andmete lekkimise tõttu avalikkuse ette.

Bitcoini tavapärase toimimise puhul edastatakse kasutaja poolt tema tarkvaralehel tehtud tehingud tema isiklikku sõlme. See sõlmpunkt edastab uue tehingu kohe kõigile eakaaslastele, kellega ta on ühendatud.

Seejärel kontrollivad need eakaaslased tehingut, et tagada selle vastavus konsensusreeglitele ja kohalikele standardimisreeglitele. Kui tehing on kinnitatud, edastab iga partner omakorda tehingu oma partneritele ja nii edasi.

Integreerimist ootavate tehingute jaotumine plokis toimub üsna tasakaalustatult ja statistiliselt ennustatavalt. Seda haavatavust võivad ära kasutada kokkumängivad spioonisõlmed, mis teevad koostööd võrgu jälgimiseks ja analüüsimiseks, et tuvastada esimene tehingu edastav sõlm. Kui vaatleja suudab leida lähtesõlme, võib ta eeldada, et tehing pärineb selle sõlme operaatorilt. Selline vaatlus võib siduda tavaliselt anonüümsed tehingud konkreetsete IP-aadressidega.

BIP156 eesmärk on selle probleemi lahendamine. Selleks võetakse uue tehingu edastamisel kasutusele täiendav etapp, et säilitada anonüümsus enne laiaulatuslikku avalikku levitamist. Dandelion kasutab kõigepealt "varre" etappi, kus tehing saadetakse läbi juhusliku sõlmede tee.

Seejärel edastatakse tehing kogu võrku "fluff" (blowhole) etapis.

Tüvi ja võilill on viited tehingu võrgu kaudu levimise käitumisele, mis meenutab võilille kuju.

Seega saavad luurajad potentsiaalselt jälgida tehingu tagasi selle sõlme juurde, mis algatas puhumisfaasi (massiline edastamine), kuid see sõlme ei ole see, kes edastas tehingu esimesena, sest ta sai selle viimaselt tüve sõlmedelt. Kui spioonisõlmed ei saa jälgida tüve, ei saa nad ka lähtesõlme tuvastada.

Isegi spioonisõlmede olemasolul tüveprotsessi ajal jääb alati kahtlus, sest niipea, kui nad kohtuvad ausa sõlmega levikegraafis, ei suuda spioonid kindlaks teha, kas see sõlme on algne allikas või lihtsalt vahendaja.

Selline marsruutimismeetod muudab raskemini jälgitavaks lähtesõlme, muutes tehingu jälgimise läbi võrgu selle päritoluni keeruliseks. Dandelion parandab seega eraelu puutumatust, piirates vastaste võimalusi võrgu deanonüümseks muutmiseks. See meetod on veelgi tõhusam, kui tehing läbib "varre" faasis sõlme, mis krüpteerib oma võrgusuhtluse, nagu Tor või P2P Transport V2.

BIP156 ei ole integreeritud Bitcoin Core'i ja on praegu klassifitseeritud staatusega "tagasi lükatud" Selle protokolliga seotud peamine mure seisneb selles, et tüveprotsessi ajal peavad tehinguid enne verifitseerimist edastama vahesõlmed. Nagu me nägime, kontrollib tavalises Bitcoini mudelis iga sõlmpunkt esmalt tehingu enne selle edastamist eakaaslastele. Kui tehing ei vasta sõlme konsensuse või kohaliku standardimise reeglitele, siis seda ignoreeritakse ja seda ei edastata. See protsess on oluline DoS-rünnakute tõrjumiseks, kuna kogu võrku edastatakse ainult kehtivad tehingud. Mittekehtivad tehingud, mis võivad tekkida massiliselt võrgu ülekoormamiseks, peatatakse esimeses sõlmes ja need ei levi edasi. Dandelion'i peamine oht on, et see uus protokoll võib tekitada uusi DoS-rünnakute vektoreid, võimaldades kehtetute tehingute edastamist läbi osa võrgu.

### P2P transport V2

P2P Transport V2 on teine võrguprotokoll, mis on esitatud BIP324-s. See on uus versioon Bitcoini P2P transpordiprotokollist, mis sisaldab oportunistlikku krüptograafiat, et parandada sõlmedevahelise side konfidentsiaalsust ja turvalisust.

Selle täiustamise eesmärk on lahendada mitu P2P-protokolli põhiversiooniga seotud probleemi. Esiteks muudab see vahetatavad andmed passiivse vaatleja jaoks eristamatuks muudest Internetis liikuvatest andmetest. Peamine eesmärk on takistada valitsustel, Interneti- või VPN-teenuse pakkujatel Bitcoini kasutajate massilist jälgimist. See muudab ka nende üksuste jaoks keerulisemaks kindlaks teha, kas internetikasutaja on ka Bitcoini kasutaja, st kas ta kasutab täielikku sõlme.

P2P V2 aitab ka vähendada tsensuuri ja rünnakute ohtu, tuvastades andmepakettide konkreetseid mustreid. See muudab mitmesuguste Sybil-rünnakute läbiviimise võrgu tasandil keerulisemaks ja kulukamaks. Sybil-rünnak toimub siis, kui toimija loob mitu valeidentiteeti, et saada põhjendamatuid eeliseid. Bitcoini võrgu kontekstis väljendub see sageli selles, et tegutseja kontrollib suurt arvu täielikke sõlmi ja kasutab neid agressiivselt ühenduste mitmekordistamiseks. Sybil-rünnakud võivad olla passiivsed, mille eesmärk on koguda teavet ja ohustada kasutajate konfidentsiaalsust, või aktiivsed, Eclipse-rünnakute kujul. Viimased isoleerivad konkreetse sõlme ülejäänud võrgust, võimaldades tal tsenseerida kasutajat või muuta saadud andmeid. Lõpuks muudab P2P V2 _Man-In-The-Middle_ (MITM) rünnakud kallimaks ja kergemini avastatavaks.

P2P V2 rakendatud krüpteerimine ei sisalda autentimist, et mitte lisada asjatut keerukust ja mitte ohustada võrguühenduse loata olemust. See uus P2P-ülekandeprotokoll pakub siiski paremat turvalisust passiivsete rünnakute vastu ning muudab aktiivsed rünnakud oluliselt kulukamaks ja avastatavamaks. Pseudosituatsioonilise andmevoo lisamine võrgusõnumitesse raskendab ründajate, kes soovivad tsenseerida või manipuleerida sidet, tööd.

P2P V2 transport lisati lisavõimalusena (vaikimisi välja lülitatud) Bitcoin Core'i versiooni 26.0, mis võeti kasutusele detsembris 2023. Seejärel lülitati see vaikimisi sisse versioonis 27.0 aprillis 2024. Seda saab muuta konfiguratsioonifaili valikuga `v2transport=`.

### Tor

Suhteliselt lihtne lahendus võrgu tasemel sõlme konfidentsiaalsuse kaotamise ohu vältimiseks on käivitada see täielikult Tori all. Tor on releeserverite (sõlmede) võrgustik, mis anonüümsustab TCP-ühenduste päritolu Internetis. See toimib andmete kapseldamise teel mitme krüpteerimiskihiga. Iga releesõlm eemaldab ühe kihi, et paljastada järgmise sõlme aadress, kuni lõpliku sihtkohani jõutakse. Tor-võrk tagab anonüümsuse, takistades vahesõlmedel teada saada nii andmete päritolu kui ka sihtkohta, mistõttu on vaatlejal väga raske jälgida kasutaja tegevust.

Tor mitte ainult ei krüpteeri edastatavaid andmeid, vaid võimaldab ka side päritolu ja sihtkoha maskeerimist. Kasutades Tor'i oma isiklike sõlmede sidepidamiseks, parandame oma tehingute privaatsust: Interneti-teenuse pakkuja (ISP) ei saa sidet dekrüpteerida ja teised Bitcoini võrgu sõlmed ei saa tuvastada lähtesõlme IP-aadressi. Lisaks varjab Tor Bitcoini kasutamist ka oma Interneti-teenuse pakkuja eest.

Selle meetodiga seotud peamine risk on see, et Tor on Bitcoinist sõltumatu protokoll. Kui teil on Tori all Bitcoin-sõlm ja Tor lakkab töötamast, siis ei saa teie Bitcoin-sõlm enam suhelda.

Samuti on oluline märkida, et Toril toimuv side on aeglasem. See viivitus on eriti tülikas sõlme esialgse käivitamise ajal, kuna algne bloki allalaadimine (IBD) nõuab palju suhtlust. Selle tulemusena võib esialgne sünkroniseerimine Bitcoini võrguga olla Tori abil oluliselt pikem. Samuti on võimalik teha IBD avatud võrgus ja seejärel aktiveerida Tor hiljem. Kuigi see meetod paljastab teie Bitcoini sõlme olemasolu teie internetiteenuse pakkujale, kaitseb see teie isiklikku tehinguinfot, kui te vahetate Tori vastu.

Olles uurinud erinevaid privaatsusmeetodeid võrgutasandil, tahan järgmistes peatükkides tutvustada ka kahte elegantset lahendust aadresside korduvkasutamise vältimiseks: BIP47 ja Silent Payments.

## BIP47 ja korduvkasutatavad maksekoodid

<chapterId>ad88e076-a04b-4aec-b3b2-7b4760175504</chapterId>

Nagu nägime 3. osas, on aadresside korduvkasutamine tõsine takistus kasutajate privaatsusele Bitcoini protokollis. Nende riskide vähendamiseks on tungivalt soovitatav luua uus vastuvõtuaadress iga uue rahakotti laekunud makse jaoks. Kuigi tänapäeval on uue aadressi genereerimine tänu kaasaegse tarkvara ja hierarhiliste deterministlike rahakottide kasutamisele lihtsustatud, võib see praktika tunduda vastunäidustatud.

Traditsioonilises pangandussüsteemis oleme näiteks harjunud jagama oma IBANi, mis jääb alati samaks. Kui me seda kellelegi ütleme, võib ta saata meile mitu makset, ilma et ta peaks meiega uuesti suhtlema. Neopangad pakuvad ka moodsamaid võimalusi, näiteks unikaalsete e-posti aadresside kasutamine PayPalis või RevTagide kasutamine Revolutis. Isegi väljaspool finantsvaldkonda on meie igapäevased tunnused, nagu postiaadress, telefoninumber ja e-posti aadress, unikaalsed ja püsivad. Me ei pea neid iga uue suhtluse korral uuendama.

Bitcoini tööpõhimõte on aga teistsugune: iga sissetuleva tehingu jaoks tuleb luua uus vastuvõtuaadress. See kompromiss kasutusmugavuse ja privaatsuse vahel ulatub tagasi Bitcoini valge raamatu algusaegadesse. Satoshi Nakamoto hoiatas meid selle ohu eest juba oma esimese versiooni avaldamisest alates 2008. aasta lõpus:

**"_"Täiendava tulemüürina võiks iga tehingu jaoks kasutada uut võtmepaari, et hoida neid ühise omanikuga sidumata._"**"

On mitmeid meetodeid, kuidas saada mitu makset ühe identifikaatori kohta, ilma et see põhjustaks aadressi korduvkasutust. Igal neist meetoditest on omad kompromissid ja puudused. Nende meetodite hulgas on Justus Ranvieri väljatöötatud ja 2015. aastal avaldatud ettepanek BIP47 . Selle ettepaneku eesmärk on luua korduvkasutatavad maksekoodid, mis võimaldavad mitu tehingut samale isikule, vältides samal ajal aadressi korduvkasutamist. Sisuliselt püüab BIP47 pakkuda intuitiivset maksesüsteemi kui unikaalset identifikaatorit, säilitades samal ajal tehingute privaatsuse.

![BTC204](assets/fr/212.webp)

BIP47 ei paranda otseselt kasutajate privaatsust, kuna BIP47 makse pakub sama suurt privaatsust kui klassikaline Bitcoini tehing, mille puhul kasutatakse värskeid aadresse. Siiski muudab see Bitcoini kasutamise mugavamaks ja intuitiivsemaks, mis tavaliselt ohustab privaatsust. Tänu BIP47-le saavutab see kasutusmugavus sama privaatsuse taseme kui klassikaline tehing. Seetõttu on BIP47 väärtuslik vahend privaatsuse säilitamiseks.

Esialgu oli BIP47 ettepanek, mis oli sõnastatud Bitcoin Core'ile integreerimiseks, kuid seda ei võetud kunagi vastu. Mõned tarkvarad otsustasid seda siiski rakenduste tasandil iseseisvalt rakendada. Seega arendasid Samourai rahakoti meeskonnad oma BIP47 rakendamise nimega "PayNym"

### BIP47 ja PayNymi üldine põhimõte

BIP47 eesmärk on võimaldada arvukate maksete vastuvõtmist ilma aadressi korduvkasutamist põhjustamata. See põhineb korduvkasutatava maksekoodi kasutamisel, mis võimaldab erinevatel saatjatel saata mitu makset ühele teisele kasutajale kuuluvale koodile. Seega ei pea saaja iga tehingu jaoks uut aadressi esitama, mis lihtsustab oluliselt nende teabevahetust, säilitades samal ajal nende privaatsust.

![BTC204](assets/it/66/4.webp)

Seejärel saab kasutaja oma maksekoodi vabalt jagada kas sotsiaalvõrgustikes või oma veebisaidil, ilma et ta riskiks privaatsuse kaotamisega, erinevalt sellest, mis juhtuks klassikalise vastuvõtuaadressi või avaliku võtme puhul.

Tehingu tegemiseks peab mõlemal osapoolel olema Bitcoini rahakott, mis on rakendatud BIP47, näiteks PayNym Samourai rahakotis või Sparrow rahakotis. Nende maksekoodide ühine kasutamine loob nende vahel salajase kanali. Selle kanali tõhusaks loomiseks peab saatja tegema Bitcoini plokiahelas konkreetse tehingu, mida nimetatakse "teavitustehinguks" (selle kohta annan hiljem täpsemalt teavet).

Mõlema kasutaja maksekoodide kombinatsioon loob ühised saladused, mis omakorda võimaldavad luua suure hulga unikaalseid Bitcoini vastuvõtuaadresse (täpselt 2^32 ehk umbes 4 miljardit). Seega ei ole BIP47 kaudu tehtud maksed tegelikult adresseeritud mitte maksekoodile endale, vaid pigem klassikalistele vastuvõtuaadressidele, mis on tuletatud asjaomaste kasutajate maksekoodidest.

Maksekood on siis virtuaalne identifikaator, mis on tuletatud rahakoti seemnest. Portfelli hierarhilises tuletamisstruktuuris on maksekood paigutatud 3. tasandile, st kontotasandile.

![BTC204](assets/it/66/5.webp)

BIP47 tuletamise sihtmärk on identifitseeritud indeksiga `47'` (`0x8000002F`), mis viitab BIP47-le. Taaskasutatava maksekoodi tuletamise tee näide on järgmine:

```plaintext
m/47'/0'/0'/
```

Et anda teile aimu, kuidas maksekood välja näeb, on siin minu oma:

```plaintext
M8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Seda koodi saab lihtsaks suhtlemiseks kodeerida ka QR-koodiks, nagu klassikalist vastuvõtuaadressi.

Mis puutub PayNym Bots'i, siis need Twitteris mõnikord nähtud robotid on Samourai rahakoti poolt loodud maksekoodi visuaalsed kujutised. Need genereeritakse hashing-funktsiooni abil, mis annab neile peaaegu unikaalsuse. Nad ilmuvad väikese märgijada kujul, mis algab tähega `+`:

```plaintext
+throbbingpond8B1
+twilightresonance487
+billowingfire340
```

Neid avatare saab esitada ka piltidena:

![BTC204](assets/fr/215.webp)

Kuigi neil robotitel ei ole konkreetset tehnilist funktsiooni BIP47 raamistikus, mängivad nad rolli kasutajate vahelise suhtluse hõlbustamisel, pakkudes kergesti äratuntavat visuaalset identiteeti.

---
*Käesoleva peatüki järgmistes BIP47-le pühendatud osades uurime selle toimimist üksikasjalikult, keskendudes eelkõige kasutatud krüptograafilistele meetoditele. Nende üsna tehniliste selgituste täielikuks mõistmiseks on kõigepealt oluline mõista HD-kontode struktuuri, võtmete tuletamise protsesse ja elliptilisel kõveral põhineva krüptograafia aluspõhimõtteid. Kui soovite nende mõistete kohta rohkem teada saada, on veel üks tasuta kursus kättesaadav Plan ₿ Network'is:*

https://planb.network/courses/cyp201
*Soovitan seda väga jälgida, sest BIP47 tehnilise toimimise mõistmine aitab teil palju lihtsamini mõista teisi sarnaseid ettepanekuid, mida arutame järgmistes peatükkides.*

---
### Taaskasutatav maksekood

Nagu eespool mainitud, asub korduvkasutatav maksekood HD rahakoti 3. tasandil, mis teeb selle võrreldavaks "xpubiga" nii oma positsiooni poolest rahakoti struktuuris kui ka oma rolli poolest.

80 baidine maksekood jaguneb järgmiselt:


- Byte "0": Versioon**. BIP47 esimese versiooni puhul on selle baidi väärtuseks "0x01";
- Byte "1": Bittväli**. See koht on reserveeritud lisamärkide lisamiseks konkreetsete kasutuste ajal. PayNymi standardkasutusel on see bait määratletud kui "0x00";
- Byte "2": Pariteet `y`**. See bait on `0x02` või `0x03`, mis näitab, kas avaliku võtme ordinaat on paariline või paaritu, kuna kasutatakse kokkusurutud avalikku võtit;
- Alates baidist "3" kuni baidini "34": Väärtus `x`**. Need baitid kujutavad avaliku võtme absisset. `x` ja pariteedi `y` liitmine moodustab täieliku kokkusurutud avaliku võtme;
- Alates baidist "35" kuni baidini "66": Ketikood**. See ala sisaldab avaliku võtmega seotud ahelakoodi;
- Alates baidist "67" kuni baidini "79": Täitmine**. See koht on ette nähtud võimalikuks edasiseks arendamiseks. Praeguse versiooni puhul on siia lihtsalt paigutatud nullid, et saavutada 80 baidi suurune väljund, mis on vajalik `OP_RETURN` väljundiks.

Siin on minu eelmises punktis juba esitatud korduvkasutatava maksekoodi heksadetsimaalne esitus:

```plaintext
0x010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

![BTC204](assets/it/66/7.webp)

Kõigepealt on vaja lisada algusesse eesliite "P", et selgelt näidata, et tegemist on maksekoodiga. Seda baiti tähistab `0x47`:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

Lõpuks, et tagada maksekoodi terviklikkus, arvutatakse kontrollsumma, kasutades `HASH256`, mis koosneb kahekordsest hashimisest funktsiooniga `SHA256`. Seejärel ühendatakse selle hashi tulemusel saadud neli esimest baiti maksekoodi lõppu:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000567080c4
```

Kui need sammud on lõpetatud, on maksekood valmis. Ainus järelejäänud samm on selle teisendamine baas 58-ks, et saada selle lõplik versioon:

```plaintext
PM8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Selle maksekoodi loomise käigus kasutame tihendatud avalikku võtit ja ahelakoodi. Mõlemad tuletatakse rahakoti seemnest deterministliku ja hierarhilise tuletamise teel. Selleks kasutatav tuletamise tee on järgmine:

```plaintext
m/47'/0'/0'/
```

Taaskasutatava maksekoodi kokkusurutud avaliku võtme ja sellega seotud ahelakoodi genereerimiseks arvutame esmalt rahakoti seemnest peamise privaatvõtme. Seejärel tuletame tütarvõtmepaari, kasutades indeksit `47 + 2^31` (tugevdatud tuletamine). Sellele sammule järgneb veel kaks järjestikust tütarvõtmepaari tuletamist, kasutades indeksit `2^31` (tugevdatud tuletamine).

### Elliptilise kurvi Diffie-Hellmani võtmevahetus (ECDH)

BIP47 keskmes olevale krüptograafilisele protokollile viidatakse akronüümiga ECDH, mis tähendab _Elliptic-Curve Diffie-Hellman_. See meetod on algse Diffie-Hellmani võtmevahetuse variant.

1976. aastal kasutusele võetud Diffie-Hellmani protokoll on võtmekokkuleppe protokoll, mis võimaldab kahel osapoolel, kellel mõlemal on võtmepaar (avalik ja privaatne), leppida kokku ühises saladuses, isegi kui nad suhtlevad ainult avaliku, ebaturvalise kanali kaudu.

![BTC204](assets/it/66/10.webp)

Seda jagatud saladust (siin sinine võti) saab seejärel kasutada teisteks toiminguteks. Tavaliselt saab seda jagatud saladust kasutada ebaturvalise võrgu kaudu toimuva side krüpteerimiseks ja dekrüpteerimiseks:

![BTC204](assets/fr/220.webp)

Diffie-Hellman kasutab jagatud saladuse arvutamiseks modulaararvutust. Siin on lihtsustatud selgitus selle toimimisest:


- Alice ja Bob lepivad kokku ühises värvitoonis, siinkohal kollane, mis kujutab endast avalikke andmeid (ründajad teavad seda värvi);
- Alice valib salajase värvi, siinkohal punase, ja segab neid kahte, et saada oranž;
- Bob valib ka salajase värvi, siin sinise, ja segab selle kollase värviga, et saada roheline;
- Seejärel vahetavad nad saadud värvid, oranži ja rohelise. See vahetus võib toimuda ebaturvalises, jälgitavas võrgus;
- Segades Bobi rohelist värvi oma salajase värviga, toodab Alice pruuni;
- Bob, kes teeb sama Alice'i oranži ja tema salajase sinise värviga, saab ka pruuni.

![BTC204](assets/it/66/12.webp)

Selles lihtsustuses tähistab pruun värv Alice'i ja Bobi vahel jagatud saladust. Oluline on mõista, et tegelikkuses on ründajal võimatu eraldada oranži ja rohelist värvi, et avastada Alice'i või Bobi salajasi värve.

Uurime nüüd, kuidas see protokoll tegelikult toimib, mitte värvianaloogiate, vaid reaalarvude ja moodularvutuse abil!

Enne Diffie-Hellmani mehhanismide arutamist tuletan teile lühidalt meelde kahte olulist matemaatilist mõistet, mida me vajame:


- **Primusarv** on naturaalarv, millel on ainult kaks jagajat: $1$ ja tema ise. Näiteks $7$ on algarv, sest seda saab jagada ainult $1$ ja $7$. Seevastu $8$ ei ole algarv, sest ta on jagatav $1$, $2$, $4$ ja $8$ga. Seega on tal kahe positiivse täisarvu asemel neli positiivset jagajat;
- **mod** (tähistatakse $mod$ või $\%$) on matemaatiline operatsioon, mis kahe täisarvu vahel annab tagasi esimese jagatise jäägi viimase eukleidilise jagamise jäägi. Näiteks $16 \bmod 5 = 1$.

**Diffie-Hellmani võtmevahetus Alice'i ja Bobi vahel toimub järgmiselt:**


- Alice ja Bob lepivad kokku kahes ühises arvus: $p$ ja $g$. $p$ on algarv ja mida suurem on see arv, seda turvalisem on Diffie-Hellmani süsteem. $g$ on $p$ algjuur. Neid kahte arvu saab avalikult edastada turvamata võrgu kaudu. Nad esindavad ülaltoodud lihtsustuses **kollase värvi** ekvivalenti. Seetõttu on oluline, et Alice ja Bob kasutaksid täpselt samu väärtusi $p$ ja $g$ jaoks.

Kui need parameetrid on määratletud, valivad Alice ja Bob kumbki juhusliku salajase numbri. Alice nimetab oma juhusliku salajase arvu $a$ (vastab **punasele värvile**) ja Bob nimetab oma $b$ (vastab **sinisele värvile**). Need numbrid peavad jääma rangelt konfidentsiaalseks.

Selle asemel, et vahetada numbreid $a$ ja $b$ otse, arvutab kumbki pool $A$ ja $B$ järgmiselt:

$A$ on võrdne $g$, mis on tõstetud $a$ potentsile $p$:

$$
A = g^a \bmod p
$$

$B$ on võrdne $g$, mis on tõstetud $b$ võimsusega $p$:

$$
B = g^b \bmod p
$$

Kahe osapoole vahel vahetatakse väärtusi $A$ (vastab **oranžile värvile**) ja $B$ (vastab **rohelisele värvile**). See vahetus võib toimuda avalikult turvamata võrgu kaudu;

Alice, kes on saanud $B$, arvutab $z$ väärtuse järgmiselt:

$z$ on võrdne $B$, mis on tõstetud $a$ potentsile $p$:

$$
z = B^a \bmod p
$$

Meenuta:

$$
B = g^b \bmod p
$$

Seega saame:

$$
z = B^a \bmod p
$$

$$
z = (g^b)^a \bmod p
$$

Eksponentide reeglite rakendamine:

$$
(x^n)^m = x^{nm}
$$

Seega saame:

$$
z = g^{ba} \bmod p
$$


- Bob, kes on saanud $A$, arvutab ka $z$ väärtuse järgmiselt:

$z$ on võrdne $A$, mis on tõstetud $b$ potentsile $p$:

$$
z = A^b \bmod p
$$

Seega saame:

$$
z = (g^a)^b \bmod p
$$

$$
z = g^{ab} \bmod p
$$

$$
z = g^{ba} \bmod p
$$

Modulo-operaatori distributivsuse tõttu saavad Alice ja Bob täpselt sama $z$ väärtuse. See arv esindab nende ühist saladust, mis on samaväärne **pruuni värviga** eelmises lihtsustuses värvipottidega. Nüüd saavad nad kasutada seda ühist saladust oma side sümmeetriliseks krüpteerimiseks turvamata võrgus.

Ründaja, isegi kui ta teab $p$, $g$, $A$ ja $B$ (avalikud väärtused), ei saa arvutada $a$, $b$ või $z$ (privaatsed väärtused). Selleks oleks vaja pöörata eksponentsiaal, mis on võimatu ülesanne, ilma et prooviks kõiki võimalusi ükshaaval läbi, sest see on samaväärne diskreetse logaritmi, st eksponentsiaalarvu pöördväärtuse arvutamisega piiratud tsüklilises rühmas.

Seega, kui $a$, $b$ ja $p$ väärtused on piisavalt suured, on Diffie-Hellmani protokoll turvaline. Tavaliselt oleks 2048-bitiste parameetrite puhul (600-kohaline arv kümnendmurdes) kõigi võimaluste $a$ ja $b$ testimine ebapraktiline. Praeguseks peetakse seda algoritmi selliste arvude puhul turvaliseks.

Just selles seisnebki Diffie-Hellmani protokolli peamine puudus. Et olla turvaline, peab algoritm kasutama suuri numbreid. Seepärast eelistatakse tänapäeval ECDH (_Elliptic Curve Diffie-Hellman_) algoritmi, mis on Diffie-Hellmani variant, mis põhineb algebralisel kõveral, täpsemalt elliptilisel kõveral. See lähenemisviis võimaldab töötada palju väiksemate arvudega, säilitades samas samaväärse turvalisuse, vähendades seega arvutamiseks ja salvestamiseks vajalikke ressursse.

Algoritmi üldine põhimõte jääb samaks. Kuid selle asemel, et kasutada juhuslikku arvu $a$ ja arvu $A$, mis on arvutatud $a$ põhjal modulaarse ekponentseerimise teel, kasutame me elliptilisel kõveral loodud võtmepaari. Selle asemel, et tugineda modulo-operaatori jaotatavusele, kasutame me elliptiliste kõverate grupiseadust, täpsemalt selle seaduse assotsiatiivsust.

Lühidalt selgitades elliptilise kõveruse krüptograafia põhimõtet, kujutab privaatne võti endast juhuslikku arvu vahemikus $1$ kuni $n-1$, kus $n$ tähistab kõveruse järjestust. Avalik võti seevastu on konkreetne punkt sellel kõveral, mis saadakse privaatvõttest punktide liitmise ja kahekordistamise operatsioonide abil, mis algavad genereerimispunktist, vastavalt võrrandile:

$$
K = k \cdot G
$$

Selles valemis tähistab $K$ avalikku võtit, $k$ privaatvõtit ja $G$ genereerimispunkti.

Nende võtmete üks olulisi omadusi on see, et $K$ on lihtne arvutada $k$-st ja $G$-st, samas kui $k$ leidmine $K$-st ja $G$-st on praktiliselt võimatu. See asümmeetria tekitab ühesuunalise funktsiooni. Teisisõnu, avaliku võtme arvutamine on lihtne, kui on teada salajane võti, kuid salajase võtme leidmine avaliku võtme põhjal on võimatu. See turvalisus tugineb endiselt diskreetse logaritmi arvutuslikule keerukusele.

Kasutame seda omadust meie Diffie-Hellmani algoritmi kohandamiseks. **ECDH tööpõhimõte on järgmine:**


- Alice ja Bob lepivad koos kokku krüptograafiliselt turvalises elliptilises kõveras ja selle parameetrites. See teave on avalik;
- Alice genereerib juhusliku arvu $ka$, mis on tema privaatne võti. See privaatne võti peab jääma salajaseks. Ta määrab oma avaliku võtme $Ka$ valitud elliptilise kõvera punktide liitmise ja kahekordistamise teel:

$$
K_a = k_a \cdot G
$$


- Bob genereerib ka juhusliku arvu $kb$, mis on tema privaatne võti. Ta arvutab sellega seotud avaliku võtme $kb$:

$$
K_b = k_b \cdot G
$$


- Alice ja Bob vahetavad oma avalikke võtmeid $Ka$ ja $Kb$ turvamata avalikus võrgus.
- Alice arvutab punkti $(x,y)$ kõveral, rakendades oma isiklikku võtit $ka$ Bobi avalikule võtmele $Kb$:

$$
(x,y) = k_a \cdot K_b
$$


- Bob arvutab punkti $(x,y)$ kõveral, rakendades oma isiklikku võtit $kb$ Alice'i avalikule võtmele $Ka$:

$$
(x,y) = k_b \cdot K_a
$$


- Alice ja Bob saavad sama punkti elliptilisel kõveral. Jagatud saladus on selle punkti $x$ koordinaat.

Tegelikult saavad nad sama ühise saladuse, sest:

(x,y) = k_a \cdot K_b = k_a \cdot (k_b \cdot G) = (k_a \cdot k_b) \cdot G = (k_b \cdot k_a) \cdot G = k_b \cdot (k_a \cdot G) = k_b \cdot K_a

$$
Un attaccante che osserva la rete pubblica non protetta può ottenere solo le chiavi pubbliche di ciascuna parte e i parametri della curva ellittica scelta. Come precedentemente spiegato, queste informazioni da sole non sono sufficienti per determinare le chiavi private. Pertanto, l'attaccante non può trovare il segreto condiviso tra Alice e Bob.
ECDH è quindi un algoritmo che consente lo scambio di chiavi. È spesso utilizzato in combinazione con altri metodi crittografici per stabilire un protocollo completo. Ad esempio, ECDH è integrato nel nucleo di TLS (_Transport Layer Security_), un protocollo di crittografia e autenticazione utilizzato per il livello di trasporto di Internet. TLS utilizza ECDHE per lo scambio di chiavi, una variante di ECDH dove le chiavi sono effimere, per garantire la confidenzialità persistente. Inoltre, TLS utilizza algoritmi di autenticazione come ECDSA, algoritmi di crittografia come AES e funzioni hash come SHA256.
TLS è notevolmente responsabile della `s` in `https` così come del lucchetto visibile nella barra degli indirizzi del tuo browser, simboli delle comunicazioni criptate. Seguendo questo corso, stai quindi utilizzando ECDH, ed è molto probabile che lo usi quotidianamente senza nemmeno saperlo.
### La Transazione di Notifica
Come abbiamo visto nella sezione precedente, ECDH è una variante dello scambio Diffie-Hellman che utilizza coppie di chiavi stabilite su una curva ellittica. Convenientemente, possediamo già molte coppie di chiavi aderenti a questo standard nei nostri portafogli Bitcoin! L'idea di BIP47 è di utilizzare le coppie di chiavi dei portafogli Bitcoin gerarchici deterministici di entrambe le parti per stabilire segreti condivisi ed effimeri tra di loro. Nel contesto di BIP47, viene utilizzato ECDHE (_Elliptic Curve Diffie-Hellman Ephemeral_).
ECDHE viene utilizzato per la prima volta in BIP47 per trasmettere il codice di pagamento dal mittente al destinatario. Questo è il famoso **notification transaction**. Questo passaggio è essenziale perché affinché BIP47 funzioni efficacemente, entrambe le parti coinvolte (il mittente e il destinatario) devono conoscere il codice di pagamento dell'altro. Questa conoscenza consente la derivazione di chiavi pubbliche effimere e, di conseguenza, indirizzi di ricezione vuoti associati.
Prima di questo scambio, il mittente è logicamente già a conoscenza del codice di pagamento del destinatario poiché lo ha recuperato off-chain, ad esempio, dal loro sito web, una fattura o i loro social media. Tuttavia, il destinatario potrebbe non conoscere necessariamente il codice di pagamento del mittente. Eppure, questo codice deve essere trasmesso a loro; altrimenti, non saranno in grado di derivare le chiavi effimere necessarie per identificare gli indirizzi dove sono conservati i loro bitcoin, né accedere ai loro fondi. Sebbene questa trasmissione del codice del mittente possa tecnicamente essere effettuata off-chain attraverso altri mezzi di comunicazione, ciò pone un problema se il portafoglio deve essere recuperato solo dal seme.
Infatti, a differenza degli indirizzi convenzionali, gli indirizzi BIP47 non sono derivati direttamente dal seed del destinatario—utilizzare un `xpub` sarebbe più semplice in questo caso—ma risultano da un calcolo che combina i codici di pagamento di entrambi: quello del mittente e quello del destinatario. Pertanto, se il destinatario perde il proprio portafoglio e tenta di ripristinarlo dal proprio seed, recupererà il proprio codice di pagamento, che è derivato direttamente dal loro seed. Tuttavia, per trovare gli indirizzi effimeri, sarà essenziale per loro avere anche i codici di pagamento di tutti coloro che hanno inviato loro bitcoin tramite BIP47. Da qui l'importanza della transazione di notifica, che consente di salvare queste informazioni sulla blockchain di Bitcoin, pur essendo in grado di trovarle molto facilmente senza dover cercare tra il miliardo di transazioni eseguite dal suo lancio nel 2009.
![BTC204](assets/it/66/15.webp)
Pertanto, sarebbe possibile implementare BIP47 senza ricorrere alla transazione di notifica, a condizione che ogni utente conservi un backup dei codici di pagamento dei propri pari. Tuttavia, questo metodo si rivela complesso da gestire finché non viene sviluppata una soluzione semplice, robusta ed efficiente per creare, conservare e aggiornare questi backup. Nello stato attuale delle cose, la transazione di notifica diventa quasi indispensabile.
Nei capitoli seguenti, studieremo altri protocolli con obiettivi simili a quelli di BIP47, ma che non richiedono una transazione di notifica. Queste alternative, tuttavia, introducono i propri compromessi.
Oltre al suo ruolo nel backup dei codici di pagamento, la transazione di notifica serve anche una funzione di notifica per il destinatario, come suggerisce il suo nome. Segnala al client del destinatario che è stato stabilito un nuovo canale di pagamento e suggerisce quindi di monitorare gli indirizzi effimeri risultanti.
### Il Modello di Privacy di BIP47
Prima di dettagliare il funzionamento tecnico della transazione di notifica, è importante discutere il modello di privacy associato a BIP47, che giustifica alcune misure prese durante la creazione di questa transazione iniziale.
Il codice di pagamento, di per sé, non rappresenta un rischio diretto per la privacy. A differenza del modello Bitcoin tradizionale, che mira a rompere il collegamento tra l'identità di un utente e le sue transazioni (che sono pubbliche) preservando l'anonimato di chiavi e indirizzi, il codice di pagamento può essere apertamente associato a un'identità senza rappresentare una minaccia.
Infatti, il codice di pagamento non è utilizzato per derivare direttamente gli indirizzi che ricevono pagamenti BIP47. Questi indirizzi sono invece generati attraverso l'applicazione di ECDH tra le chiavi derivate dai codici di pagamento delle due parti coinvolte.
Così, un codice di pagamento di per sé non porta direttamente a una perdita di privacy, poiché solo l'indirizzo di notifica è derivato da esso. Sebbene questo indirizzo possa rivelare alcune informazioni, normalmente non consente di scoprire le parti con cui si stanno conducendo transazioni, a meno che non si effettui un'analisi approfondita della catena. Infatti, se il mittente utilizza UTXO che possono essere collegati alla loro identità per eseguire la transazione di notifica, allora diventa possibile dedurre che la loro identità è probabilmente collegata ai pagamenti BIP47 al tuo codice di pagamento. Questo non rivelerà le transazioni sottostanti, ma indicherà la loro probabile esistenza.
Pertanto, è essenziale mantenere questa stretta separazione tra i codici di pagamento degli utenti. Verso questo obiettivo, il passo iniziale di comunicazione del codice è un momento critico per la privacy del pagamento, ma obbligatorio per il corretto funzionamento del protocollo. Se uno dei codici di pagamento può essere ottenuto pubblicamente (come su un sito web), il secondo codice, quello del mittente, non deve essere collegato al primo in nessun caso.
Prendiamo un esempio concreto: voglio fare una donazione a un movimento politico tramite BIP47:
- L'organizzazione ha reso pubblico il suo codice di pagamento sul suo sito web o tramite i suoi social network;
- Questo codice è quindi collegato al movimento politico;
- Recupero questo codice di pagamento;
- Prima di procedere con un invio, devo assicurarmi che conoscano il mio codice di pagamento, che è anche collegato alla mia identità poiché lo uso per ricevere transazioni sui miei social network.
Come trasmettere il mio codice senza rischi? L'uso di mezzi di comunicazione convenzionali potrebbe portare a una fuga di informazioni e, di conseguenza, associarmi a questo movimento politico. La transazione di notifica offre una soluzione grazie a uno strato di crittografia che impedisce precisamente questa associazione tra due codici. Sebbene questo non sia l'unico metodo per trasmettere segretamente il codice di pagamento del mittente, si dimostra molto efficace.
Nel diagramma sottostante, le linee arancioni indicano i punti in cui il flusso di informazioni deve essere interrotto, e le frecce nere mostrano le connessioni che potrebbero potenzialmente essere osservate da terze parti:
![BTC204](assets/it/66/16.webp)
In realtà, all'interno del modello tradizionale di privacy di Bitcoin, è spesso complesso dissociare completamente il flusso di informazioni tra la coppia di chiavi e l'utente, specialmente durante le transazioni a distanza. Ad esempio, nel contesto di una campagna di donazione, il destinatario deve inevitabilmente divulgare un indirizzo o una chiave pubblica tramite il loro sito web o social network. L'uso corretto di BIP47, in particolare con la transazione di notifica, permette di aggirare questo problema grazie a ECDHE e allo strato di crittografia che studieremo ulteriormente.
Ovviamente, il modello classico di privacy di Bitcoin si applica ancora alle chiavi pubbliche effimere, che sono derivate dalla combinazione dei due codici di pagamento. I due modelli sono in realtà complementari. Quello che voglio evidenziare qui è che, contrariamente all'uso abituale di una chiave pubblica per ricevere bitcoin, il codice di pagamento può essere collegato a una specifica identità, perché l'informazione "_Alice effettua una transazione con Bob_" viene interrotta in un'altra fase. Il codice di pagamento viene utilizzato per generare indirizzi di pagamento, ma basandosi unicamente sull'osservazione della blockchain, è impossibile collegare una transazione di pagamento BIP47 ai codici di pagamento utilizzati per eseguirla, a meno che gli UTXO coinvolti non fossero già collegati a un'identità precedentemente e gli utenti non abbiano associato i loro codici di pagamento alle rispettive identità.
Per riassumere, il modello di privacy offerto dai pagamenti BIP47 potrebbe essere considerato superiore a quello della base di Bitcoin, anche se non è magico in alcun modo.
### Costruzione della Transazione di Notifica
Ora, vediamo come funziona questa transazione di notifica. Immaginiamo che Alice voglia inviare fondi a Bob con BIP47. Nel mio esempio, Alice agisce come mittente e Bob come destinatario. Quest'ultimo ha pubblicato il suo codice di pagamento sul suo sito web. Pertanto, Alice è già a conoscenza del codice di pagamento di Bob.
**1- Alice calcola un segreto condiviso con ECDH:**
- Seleziona una coppia di chiavi dal suo portafoglio HD situato su un ramo diverso dal suo codice di pagamento. Nota, questa coppia non dovrebbe essere facilmente associata all'indirizzo di notifica di Alice, né all'identità di Alice (vedi sezione precedente);
- Alice seleziona la chiave privata da questa coppia. La chiamiamo $a$ (minuscolo);
$$

a

$$
```text
- Alice recupera la chiave pubblica associata all'indirizzo di notifica di Bob. Questa chiave è la prima figlia derivata dal codice di pagamento di Bob (indice $/0$). Chiamiamo questa chiave pubblica $B$ (maiuscolo). La chiave privata associata a questa chiave pubblica è chiamata $b$ (minuscolo). $B$ è determinata dall'addizione e dal raddoppio dei punti sulla curva ellittica da $G$ (il punto generatore) con $b$ (la chiave privata):
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ (maiuscolo) sulla curva ellittica tramite l'addizione e il raddoppio dei punti applicando la sua chiave privata $a$ dalla chiave pubblica di Bob $B$.
$$ S = a \cdot B $$
- Alice calcola il fattore di oscuramento $f$ che le permetterà di criptare il suo codice di pagamento. Per fare ciò, determinerà un numero pseudo-casuale con la funzione HMAC-SHA512. Nel secondo input di questa funzione, utilizza un valore che solo Bob potrà recuperare: $x$ che è l'ascissa del punto segreto precedentemente calcolato. Il primo input è $o$ che è l'UTXO consumato in input di questa transazione (outpoint).
$$ f = \text{HMAC-SHA512}(o, x) $$
**2- Alice converte il suo codice di pagamento personale in base 2 (binario).**
**3- Utilizza questo fattore di oscuramento come chiave per eseguire la crittografia simmetrica sul payload del suo codice di pagamento.** L'algoritmo di crittografia utilizzato è semplicemente un `XOR`. L'operazione eseguita è paragonabile alla cifratura di Vernam, anche denominata "One-Time Pad".
- Alice prima divide il suo fattore di oscuramento in due: i primi 32 byte sono denominati $f1$ e gli ultimi 32 byte sono denominati $f2$. Quindi, abbiamo:
$$ f = f1 || f2 $$
- Alice calcola l'$x'$ criptato dell'ascissa della chiave pubblica $x$ del suo codice di pagamento, e il $c'$ criptato del suo codice catena $c$ separatamente. $f1$ e $f2$ agiscono rispettivamente come chiavi di crittografia. L'operazione utilizzata è il `XOR` (o esclusivo).
$$ x' = x \oplus f1 $$
$$ c' = c \oplus f2 $$
- Alice sostituisce i valori reali dell'ascissa della chiave pubblica $x$ e del codice catena $c$ nel suo codice di pagamento con i valori criptati $x'$ e $c'$.
**4-** Alice ora ha il suo codice di pagamento con un payload criptato. Costruirà e trasmetterà una transazione che coinvolge la sua chiave pubblica $A$ come input, un output all'indirizzo di notifica di Bob, e un output `OP_RETURN` contenente il suo codice di pagamento con il payload criptato. **Questa transazione è la transazione di notifica**.
Un `OP_RETURN` è un opcode che segna un output di una transazione Bitcoin come non valido. Oggi, è utilizzato per trasmettere o ancorare informazioni sulla blockchain di Bitcoin. Fino a 80 byte di dati possono essere memorizzati, che sono scritti sulla catena e quindi visibili a tutti gli altri utenti.
Come abbiamo visto nelle sezioni precedenti, ECDH è utilizzato per generare un segreto condiviso tra due utenti che comunicano su una rete non sicura, potenzialmente osservata da attaccanti. In BIP47, ECDH è utilizzato per la comunicazione sulla rete Bitcoin, che per sua natura è una rete di comunicazione trasparente osservata da molti attaccanti. Il segreto condiviso calcolato tramite lo scambio di chiavi ECDH è poi utilizzato per criptare le informazioni segrete da trasmettere: il codice di pagamento del mittente (di Alice).
Ricapitoliamo i passaggi che abbiamo appena esaminato insieme per eseguire una transazione di notifica:
- Alice recupera il codice di pagamento e l'indirizzo di notifica di Bob;
- Alice seleziona un UTXO che possiede nel suo portafoglio HD con la corrispondente coppia di chiavi;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH;
- Utilizza questo punto segreto per calcolare un HMAC, che è il fattore di oscuramento;
- Utilizza questo fattore di oscuramento per criptare il payload del suo codice di pagamento personale.
- Lei utilizza un output di transazione `OP_RETURN` per comunicare il codice di pagamento mascherato a Bob.
![BTC204](assets/it/66/17.webp)
### Transazione di Notifica: Studio Concreto
Per comprendere meglio il suo funzionamento, in particolare l'uso di `OP_RETURN`, esaminiamo insieme una vera transazione di notifica. Ho eseguito tale transazione sulla testnet, che potete trovare [cliccando qui](https://mempool.space/fr/testnet/tx/0e2e4695a3c49272ef631426a9fd2dae6ec3a469e3a39a3db51aa476cd09de2e).
![BTC204](assets/fr/227.webp)
Osservando questa transazione, possiamo vedere che ha un singolo input e 4 output:
- Il primo output è l'`OP_RETURN` che contiene il mio codice di pagamento mascherato;
- Il secondo output di 546 sats punta all'indirizzo di notifica del mio destinatario;
- Il terzo output di 15.000 sats rappresenta le commissioni di servizio, poiché ho utilizzato Samourai Wallet per costruire questa transazione;
- Il quarto output di 2 milioni di sats rappresenta il resto, ovvero la differenza rimanente dal mio input che ritorna a un altro indirizzo che mi appartiene.
Il più interessante da studiare è ovviamente l'output 0 che utilizza l'`OP_RETURN`. Vediamo più da vicino cosa contiene. Ecco lo `scriptPubKey` in esadecimale:
6a4c50010002b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d800000000000000000000000000
```

```text
In questo script, possiamo sezionare diverse parti. Prima di tutto, gli opcode:
6a4c
```

```text
Tra gli opcode, possiamo riconoscere `0x6a` che designa l'`OP_RETURN` e `0x4c` che designa l'`OP_PUSHDATA1`.
Il byte seguente questo ultimo opcode indica la dimensione del payload che segue. Indica `0x50`, ovvero 80 byte:
6a4c50
```

```text
Poi, abbiamo i metadati del mio codice di pagamento in chiaro:
010002
```

```text
La coordinata x criptata della chiave pubblica del mio codice di pagamento:
b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164
```

```text
Il codice catena criptato del mio codice di pagamento:
927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d8
```

```text
E infine, il padding per raggiungere 80 byte, la dimensione standard di un `OP_RETURN`:
00000000000000000000000000
```

```
Per capire meglio, ecco il mio codice di pagamento in chiaro in base 58:
````text
PM8TJQCyt6ovbozreUCBrfKqmSVmTzJ5vjqse58LnBzKFFZTwny3KfCDdwTqAEYVasn11tTMPc2FJsFygFd3YzsHvwNXLEQNADgxeGnMK8Ugmin62TZU
Quando si confronta il mio codice di pagamento in chiaro con l'`OP_RETURN`, è evidente che l'HRP (`0x47`) e il checksum (`0x8604e4db`) non vengono trasmessi. Questo è previsto, poiché queste informazioni sono destinate agli esseri umani.
Successivamente, possiamo identificare la versione (`0x01`), il campo di bit (`0x00`) e la parità della chiave pubblica (`0x02`). E, alla fine del codice di pagamento, i byte vuoti (`0x00000000000000000000000000`) sono utilizzati per riempire il codice fino a un totale di 80 byte. Tutti questi metadati vengono trasmessi in chiaro (non criptati).
Infine, si può osservare che la coordinata x della chiave pubblica (`0x77507c9c17a89cfca2d3af554745d6c2db0e7f6b2721a3941a504933103cc42a`) e il codice catena (`0xdd94881210d6e752a9abc8a9fa0070e85184993c4f643f1121dd807dd556d1dc`) sono stati criptati. Questo costituisce il payload del codice di pagamento.
### Cos'è XOR?
Nelle sezioni precedenti, abbiamo visto che il codice di pagamento è stato trasmesso criptato utilizzando l'operazione XOR. Prendiamoci un momento per capire come funziona questo operatore, poiché è ampiamente utilizzato nella crittografia.
XOR è un operatore logico bit a bit basato sull'algebra booleana. Con due operandi bit, restituisce `1` se i bit dello stesso rango sono diversi, e restituisce `0` se i bit dello stesso rango sono uguali. Ecco la tabella di verità di XOR basata sui valori degli operandi `D` e `E`:
| D   | E   | D XOR E |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |
Per esempio:
$$

$$
0110 \oplus 1110 = 1000
Oppure:
$$

$$
010011 \oplus 110110 = 100101
Con ECDH, l'uso di XOR come strato di crittografia è particolarmente adatto. Innanzitutto, a causa di questo operatore, la crittografia è simmetrica. Questo consente al destinatario di decifrare il codice di pagamento con la stessa chiave utilizzata per la crittografia. La chiave di crittografia e decrittografia viene calcolata dal segreto condiviso grazie a ECDH. Questa simmetria è resa possibile dalle proprietà commutativa e associativa dell'operatore XOR:
- Altre proprietà:
$$

$$
D \oplus D = 0
D ⊕ 0 = D
- Commutatività:
$$

$$
D \oplus E = E \oplus D
- Associatività:
$$

$$
D \oplus (E \oplus Z) = (D \oplus E) \oplus Z = D \oplus E \oplus Z
Se:
$$

$$
D \oplus E = L
Allora:
$$

$$
D \oplus L = D \oplus (D \oplus E) = D \oplus D \oplus E = 0 \oplus E = E \\
\therefore D \oplus L = E
Successivamente, questo metodo di cifratura assomiglia molto al cifrario di Vernam (One-Time Pad), l'unico algoritmo di cifratura conosciuto fino ad oggi che possiede sicurezza incondizionata (o assoluta). Affinché il cifrario di Vernam abbia questa caratteristica, la chiave di cifratura deve essere perfettamente casuale, deve essere della stessa dimensione del messaggio e deve essere utilizzata una sola volta. Nel metodo di cifratura utilizzato qui per BIP47, la chiave è effettivamente della stessa dimensione del messaggio, il fattore di offuscamento è esattamente della stessa dimensione della concatenazione della coordinata x della chiave pubblica con il codice catena del codice di pagamento. Questa chiave di cifratura è effettivamente utilizzata una sola volta. Tuttavia, questa chiave non è il risultato di una casualità perfetta poiché è un HMAC. È piuttosto pseudo-casuale. Pertanto, non si tratta di un cifrario di Vernam, ma il metodo è simile.
### Ricezione della Transazione di Notifica
Ora che Alice ha inviato la transazione di notifica a Bob, vediamo come lui la interpreta. Come promemoria, Bob deve essere in grado di accedere al codice di pagamento di Alice. Senza queste informazioni, come vedremo nella sezione seguente, non sarà in grado di derivare le coppie di chiavi create da Alice e, quindi, non sarà in grado di accedere ai suoi bitcoin ricevuti tramite BIP47. Per ora, il payload del codice di pagamento di Alice è criptato. Vediamo come Bob lo decifra.
**1-** Bob monitora le transazioni che creano output con il suo indirizzo di notifica.
**2-** Quando una transazione ha un output sul suo indirizzo di notifica, Bob la analizza per vedere se contiene un output OP_RETURN che segue lo standard BIP47.
**3-** Se il primo byte del payload OP_RETURN è `0x01`, Bob inizia la sua ricerca di un possibile segreto condiviso con ECDH:
- Bob seleziona la chiave pubblica nell'input della transazione. Ovvero, la chiave pubblica di Alice denominata $A$ con:
$$ A = a \cdot G $$
- Bob seleziona la chiave privata $b$ associata al suo indirizzo di notifica personale:
$$ b $$
- Bob calcola il punto segreto $S$ (segreto condiviso ECDH) sulla curva ellittica sommando e raddoppiando i punti, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$:
$$ S = b \cdot A $$
- Bob determina il fattore di offuscamento $f$ che gli permetterà di decifrare il payload del codice di pagamento di Alice. Nello stesso modo in cui Alice aveva precedentemente calcolato, Bob troverà $f$ applicando HMAC-SHA512 su $x$ la coordinata x del punto segreto $S$, e su $o$ l'UTXO consumato come input in questa transazione di notifica:
$$ f = \text{HMAC-SHA512}(o, x) $$
**4-** Bob interpreta i dati nell'OP_RETURN della transazione di notifica come un codice di pagamento. Egli semplicemente decifra il payload di questo potenziale codice di pagamento usando il fattore di offuscamento $f$:
- Bob divide il fattore di offuscamento $f$ in 2 parti: i primi 32 byte di $f$ saranno $f1$ e gli ultimi 32 byte saranno $f2$;
- Bob decifra la coordinata x cifrata $x'$ della chiave pubblica dal codice di pagamento di Alice:
$$ x = x' \oplus f1 $$
- Bob decifra il valore del codice catena cifrato $c'$ dal codice di pagamento di Alice:
$$ c = c' \oplus f2 $$
**5-** Bob verifica se il valore della chiave pubblica dal codice di pagamento di Alice è effettivamente parte del gruppo secp256k1. Se è così, lo interpreta come un codice di pagamento valido. Altrimenti, ignora questa transazione.
Ora che Bob è a conoscenza del codice di pagamento di Alice, lei può inviargli fino a `2^32` pagamenti, senza mai dover effettuare un'altra transazione di notifica di questo tipo.
Perché funziona? Come fa Bob a determinare lo stesso fattore di offuscamento di Alice, e quindi a decifrare il suo codice di pagamento? Esaminiamo più da vicino il ruolo di ECDH in quello che abbiamo appena descritto.
Prima di tutto, stiamo trattando con la crittografia simmetrica. Questo significa che la chiave di cifratura e la chiave di decifratura sono lo stesso valore. Questa chiave nella transazione di notifica è il fattore di offuscamento:
$$ f = f1 || f2 $$
Pertanto, Alice e Bob devono ottenere lo stesso valore per $f$, senza trasmetterlo direttamente poiché un attaccante potrebbe rubarlo e decifrare le informazioni segrete. Questo fattore di offuscamento si ottiene applicando HMAC-SHA512 su 2 valori:
- la coordinata x di un punto segreto;
- e l'UTXO consumato come input nella transazione.
Bob, quindi, ha bisogno di queste due informazioni per decifrare il payload del codice di pagamento di Alice. Per l'UTXO come input, Bob può semplicemente recuperarlo osservando la transazione di notifica. Per il punto segreto, Bob dovrà usare ECDH. Come visto nella sezione precedente su Diffie-Hellman, semplicemente scambiando le rispettive chiavi pubbliche e applicando segretamente le proprie chiavi private alla chiave pubblica dell'altro, Alice e Bob possono trovare un punto specifico e segreto sulla curva ellittica. La transazione di notifica si basa su questo meccanismo:
- Coppia di chiavi di Bob:
$$ B = b \cdot G $$
- Coppia di chiavi di Alice:
$$ A = a \cdot G $$
- Per un segreto $S (x, y)$:
$$ S = a \cdot B = a \cdot (b \cdot G) = (b \cdot a) \cdot G = b \cdot A $$
Ora che Bob conosce il codice di pagamento di Alice, sarà in grado di rilevare i suoi pagamenti BIP47, e può derivare le chiavi private che bloccano i bitcoin ricevuti.
Ricapitoliamo i passaggi che abbiamo appena esaminato per ricevere e interpretare una transazione di notifica:
- Bob monitora gli output delle transazioni al suo indirizzo di notifica;
- Quando ne rileva uno, recupera le informazioni contenute nell'OP_RETURN;
- Bob seleziona la chiave pubblica in input e calcola un punto segreto usando ECDH;
- Usa questo punto segreto per calcolare un HMAC che è il fattore di offuscamento;
- Usa questo fattore di offuscamento per decifrare il payload del codice di pagamento di Alice contenuto nell'OP_RETURN.
### La Transazione di Pagamento BIP47
Studiamo ora insieme il processo di pagamento con BIP47. Per ricordarvi lo stato attuale delle cose:
- Alice conosce il codice di pagamento di Bob, che ha semplicemente recuperato dal suo sito web;
- Bob conosce il codice di pagamento di Alice grazie alla transazione di notifica;
- Alice effettuerà un primo pagamento a Bob. Potrà effettuarne molti altri allo stesso modo.
Prima di spiegare questo processo, penso sia importante ricordare gli indici su cui stiamo attualmente lavorando. Il percorso di derivazione di un codice di pagamento è descritto come segue: `m/47'/0'/0'`. La profondità successiva distribuisce gli indici in questo modo:
- La prima coppia di chiavi figlio normali (non rinforzate) è quella utilizzata per generare l'indirizzo di notifica di cui abbiamo parlato nella parte precedente: `m/47'/0'/0'/0`;
- Le coppie di chiavi figlio normali sono utilizzate all'interno di ECDH per generare indirizzi di ricezione dei pagamenti BIP47 come vedremo in questa sezione: da `m/47'/0'/0'/0` a `m/47'/0'/0'/2 147 483 647`;
- Le coppie di chiavi figlio rinforzate sono codici di pagamento effimeri: da `m/47'/0'/0'/0'` a `m/47'/0'/0'/2 147 483 647'`.
Ogni volta che Alice desidera inviare un pagamento a Bob, deriva un nuovo indirizzo vergine unico, grazie ancora al protocollo ECDH:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale riutilizzabile:
$$ a $$
- Alice seleziona la prima chiave pubblica inutilizzata derivata dal codice di pagamento di Bob. Questa chiave pubblica, la chiameremo $B$. È associata alla chiave privata $b$ che solo Bob conosce:
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ sulla curva ellittica tramite addizione e raddoppio di punti applicando la sua chiave privata $a$ alla chiave pubblica $B$ di Bob:
$$ S = a \cdot B $$
- Da questo punto segreto, Alice calcolerà il segreto condiviso $s$ (minuscolo). Per fare ciò, seleziona la coordinata x del punto segreto $S$ denominata $Sx$, e passa questo valore attraverso la funzione hash SHA256:
$$ S = (Sx, Sy) $$
$$ s = \text{SHA256}(Sx) $$
- Alice utilizza questo segreto condiviso $s$ per calcolare un indirizzo Bitcoin di ricezione dei pagamenti. Inizialmente, verifica che $s$ sia contenuto nell'ordine della curva secp256k1. In caso contrario, incrementa l'indice della chiave pubblica di Bob per derivare un altro segreto condiviso;
- In secondo luogo, calcola una chiave pubblica $K0$ aggiungendo sulla curva ellittica i punti $B$ e $s·G$. In altre parole, Alice aggiunge la chiave pubblica derivata dal codice di pagamento di Bob $B$ con un altro punto calcolato sulla curva ellittica tramite addizione e raddoppio con il segreto condiviso $s$ dal punto generatore della curva secp256k1 $G$. Questo nuovo punto rappresenta una chiave pubblica, e lo chiamiamo $K0$:
$$ K0 = B + s \cdot G $$
- Con questa chiave pubblica $K0$, Alice può derivare un indirizzo vergine standard di ricezione (per esempio, SegWit V0 in bech32).
Una volta che Alice ha ottenuto l'indirizzo di ricezione di Bob $K0$, può eseguire una transazione Bitcoin in modo standard. Per fare ciò, seleziona un UTXO di sua proprietà, assicurato da una coppia di chiavi di un ramo diverso del suo portafoglio HD, e lo spende per soddisfare un output all'indirizzo di Bob $K0$. È importante notare che questo pagamento, una volta derivato l'indirizzo, segue un processo convenzionale e non dipende più dalle chiavi associate a BIP47.
Ricapitoliamo i passaggi che abbiamo appena eseguito insieme per inviare un pagamento BIP47:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH dalla prima chiave pubblica derivata non utilizzata dal codice di pagamento di Bob;
- Utilizza questo punto segreto per calcolare un segreto condiviso con SHA256;
- Utilizza questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla chiave pubblica di Bob;
- Ottiene una nuova chiave pubblica effimera per la quale solo Bob ha la chiave privata associata;
- Alice può effettuare una transazione standard a Bob con l'indirizzo di ricezione effimero derivato.
![BTC204](assets/it/66/21.webp)
Se Alice desidera effettuare un secondo pagamento, seguirà gli stessi passaggi di prima, eccetto che questa volta selezionerà la seconda chiave pubblica derivata dal codice di pagamento di Bob. Specificamente, utilizzerà la prossima chiave non utilizzata. Otterrà così un nuovo indirizzo di ricezione appartenente a Bob, designato $K1$:
![BTC204](assets/it/66/22.webp)
Può continuare in questo modo e derivare fino a `2^32` indirizzi non utilizzati appartenenti a Bob.
Da un punto di vista esterno, osservando la blockchain, è teoricamente impossibile differenziare un pagamento BIP47 da un pagamento standard. Ecco un esempio di transazione di pagamento BIP47 sul Testnet:
```

94b2e59510f2e1fa78411634c98a77bbb638e28fb2da00c9f359cd5fc8f87254
````
Questo sembra una transazione standard con un input consumato, un output di pagamento e un resto:
![BTC204](assets/fr/232.webp)
### Ricevere il Pagamento BIP47 e Derivare la Chiave Privata
Alice ha appena effettuato il suo primo pagamento a un nuovo indirizzo BIP47 appartenente a Bob. Ora vediamo come Bob riceve questo pagamento. Vedremo anche perché Alice non ha accesso alla chiave privata dell'indirizzo che ha appena generato da sola, e come Bob recupera questa chiave per spendere i bitcoin che ha appena ricevuto.
Non appena Bob riceve la transazione di notifica da Alice, deriva la chiave pubblica BIP47 $K0$ anche prima che lei abbia inviato qualsiasi pagamento. Poi monitora qualsiasi pagamento all'indirizzo associato. Infatti, deriva immediatamente diversi indirizzi che monitorerà ($K0$, $K1$, $K2$, $K3$...). Ecco come deriva questa chiave pubblica $K0$:
- Bob seleziona la prima chiave privata derivata dal suo codice di pagamento. Questa chiave privata è denominata $b$. È associata alla chiave pubblica $B$ con cui Alice aveva fatto i suoi calcoli nel passaggio precedente:
$$ b $$
- Bob seleziona la prima chiave pubblica di Alice derivata dal suo codice di pagamento. Questa chiave è denominata $A$. È associata alla chiave privata $a$ con cui Alice aveva fatto i suoi calcoli, e di cui solo Alice è a conoscenza. Bob può eseguire questo processo poiché è a conoscenza del codice di pagamento di Alice che le è stato trasmesso con la transazione di notifica:
$$ A = a \cdot G $$
- Bob calcola il punto segreto $S$, mediante addizione e raddoppio di punti sulla curva ellittica, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$. Qui troviamo l'uso di ECDH che garantisce che questo punto $S$ sarà lo stesso sia per Bob che per Alice:
$$ S = b \cdot A $$
- Proprio come ha fatto Alice, Bob isola la coordinata x di questo punto $S$. Abbiamo chiamato questo valore $Sx$. Egli passa questo valore attraverso la funzione SHA256 per trovare il segreto condiviso $s$ (minuscolo):
$$ s = \text{SHA256}(Sx) $$
- Proprio come Alice, Bob calcola il punto $s·G$ sulla curva ellittica. Poi, aggiunge questo punto segreto alla sua chiave pubblica $B$. Ottiene così un nuovo punto sulla curva ellittica che interpreta come una chiave pubblica $K0$:
$$ K0 = B + s \cdot G $$
Una volta che Bob ha questa chiave pubblica $K0$, può derivare la chiave privata associata per essere in grado di spendere i suoi bitcoin. È l'unico che può generare questa chiave privata:
- Bob aggiunge la sua chiave privata figlio $b$ derivata dal suo codice di pagamento personale. È l'unico che può ottenere il valore di $b$. Poi, aggiunge $b$ con il segreto condiviso $s$ per ottenere $k0$, la chiave privata di $K0$:
$$ k0 = b + s $$
Grazie alla legge di gruppo della curva ellittica, Bob ottiene esattamente la chiave privata corrispondente alla chiave pubblica usata da Alice. Abbiamo quindi:
$$ K0 = k0 \cdot G $$
Riassumerò i passaggi che abbiamo appena esaminato insieme per ricevere un pagamento BIP47 e calcolare la chiave privata corrispondente:
- Bob seleziona la prima chiave privata figlio derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica usando ECDH dalla prima chiave pubblica figlio derivata dal codice catena di Alice;
- Usa questo punto segreto per calcolare un segreto condiviso con SHA256;
- Usa questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla sua chiave pubblica personale;
- Ottiene una nuova chiave pubblica effimera, alla quale Alice invierà il suo primo pagamento;
- Bob calcola la chiave privata associata a questa chiave pubblica effimera aggiungendo la sua chiave privata figlio derivata dal suo codice di pagamento e il segreto condiviso.
![BTC204](assets/it/66/24.webp)
Poiché Alice non può ottenere $b$ (la chiave privata di Bob), lei non è in grado di determinare $k0$ (la chiave privata associata all'indirizzo di ricezione BIP47 di Bob). Schematicamente, possiamo rappresentare il calcolo del segreto condiviso $S$ così:
![BTC204](assets/it/66/19.webp)
Una volta trovato il segreto condiviso con ECDH, Alice e Bob calcolano la chiave pubblica di pagamento BIP47 $K0$, e Bob calcola anche la chiave privata associata $k0$:
![BTC204](assets/it/66/25.webp)
### Rimborsare il Pagamento BIP47
Poiché Bob è a conoscenza del codice di pagamento riutilizzabile di Alice, ha già tutte le informazioni necessarie per inviarle un rimborso. Non avrà bisogno di contattare nuovamente Alice per chiedere informazioni. Dovrà semplicemente notificarla con una transazione di notifica, specialmente affinché lei possa recuperare i suoi indirizzi BIP47 con il suo seed, e poi potrà anche inviarle fino a `2^32` pagamenti.
La funzionalità di rimborso è specifica per BIP47 ed è uno dei suoi vantaggi rispetto ad altri metodi che studieremo nei prossimi capitoli, come i Pagamenti Silenziosi.
Bob può quindi rimborsare Alice nello stesso modo in cui lei gli ha inviato i pagamenti. I ruoli si invertono:
![BTC204](assets/it/66/26.webp)
_Un grande ringraziamento a [Fanis Michalakis](https://x.com/FanisMichalakis) per la sua revisione e preziosi consigli esperti sull'articolo che ha ispirato la scrittura di questo capitolo!_
https://planb.network/tutorials/privacy/on-chain/paynym-bip47-a492a70b-50eb-4f95-a766-bae2c5535093
## Pagamenti Silenziosi
<chapterId>2871d594-414e-4598-a830-91c9eb84dfb8</chapterId>
Il BIP47 è stato criticato per la sua inefficienza sulla blockchain. Come spiegato nel capitolo precedente, richiede una transazione di notifica per ogni nuovo destinatario. Questo vincolo diventa trascurabile se si prevede di stabilire un canale di pagamento duraturo con questo destinatario. Infatti, una singola transazione di notifica apre la strada a un numero quasi infinito di pagamenti BIP47 successivi.
Tuttavia, in determinate situazioni, la transazione di notifica può rappresentare un ostacolo per l'utente. Prendiamo l'esempio di una donazione una tantum a un destinatario: con un indirizzo Bitcoin classico, una singola transazione è sufficiente per effettuare la donazione. Ma con il BIP47, sono necessarie due transazioni: una per la notifica e un'altra per il pagamento effettivo. Quando la domanda di spazio nel blocco è bassa e le commissioni di transazione sono minime, questo passaggio aggiuntivo generalmente non rappresenta un problema. Tuttavia, durante i periodi di congestione, le commissioni di transazione possono diventare esorbitanti per un singolo pagamento, potenzialmente raddoppiando il costo per l'utente rispetto a una transazione Bitcoin standard, il che può essere inaccettabile per l'utente.
Per situazioni in cui l'utente prevede di effettuare solo pochi pagamenti a un identificatore statico, sono state sviluppate altre soluzioni. Tra queste ci sono i Pagamenti Silenziosi, descritti nel [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki). Questo protocollo consente l'uso di un identificatore statico per ricevere pagamenti senza generare riutilizzo dell'indirizzo e senza richiedere l'uso di transazioni di notifica. Esaminiamo come funziona questo protocollo.
---
_Per comprendere appieno questo capitolo, è essenziale essere familiari con il funzionamento di ECDH (Elliptic Curve Diffie-Hellman) e la derivazione delle chiavi crittografiche in un portafoglio HD. Questi concetti sono stati dettagliati nel capitolo precedente sul BIP47. Non li ripeterò qui. Se non sei ancora familiare con queste nozioni, ti consiglio di consultare il capitolo precedente prima di continuare con questo. Non riprenderò nemmeno i rischi associati al riutilizzo degli indirizzi di ricezione, né l'importanza di avere un identificatore unico per ricevere pagamenti._
---
### Perché non spostare la notifica?
Come discusso nel capitolo sul BIP47, la transazione di notifica svolge principalmente due funzioni:
- Notifica il destinatario;
- Trasmette il codice di pagamento del mittente.
Si potrebbe ingenuamente pensare che questo processo di notifica potrebbe essere effettuato off-chain. In teoria, ciò è completamente fattibile: sarebbe sufficiente per il destinatario indicare un mezzo di comunicazione per ricevere i codici di pagamento BIP47 dai mittenti. Tuttavia, questo approccio presenta due problemi principali:
- Primo, ciò sposterebbe il processo di trasmissione del codice su un altro protocollo di comunicazione. Le questioni relative ai costi e alla privacy dello scambio rimarrebbero, ma sarebbero semplicemente trasferite a questo nuovo protocollo. In termini di privacy, ciò potrebbe anche creare un collegamento tra l'identità di un utente e l'attività sulla blockchain, cosa che cerchiamo di evitare eseguendo la notifica direttamente sulla blockchain. Inoltre, effettuare la notifica fuori dalla blockchain introdurrebbe rischi di censura (come il blocco dei fondi) che non esistono su Bitcoin;
Successivamente, ciò porrebbe un problema di recupero. Con BIP47, il destinatario deve assolutamente conoscere i codici di pagamento dei mittenti per accedere ai fondi. Questo è vero al momento della ricezione, ma anche in caso di recupero dei fondi tramite il seed in caso di perdita del portafoglio. Con le notifiche onchain, questo rischio viene evitato, poiché l'utente può trovare e decifrare le transazioni di notifica semplicemente conoscendo il proprio seed. Tuttavia, se la notifica viene eseguita fuori dalla blockchain, l'utente dovrebbe mantenere un backup dinamico di tutti i codici di pagamento ricevuti, il che è impraticabile per l'utente medio.
Tutti questi vincoli rendono l'uso della notifica onchain indispensabile nel contesto di BIP47. Eppure, i Pagamenti Silenziosi cercano specificamente di evitare questo passaggio di notifica onchain a causa del suo costo. Pertanto, la soluzione adottata non è spostare la notifica, ma eliminarla completamente. Per raggiungere questo obiettivo, deve essere accettato un compromesso: quello della scansione. A differenza di BIP47, dove l'utente sa esattamente dove trovare i propri fondi grazie alle transazioni di notifica, nel contesto dei Pagamenti Silenziosi, l'utente deve esaminare tutte le transazioni Bitcoin esistenti per rilevare eventuali pagamenti che potrebbero essere destinati a loro. Per ridurre questo onere operativo, la ricerca di Pagamenti Silenziosi è limitata solo alle transazioni che probabilmente contengono tali pagamenti, ovvero quelle che includono almeno un output Taproot P2TR. La scansione si concentra esclusivamente anche sulle transazioni dalla data di creazione del portafoglio (non c'è bisogno di scandire transazioni risalenti al 2009 se il portafoglio è stato creato nel 2024).
Pertanto, potete vedere perché BIP47 e Pagamenti Silenziosi, sebbene mirino a un obiettivo simile, comportano compromessi diversi e **quindi si rivolgono effettivamente a casi d'uso distinti**. Per i pagamenti una tantum, come le donazioni occasionali, i Pagamenti Silenziosi sono più appropriati a causa del loro costo inferiore. Al contrario, per le transazioni regolari allo stesso destinatario, come nel caso delle piattaforme di scambio o dei pool di mining, BIP47 potrebbe essere preferito.
Esploriamo insieme il funzionamento tecnico dei Pagamenti Silenziosi per capirne meglio le implicazioni. Per fare ciò, suggerisco di adottare lo stesso approccio del documento esplicativo di BIP352. Scomporremo gradualmente i calcoli da eseguire, elemento per elemento, giustificando ogni nuova aggiunta.
### Alcuni concetti da comprendere
Prima di iniziare, è importante chiarire che i Pagamenti Silenziosi si basano esclusivamente sull'uso di tipi di script P2TR (_Pay to Taproot_). A differenza di BIP47, non è necessario derivare gli indirizzi di ricezione dalle chiavi pubbliche figlie tramite hashing. Infatti, nello standard P2TR, la chiave pubblica modificata viene utilizzata direttamente e apertamente nell'indirizzo. Così, un indirizzo di ricezione Taproot è essenzialmente una chiave pubblica accompagnata da alcuni metadati. Questa chiave pubblica modificata è l'aggregazione di altre due chiavi pubbliche: una che consente la spesa diretta e tradizionale tramite una semplice firma, e l'altra che rappresenta la radice di Merkle del MAST, che autorizza la spesa soggetta alla soddisfazione di una delle condizioni potenzialmente iscritte nell'albero di Merkle.
![BTC204](assets/it/67/01.webp)
La decisione di limitare i Pagamenti Silenziosi esclusivamente a Taproot è motivata da due ragioni principali:
- Primo, facilita significativamente l'implementazione e gli aggiornamenti futuri nel software del portafoglio, poiché è necessario aderire a un solo standard;
- In secondo luogo, questo approccio aiuta a migliorare l'insieme di anonimato degli utenti incoraggiandoli a non disperdersi tra diversi tipi di script, che generano impronte di portafoglio distinte nell'analisi della catena (per maggiori informazioni su questo concetto, vi invito a consultare il capitolo 4 della parte 2).
### Derivazione naive di una chiave pubblica di Pagamenti Silenziosi
Iniziamo con un semplice esempio che ti aiuterà a comprendere il funzionamento di base dei Pagamenti Silenziosi (SP, Silent Payments). Prendiamo Alice e Bob, due utenti Bitcoin. Alice vuole inviare bitcoin a Bob su un nuovo indirizzo di ricezione. Tre obiettivi devono essere raggiunti in questo processo:
- Alice deve essere in grado di generare un nuovo indirizzo;
- Bob deve essere in grado di identificare un pagamento inviato a questo specifico indirizzo;
- Bob deve essere in grado di ottenere la chiave privata associata a questo indirizzo per poter spendere i suoi fondi.
Alice ha un UTXO nel suo portafoglio Bitcoin protetto con la seguente coppia di chiavi:
- $a$: la chiave privata;
- $A$: la chiave pubblica ($A = a \cdot G$)
Bob ha un indirizzo SP che ha pubblicato su internet con:
- $b$: la chiave privata;
- $B$: la chiave pubblica ($B = b \cdot G$)
Recuperando l'indirizzo di Bob, Alice è in grado di calcolare un nuovo indirizzo vuoto che appartiene a Bob usando ECDH. Chiamiamo questo indirizzo $P$:
$$ P = B + \text{hash}(a \cdot B) \cdot G $$
In questa equazione, Alice ha semplicemente calcolato il prodotto scalare della sua chiave privata $a$ e della chiave pubblica di Bob $B$. Ha passato questo risultato attraverso una funzione hash conosciuta da tutti. Il valore di output è poi moltiplicato scalarmente per il punto generatore $G$ della curva ellittica `secp256k1`. Infine, Alice aggiunge il punto ottenuto alla chiave pubblica di Bob $B$. Una volta che Alice ha questo indirizzo $P$, lo usa come output in una transazione, il che significa che invia bitcoin ad esso.
> _Nel contesto dei Pagamenti Silenziosi, la funzione "hash" corrisponde a una funzione hash SHA256 etichettata specificamente con `BIP0352/SharedSecret`, assicurando che gli hash generati siano unici per questo protocollo e non possano essere riutilizzati in altri contesti, fornendo anche una protezione aggiuntiva contro il riutilizzo di nonce nelle firme. Questo standard corrisponde a quello [specificato nel BIP340 per le firme Schnorr](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) su `secp256k1`._
Grazie alle proprietà della curva ellittica su cui si basa ECDH, sappiamo che:
$$ a \cdot B = b \cdot A $$
Bob sarà quindi in grado di calcolare l'indirizzo di ricezione su cui Alice ha inviato i bitcoin. Per fare ciò, monitora tutte le transazioni Bitcoin che soddisfano i criteri dei Pagamenti Silenziosi e applica il seguente calcolo a ciascuna di esse per vedere se il pagamento è indirizzato a lui (_scanning_):
$$ P' = B + \text{hash}(b \cdot A) \cdot G $$
Quando esamina la transazione di Alice, si rende conto che $P'$ è uguale a $P$. Sa quindi che questo pagamento è indirizzato a lui:
$$ P' = B + \text{hash}(b \cdot A) \cdot G = B + \text{hash}(a \cdot B) \cdot G = P $$
Da qui, Bob sarà in grado di calcolare la chiave privata $p$ che consente di spendere l'indirizzo $P$:
$$ p = (b + \text{hash}(b \cdot A)) \bmod n $$
Come puoi vedere, per calcolare questa chiave privata $p$, è necessario avere la chiave privata $b$. Solo Bob ha questa chiave privata $b$. Sarà quindi effettivamente l'unico in grado di spendere i bitcoin inviati al suo indirizzo di Pagamenti Silenziosi.
![BTC204](assets/fr/236.webp)
_Didascalia:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s$: Il segreto comune ECDH
- $P$: La chiave pubblica / indirizzo unico per il pagamento a Bob
Ecco un approccio inizialmente piuttosto ingenuo nell'uso dell'indirizzo statico di Bob, denotato $B$, per derivare un indirizzo unico $P$ per inviare bitcoin. Tuttavia, questo metodo è troppo semplicistico e presenta diversi difetti che necessitano di correzione. Il primo problema è che, in questo schema, Alice non può creare molteplici output per Bob all'interno della stessa transazione.
### Come creare molteplici output?
Nell'esempio della sezione precedente, Alice crea un singolo output che andrà a Bob al suo indirizzo unico $P$. Con lo stesso input selezionato, è impossibile per Alice creare due indirizzi vergini distinti per Bob, poiché il metodo utilizzato porterebbe sempre allo stesso risultato per $P$, quindi allo stesso indirizzo. Tuttavia, ci possono essere molte situazioni in cui Alice desidera dividere il suo pagamento a Bob in diverse piccole somme, creando così molteplici UTXO. È quindi necessario trovare un metodo che permetta di farlo.
Per raggiungere questo obiettivo, modificheremo leggermente il calcolo che Alice esegue per derivare $P$, in modo che possa generare due indirizzi distinti per Bob, ovvero $P_0$ e $P_1$.
Per modificare il calcolo e ottenere 2 indirizzi diversi, è sufficiente aggiungere un intero che modifica il risultato. Così, Alice aggiungerà $0$ nel suo calcolo per ottenere l'indirizzo $P_0$ e $1$ per ottenere l'indirizzo $P_1$. Chiamiamo questo intero $i$:
$$ P_i = B + \text{hash}(a \cdot B \text{ ‖ } i) \cdot G $$
Il processo di calcolo rimane invariato rispetto al metodo precedente, eccetto che questa volta Alice concatenerà $a \cdot B$ con $i$ prima di procedere al hash. È quindi sufficiente cambiare $i$ per avere un nuovo indirizzo appartenente a Bob. Ad esempio:
$$ P_0 = B + \text{hash}(a \cdot B \text{ ‖ } 0) \cdot G $$
$$ P_1 = B + \text{hash}(a \cdot B \text{ ‖ } 1) \cdot G $$
Quando Bob esamina la blockchain per i Pagamenti Silenziosi destinati a lui, inizia utilizzando $i = 0$ per l'indirizzo $P_0$. Se non trova nessun pagamento su $P_0$, conclude che questa transazione non contiene nessun Pagamento Silenzioso per lui e smette di analizzarla. Tuttavia, se $P_0$ è valido e contiene un pagamento per lui, procede con $P_1$ nella stessa transazione per verificare se Alice ha effettuato un secondo pagamento. Se $P_1$ risulta essere invalido, interrompe la sua ricerca per questa transazione; altrimenti, continua a testare valori successivi di $i$.
$$ P_1 = B + \text{hash}(b \cdot A \text{ ‖ } 1) \cdot G $$
Poiché Bob si ferma immediatamente a $i = 0$ se $P_0$ non produce risultati, l'uso di questo intero aggiunge quasi nessun onere operativo aggiuntivo a Bob per la fase di scansione delle transazioni.
Bob può quindi calcolare le chiavi private nello stesso modo:
$$

p_0 = (b + \text{hash}(b \cdot A \text{ ‖ } 0)) \bmod n

$$
p_1 = (b + \text{hash}(b \cdot A \text{ ‖ } 1)) \bmod n
$$

_Didascalia:_


- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hash SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $s_1$: Il secondo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $P_1$: La seconda chiave pubblica / indirizzo unico per il pagamento a Bob

Con questo metodo, iniziamo ad avere un bel protocollo, ma ci sono ancora alcune sfide da superare, in particolare la prevenzione del riutilizzo degli indirizzi.

### Come evitare il riutilizzo degli indirizzi?

Come abbiamo visto nelle sezioni precedenti, Alice utilizza la coppia di chiavi che proteggono il suo UTXO, che spenderà per calcolare il segreto condiviso ECDH con Bob. Questo segreto le permette di derivare l'indirizzo unico $P_0$. Tuttavia, la coppia di chiavi ($a$, $A$) usata da Alice può proteggere più UTXO se ha riutilizzato questo indirizzo diverse volte. Juhul kui Alice kasutab Bobi statilise koodi $B$ puhul kaks korda makseid, kasutades sama koodi $A$ kaitstud UTXO-d, on tegemist Bobi jaoks sama koodi kasutamisega, mis tähendab, et ta kasutab sama koodi uuesti.

> _Il riutilizzo degli indirizzi è una pratica molto negativa per la privacy degli utenti. Per capire perché, vi consiglio di rivedere le prime parti di questa formazione._
Infatti, poiché l'indirizzo unico $P_0$ è derivato da $A$ e $B$, se Alice deriva un secondo indirizzo per un secondo pagamento a $B$, con la stessa chiave $A$, finirà per ottenere lo stesso indirizzo $P_0$. Et vältida seda riski ja vältida riutilizzo degli indirizzi all'interno dei Pagamenti Silenziosi, dobbiamo modificare leggermente i nostri calcoli.

Quello che vogliamo è che ogni UTXO consumato da Alice come input di un pagamento dia un indirizzo unico dal lato di Bob, anche se più UTXO sono protetti dalla stessa coppia di chiavi. È quindi sufficiente aggiungere un riferimento all'UTXO nel calcolo dell'indirizzo unico $P_0$. Questo riferimento sarà semplicemente l'hash dell'UTXO consumato come input:

$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$

E questo riferimento di input, Alice lo aggiungerà nel suo calcolo dell'indirizzo unico $P_0$:

Durante la sua scansione, Bob può anche aggiungere $\text{inputHash}$, poiché tutto ciò che deve fare è osservare la transazione per dedurre $\text{outpoint}$:

$$ P_0 = B + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0) \cdot G $$ $$

Quando trova un valido $P_0$, può calcolare la corrispondente chiave privata $p_0$:

$$
p_0 = (b + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0)) \bmod n
$$

```text
_Legenda:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $H$: L'hash dell'UTXO usato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hash SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
Al momento, i nostri calcoli presuppongono che Alice utilizzi un singolo input per la sua transazione. Tuttavia, dovrebbe essere in grado di utilizzare più input. Di conseguenza, da parte di Bob, per ogni transazione contenente più input, teoricamente avrebbe bisogno di calcolare l'ECDH per ogni input per determinare se un pagamento è destinato a lui. Questo metodo non è soddisfacente, quindi abbiamo bisogno di trovare una soluzione per ridurre il carico di lavoro!
### Modificare le chiavi pubbliche negli input
Per risolvere questo problema, invece di utilizzare la coppia di chiavi che protegge un input specifico da parte di Alice, useremo la somma di tutte le coppie di chiavi utilizzate negli input della transazione. Questa somma sarà quindi considerata come una nuova coppia di chiavi. Questa tecnica è nota come "tweak".
Per esempio, immagina che la transazione di Alice abbia 3 input, ognuno protetto con una coppia di chiavi diversa:
- $a_0$ protegge l'input #0;
- $a_1$ protegge l'input #1;
- $a_2$ protegge l'input #2.
Seguendo il metodo descritto sopra, Alice dovrebbe scegliere una singola coppia di chiavi tra $a_0$, $a_1$ e $a_2$ per calcolare il segreto ECDH e generare l'indirizzo di pagamento unico $P$ dall'indirizzo statico $B$ di Bob. Tuttavia, questo approccio richiede a Bob di testare ogni possibilità sequenzialmente, partendo da $a_0$, poi $a_1$, e così via, fino all'identificazione di una coppia che genera un indirizzo valido $P$. Questo processo richiede che Bob esegua il calcolo ECDH su tutti gli input di tutte le transazioni, aumentando significativamente il carico di lavoro operativo di scansione.
Per evitare ciò, chiederemo ad Alice di eseguire il suo calcolo di $P$ utilizzando la somma di tutte le chiavi in input. Prendendo il nostro esempio, la chiave privata modificata $a$ sarebbe calcolata come segue:
$$ a = a_0 + a_1 + a_2 $$
Allo stesso modo, Alice e Bob saranno in grado di calcolare la chiave pubblica modificata:
$$ A = A_0 + A_1 + A_2 $$
Grazie a questo metodo, a Bob basta calcolare la somma delle chiavi pubbliche della transazione, poi calcolare il segreto ECDH da $A$ soltanto, il che riduce notevolmente il numero di calcoli da fare per la fase di scansione. Tuttavia, ricorda dalla sezione precedente. Avevamo incluso nel nostro calcolo l'hash $\text{inputHash}$ che viene usato come nonce per prevenire il riutilizzo degli indirizzi:
$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$
Ma se ci sono più input in una transazione, è necessario determinare quale $\text{outpoint}$ viene scelto in questo calcolo. Secondo il BIP352, il criterio di selezione per $\text{outpoint}$ da usare è scegliere il più piccolo lessicograficamente, il che significa selezionare l'UTXO che appare per primo in ordine alfabetico. Questo metodo standardizza l'UTXO da scegliere in ogni transazione. Ad esempio, se questo $\text{outpoint}$ più piccolo lessicograficamente è $\text{outpoint}_L$, il calcolo di $\text{inputHash}$ sarà:
$$ \text{inputHash} = \text{hash}(\text{outpoint}\_L \text{ ‖ } A) $$
I calcoli rimangono quindi identici a quelli presentati nella sezione precedente, eccetto che la chiave privata $a$ e la sua corrispondente chiave pubblica $A$ non rappresentano più una coppia che protegge un singolo input, ma ora rappresentano la modifica di tutte le coppie di chiavi negli input.
### Separare le Chiavi di Spesa e di Scansione
Finora, abbiamo discusso dell'indirizzo statico di Pagamento Silenzioso $B$ come di una chiave pubblica unica. Ricorda, è questa chiave pubblica $B$ che viene usata da Alice per creare il segreto condiviso ECDH, che a sua volta viene usato per calcolare l'indirizzo di pagamento unico $P$. Bob usa questa chiave pubblica $B$ e la corrispondente chiave privata $b$ per la fase di scansione. Ma userà anche la chiave privata $b$ per calcolare la chiave privata $p$ che consente di spendere dall'indirizzo $P$.
Lo svantaggio di questo metodo è che la chiave privata $b$, che viene usata per calcolare tutte le chiavi private per gli indirizzi che ricevono Pagamenti Silenziosi, viene anche usata da Bob per scansionare le transazioni. Questo passaggio richiede che la chiave $b$ sia disponibile su un software di portafoglio connesso a Internet, il che la espone a un rischio maggiore di furto rispetto al mantenerla su un portafoglio freddo. Idealmente, sarebbe vantaggioso poter approfittare dei Pagamenti Silenziosi mantenendo la chiave privata $b$, che controlla l'accesso a tutte le altre chiavi private, al sicuro su un portafoglio hardware. Fortunatamente, il protocollo è stato adattato per permettere esattamente questo.
Per raggiungere questo obiettivo, il BIP352 specifica che il ricevente usa 2 diverse coppie di chiavi:
- $B_{\text{spend}}$: per calcolare le chiavi private degli indirizzi di pagamento unici;
- $B_{\text{scan}}$: per trovare indirizzi di pagamento unici.
In questo modo, Bob può mantenere la chiave privata $b_{\text{spend}}$ su un portafoglio hardware e usare la chiave privata $b_{\text{scan}}$ su software online per trovare i suoi Pagamenti Silenziosi, senza rivelare $b_{\text{spend}}$. Tuttavia, le chiavi pubbliche $B_{\text{scan}}$ e $B_{\text{spend}}$ sono entrambe pubblicamente rivelate, poiché si trovano nell'indirizzo statico di Bob $B$:
Per calcolare un indirizzo di pagamento unico $P_0$ appartenente a Bob, Alice eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot a \cdot B\_{\text{scan}} \text{ ‖ } 0) \cdot G $$
Per trovare i pagamenti indirizzati a lui, Bob eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Come puoi vedere, fino a questo momento, Bob non ha avuto bisogno di usare $b_{\text{spend}}$ che si trova sul suo portafoglio hardware. Quando desidera spendere $P_0$, può quindi eseguire il seguente calcolo per trovare la chiave privata $p_0$:
$$ p*0 = (b*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0)) \bmod n $$
_Didascalia:_
- $B_{\text{scan}}$: Chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: Chiave privata di scansione di Bob
- $B_{\text{spend}}$: Chiave pubblica di spesa di Bob (indirizzo statico)
- $b_{\text{spend}}$: Chiave privata di spesa di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash dell'UTXO più piccolo (lessicograficamente) usato in input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo di pagamento unico per Bob
### Utilizzando indirizzi SP con un'etichetta
Bob ha quindi un indirizzo statico $B$ per i Pagamenti Silenziosi come segue:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Il problema con questo metodo è che non permette di segregare i diversi pagamenti inviati a questo indirizzo. Ad esempio, se Bob ha 2 clienti diversi per la sua attività e vuole differenziare chiaramente i pagamenti da ciascuno, avrebbe bisogno di 2 indirizzi statici diversi. Una soluzione ingenua, con l'approccio attuale, sarebbe che Bob crei due portafogli separati, ognuno con il proprio indirizzo statico, o addirittura stabilisca due indirizzi statici diversi all'interno dello stesso portafoglio. Tuttavia, questa soluzione richiede la scansione dell'intera blockchain due volte (una per ciascun indirizzo) per rilevare rispettivamente i pagamenti destinati a ciascun indirizzo. Questa doppia scansione aumenta in modo irragionevole l'onere operativo per Bob.
Per risolvere questo problema, BIP352 utilizza un sistema di etichettatura che consente di avere diversi indirizzi statici senza aumentare in modo irragionevole il carico di lavoro per trovare Pagamenti Silenziosi sulla blockchain. Per fare ciò, viene aggiunto un intero $m$ alla chiave pubblica di spesa $B_{\text{spend}}$. Questo intero può assumere il valore di $1$ per il primo indirizzo statico, poi $2$ per il secondo, e così via. Le chiavi di spesa $B_{\text{spend}}$ saranno d'ora in poi chiamate $B_m$ e saranno costruite in questo modo:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Per esempio, per la prima chiave di spesa con l'etichetta $1$:
$$ B*1 = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } 1) \cdot G $$
L'indirizzo statico pubblicato da Bob consisterà ora di $B_{\text{scan}}$ e $B_m$. Per esempio, il primo indirizzo statico con l'etichetta $1$ sarà:
$$ B = B\_{\text{scan}} \text{ ‖ } B_1 $$
> _Iniziamo solo dall'etichetta 1 perché l'etichetta 0 è riservata per il resto._
Alice, da parte sua, deriverà l'indirizzo di pagamento unico $P$ nello stesso modo di prima, ma utilizzando il nuovo $B_1$ invece di $B_{\text{spend}}$.
$$ P*0 = B_1 + \text{hash}(\text{inputHash} \cdot a \cdot B*{\text{scan}} \text{ ‖ } 0) \cdot G $$
In realtà, Alice potrebbe non sapere nemmeno che Bob ha un indirizzo etichettato, poiché lei semplicemente utilizza la seconda parte dell'indirizzo statico che lui le ha fornito, che in questo caso, è il valore $B_1$ piuttosto che $B_{\text{spend}}$.
Per scansionare i pagamenti, Bob utilizzerà sempre il valore del suo indirizzo statico iniziale con $B_{\text{spend}}$ in questo modo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Poi, semplicemente sottrae il valore che trova per $P_0$ da ogni output uno per uno. Poi controlla se uno dei risultati di queste sottrazioni corrisponde al valore di una delle etichette che usa nel suo portafoglio. Se corrisponde, per esempio, per l'output #4 con l'etichetta $1$, ciò significa che questo output è un Pagamento Silenzioso associato al suo indirizzo statico etichettato $B_1$:
$$ Out*4 - P_0 = \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Questo funziona perché:
$$ B*1 = B*{\text{spend}} + \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Grazie a questo metodo, Bob può utilizzare una moltitudine di indirizzi statici ($B_1$, $B_2$, $B_3$...), tutti derivati dal suo indirizzo statico base ($B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}}$), al fine di separare correttamente gli usi.
Tuttavia, questa separazione degli indirizzi statici è valida solo da una prospettiva di gestione personale del portafoglio e non consente la separazione delle identità. Poiché tutti hanno lo stesso $B*{\text{scan}}$, è molto facile associare tutti gli indirizzi statici insieme e dedurre che appartengono a una singola entità.
_Didascalia:_
- $B_{\text{scan}}$: chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: chiave privata di scansione di Bob
- $B_{\text{spend}}$: chiave pubblica di spesa di Bob (indirizzo iniziale)
- $B_m$: chiave pubblica di spesa etichettata di Bob (indirizzo statico)
- $b_m$: chiave privata di spesa etichettata di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash del più piccolo UTXO (lessicograficamente) utilizzato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $p_0$: La chiave privata del primo indirizzo di pagamento unico a Bob
- $X$: L'hash della chiave privata di scansione con l'etichetta
### Come Costruire un Indirizzo per Pagamenti Silenziosi?
Per costruire un indirizzo dedicato ai Pagamenti Silenziosi, è necessario prima derivare 2 coppie di chiavi nel proprio portafoglio Bitcoin HD:
- La coppia $b_{\text{scan}}$, $B_{\text{scan}}$ per cercare i pagamenti indirizzati a noi;
- La coppia $b_{\text{spend}}$, $B_{\text{spend}}$ per spendere i bitcoin che abbiamo ricevuto.
Queste coppie sono derivate seguendo questi percorsi (_Bitcoin Mainnet_):
scan: m / 352' / 0' / 0' / 1' / 0
spend: m / 352' / 0' / 0' / 0' / 0
```

```text
Una volta disponibili queste 2 coppie di chiavi, si concatenano semplicemente (una di seguito all'altra) per creare il payload dell'indirizzo statico:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Se si desidera utilizzare etichette, $B_{\text{spend}}$ viene sostituito con $B_m$:
$$ B = B\_{\text{scan}} \text{ ‖ } B_m $$
Con l'etichetta $m$:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Una volta disponibile questo payload, si aggiunge la HRP (_Human-Readable Part_) `sp` e la versione `q` (= versione 0). Viene anche aggiunto un checksum, e l'indirizzo è formattato in bech32m.
Ad esempio, ecco il mio indirizzo statico per i Pagamenti Silenziosi:
sp1qqvhjvsq2vz8zwrw372vuzle7472zup2ql3pz64yn5cpkw5ngv2n6jq4nl8cgm6zmu48yk3eq33ryc7aam6jrvrg0d0uuyzecfhx2wgsumcurv77e
```