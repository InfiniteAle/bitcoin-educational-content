---
name: Bitcoinin yksityisyys
goal: Ymmärtää ja hallita yksityisyyden suojan periaatteet Bitcoinia käytettäessä
objectives: 

  - Määritellään teoreettiset käsitteet, joita tarvitaan yksityisyyden suojan panosten ymmärtämiseksi
  - Osaat tunnistaa ja lieventää riskejä, jotka liittyvät käyttäjien yksityisyyden menettämiseen Bitcoinissa
  - Menetelmien ja työkalujen käyttö yksityisyyden suojaamiseksi Bitcoinissa
  - Ymmärtää ketjuanalyysimenetelmiä ja kehittää puolustusstrategioita

---
# Suojaa yksityisyytesi bitcoinilla

Maailmassa, jossa rahaliikenteen yksityisyys on vähitellen muuttumassa ylellisyydeksi, yksityisyyden suojan periaatteiden ymmärtäminen ja hallitseminen Bitcoinin käytössä on välttämätöntä. Tämä koulutus tarjoaa sinulle kaikki avaimet, sekä teoreettiset että käytännön, jotta voit saavuttaa tämän tavoitteen omatoimisesti.

Nykyään Bitcoinissa on yrityksiä, jotka ovat erikoistuneet ketjuanalyysiin. Heidän ydintoimintansa on nimenomaan tunkeutua yksityisyyteesi vaarantaakseen tapahtumiesi luottamuksellisuuden. Itse asiassa "oikeutta yksityisyyteen" ei Bitcoinissa ole olemassa. Siksi on sinun, käyttäjän, tehtävä puolustaa luonnollisia oikeuksiasi ja suojella transaktioiden luottamuksellisuutta, koska kukaan muu ei tee sitä puolestasi.

Tämä koulutus on kattava yleiskurssi. Jokainen tekninen käsite on yksityiskohtainen ja sitä tuetaan selittävillä kaavioilla. Tavoitteena on tehdä tietämys kaikkien ulottuville. BTC204 on siis tarkoitettu aloittelijoille ja keskitason käyttäjille. Tämä koulutus tarjoaa lisäarvoa myös kokeneemmille bitcoinin käyttäjille, sillä syvennymme joihinkin usein tuntemattomiin teknisiin käsitteisiin.

Tule mukaan muuttamaan Bitcoinin käyttöäsi ja tule tietoiseksi käyttäjäksi, joka pystyy ymmärtämään luottamuksellisuuteen liittyvät kysymykset ja suojelemaan yksityisyyttäsi.

+++
# Johdanto

<partId>e17474a8-8899-4bdb-a7f8-bc52ddb01440</partId>

## Johdatus koulutukseen

<chapterId>08ba1933-f393-4fb5-8279-777d874caedb</chapterId>

Maailmassa, jossa rahaliikenteen yksityisyys on vähitellen muuttumassa ylellisyydeksi, yksityisyyden suojan periaatteiden ymmärtäminen ja hallitseminen Bitcoinin käytössä on välttämätöntä. Tämä koulutus tarjoaa sinulle kaikki avaimet, sekä teoreettiset että käytännön, jotta voit saavuttaa tämän tavoitteen omatoimisesti.

Nykyään Bitcoin-ekosysteemissä on yrityksiä, jotka ovat erikoistuneet lohkoketjuanalyysiin. Heidän ydintoimintansa on nimenomaan tunkeutua yksityisyyteesi ja vaarantaa tapahtumiesi luottamuksellisuus. Itse asiassa "oikeutta yksityisyyteen" Bitcoinissa ei ole olemassa. Siksi on sinun, käyttäjän, tehtävä puolustaa luonnollisia oikeuksiasi ja suojella transaktioiden luottamuksellisuutta, koska kukaan muu ei tee sitä puolestasi.

Bitcoin ei ole olemassa vain "Number Go Up" ja säästöjen arvon säilyttämiseksi. Ainutlaatuisten ominaisuuksiensa ja historiansa vuoksi se on ensisijaisesti vaihtoehtoisen talouden väline. Tämän merkittävän keksinnön ansiosta voit vapaasti hallita rahojasi, käyttää niitä ja kerryttää niitä ilman, että kukaan voi estää sinua.

Bitcoin tarjoaa rauhanomaisen pakotien valtioiden ikeestä, jolloin voit nauttia täysin luonnollisista oikeuksistasi, joita vakiintuneet lait eivät voi kyseenalaistaa. Satoshi Nakamoton keksinnön ansiosta sinulla on valta valvoa yksityisomistusoikeuttasi ja saada takaisin sopimusvapautesi.

Bitcoin ei kuitenkaan ole oletusarvoisesti anonyymi, mikä voi aiheuttaa riskin vaihtoehtoisessa taloudessa toimiville henkilöille erityisesti alueilla, joilla vallitsee hirmuhallinto. Tämä ei kuitenkaan ole ainoa vaara. Koska bitcoin on arvokas ja sensuroimaton omaisuuserä, se voi herättää varkaiden huomion. Siksi yksityisyyden suojaamisesta tulee myös turvallisuuskysymys: se voi auttaa sinua estämään verkkohyökkäyksiä ja fyysisiä hyökkäyksiä.

Kuten tulemme näkemään, vaikka protokolla tarjoaa tietyt luontaiset yksityisyydensuojat, on ratkaisevan tärkeää käyttää lisätyökaluja yksityisyyden optimoimiseksi ja puolustamiseksi. Tämä kurssi on suunniteltu kattavaksi, yleistajuiseksi poluksi Bitcoinin yksityisyyskysymysten ymmärtämiseen. Jokaista teknistä käsitettä käsitellään yksityiskohtaisesti ja tuetaan selittävillä kaavioilla. Tavoitteena on tehdä tieto kaikkien, myös aloittelevien ja keskitason käyttäjien, ulottuville. Kokeneemmille bitcoin-käyttäjille käsittelemme kurssin aikana myös hyvin teknisiä ja joskus vähemmän tunnettuja käsitteitä, jotta kunkin aiheen ymmärtäminen syvenee.

Tämän kurssin tavoitteena ei ole tehdä sinusta täysin anonyymiä käyttäessäsi Bitcoinia, vaan antaa sinulle välttämättömät työkalut, joiden avulla voit suojella yksityisyyttäsi henkilökohtaisten tavoitteidesi mukaisesti. Sinulla on vapaus valita esitellyistä käsitteistä ja työkaluista omat strategiat, jotka on räätälöity omien tavoitteidesi ja tarpeidesi mukaan.

### Jakso 1: Määritelmät ja keskeiset käsitteet

Aluksi tarkastelemme yhdessä Bitcoinin toimintaa sääteleviä perusteita ja lähestymme sitten rauhallisesti yksityisyyteen liittyviä käsitteitä. On tärkeää hallita joitakin peruskäsitteitä, kuten UTXO:t, vastaanottavat osoitteet tai skriptit, ennen kuin voimme täysin ymmärtää käsitteet, joita käsittelemme seuraavissa osioissa. Esittelemme myös Satoshi Nakamoton visioiman Bitcoinin yleisen yksityisyydensuojan mallin, jonka avulla voimme hahmottaa ongelmat ja niihin liittyvät riskit.

![BTC204](assets/it/11/1.webp)

### Jakso 2: Ketjuanalyysin ymmärtäminen ja suojautuminen

Toisessa osiossa tutkimme lohkoketjuanalytiikkayritysten käyttämiä tekniikoita, joilla seurataan toimintaasi Bitcoinissa. Näiden menetelmien ymmärtäminen on ratkaisevan tärkeää yksityisyytesi suojan parantamiseksi. Tässä osassa pyritään tarkastelemaan hyökkääjien strategioita, jotta voimme ymmärtää paremmin riskejä ja luoda pohjan tekniikoille, joita tutkimme myöhemmissä osioissa. Analysoimme transaktiomalleja, sisäisiä ja ulkoisia heuristiikkoja sekä näiden mallien uskottavia tulkintoja. Teoriaosuuden lisäksi opimme käytännön esimerkkien ja harjoitusten avulla, miten lohko-etsintäohjelmaa käytetään ketjuanalyysin suorittamiseen.

![BTC204](assets/fr/002.webp)

### Jakso 3: Parhaiden käytäntöjen hallinta yksityisyyden suojaamiseksi

Kurssimme kolmannessa osiossa pääsemme asian ytimeen: harjoitteluun! Tavoitteena on hallita kaikki olennaiset parhaat käytännöt, joista pitäisi tulla jokaiselle Bitcoin-käyttäjälle luonnollisia refleksejä. Käsittelemme tuoreiden osoitteiden käyttöä, merkitsemistä, konsolidointia, kokonaisten solmujen käyttöä sekä KYC- ja hankintamenetelmiä. Tavoitteena on antaa sinulle kattava yleiskuva sudenkuopista, joita on syytä välttää, jotta voimme luoda vankan perustan pyrkimyksellemme yksityisyyden suojaan. Joidenkin käytäntöjen osalta sinua ohjataan erityiseen opetusohjelmaan niiden toteuttamiseksi.

![BTC204](assets/it/11/3.webp)

### Jakso 4: Coinjoin-transaktioiden ymmärtäminen

Miten voimme puhua bitcoinin yksityisyydestä keskustelematta coinjoinista? Luvussa 4 saat selville kaiken, mitä sinun tarvitsee tietää tästä yhdistämismenetelmästä. Opit, mikä coinjoin on, sen historian ja tavoitteet sekä erilaiset olemassa olevat coinjoin-tyypit. Lopuksi kokeneemmille käyttäjille selvitetään, mitä anonsetit ja entropia ovat ja miten nämä indikaattorit lasketaan.

![BTC204](assets/it/11/4.webp)

### Jakso 5: Muiden kehittyneiden yksityisyyden suojaa koskevien tekniikoiden ongelmien ymmärtäminen

Viidennessä osassa luodaan katsaus kaikkiin muihin olemassa oleviin tekniikoihin, joilla yksityisyyttä voi suojata Bitcoinissa coinjoinin lisäksi. Vuosien varrella kehittäjät ovat osoittaneet huomattavaa luovuutta suunnitellessaan yksityisyyden suojaamiseen tarkoitettuja työkaluja. Tarkastelemme kaikkia näitä menetelmiä, kuten payjoinia, yhteistransaktioita, Coin Swapia ja Atomic Swapia, ja kerromme yksityiskohtaisesti niiden toiminnasta, tavoitteista ja mahdollisista heikkouksista.

Käsittelemme myös yksityisyyden suojaa solmuverkkotasolla ja tapahtumien leviämistä. Käsittelemme myös erilaisia protokollia, joita on vuosien varrella ehdotettu käyttäjien yksityisyyden parantamiseksi Bitcoinissa, mukaan lukien staattiset osoiteprotokollat.

![BTC204](assets/fr/005.webp)

# Määritelmät ja keskeiset käsitteet

<partId>b9bbbde3-34c0-4851-83e8-e2ffb029cf31</partId>

## Bitcoinin UTXO-malli

<chapterId>8d6b50c5-bf74-44f4-922b-25204991cb75</chapterId>

Bitcoin on ensisijaisesti valuutta, mutta tiedätkö konkreettisesti, miten BTC on esitetty protokollassa?

### Bitcoinin UTXO:t: Mitä ne ovat?

Bitcoin-protokollassa rahayksiköiden hallinta perustuu UTXO-malliin, joka tarkoittaa "_Unspent Transaction Output_"

Tämä malli eroaa huomattavasti perinteisistä pankkijärjestelmistä, joissa rahoitusvirtojen seuranta perustuu tili- ja saldomekanismiin. Itse asiassa pankkijärjestelmässä yksittäisiä saldoja ylläpidetään tileillä, jotka on liitetty henkilöllisyyteen. Kun esimerkiksi ostat patongin leipurilta, pankkisi yksinkertaisesti veloittaa ostoksen summan tililtäsi, jolloin saldosi pienenee, kun taas leipurin tilille hyvitetään sama summa, jolloin sen saldo kasvaa. Tässä järjestelmässä tilillesi tulevan ja sieltä lähtevän rahan välillä ei ole mitään muuta yhteyttä kuin tapahtumakirjanpito.

Bitcoinissa asiat toimivat eri tavalla. Tilin käsitettä ei ole olemassa, ja rahayksiköitä ei hallinnoida saldojen vaan UTXO:iden avulla. UTXO edustaa tiettyä bitcoin-määrää, jota ei ole vielä käytetty, ja muodostaa siten "bitcoinin kappaleen", joka voi olla suuri tai pieni. UTXO voi esimerkiksi olla arvoltaan `500 BTC` tai vain `700 SATS`.

**> Muistutus:** Satoshi, usein lyhennettynä sat, on Bitcoinin pienin yksikkö, joka on verrattavissa fiat-valuuttojen penniin.

```plaintext
1 BTC = 100,000,000 SATS
```

Teoriassa UTXO voi edustaa mitä tahansa arvoa bitcoineina, aina satista teoreettiseen maksimiin eli noin 21 miljoonaan BTC:hen asti. On kuitenkin loogisesti mahdotonta omistaa kaikkia 21 miljoonaa bitcoinia, ja on olemassa alempi taloudellinen kynnysarvo, jota kutsutaan "pölyksi" ja jonka alapuolella UTXO:n käyttäminen katsotaan taloudellisesti kannattamattomaksi.

**> Tiesitkö?** Bitcoinilla koskaan luodun suurimman UTXO:n arvo oli 500 000 BTC`. Se luotiin MtGox-alustalla konsolidointioperaation aikana marraskuussa 2011: [29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf](https://mempool.space/fr/tx/29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf)

### UTXO ja menoedellytykset

UTXO:t ovat Bitcoinin vaihtovälineitä. Jokaisessa transaktiossa kulutetaan UTXO:ita panoksina ja luodaan uusia UTXO:ita tuotoksina. Kun transaktio tehdään, panoksina käytetyt UTXO:t katsotaan "käytetyiksi", ja uudet UTXO:t luodaan ja osoitetaan transaktion tuotoksissa ilmoitetuille vastaanottajille. UTXO edustaa siis yksinkertaisesti transaktion käyttämätöntä tuotosta ja siten käyttäjälle tiettynä ajankohtana kuuluvaa bitcoin-määrää.

![BTC204](assets/it/21/2.webp)

Kaikki UTXO:t on suojattu skripteillä, joissa määritellään ehdot, joiden mukaisesti niitä voidaan käyttää. Käyttäjän on UTXO:n käyttämiseksi osoitettava verkolle, että hän täyttää UTXO:ta suojaavassa käsikirjoituksessa asetetut ehdot. Yleensä UTXO:t on suojattu julkisella avaimella (tai tätä julkista avainta edustavalla vastaanotto-osoitteella). Käyttäjän on osoitettava, että hänellä on vastaava yksityinen avain, jotta hän voi käyttää kyseiseen julkiseen avaimeen liittyvän UTXO:n, antamalla kyseisellä avaimella tehdyn digitaalisen allekirjoituksen. Tämän vuoksi sanotaan, että bitcoin-lompakko ei itse asiassa sisällä bitcoineja, vaan pikemminkin yksityisiä avaimia, jotka puolestaan antavat sinulle pääsyn UTXO-varmenteisiisiisi ja siten myös niiden edustamiin bitcoineihin.

![BTC204](assets/it/21/3.webp)

Koska Bitcoinissa ei ole tilin käsitettä, lompakon saldo on yksinkertaisesti kaikkien niiden UTXO:iden arvojen summa, joita se voi käyttää. Esimerkiksi jos Bitcoin-lompakko voi käyttää seuraavat 4 UTXOa:

```plaintext
- 2 BTC
- 8 BTC
- 5 BTC
- 2 BTC
```

Lompakkosi kokonaissaldo olisi `17 BTC`.

![BTC204](assets/it/21/4.webp)

## Bitcoin-tapahtumien rakenne

<chapterId>29d3aaab-de2e-4746-ab40-c9748898850c</chapterId>

### Liiketoimen panokset ja tuotokset

Bitcoin-transaktio on lohkoketjuun kirjattu tapahtuma, joka mahdollistaa bitcoinien omistusoikeuden siirtämisen henkilöltä toiselle. Tarkemmin sanottuna, koska olemme UTXO-mallissa eikä tilejä ole, transaktio täyttää yhden tai useamman UTXO:n suojaamat käyttöehdot, kuluttaa niitä ja vastaavasti luo uusia UTXO:ita, jotka on varustettu uusilla käyttöehdoilla. Lyhyesti sanottuna transaktio siirtää bitcoinit täyttyneestä skriptistä uuteen skriptiin, jonka tarkoituksena on suojata ne.

![BTC204](assets/it/22/1.webp)

Jokainen Bitcoin-tapahtuma koostuu siis yhdestä tai useammasta syötteestä ja yhdestä tai useammasta tulosteesta. Syötteet ovat UTXO:ita, joita transaktio kuluttaa tuotosten tuottamiseksi. Tuotokset ovat uusia UTXO:ita, joita voidaan käyttää tulevien transaktioiden syötteinä.

![BTC204](assets/it/22/2.webp)

**> Tiesitkö?** Teoriassa bitcoin-tapahtumassa voi olla ääretön määrä tuloja ja lähtöjä. Vain lohkojen enimmäiskoko rajoittaa tätä määrää. Bitcoin-transaktion jokainen tulo viittaa edelliseen käyttämättömään UTXO:hon (Unspent Transaction Output). Jotta UTXO:ta voidaan käyttää syötteenä, sen haltijan on todistettava olevansa sen laillinen omistaja validoimalla siihen liittyvä käsikirjoitus eli täyttämällä asetetut käyttöehdot. Yleensä tämä edellyttää digitaalisen allekirjoituksen antamista, joka on tuotettu julkista avainta vastaavalla yksityisellä avaimella, joka alun perin suojasi kyseisen UTXO:n. Tämä tarkoittaa, että UTXO:n on oltava digitaalinen allekirjoitus. Tämän jälkeen käsikirjoitus tarkistaa, että allekirjoitus vastaa varojen vastaanottamisen yhteydessä käytettyä julkista avainta.

Jokaisessa ulostulossa puolestaan määritetään siirrettävien bitcoinien määrä sekä vastaanottaja. Jälkimmäinen määritellään uudella skriptillä, joka yleensä lukitsee juuri luodun UTXO:n vastaanottavalla osoitteella tai uudella julkisella avaimella.

Jotta transaktiota voidaan pitää konsensussääntöjen mukaan pätevänä, kokonaistulosten on oltava pienemmät tai yhtä suuret kuin kokonaissyötteiden. Toisin sanoen transaktion tuottamien uusien UTXO:iden summa ei saa ylittää panoksina kulutettujen UTXO:iden summaa. Tämä periaate on looginen: jos sinulla on vain 500 000 SATS, et voi tehdä 700 000 SATS:n ostoa.

### Vaihto ja konsolidointi Bitcoin-tapahtumassa

Bitcoin-tapahtuman vaikutusta UTXO:iin voidaan siis verrata kultakolikon sulattamiseen. Itse asiassa UTXO ei ole jaettavissa, vaan ainoastaan yhdistettävissä. Tämä tarkoittaa, että käyttäjä ei voi yksinkertaisesti jakaa tiettyä bitcoin-määrää edustavaa UTXOa useammaksi pienemmäksi UTXOksi. Hänen on kulutettava se kokonaan transaktiossa luodakseen yhden tai useamman uuden UTXO:n, joiden arvot ovat mielivaltaisia ja joiden on oltava alkuperäistä arvoa pienempiä tai yhtä suuria.

Tämä mekanismi on samanlainen kuin kultakolikossa. Kuvittele, että omistat 2 unssin kolikon ja haluat maksaa 1 unssin, jos myyjä ei voi antaa sinulle vaihtorahaa. Sinun pitäisi sulattaa kolikkosi ja lyödä kaksi uutta 1 unssin kolikkoa.

Bitcoinissa toiminta on samanlaista. Oletetaan, että Alicen UTXO on `10 000 SATS` ja hän haluaa ostaa patongin, joka maksaa `4 000 SATS`. Alice suorittaa transaktion, jonka panoksena on 1 UTXO, jonka arvo on `10 000 SATS` ja jonka hän kuluttaa kokonaan, ja jonka tuotoksena hän luo 2 UTXOa, joiden arvo on `4 000 SATS` ja `6 000 SATS`. UTXO arvoltaan 4 000 SATS` lähetetään leipurille maksuna patongista, kun taas UTXO arvoltaan 6 000 SATS` palautuu Liisalle vaihtorahana. Tätä UTXO:ta, joka palaa takaisin transaktion alkuperäiselle lähettäjälle, kutsutaan Bitcoin-jargonissa "vaihtorahaksi".

Kuvitellaan nyt, että Alicella ei ole yhtä UTXO:ta, jonka arvo on "10 000 SATS", vaan kaksi UTXO:ta, joiden kummankin arvo on "3 000 SATS". Tässä tilanteessa yksikään yksittäisistä UTXO:ista ei riitä kattamaan patongin 4 000 SATS:n määrää. Sen vuoksi Alicen on käytettävä molempia 3 000 SATS:n UTXO:ita samanaikaisesti tapahtuman panoksina. Tällä tavoin kokonaispanos on 6 000 SATS`, jolloin hän voi maksaa leipurille 4 000 SATS`:n maksun. Tätä menetelmää, jossa useat UTXO:t ryhmitellään liiketoimen panoksiksi, kutsutaan usein "konsolidoinniksi".

### Transaktiomaksut

Intuitiivisesti voisi ajatella, että myös transaktiomaksut ovat transaktion tuotos. Todellisuudessa näin ei kuitenkaan ole. Transaktiomaksut edustavat panosten ja tuotosten kokonaismäärän välistä erotusta. Tämä tarkoittaa sitä, että kun osa panosten arvosta on käytetty transaktion haluttujen tuotosten kattamiseen, tietty summa panoksista jää käyttämättä. Tämä jäljelle jäävä summa muodostaa transaktiomaksut.

```plaintext
Commissioni = input totali - output totali
```

Palataanpa esimerkkiin Alicesta, jonka UTXO on 10 000 SATS ja joka haluaa ostaa patongin 4 000 SATS:lla. Liisa luo tapahtuman, jonka syötteenä on 10 000 SATS:n UTXO. Sen jälkeen hän luo 4 000 SATS:n suuruisen tuotoksen, joka on tarkoitettu leipurille patongin maksamiseen. Kannustaakseen louhijoita sisällyttämään hänen transaktionsa lohkoon Alice antaa 200 SATS` palkkioksi. Näin hän luo toisen tuotoksen, loppuosan, joka palautetaan hänelle ja joka on 5 800 SATS`.

Soveltamalla provisiokaavaa näemme, että kaivostyöläisille on jäljellä 200 SATSia:

```plaintext
Commissioni = input totali - output totali
Spese = 10.000 - (4.000 + 5.800)
Spese = 10.000 - 9.800
Spese = 200
```

Kun louhija validoi onnistuneesti lohkon, hänellä on oikeus periä nämä palkkiot kaikista lohkoonsa sisältyvistä transaktioista niin sanotun "coinbase"-transaktion kautta.

### UTXO:n luominen Bitcoinissa

Jos olet seurannut edellisiä kohtia tarkasti, tiedät nyt, että UTXO:t voidaan luoda vain kuluttamalla muita olemassa olevia UTXO:ita. Näin ollen Bitcoinin kolikot muodostavat jatkuvan ketjun. Saatat kuitenkin ihmetellä, miten ensimmäiset UTXO:t ilmestyivät tähän ketjuun. Tämä herättää samanlaisen ongelman kuin kana ja muna: mistä nämä alkuperäiset UTXO:t tulivat?

Vastaus löytyy **coinbase-tapahtumasta**.

Coinbase on erityyppinen Bitcoin-tapahtuma, joka on ainutlaatuinen jokaisessa lohkossa ja aina ensimmäinen lohkoissa. Sen avulla louhija, joka on löytänyt kelvollisen työtodistuksen, voi saada lohkopalkkionsa. Tämä palkkio koostuu kahdesta elementistä: **lohkoavustus** ja **transaktiopalkkiot**, joita käsiteltiin edellisessä osassa.

Coinbase-tapahtuman ainutlaatuinen piirre on se, että se on ainoa, joka voi luoda bitcoineja tyhjästä ilman, että sen tarvitsee kuluttaa panoksia tuotostensa tuottamiseksi. Nämä äskettäin luodut bitcoinit muodostavat niin sanotun "alkuperäisen UTXO:n"

Lohkoavustuksesta saadut bitcoinit ovat uusia BTC:itä, jotka luodaan tyhjästä, konsensussäännöissä ennalta määritellyn liikkeeseenlaskun aikataulun mukaisesti. Lohkoavustus puolitetaan 210 000 lohkon välein, noin neljän vuoden välein, prosessissa, jota kutsutaan "puolitukseksi" Aluksi luotiin 50 bitcoinia lohkoavustusta kohden, mutta tämä määrä on vähitellen pienentynyt; tällä hetkellä se on 3 125 bitcoinia lohkoa kohden.

Vaikka transaktiomaksut edustavat vastaperustettua BTC:tä, ne eivät saa ylittää lohkon kaikkien transaktioiden yhteenlaskettujen tulojen ja menojen erotusta. Näimme aiemmin, että nämä maksut edustavat sitä osaa panoksista, jota ei käytetä transaktioiden tuotoksissa. Tämä osa "häviää" teknisesti transaktion aikana, ja louhijalla on oikeus luoda tämä arvo uudelleen yhden tai useamman uuden UTXO:n muodossa. Kyseessä on siis arvon siirto transaktion lähettäjältä louhijalle, joka lisää sen lohkoketjuun.

**> Tiesitkö?** Coinbase-tapahtumasta syntyneisiin bitcoineihin sovelletaan 100 lohkon kypsymisjaksoa, jonka aikana louhija ei voi käyttää niitä. Tämän säännön tarkoituksena on välttää komplikaatioita, jotka liittyvät äskettäin luotujen bitcoinien käyttöön ketjussa, joka saattaa myöhemmin vanhentua.

### UTXO-mallin vaikutukset

Ensinnäkin UTXO-malli vaikuttaa suoraan Bitcoinin transaktiomaksuihin. Koska kunkin lohkon kapasiteetti on rajallinen, louhijat suosivat transaktioita, jotka tarjoavat parhaat maksut suhteessa lohkossa varattuun tilaan. Itse asiassa mitä enemmän UTXO:ta transaktio sisältää tulona ja lähtönä, sitä raskaampi se on ja vaatii siksi korkeampia maksuja. Tämä on yksi syy siihen, miksi UTXO:iden määrää pyritään usein vähentämään, mikä voi vaikuttaa myös yksityisyyteen, jota käsittelemme yksityiskohtaisesti tämän koulutuksen kolmannessa osassa.

Seuraavaksi, kuten edellisissä osissa mainittiin, Bitcoin-kolikot ovat lähinnä UTXO-ketju. Jokainen transaktio luo siis linkin menneen UTXO:n ja tulevan UTXO:n välille. UTXO:iden avulla voidaan siis seurata bitcoinien kulkua niiden luomisesta niiden nykyiseen kulutukseen. Tätä avoimuutta voidaan pitää myönteisenä, sillä sen avulla jokainen käyttäjä voi varmistaa saamiensa bitcoinien aitouden. Tähän jäljitettävyyden ja tarkastettavuuden periaatteeseen perustuu kuitenkin myös ketjuanalyysi, joka on suunniteltu vaarantamaan yksityisyyttä. Tutkimme tätä käytäntöä perusteellisesti koulutuksen toisessa osassa.

## Bitcoinin yksityisyysmalli

<chapterId>769d8963-3ed5-4094-b21d-9203c7d9e465</chapterId>

### Valuutta: Aitous, eheys ja kaksinkertainen rahankäyttö

Yksi valuutan tehtävistä on ratkaista ongelman, joka liittyy tarpeiden kaksinkertaiseen päällekkäisyyteen. Vaihtoon perustuvassa järjestelmässä vaihdon tekeminen edellyttää paitsi sitä, että löydetään yksilö, joka tarjoaa minun tarpeeni tyydyttävää tavaraa, myös sitä, että hänelle tarjotaan samanarvoinen tavara, joka tyydyttää hänen tarpeensa. Tämän tasapainon löytäminen osoittautuu monimutkaiseksi.

Tästä syystä käytetään valuuttaa, joka mahdollistaa arvon siirtämisen sekä tilassa että ajassa.

Jotta valuutta voisi ratkaista tämän ongelman, on tärkeää, että tavaran tai palvelun tarjoava osapuoli on vakuuttunut siitä, että se pystyy käyttämään kyseisen summan myöhemmin. Siksi jokainen järkevä henkilö, joka haluaa hyväksyä jonkin rahan, olipa se sitten digitaalinen tai fyysinen, varmistaa, että se täyttää kaksi peruskriteeriä:


- Kolikon on oltava ehjä ja aito;**- **eikä sitä saa käyttää kahdesti.**

Kun käytetään fyysistä valuuttaa, ensimmäinen ominaisuus on kaikkein vaikein todistaa. Metallirahojen koskemattomuus on eri historiallisilla kausilla usein vaarantunut esimerkiksi leikkaamalla tai lyömällä. Esimerkiksi muinaisessa Roomassa oli tavallista, että kansalaiset raaputtivat kultakolikoiden reunoja kerätäkseen osan jalometallista ja säilyttääkseen ne tulevia liiketoimia varten. Kolikon itseisarvo pieneni näin, mutta sen nimellisarvo pysyi samana. Tämä on merkittävä syy siihen, miksi myöhemmin kolikoiden reunaan lyötiin raitoja.

Aitous on myös vaikea ominaisuus, jota on vaikea todentaa fyysisin rahamääräisin keinoin. Nykyään väärennösten torjuntatekniikat ovat yhä monimutkaisempia, mikä pakottaa kauppiaat investoimaan kalliisiin todentamisjärjestelmiin.

Toisaalta fyysisten valuuttojen luonteen vuoksi kaksinkertainen maksaminen ei ole ongelma. Jos annan sinulle 10 euron setelin, se siirtyy peruuttamattomasti omistuksestani sinun omistukseesi, mikä tietysti sulkee pois mahdollisuuden käyttää samat rahayksiköt useaan kertaan. Lyhyesti sanottuna en voi käyttää 10 euron seteliä uudelleen.

Digitaalisen valuutan kohdalla vaikeus on erilainen. Kolikon aitouden ja eheyden varmistaminen on usein helpompaa. Kuten edellisessä jaksossa todettiin, Bitcoinin UTXO-mallin avulla kolikko voidaan jäljittää sen alkuperään, jolloin voidaan varmistaa, että louhija on todellakin luonut sen konsensussääntöjen mukaisesti.

Kaksinkertaisen maksun välttämisen varmistaminen on kuitenkin monimutkaisempaa, sillä kaikki digitaaliset hyödykkeet ovat pohjimmiltaan tietoa. Toisin kuin fyysiset tavarat, tieto ei jakaannu vaihdon aikana, vaan se leviää moninkertaistumalla. Jos esimerkiksi lähetän sinulle asiakirjan sähköpostitse, se monistuu. Sinä puolestasi et voi varmuudella varmistaa, että olen poistanut alkuperäisen asiakirjan.

### Kaksinkertaisen maksun estäminen Bitcoinissa

Ainoa tapa välttää digitaalisen omaisuuden päällekkäisyys on olla tietoinen kaikista järjestelmän sisällä tapahtuvista vaihdoista. Näin tiedät, kuka omistaa mitäkin, ja voit päivittää kaikkien omistusoikeudet tehtyjen transaktioiden perusteella. Näin toimitaan esimerkiksi pankkijärjestelmän kirjallisen rahan kanssa. Kun maksat 10 euroa kauppiaalle luottokortilla, pankki kirjaa tämän vaihdon ja päivittää pääkirjan.

Bitcoinissa kaksinkertaisen maksun estäminen tapahtuu samalla tavalla. Tarkoituksena on vahvistaa, ettei kyseessä ole transaktio, jossa on jo käytetty kyseisiä kolikoita. Jos näitä kolikoita ei ole koskaan käytetty, voimme olla varmoja, ettei tuplamaksua tapahdu. Satoshi Nakamoto kuvasi tätä periaatetta valkoisessa kirjassaan tällä kuuluisalla lauseella:

**"_Ainut tapa varmistaa tapahtuman puuttuminen on olla tietoinen kaikista tapahtumista._"**"

Toisin kuin pankkimallissa, Bitcoinissa ei kuitenkaan haluta luottaa keskusyksikköön. On välttämätöntä, että kaikki käyttäjät voivat vahvistaa tämän kaksinkertaisen maksun puuttumisen ilman, että he luottavat kolmanteen osapuoleen. Siksi kaikkien on oltava tietoisia kaikista Bitcoin-tapahtumista. Tämän vuoksi Bitcoin-tapahtumat lähetetään julkisesti kaikkiin verkon solmuihin ja tallennetaan selkokielellä lohkoketjuun.

Juuri tämä tietojen julkinen levittäminen vaikeuttaa yksityisyyden suojaa Bitcoinissa. Perinteisessä pankkijärjestelmässä teoriassa vain rahoituslaitos on tietoinen tehdyistä transaktioista. Toisaalta Bitcoinissa kaikki käyttäjät saavat tiedon kaikista transaktioista omien solmujensa kautta.

### Yksityisyysmalli: pankkijärjestelmä vs. Bitcoin

Perinteisessä järjestelmässä pankkitilisi on sidottu henkilöllisyyteesi. Pankkiiri pystyy tietämään, mikä asiakas kuuluu millekin pankkitilille ja mitä tapahtumia siihen liittyy. Tämä tiedonkulku on kuitenkin katkennut pankin ja julkisten tahojen välillä. Toisin sanoen on mahdotonta tietää toiselle henkilölle kuuluvan pankkitilin saldoa ja tapahtumia. Vain pankilla on pääsy näihin tietoihin.

Esimerkiksi pankkiirisi tietää, että ostat patongin joka aamu naapuruston leipomosta, mutta naapurisi ei tiedä tästä liiketoimesta. Näin ollen tietovirta on asianomaisten osapuolten, erityisesti pankin, saatavilla, mutta ulkopuolisten ulottumattomissa.

Edellisessä osassa esitetyn transaktioiden julkista levittämistä koskevan rajoituksen vuoksi Bitcoinin yksityisyysmalli ei voi noudattaa pankkijärjestelmän mallia. Koska Bitcoinin tapauksessa tiedonkulkua ei voida katkaista transaktioiden ja julkisuuden välillä, **yksityisyysmalli perustuu käyttäjän henkilöllisyyden ja itse transaktioiden** erottamiseen toisistaan.

Jos esimerkiksi ostat patongin leipurilta, joka maksaa BTC:llä, naapurisi, joka omistaa oman solmunsa, näkee tapahtumasi, aivan kuten hän näkee kaikki muutkin tapahtumat järjestelmässä. Jos yksityisyyden suojaa koskevia periaatteita kuitenkin noudatetaan, hänen ei pitäisi pystyä yhdistämään tätä tiettyä transaktiota henkilöllisyyteesi.

Koska Bitcoin-tapahtumat ovat julkisia, niiden välille voidaan silti luoda yhteyksiä, joiden avulla voidaan päätellä tietoja osallistujista. Tämä toiminta muodostaa jopa oman erikoisalansa, jota kutsutaan "ketjuanalyysiksi" Kurssin seuraavassa osassa kutsun sinut tutustumaan ketjuanalyysin perusteisiin, jotta ymmärrät, miten bitcoinejasi seurataan, ja osaat puolustautua paremmin.

# Ketjuanalyysin ymmärtäminen ja suojautuminen

<partId>4739371e-9fef-45b0-bcaa-b7a4df6b4470</partId>

## Mikä on Bitcoinin ketjuanalyysi?

<chapterId>7d198ba6-4af2-4f24-86cb-3c79cb25627e</chapterId>

### Määritelmä ja toiminta

Ketjuanalyysi on käytäntö, joka kattaa kaikki menetelmät, joita käytetään bitcoinien virtauksen seuraamiseen lohkoketjussa. Yleensä ketjuanalyysi perustuu aiempien transaktioiden näytteiden piirteiden havainnointiin. Sen jälkeen siinä tunnistetaan nämä samat piirteet transaktiossa, jota halutaan analysoida, ja päätellään uskottavia tulkintoja. Tätä käytännönläheistä ongelmanratkaisumenetelmää riittävän hyvän ratkaisun löytämiseksi kutsutaan "heuristiikoiksi"

Yksinkertaisuuden vuoksi ketjuanalyysi suoritetaan kolmessa päävaiheessa:

1. **Lohkoketjun tarkkailu;**

2. **Tunnettujen ominaisuuksien tunnistaminen;**

3. **Vetovoimaoletukset.**

Lohkoketjuanalyysin voi tehdä kuka tahansa. Riittää, että sinulla on pääsy lohkoketjun julkiseen tietoon kokonaisen solmun kautta, jotta voit tarkkailla transaktioiden liikkeitä ja tehdä oletuksia. On myös ilmaisia työkaluja, jotka helpottavat tätä analyysia, kuten verkkosivusto [OXT.me](https://oxt.me/), johon tutustumme yksityiskohtaisesti tämän osan kahdessa viimeisessä luvussa. Suurin yksityisyysriski tulee kuitenkin ketjuanalyysiin erikoistuneista yrityksistä. Nämä yritykset ovat vieneet ketjuanalyysin teolliseen mittakaavaan ja myyvät palvelujaan rahoituslaitoksille tai hallituksille. Näistä yrityksistä Chainalysis on luultavasti tunnetuin.

### Ketjuanalyysin tavoitteet

Yksi ketjuanalyysin tavoitteista on ryhmitellä Bitcoiniin kohdistuvia erilaisia toimintoja, jotta voidaan määrittää, kuka käyttäjä ne on suorittanut. Seuraavaksi on mahdollista yrittää yhdistää tämä toimintojen joukko todelliseen henkilöllisyyteen.

Muistakaa edellinen luku. Selitin, miksi Bitcoinin yksityisyysmalli perustui alun perin siihen, että käyttäjien identiteetit erotettiin heidän transaktioistaan. Siksi olisi houkuttelevaa ajatella, että ketjussa tapahtuva analyysi on hyödytöntä, sillä vaikka ketjussa tapahtuvia toimintoja voikin ryhmitellä, niitä ei voi yhdistää todelliseen identiteettiin.

Teoriassa tämä väite pitää paikkansa. Koulutuksen ensimmäisessä osassa näimme, että UTXO:n olosuhteiden määrittämiseen käytetään kryptografisia avainpareja. Pohjimmiltaan nämä avainparit eivät paljasta mitään tietoa haltijansa henkilöllisyydestä. Näin ollen, vaikka pystymme ryhmittelemään eri avainpareihin liittyviä toimintoja, tämä ei kerro mitään näiden toimintojen taustalla olevasta yksiköstä.

Käytännön todellisuus on kuitenkin paljon monimutkaisempi. On olemassa lukuisia käyttäytymistapoja, jotka saattavat yhdistää todellisen identiteetin ketjussa tapahtuvaan toimintaan. Analyysissä tätä kutsutaan sisäänmenopisteeksi, ja niitä on monia.

Yleisin on tietysti KYC (_Know Your Customer_). Jos nostat bitcoinejasi säännellyltä alustalta johonkin henkilökohtaiseen vastaanotto-osoitteeseesi, jotkut ihmiset pystyvät yhdistämään henkilöllisyytesi tähän osoitteeseen. Yleisemmällä tasolla merkintäpiste voi olla mikä tahansa vuorovaikutuksen muoto oikean elämäsi ja bitcoin-tapahtuman välillä. Jos esimerkiksi julkaiset vastaanotto-osoitteen sosiaalisissa verkostoissa, se voi olla tulokohta analyysille. Jos suoritat bitcoin-maksun leipurillesi, he voivat yhdistää kasvosi (jotka ovat osa identiteettiäsi) bitcoin-osoitteeseen.

Nämä sisäänpääsykohdat ovat lähes väistämättömiä Bitcoinin käytössä. Vaikka voit yrittää rajoittaa niiden laajuutta, ne pysyvät läsnä. Siksi on ratkaisevan tärkeää yhdistää menetelmiä, joilla pyritään säilyttämään yksityisyytesi. Vaikka todellisen henkilöllisyyden ja transaktioiden erottaminen toisistaan on houkutteleva lähestymistapa, se on nykyään edelleen riittämätön. Jos kaikki ketjutoimintasi voidaan ryhmitellä yhteen, pienikin tunkeutumiskohta vaarantaa todennäköisesti sen ainoan yksityisyyden suojan, jonka olet luonut.

### Puolustautuminen ketjuanalyysia vastaan

Siksi on myös tarpeen pystyä käsittelemään lohkoketjuanalyysia Bitcoinin käytössä. Näin etenemällä voimme minimoida toimintojemme yhdistämisen ja rajoittaa pääsyn vaikutusta yksityisyyteemme.

Itse asiassa, jotta lohkoketjuanalyysin torjuminen olisi helpompaa, mikä olisikaan parempi lähestymistapa kuin tutustua lohkoketjuanalyysissä käytettyihin menetelmiin? Jos haluat tietää, miten voit parantaa yksityisyyttäsi Bitcoinissa, sinun on ymmärrettävä nämä menetelmät. Näin voit ymmärtää paremmin tekniikoita, kuten coinjoin tai payjoin (tekniikoita, joita tutkimme koulutuksen loppuosassa), ja vähentää mahdollisesti tekemiäsi virheitä.

Tässä yhteydessä voidaan tehdä analogia salakirjoituksen ja salausanalyysin kanssa. Hyvä salakirjoittaja on ennen kaikkea hyvä salausanalyytikko. Uuden salausalgoritmin kehittämiseksi on tiedettävä, mitä hyökkäyksiä se kohtaa, ja tutkittava, miksi aiempia algoritmeja on hakkeroitu. Sama periaate pätee Bitcoinin yksityisyyteen. Lohkoketjun analyysimenetelmien ymmärtäminen on avain suojautumiseen. Siksi ehdotan tässä koulutuksessa kokonaista lohkoketjujen analysointia käsittelevää osiota.

https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/fr/tutorials/privacy/on-chain/payjoin-848b6a23-deb2-4c5f-a27e-93e2f842140f
### Lohkoketjuanalyysin menetelmät

On tärkeää ymmärtää, että lohkoketjuanalyysi ei ole tarkka tiede. Se perustuu aiemmista havainnoista tai loogisista tulkinnoista johdettuihin heuristiikkoihin. Näiden sääntöjen avulla saadaan melko luotettavia tuloksia, mutta ei koskaan absoluuttisen tarkkoja. Toisin sanoen **lohkoketjuanalyysiin sisältyy aina todennäköisyysulottuvuus annetuissa päätelmissä**. Voidaan esimerkiksi arvioida suuremmalla tai pienemmällä varmuudella, että kaksi osoitetta kuuluu samalle taholle, mutta täysi varmuus on aina saavuttamattomissa.

Lohkoketjuanalyysin päätavoitteena on nimenomaan erilaisten heuristiikkojen yhdistäminen virheriskin minimoimiseksi. Kyse on tavallaan todisteiden kasautumisesta, jonka avulla pääsemme lähemmäs todellisuutta.

Nämä kuuluisat heuristiikat voidaan ryhmitellä useisiin luokkiin, joita käsittelemme yksityiskohtaisesti yhdessä:


- Transaktiomallit (tai transaktiomallit);**
- Tapahtuman sisäiset heuristiikat;**
- Tapahtuman ulkopuoliset heuristiikat.**

### Satoshi Nakamoto ja lohkoketjuanalyysi

On huomattava, että Satoshi Nakamoto löysi itse kaksi ensimmäistä ketjuanalyysin heuristiikkaa. Hän käsittelee niitä Bitcoinin valkoisen kirjan osassa 10. Nämä ovat:


- common Input Property Heuristics (CIOH);
- ja osoitteiden uudelleenkäyttö.

![BTC204](assets/fr/031.webp)

Lähde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Seuraavissa luvuissa selvitämme, mistä tässä on kyse, mutta on jo nyt mielenkiintoista huomata, että nämä kaksi heuristiikkaa ovat edelleen tärkeässä asemassa ketjuanalyysissä.

## Tapahtumamallit

<chapterId>d365a101-2d37-46a5-bfb9-3c51e37bf96b</chapterId>

Transaktiomalli on yksinkertaisesti lohkoketjusta löytyvä tyypillisen transaktion yleinen malli tai rakenne, jonka tulkinta on oletettavasti tiedossa. Kun tutkimme malleja, keskitymme yksittäiseen transaktioon, jota analysoimme korkealla tasolla.

Toisin sanoen tarkastelemme ainoastaan UTXO:iden määrää syötteissä ja UTXO:iden määrää tuotoksissa, mutta emme keskity tapahtuman tarkempiin yksityiskohtiin tai ympäristöön. Havaitun mallin perusteella pystymme tulkitsemaan tapahtuman luonteen. Sen jälkeen etsimme sen rakenteesta piirteitä ja päätämme tulkinnan.

![BTC204](assets/it/32/01.webp)

Tässä osassa tutustumme yhdessä tärkeimpiin transaktiomalleihin, joita voi esiintyä ketjuanalyysissä, ja annan kunkin mallin osalta todennäköisen tulkinnan rakenteesta sekä konkreettisen esimerkin.

### Yksinkertainen lähettäminen (tai yksinkertainen maksaminen)

Aloitetaan hyvin suositusta mallista, sillä se esiintyy useimmissa bitcoin-maksuissa. Yksinkertaiselle maksumallille on ominaista, että se kuluttaa yhden tai useamman UTXO:n syötteinä ja tuottaa 2 UTXO:ta tuotoksina. Tämä malli näyttää siis seuraavalta:

![BTC204](assets/it/32/02.webp)

Kun tunnistamme tämän transaktiorakenteen lohkoketjusta, voimme jo tehdä tulkinnan. Kuten nimestä voi päätellä, tämä kuvio osoittaa, että kyseessä on lähetä tai maksa -tapahtuma. Käyttäjä on kuluttanut UTXO:nsa tulona tyydyttääkseen tulona maksun UTXO:n ja muutoksen UTXO:n (samalle käyttäjälle palautettu raha).

Näin ollen tiedämme, että havaittu käyttäjä ei todennäköisesti enää omista toista kahdesta ulostulon UTXO:sta (maksun UTXO), mutta hänellä on edelleen toinen UTXO (muutoksen UTXO).

Tällä hetkellä meidän on mahdotonta määritellä, mikä ulostulo edustaa mitäkin UTXO:ta, koska tämä ei ole mallien tutkimisen tavoite. Saavutamme tämän tavoitteen tukeutumalla heuristiikkoihin, joita tutkimme seuraavissa osissa. Tässä vaiheessa tavoitteemme rajoittuu kyseisen tapahtuman luonteen tunnistamiseen, joka tässä tapauksessa on yksinkertainen lähetys.

Tässä on esimerkiksi Bitcoin-tapahtuma, jossa käytetään yksinkertaista lähetysmallia:

```plaintext
b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769
```

![BTC204](assets/it/32/03.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769)

Tämän ensimmäisen esimerkin jälkeen sinulla pitäisi olla parempi käsitys siitä, mitä "transaktiomallin" tutkiminen tarkoittaa Tutkimme transaktiota keskittymällä vain sen rakenteeseen ottamatta huomioon sen ympäristöä tai transaktiokohtaisia yksityiskohtia. Tarkastelemme sitä vain globaalisti tässä ensimmäisessä vaiheessa.

Nyt kun olet ymmärtänyt, mikä malli on, siirrymme muihin olemassa oleviin malleihin.

### Nuohous

Tälle toiselle mallille on ominaista, että se kuluttaa syötteenä yhden UTXO:n ja tuottaa tuotoksena yhden UTXO:n.

![BTC204](assets/it/32/04.webp)

Tämän mallin tulkinta on, että kyseessä on automaattinen siirto. Käyttäjä on siirtänyt bitcoininsa itselleen, toiseen omistamaansa osoitteeseen. Koska transaktiossa ei ole jäännösosuutta, on hyvin epätodennäköistä, että kyseessä on maksu. Itse asiassa maksun yhteydessä on lähes mahdotonta, että maksajalla olisi UTXO, joka vastaa täsmälleen myyjän pyytämää summaa, johon on lisätty transaktiomaksut. Yleensä maksaja joutuu siksi tuottamaan jäännöstuloksen.

Näin ollen tiedämme, että kyseinen UTXO on todennäköisesti edelleen havaitun käyttäjän hallussa. Ketjuanalyysin yhteydessä, jos tiedämme, että transaktiossa syötteenä käytetty UTXO kuuluu Alicelle, voimme olettaa, että myös tuotoksena oleva UTXO kuuluu Alicelle. Myöhemmin on mielenkiintoista löytää transaktion sisäisiä heuristiikkoja, jotka voivat vahvistaa tätä oletusta (näitä heuristiikkoja tarkastellaan kohdassa 3.3).

Tässä on esimerkiksi Bitcoin-tapahtuma, joka noudattaa pyyhkäisymallia:

```plaintext
35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d
```

![BTC204](assets/it/32/05.webp)

Lähde:[Mempool.space](https://mempool.space/fr/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d) Tämäntyyppinen kuvio voi kuitenkin paljastaa myös itse tehdyn siirron kryptovaluuttapörssin tilille. Vasta tunnettujen osoitteiden ja tapahtuman kontekstin tutkiminen antaa meille mahdollisuuden tietää, onko kyseessä konsolidointi omavaraisuuslompakkoon vai nosto alustalle. Vaihtofoorumien osoitteet ovat nimittäin usein helposti tunnistettavissa.

Palataanpa Alicen esimerkkiin: jos yhdistäminen johtaa tunnetun alustan (esimerkiksi Binance) osoitteeseen, tämä voi tarkoittaa, että bitcoinit on siirretty Alicen välittömästä hallussapidosta, luultavasti tarkoituksenaan myydä ne tai säilyttää ne kyseisellä alustalla. Toisaalta, jos kohdeosoite on tuntematon, on järkevää olettaa, että kyseessä on yksinkertaisesti toinen lompakko, joka edelleen kuuluu Alicelle. Tämäntyyppinen tutkimus kuuluu kuitenkin pikemminkin heuristiikan eikä mallien tutkimisen kategoriaan.

### Konsolidointi

Tälle mallille on ominaista, että se kuluttaa syötteenä useita UTXO:ita ja tuottaa tuloksena yhden UTXO:n.

![BTC204](assets/it/32/06.webp)

Tämän kuvion tulkinta on, että olemme konsolidoitumassa. Tämä on Bitcoin-käyttäjien yleinen käytäntö yhdistää useita UTXO:ita ennakoiden mahdollista transaktiomaksujen nousua. Suorittamalla tämä operaatio aikana, jolloin maksut ovat alhaiset, on mahdollista säästää tulevissa maksuissa. Keskustelemme tästä käytännöstä lisää luvussa 4.3.

Voimme päätellä, että tämän tapahtumamallin takana oleva käyttäjä on todennäköisesti saanut kaikki syötetyt UTXO:t ja että hänellä on edelleen hallussaan myös tulostettu UTXO. Tämä on ehdottomasti automaattinen siirto.

Aivan kuten konsolidointi, tämäntyyppinen kuvio voi myös paljastaa itsesiirron pörssialustan tilille. Tunnettujen osoitteiden ja tapahtuman kontekstin tutkiminen antaa meille mahdollisuuden tietää, onko kyse konsolidoinnista omatoimilompakkoon vai nostosta alustalle.

Tässä on esimerkiksi Bitcoin-tapahtuma, jossa käytetään konsolidointijärjestelmää:

```plaintext
77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94
```

![BTC204](assets/it/32/07.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)

Ketjuanalyysin yhteydessä tämä malli voi paljastaa paljon tietoa. Jos esimerkiksi tiedämme, että yksi panoksista kuuluu Liisalle, voimme olettaa, että kaikki muutkin tämän liiketoimen panokset ja tuotokset kuuluvat hänelle. Tämän oletuksen avulla voimme sitten jäljittää aiempia tapahtumaketjuja löytääksemme ja analysoidaksemme muita tapahtumia, jotka todennäköisesti liittyvät Liisaan.

![BTC204](assets/it/32/08.webp)

### Ryhmitellyt menot

Tälle mallille on ominaista muutaman UTXO:n kulutus panoksena (usein vain yksi) ja lukuisten UTXO:iden tuotanto tuotoksena.

![BTC204](assets/it/32/09.webp)

Tämän mallin tulkinta on, että kyseessä on niputettu kulutus. Tämä on käytäntö, joka todennäköisesti paljastaa merkittävää taloudellista toimintaa, kuten vaihtofoorumi. Ryhmitettyjen menojen ansiosta nämä yksiköt voivat säästää maksuissa yhdistämällä menonsa yhdeksi tapahtumaksi.

Tästä mallista voidaan päätellä, että UTXO-panos tulee yrityksestä, jolla on merkittävää taloudellista toimintaa, ja että UTXO-tuotokset hajautuvat. Monet niistä kuuluvat yrityksen asiakkaille, jotka ovat nostaneet bitcoineja alustalta. Toiset voivat mennä kumppaniyrityksille. Lopuksi on varmasti yksi tai useampi vaihto, joka palaa liikkeeseen laskevalle yritykselle.

Tässä on esimerkiksi Bitcoin-tapahtuma, jossa käytetään ryhmiteltyä kulutusmallia (todennäköisesti kyseessä on Bybit-alustan myöntämä tapahtuma):

```plaintext
8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43
```

![BTC204](assets/it/32/10.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Protokollakohtaiset tapahtumat

Tapahtumakuvioista voidaan myös tunnistaa kuvioita, jotka paljastavat tietyn protokollan käytön. Esimerkiksi Whirlpool coinjoineilla (joita käsittelemme osassa 5) on helposti tunnistettava rakenne, jonka avulla ne voidaan erottaa muista perinteisemmistä transaktioista.

![BTC204](assets/it/32/11.webp)

Tämän mallin analysointi viittaa siihen, että kyseessä on todennäköisesti yhteistyöhön perustuva liiketoimi. On myös mahdollista havaita coinjoin. Jos jälkimmäinen hypoteesi osoittautuu oikeaksi, tulosteiden määrä voi antaa karkean arvion coinjoin-osallistujien määrästä.

Tässä on esimerkiksi Bitcoin-tapahtuma, jossa käytetään coinjoin-yhteistyötapahtuman tyyppimallia:

```plaintext
00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea
```

![BTC204](assets/it/32/12.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)

On olemassa monia muita protokollia, joilla on omat erityiset rakenteensa. Niinpä voisimme erottaa esimerkiksi Wabisabi-tyyppiset transaktiot, Stamps-transaktiot tai jopa Runes-tyyppiset transaktiot.

Näiden tapahtumamallien ansiosta voimme jo tulkita tietyn määrän tietoa tietystä tapahtumasta. Tapahtuman rakenne ei kuitenkaan ole ainoa tietolähde, jota voidaan analysoida. Voimme tutkia myös sen yksityiskohtia. Näitä transaktion sisäisiä yksityiskohtia kutsun mielelläni "sisäisiksi heuristiikoiksi", ja tutkimme niitä seuraavassa luvussa.

## Sisäiset heuristiikat

<chapterId>c54b5abe-872f-40f4-a0d0-c59faff228ba</chapterId>

Sisäinen heuristiikka on erityinen piirre, joka on tunnistettu tapahtumassa itsessään ilman, että sen ympäristöä tarvitsee tutkia, ja jonka avulla voimme tehdä johtopäätöksiä. Toisin kuin mallit, joissa keskitytään transaktion yleiseen rakenteeseen korkealla tasolla, sisäiset heuristiikat perustuvat poimittavien tietojen joukkoon. Näitä ovat mm:


- Eri UTXO:iden määrät sisään ja ulos;
- Kaikki skripteistä: osoitteiden vastaanottaminen, versiointi, lukitusajat jne.

Yleensä tämäntyyppisen heuristiikan avulla voidaan tunnistaa tietyn liiketoimen loppuosa. Näin voimme jatkaa kokonaisuuden jäljittämistä useiden tapahtumien kautta. Jos tunnistamme UTXO:n, joka kuuluu käyttäjälle, jota haluamme seurata, on ratkaisevan tärkeää määrittää, mikä tuotos on siirretty toiselle käyttäjälle ja mikä tuotos edustaa jäännöstä ja on siten edelleen käyttäjän hallussa.

![BTC204](assets/it/33/01.webp)

Muistutan jälleen kerran, että nämä heuristiikat eivät ole missään nimessä tarkkoja. Yksittäin tarkasteltuna niiden avulla voimme vain tunnistaa uskottavia skenaarioita. Erilaisten heuristiikkojen kasautuminen auttaa vähentämään epävarmuutta, mutta ei koskaan poistamaan sitä kokonaan.

### Sisäiset yhtäläisyydet

Tässä heuristiikassa tutkitaan saman liiketoimen tulojen ja lähtöjen samankaltaisuuksia. Jos havaitsemme saman ominaisuuden syötteissä ja vain yhdessä tapahtuman tuotoksista, on todennäköistä, että tämä tuotos muodostaa loput.

Ilmeisin ominaisuus on vastaanottavan osoitteen uudelleenkäyttö samassa tapahtumassa.

![BTC204](assets/it/33/02.webp)

Tämä heuristiikka ei jätä juurikaan tilaa epäilyille. Ellei yksityistä avainta ole hakkeroitu, sama vastaanottava osoite paljastaa väistämättä yhden käyttäjän toiminnan. Tästä seuraa tulkinta, jonka mukaan loput tapahtumasta on tulostettu samalla osoitteella kuin syötetty. Tämä mahdollistaa yksilön jatkuvan jäljittämisen tämän lopun perusteella.

Tässä on esimerkiksi tapahtuma, johon tätä heuristiikkaa voidaan soveltaa järkevästi:

```plaintext
54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0
```

![BTC204](assets/fr/046.webp)

Fonte: [Mempool.space](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Nämä yhtäläisyydet syötteen ja tulosteen välillä eivät lopu osoitteen uudelleenkäyttöön. Kaikki skriptien käytön samankaltaisuudet voivat mahdollistaa heuristiikan soveltamisen. Joskus voidaan esimerkiksi havaita sama versiointi syötteen ja jonkin tapahtuman tuotoksen välillä.

![BTC204](assets/it/33/04.webp)

Tässä kaaviossa näkyy, että syöttö nro 0 avaa P2WPKH-skriptin (SegWit V0, joka alkaa kirjaimella `bc1q`). Lähtö nro 0 käyttää samantyyppistä skriptiä. Lähtö nro 1 käyttää kuitenkin P2TR-skriptiä (SegWit V1, joka alkaa kirjaimella `bc1p`). Tämän ominaisuuden tulkinta on, että on todennäköistä, että osoite, jolla on sama versiointi kuin syötteellä, on lopun osoite. Se kuuluisi siis edelleen samalle käyttäjälle.

Tässä on yksi liiketoimi, johon tätä heuristiikkaa voidaan soveltaa järkevästi:

```plaintext
db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578
```

![BTC204](assets/fr/048.webp)

Fonte: [Mempool.space](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)

Tässä tapauksessa voimme nähdä, että tulo nro 0 ja lähtö nro 1 käyttävät P2WPKH-skriptejä (SegWit V0), kun taas lähtö nro 0 käyttää toisenlaista skriptityyppiä, P2PKH (Legacy). 2010-luvun alussa tämä skriptiversioon perustuva heuristiikka oli suhteellisen hyödytön käytettävissä olevien skriptityyppien rajallisuuden vuoksi. Ajan myötä ja Bitcoinin myöhempien päivitysten myötä skriptityyppien kirjo on kuitenkin kasvanut. Tästä heuristiikasta on tulossa yhä merkityksellisempi, koska skriptityyppien laajemman valikoiman myötä käyttäjät jakautuvat pienempiin ryhmiin, mikä lisää mahdollisuuksia soveltaa tätä sisäisen version uudelleenkäytön heuristiikkaa. Tästä syystä jo pelkästään yksityisyyden suojan kannalta on suositeltavaa valita yleisin käsikirjoitustyyppi. Esimerkiksi näitä rivejä kirjoittaessani Taproot-skriptejä (`bc1p`) käytetään harvemmin kuin SegWit V0 -skriptejä (`bc1q`). Vaikka edelliset tarjoavat taloudellisia ja yksityisyyden suojaa koskevia etuja tietyissä erityistilanteissa, perinteisemmissä yhden allekirjoituksen käyttötarkoituksissa voi olla viisasta pitäytyä vanhemmassa standardissa yksityisyyden suojaan liittyvistä syistä siihen asti, kunnes uusi standardi otetaan laajemmin käyttöön.

### Maksut pyöristetyillä luvuilla

Toinen sisäinen heuristiikka, joka voi auttaa meitä tunnistamaan jäännösluvun, on pyöristetty luku. Kun kyseessä on yksinkertainen maksujärjestelmä (1 tulo ja 2 lähtöä), jos jompikumpi tuloista käyttää pyöristetyn summan, se edustaa yleensä maksua.

![BTC204](assets/it/33/06.webp)

Eliminoimalla voidaan todeta, että jos toinen tuotos edustaa maksua, toinen edustaa muutosta. Näin ollen voidaan päätellä, että on todennäköistä, että tapahtuman syöttäneellä käyttäjällä on edelleen hallussaan muutokseksi tunnistettu tuotos.

On huomattava, että tämä heuristiikka ei ole aina sovellettavissa, sillä useimmat maksut suoritetaan edelleen fiat-valuuttayksiköissä. Itse asiassa, kun ranskalainen kauppias hyväksyy bitcoinin, hän ei yleensä näytä vakaita hintoja sateina. Hän valitsee mieluummin euromääräisen hinnan ja maksettavan bitcoin-summan välisen muuntamisen. Siksi transaktion tulosteessa ei pitäisi olla pyöristettyä lukua.

Analyytikko voi kuitenkin yrittää tehdä tämän muuntamisen ottamalla huomioon valuuttakurssin, joka oli voimassa sillä hetkellä, kun tapahtuma lähetettiin verkon kautta. Esimerkkinä voidaan ottaa transaktio, jonka panos on 97,552 satsia ja kaksi tulosta, joista toinen on 31,085 satsia ja toinen 64,152 satsia. Ensisilmäyksellä tämä tapahtuma ei näytä sisältävän pyöristettyjä määriä. Soveltamalla 64,339 euron vaihtokurssia tapahtumahetkellä saadaan kuitenkin seuraavanlainen euromääräinen muunnos:


- Panos on 62,76 euroa;
- Tuotos on 20 euroa;
- Tuotos on 41,27 euroa.

Kun maksutapahtuma on muunnettu fiat-valuutaksi, se mahdollistaa pyöristettyjen summien maksamisen heuristiikan soveltamisen. Tulos 20 euroa oli todennäköisesti tarkoitettu kauppiaalle tai muutoin vaihtanut omistajaa. Tästä voidaan päätellä, että 41,27 euron tulo jäi todennäköisesti alkuperäisen käyttäjän haltuun.

![BTC204](assets/it/33/07.webp)

Jos jonain päivänä Bitcoinista tulee ensisijainen laskentayksikkö liiketoimissamme, tämä heuristiikka voi olla entistäkin hyödyllisempi analyysin kannalta.

Tässä on esimerkiksi tapahtuma, johon tätä heuristiikkaa voidaan todennäköisesti soveltaa:

```plaintext
2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a
```

![BTC204](assets/fr/051.webp)

Fonte: [Mempool.space](https://mempool.space/tx/2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a)

### Suurin tuotos

Kun yksinkertaisessa maksumallissa tapahtuman kahden tuotoksen välillä on huomattavan suuri ero, voidaan arvioida, että suurempi tuotos on todennäköisesti jäännös.

![BTC204](assets/it/33/09.webp)

Tämä suurimman tuotoksen heuristiikka on luultavasti kaikista epätarkin. Yksin tunnistettuna se on melko heikko. Tämä ominaisuus voidaan kuitenkin yhdistää muihin heuristiikkoihin tulkintamme epävarmuuden vähentämiseksi.

Jos esimerkiksi tarkastelemme tapahtumaa, jossa on yksi suorite, jossa on pyöreä määrä, ja toinen suorite, jossa on suurempi määrä, voimme vähentää epävarmuutta soveltamalla yhdessä pyöreisiin maksuihin liittyviä heuristiikkoja ja suurempaan suoritteeseen liittyviä heuristiikkoja.

Tässä on esimerkiksi tapahtuma, johon tätä heuristiikkaa voidaan todennäköisesti soveltaa:

```plaintext
b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf
```

![BTC204](assets/fr/053.webp)

Fonte: [Mempool.space](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Ulkoiset heuristiikat

<chapterId>4a170e3b-200d-431a-8285-18a23ff617ba</chapterId>

Ulkoisten heuristiikkojen tutkimiseen kuuluu tiettyjen sellaisten elementtien samankaltaisuuksien, mallien ja ominaisuuksien analysointi, jotka eivät liity itse liiketoimintaan. Toisin sanoen, jos aiemmin rajoituimme hyödyntämään liiketoimelle ominaisia elementtejä sisäisten heuristiikkojen avulla, laajennamme nyt analyysikenttäämme liiketoimen ympäristöön ulkoisten heuristiikkojen avulla.

### Osoitteiden uudelleenkäyttö

Tämä on yksi tunnetuimmista heuristiikoista Bitcoin-harrastajien keskuudessa. Osoitteiden uudelleenkäyttö mahdollistaa yhteyden luomisen eri transaktioiden ja eri UTXO:iden välille. Se havaitaan, kun Bitcoinin vastaanottoosoitetta käytetään useita kertoja.

Näin ollen on mahdollista hyödyntää osoitteiden uudelleenkäyttöä saman tapahtuman sisällä sisäisenä heuristisena keinona tunnistaa loput (kuten edellisessä luvussa todettiin). Osoitteiden uudelleenkäyttöä voidaan kuitenkin käyttää myös ulkoisena heuristiikkana, jonka avulla voidaan tunnistaa useiden transaktioiden takana olevan kokonaisuuden ainutlaatuisuus.

Osoitteen uudelleenkäytön tulkinta on, että kaikki tähän osoitteeseen lukitut UTXO:t kuuluvat (tai ovat kuuluneet) samalle yksikölle. Tämä heuristiikka jättää vain vähän tilaa epävarmuudelle. Kun se voidaan tunnistaa, seuraava tulkinta vastaa todennäköisimmin todellisuutta. Näin ollen se mahdollistaa erilaisten ketjussa tapahtuvien toimintojen klusteroinnin.

![BTC204](assets/it/34/01.webp)

Kuten tämän osan 3 johdannossa selitetään, tämän heuristiikan löysi Satoshi Nakamoto itse. Valkoisessa kirjassa hän mainitsee nimenomaan ratkaisun, jolla käyttäjät voivat välttää sen, eli yksinkertaisesti käyttää uutta osoitetta jokaista uutta transaktiota varten:

"_Lisäsuojana voitaisiin käyttää uutta avainparia jokaiselle tapahtumalle, jotta niitä ei voitaisi yhdistää yhteiseen omistajaan._"

![BTC204](assets/fr/055.webp)

Lähde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Tässä on esimerkiksi osoite, jota käytetään uudelleen useissa tapahtumissa:

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

Lähde:[Mempool.space](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Skriptien ja lompakoiden sormenjälkien samankaltaisuus

Osoitteiden uudelleenkäytön lisäksi on olemassa useita muita heuristiikkoja osakkeiden liittämiseksi samaan salkkuun tai osoitekokonaisuuteen.

Ensinnäkin analyytikko voi hyödyntää käsikirjoitusten käytön samankaltaisuuksia. Esimerkiksi tietyt vähemmistöskriptit, kuten multisig, voidaan tunnistaa helpommin kuin SegWit V0 -skriptit. Mitä suurempaan ryhmään piiloudumme, sitä vaikeampi meitä on tunnistaa. Tämän vuoksi hyvissä Coinjoin-protokollissa kaikki osallistujat käyttävät täsmälleen samantyyppisiä skriptejä.

Yleisemmin analyytikko voi myös keskittyä salkun sormenjälkiominaisuuksiin. Nämä ovat erityisiä käyttöön liittyviä prosesseja, joita voidaan yrittää tunnistaa ja hyödyntää niitä seurantaheuristiikoina. Toisin sanoen, jos havaitaan samojen sisäisten ominaisuuksien kasautumista seurattavaan yksikköön liitetyissä transaktioissa, voidaan yrittää tunnistaa samat ominaisuudet muista transaktioista.

Voidaan esimerkiksi havaita, että jäljitetty käyttäjä lähettää järjestelmällisesti loput P2TR-osoitteisiin (`bc1p...`). Jos tämä prosessi toistuu, sitä voidaan käyttää heuristiikkana analyysin jatkamisessa. Myös muita sormenjälkiä voidaan käyttää, kuten UTXO:iden järjestystä, jäännösosuuksien sijoittamista lähdöissä, RBF (Replace-by-Fee) -signaalia tai jopa versionumeroa, `nSequence`-kenttää ja `nLockTime`-kenttää.

Kuten [@LaurentMT](https://twitter.com/LaurentMT) toteaa [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (ranskankielinen podcast), lompakon sormenjälkien hyödyllisyys ketjuanalyysissä kasvaa merkittävästi ajan myötä. Eroja korostavat todellakin käsikirjoitustyyppien lisääntyvä määrä ja lompakko-ohjelmistojen yhä asteittaisempi näiden uusien ominaisuuksien käyttöönotto. Saattaa jopa olla niin, että seurattavan yksikön käyttämä ohjelmisto voidaan tunnistaa tarkasti. Siksi on tärkeää ymmärtää, että lompakon digitaalisen jalanjäljen tutkiminen osoittautuu erityisen merkitykselliseksi viimeaikaisten transaktioiden osalta, enemmän kuin 2010-luvun alussa aloitettujen transaktioiden osalta.

Yhteenvetona voidaan todeta, että sormenjälki voi olla mikä tahansa erityinen käytäntö, jonka lompakko suorittaa automaattisesti tai käyttäjä manuaalisesti ja joka voidaan löytää muista tapahtumista analyysin helpottamiseksi.

### Panosten yhteisen omistuksen heuristiikka (CIOH)

CIOH on englanninkielinen termi "Common Input Ownership Heuristic", joka tarkoittaa, että kun transaktio sisältää useita panoksia, ne ovat todennäköisesti peräisin yhdeltä taholta. Näin ollen niiden omistus on yhteinen.

Sovellettaessa panosten yhteistä omistusheuristiikkaa (Common Ownership Heuristics of Inputs, CIOH) havaitsemme ensin liiketoimen, jolla on useita panoksia. Tämä voi olla vähintään 2 ja enintään 30 panosta. Kun tämä ominaisuus on tunnistettu, tarkistetaan, sopiiko liiketoimi johonkin tunnettuun liiketoimimalliin. Jos siinä on esimerkiksi 5 panosta, joiden määrät ovat suunnilleen yhtä suuret, ja 5 tulosta, joiden määrät ovat täsmälleen samat, tiedämme, että kyseessä on coinjoin-transaktio. Siksi emme voi soveltaa IOCH:ta.

Jos tapahtuma ei kuitenkaan sovi mihinkään tunnettuun yhteistoiminnallisen tapahtuman malliin, voimme päätellä, että kaikki syötteet ovat todennäköisesti peräisin samasta tahosta. Tämä voi olla erittäin hyödyllistä tunnetun klusterin laajentamisessa tai seurannan jatkamisessa.

CIOH:n löysi Satoshi Nakamoto. Hän käsittelee tätä valkoisen kirjan osassa 10:

"_[...] kytkentä on väistämätöntä, kun on kyse usean panoksen liiketoimista, joista käy väistämättä ilmi, että niiden panokset omisti sama omistaja. Riskinä on, että jos avaimen omistaja paljastuu, linkitykset voivat paljastaa muita samalle omistajalle kuuluneita transaktioita._"

On erityisen kiehtovaa huomata, että Satoshi Nakamoto oli jo ennen Bitcoinin virallista julkaisua tunnistanut kaksi tärkeintä käyttäjien yksityisyyden suojaan liittyvää haavoittuvuutta, nimittäin IOCH:n ja osoitteiden uudelleenkäytön. Tällainen ennuste on varsin merkittävä, sillä nämä kaksi heuristiikkaa ovat edelleen tähän päivään asti hyödyllisimpiä lohkoketjujen analysoinnissa.

Esimerkkinä tässä on tapahtuma, johon voimme todennäköisesti soveltaa IOCH:ää:

```plaintext
20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712
```

Fonte: [Mempool.space](https://mempool.space/tx/20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712)

### Offchain-tiedot

Ketjussa tapahtuva analyysi ei tietenkään rajoitu pelkästään ketjussa oleviin tietoihin. Analyysin tarkentamiseen voidaan käyttää myös aiemmista analyyseistä saatuja tai Internetissä saatavilla olevia tietoja.

Jos esimerkiksi havaitaan, että seurattavat transaktiot lähetetään järjestelmällisesti samasta Bitcoin-solmusta ja sen IP-osoite voidaan tunnistaa, saattaa olla mahdollista tunnistaa muita samasta yksiköstä peräisin olevia transaktioita sekä määrittää osa lähettäjän henkilöllisyydestä. Vaikka tätä käytäntöä ei ole helppo toteuttaa, koska se vaatii useita solmuja, on mahdollista, että jotkut ketjuanalyysiin erikoistuneet yritykset käyttävät sitä.

Analyytikko voi myös tukeutua aiemmin avoimen lähdekoodin kautta tehtyihin analyyseihin tai omiin aiempiin analyyseihinsa. Kenties voitaisiin löytää tuloste, joka osoittaa jo tunnistettuun osoiteklusteriin. Joskus on myös mahdollista tukeutua tulosteeseen, joka viittaa vaihtofoorumiin, sillä näiden yritysten osoitteet ovat yleisesti tiedossa.

Vastaavasti voidaan suorittaa analyysi eliminoimalla. Jos esimerkiksi analysoitaessa tapahtumaa, jossa on kaksi ulostuloa, toinen niistä on yhteydessä jo tunnettuun, mutta seurattavasta yksiköstä erilliseen osoiteklusteriin, voidaan tulkita, että toinen ulostulo edustaa todennäköisesti loput.

Ketjuanalyysi sisältää myös OSINT:n (_Open Source Intelligence_) osan, joka on hieman yleisluontoisempi internet-hakujen kanssa. Tämän vuoksi ei ole suositeltavaa julkaista vastaanottoosoitteita suoraan sosiaalisessa mediassa tai verkkosivuilla, olipa kyseessä sitten salanimi tai ei.

![BTC204](assets/fr/063.webp)

### Ajalliset kuviot

Sitä ei oteta yleisesti huomioon, mutta tietyt ihmisten käyttäytymismallit ovat tunnistettavissa ketjussa. Analysoinnissa hyödyllisin saattaa olla nukkumistottumuksesi! Kyllä, kun nukut, et oletettavasti lähetä Bitcoin-tapahtumia. Koska nukut yleensä samoihin aikoihin, on yleistä käyttää ajallista analyysia ketjussa tapahtuvassa analyysissä. Siinä yksinkertaisesti luetteloidaan ajat, jolloin tietyn tahon transaktiot lähetetään Bitcoin-verkkoon. Analysoimalla näitä ajallisia malleja voimme päätellä paljon tietoa.

Ensinnäkin ajallinen analyysi tunnistaa joskus seurattavan kokonaisuuden luonteen. Jos havaitaan, että liiketoimia siirretään johdonmukaisesti 24 tunnin ajan, tämä paljastaa vahvan taloudellisen toiminnan. Näiden liiketoimien takana oleva yksikkö on todennäköisesti yritys, joka on mahdollisesti kansainvälinen ja jolla on ehkä sisäisesti automatisoituja menettelyjä.

Esimerkiksi [olin tunnistanut tämän kuvion muutama kuukausi sitten](https://twitter.com/Loic_Pandul/status/1701127409712452072) analysoimalla [transaktiota, jossa oli virheellisesti jaettu 19 bitcoinia maksuja](https://mempool.space/tx/d5392d474b4c436e1c9d1f4ff4be5f5f9bb0eb2e26b61d2781751474b7e870fd). Yksinkertaisen ajallisen analyysin avulla olin voinut olettaa, että kyseessä oli automatisoitu palvelu ja siten todennäköisesti suuri yksikkö, kuten vaihtopalvelu.

Itse asiassa muutamaa päivää myöhemmin selvisi, että varat kuuluivat PayPalille Paxos-vaihtofoorumin kautta.

Jos taas havaitsemme, että aikakuvio jakautuu 16 hyvin tarkkaan määritellylle tunnille, voimme arvioida, että kyseessä on yksittäinen käyttäjä tai ehkäpä paikallinen yritys riippuen kaupan määrästä.

Havaitun kokonaisuuden luonteen lisäksi ajallinen malli voi antaa meille myös käyttäjän likimääräisen sijainnin aikavyöhykkeiden avulla. Tämän jälkeen voimme yhdistää muita tapahtumia ja käyttää niiden aikaleimoja lisäheuristiikkana, jonka voimme lisätä analyysiimme.

Esimerkiksi aiemmin mainitsemassani uudelleenkäytetyssä osoitteessa voidaan havaita, että sekä saapuvat että lähtevät tapahtumat keskittyvät 13 tunnin välein.

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

![BTC204](assets/fr/064.webp)

Lähde: OXT.me

Tämä alue vastaa todennäköisesti Eurooppaa, Afrikkaa tai Lähi-itää. Voimme siis päätellä, että näiden tapahtumien takana oleva käyttäjä asuu siellä.

Toisessa rekisterissä juuri tällainen aika-analyysi mahdollisti sen hypoteesin, että Satoshi Nakamoto ei toiminutkaan Japanista käsin vaan Yhdysvalloista käsin: [_The Time Zones of Satoshi Nakamoto_] (https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

## Käytännön sovellus Block Explorerilla

<chapterId>6493cf2f-225c-405f-9375-c4304f1087ed</chapterId>

Tässä viimeisessä luvussa sovellamme konkreettisesti tähän mennessä opiskelemiamme käsitteitä. Esittelen esimerkkejä todellisista Bitcoin-tapahtumista, ja sinun on kerättävä pyytämäni tiedot.

Ihannetapauksessa näissä harjoituksissa olisi suositeltavaa käyttää ammattimaista ketjuanalyysityökalua. Samourai Walletin luojien lopetettua toimintansa ainoa ilmainen analyysityökalu OXT.me ei kuitenkaan ole enää saatavilla. Siksi valitsemme näihin harjoituksiin klassisen lohko-etsintäohjelman. Suosittelen käyttämään [Mempool.space](https://mempool.space/) sen monien ominaisuuksien ja ketjuanalyysityökalujen valikoiman vuoksi, mutta voit myös valita jonkin muun etsintäohjelman, kuten [Bitcoin Explorer](https://bitcoinexplorer.org/). Aluksi esittelen harjoitukset. Tee ne lohkoexplorerin avulla ja kirjoita vastauksesi paperille. Tämän luvun lopussa annan sitten vastaukset, jotta voit tarkistaa ja korjata tuloksesi.

_Näihin harjoituksiin valitut liiketoimet valittiin yksinomaan niiden ominaisuuksien perusteella jokseenkin sattumanvaraisesti. Tämä luku on tarkoitettu ainoastaan opetus- ja tiedotustarkoituksiin. Haluan tehdä selväksi, etten suosittele tai kannusta käyttämään näitä työkaluja haitallisiin tarkoituksiin. Tarkoituksena on opettaa, miten voit suojautua ketjuanalyysiltä, ei tehdä analyysejä muiden yksityisten tietojen paljastamiseksi._

### Harjoitus 1

Analysoitavan tapahtuman tunnus:

```plaintext
3769d3b124e47ef4ffb5b52d11df64b0a3f0b82bb10fd6b98c0fd5111789bef7
```

Mikä on tämän tapahtuman mallinimi ja mitä uskottavia tulkintoja voidaan tehdä tarkastelemalla vain sen mallia eli tapahtuman rakennetta?

### Harjoitus 2

Analysoitavan tapahtuman tunnus:

```plaintext
baa228f6859ca63e6b8eea24ffad7e871713749d693ebd85343859173b8d5c20
```

Mikä on tämän tapahtuman mallinimi ja mitä uskottavia tulkintoja voidaan tehdä tarkastelemalla vain sen mallia eli tapahtuman rakennetta?

### Harjoitus 3

Analysoitavan tapahtuman tunnus:

```plaintext
3a9eb9ccc3517cc25d1860924c66109262a4b68f4ed2d847f079b084da0cd32b
```

Mikä on tämän liiketoimen malli?

Kun olet tunnistanut sen mallin käyttäen transaktion sisäisiä heuristiikkoja, mikä tuloste todennäköisesti edustaa loput?

### Harjoitus 4

Analysoitavan tapahtuman tunnus:

```plaintext
35f0b31c05503ebfdf7311df47f68a048e992e5cf4c97ec34aa2833cc0122a12
```

Mikä on tämän liiketoimen malli?

Kun olet tunnistanut sen mallin käyttäen transaktion sisäisiä heuristiikkoja, mikä tuloste todennäköisesti edustaa loput?

### Harjoitus 5

Kuvittele, että Loïc on julkaissut yhden Bitcoin-osoitteensa maksujen vastaanottamista varten sosiaalisessa verkostossa Twitterissä:

![BTC204](assets/fr/065.webp)

```plaintext
bc1qja0hycrv7g9ww00jcqanhfpqmzx7luqalum3vu
```

Mitä Bitcoin-tapahtumia voimme yhdistää Loïcin henkilöllisyyteen käyttämällä **vain osoitteen uudelleenkäytön heuristiikkaa**?

_Ei ole selvää, että en ole tämän vastaanottavan osoitteen todellinen omistaja enkä julkaissut sitä sosiaalisessa mediassa. Se on osoite, jonka valitsin satunnaisesti lohkoketjusta._

### Harjoitus 6

Harjoituksen 5 jälkeen pystyit tunnistamaan osoitteen uudelleenkäytön heuristiikan avulla useita Bitcoin-tapahtumia, joissa Loïc näyttää olevan mukana. Normaalisti sinun olisi pitänyt tunnistaa tunnistetuista transaktioista tämä:

Tämä tapahtuma on ensimmäinen, joka lähettää varoja Loïcin osoitteeseen. Mistä luulet Loïcin tämän tapahtuman kautta saamien bitcoinien olevan peräisin?

### Harjoitus 7

Harjoituksen 5 jälkeen pystyit tunnistamaan osoitteen uudelleenkäytön heuristiikan avulla useita Bitcoin-tapahtumia, joissa Loïc näyttää olevan mukana. Haluat nyt selvittää, mistä Loïc on tullut. Tee löydettyjen transaktioiden perusteella aika-analyysi löytääksesi Loïcin todennäköisesti käyttämän aikavyöhykkeen. Määritä aikavyöhykkeen perusteella paikka, jossa Loïc näyttää asuvan (maa, osavaltio/alue, kaupunki...).

### Harjoitus 8

Tässä on Bitcoin-tapahtuma tutkittavaksi:

```plaintext
bb346dae645d09d32ed6eca1391d2ee97c57e11b4c31ae4325bcffdec40afd4f
```

Mitä tietoja voimme tulkita, kun tarkastelemme vain tätä liiketapahtumaa?

### Tehtävien ratkaisut

**_Harjoitus 1:_**

Tämän liiketoimen malli on yksinkertainen maksu. Jos tarkastelemme vain sen rakennetta, voimme tulkita, että yksi lähtö edustaa muutosta ja toinen lähtö todellista maksua. Tällöin tiedämme, että havaittu käyttäjä ei todennäköisesti enää omista toista tulosteiden UTXO:ta (maksua varten), mutta hänellä on edelleen hallussaan toinen UTXO (muutosta varten).

**_Harjoitus 2:_**

Tämän tapahtuman malli on eräkulutus. Tämä kuvio viittaa todennäköisesti merkittävään taloudelliseen toimintaan, kuten vaihtofoorumiin. Voimme päätellä, että panoksena oleva UTXO on peräisin yrityksestä, jolla on merkittävää taloudellista toimintaa, ja että tuotoksena olevat UTXO:t hajautuvat. Osa kuuluu yrityksen asiakkaille, jotka ovat nostaneet bitcoininsa itsesäilyttäviin lompakoihin. Toiset voivat mennä kumppaniyrityksille. Lopuksi on varmasti vielä loppuosa, joka palaa liikkeeseen laskevalle yritykselle.

**_Harjoitus 3:_**

Tämän liiketoimen malli on yksinkertainen maksu. Siksi voimme soveltaa tapahtumaan sisäisiä heuristiikkoja ja yrittää tunnistaa loput.

Itse olen tunnistanut ainakin kaksi sisäistä heuristiikkaa, jotka tukevat samaa hypoteesia:


- Samantyyppisen käsikirjoituksen uudelleenkäyttö;
- Suurin tuotanto.

Ilmeisin heuristiikka on samantyyppisten käsikirjoitusten uudelleenkäyttö. Itse asiassa ulostulo `0` on `P2SH`, joka on tunnistettavissa sen vastaanottoosoitteesta, joka alkaa `3`:lla:

```plaintext
3Lcdauq6eqCWwQ3UzgNb4cu9bs88sz3mKD
```

Lähtö `1` on `P2WPKH`, joka on tunnistettavissa sen osoitteesta, joka alkaa `bc1q`:

```plaintext
bc1qya6sw6sta0mfr698n9jpd3j3nrkltdtwvelywa
```

UTXO, jota käytetään syötteenä tässä tapahtumassa, käyttää myös `P2WPKH`-skriptiä:

```plaintext
bc1qyfuytw8pcvg5vx37kkgwjspg73rpt56l5mx89k
```

Voimme siis olettaa, että tuotos `0` vastaa maksua ja tuotos `1` on transaktion loppuosa, mikä tarkoittaisi, että syötteen käyttäjä omistaa edelleen tuotoksen `1`.

Hypoteesin tukemiseksi tai kumoamiseksi voimme etsiä muita heuristiikkoja, jotka vahvistavat ajatteluamme tai vähentävät todennäköisyyttä, että hypoteesimme on oikea.

Olen tunnistanut ainakin yhden toisen heuristiikan. Se on suurin tuotos. Tulos "0" mittaa "123 689 satsia", kun taas tuloksen "1" mittaa "505 839 satsia". Näiden kahden tuloksen välillä on siis merkittävä ero. Suuremman tuotoksen heuristiikka viittaa siihen, että laajempi tuotos on todennäköisesti loput. Tämä heuristiikka vahvistaa siis entisestään alkuperäistä hypoteesiamme.

Vaikuttaa todennäköiseltä, että UTXO-syötteen antaneella käyttäjällä on edelleen hallussaan ulostulo `1`, joka näyttää edustavan loput tapahtumasta.

**_Harjoitus 4:_**

Tämän liiketoimen malli on yksinkertainen maksu. Siksi voimme soveltaa tapahtumaan sisäisiä heuristiikkoja ja yrittää tunnistaa loput.

Olen itse tunnistanut ainakin kaksi sisäistä heuristiikkaa, jotka tukevat samaa hypoteesia:


- Samantyyppisen käsikirjoituksen uudelleenkäyttö;
- Pyöristetyn määrän tulo.

Ilmeisin heuristiikka on samantyyppisten käsikirjoitusten uudelleenkäyttö. Itse asiassa ulostulo `0` on `P2SH`, joka on tunnistettavissa sen vastaanottoosoitteesta, joka alkaa `3`:lla:

```plaintext
3FSH5Mnq6S5FyQoKR9Yjakk3X4KCGxeaD4
```

Lähtö `1` on `P2WPKH`, joka on tunnistettavissa sen osoitteesta, joka alkaa `bc1q`:

```plaintext
bc1qvdywdcfsyavt4v8uxmmrdt6meu4vgeg439n7sg
```

UTXO, jota käytetään syötteenä tässä tapahtumassa, käyttää myös `P2WPKH`-skriptiä:

```plaintext
bc1qku3f2y294h3ks5eusv63dslcua2xnlzxx0k6kp
```

Voimme siis olettaa, että tuotos `0` vastaa maksua ja tuotos `1` on transaktion loppuosa, mikä tarkoittaisi, että syötteen käyttäjällä on edelleen hallussaan tuotos `1`.

Hypoteesin tukemiseksi tai kumoamiseksi voimme etsiä muita heuristiikkoja, jotka vahvistavat ajatteluamme tai vähentävät todennäköisyyttä, että hypoteesimme on oikea.

Olen tunnistanut ainakin yhden toisen heuristiikan. Se on pyöreän summan tuotos. Lähtö `0` mittaa `70,000 satsia`, kun taas lähtö `1` mittaa `22,962 satsia`. Kyseessä on siis täysin pyöreä tuotos BTC-tiliyksiköissä. Pyöreän tuotoksen heuristiikka viittaa siihen, että UTXO, jossa on yksi pyöreä määrä, on todennäköisesti maksu, ja poistamalla toinen edustaa loput. Tämä heuristiikka vahvistaa siis entisestään alkuperäistä hypoteesiamme.

Tässä esimerkissä toinen heuristiikka saattaa kuitenkin kyseenalaistaa alkuperäisen oletuksemme. Itse asiassa lähtö `0` on suurempi kuin lähtö `1`. Jos perustamme päättelymme heuristiikkaan, jonka mukaan suurin tuotos on yleensä jäännös, voimme päätellä, että tuotos `0` on jäännös. Tämä vastahypoteesi vaikuttaa kuitenkin epätodennäköiseltä, koska kaksi muuta heuristiikkaa vaikuttavat huomattavasti vakuuttavammilta kuin suurimman tuotoksen heuristiikka. Näin ollen vaikuttaa järkevältä säilyttää alkuperäinen hypoteesimme tästä näennäisestä ristiriidasta huolimatta.

Näin ollen vaikuttaa todennäköiseltä, että UTXO:n syötteen antaneella käyttäjällä on edelleen hallussaan ulostulo "1", joka näyttää edustavan loput tapahtumasta.

**_Harjoitus 5:_**

Näemme, että Loïcin henkilöllisyyteen voidaan yhdistää 8 tapahtumaa. Näistä 4 liittyy bitcoinien vastaanottamiseen:

```plaintext
2d9575553c99578268ffba49a1b2adc3b85a29926728bd0280703a04d051eace
8b70bd322e6118b8a002dbdb731d16b59c4a729c2379af376ae230cf8cdde0dd
d5864ea93e7a8db9d3fb113651d2131567e284e868021e114a67c3f5fb616ac4
bc4dcf2200c88ac1f976b8c9018ce70f9007e949435841fc5681fd33308dd762
```

Toinen 4 koskee Bitcoinin lähettämistä:

```plaintext
8b52fe3c2cf8bef60828399d1c776c0e9e99e7aaeeff721fff70f4b68145d540
c12499e9a865b9e920012e39b4b9867ea821e44c047d022ebb5c9113f2910ed6
a6dbebebca119af3d05c0196b76f80fdbf78f20368ebef1b7fd3476d0814517d
3aeb7ce02c35eaecccc0a97a771d92c3e65e86bedff42a8185edd12ce89d89cc
```

**_Harjoitus 6:_**

Jos tarkastelemme tämän tapahtuman mallia, on selvää, että kyseessä on ryhmitelty meno. Itse asiassa tapahtumassa on yksi panos ja 51 tuotosta, mikä viittaa merkittävään taloudelliseen toimintaan. Voimme siis olettaa, että Loïc teki bitcoin-noston vaihtoalustalta.

Useat tekijät vahvistavat tätä hypoteesia. Ensinnäkin UTXO-syötteen suojaamiseen käytetty skriptityyppi on P2SH multisig 2/3 -skripti, mikä viittaa vaihtofoorumeille tyypilliseen kehittyneeseen turvallisuustasoon:

```plaintext
OP_PUSHNUM_2
OP_PUSHBYTES_33 03eae02975918af86577e1d8a257773118fd6ceaf43f1a543a4a04a410e9af4a59
OP_PUSHBYTES_33 03ba37b6c04aaf7099edc389e22eeb5eae643ce0ab89ac5afa4fb934f575f24b4e
OP_PUSHBYTES_33 03d95ef2dc0749859929f3ed4aa5668c7a95baa47133d3abec25896411321d2d2d
OP_PUSHNUM_3
OP_CHECKMULTISIG
```

Lisäksi analysoitua osoitetta `3PUv9tQMSDCEPSMsYSopA5wDW86pwRFbNF` käytettiin uudelleen yli 220 000 eri transaktiossa, mikä on usein tyypillistä vaihtopalveluille, jotka eivät yleensä ole huolissaan yksityisyydestään. Osoitteeseen sovelletut ajalliset heuristiikat osoittavat myös, että transaktioita on tehty säännöllisesti lähes päivittäin kolmen kuukauden ajanjakson aikana, ja niitä on pidennetty yli 24 tunnin ajan, mikä viittaa vaihtofoorumin jatkuvaan toimintaan.

Lisäksi tämän yksikön käsittelemät määrät ovat valtavia. Itse asiassa osoite vastaanotti ja lähetti 44 BTC:tä 222 262 transaktion aikana joulukuun 2022 ja maaliskuun 2023 välisenä aikana. Nämä merkittävät volyymit vahvistavat entisestään vaihtoalustan toiminnan todennäköisen luonteen.

**_Harjoitus 7:_**

Tapahtumien vahvistusajat ovat seuraavat UTC-ajat:

```plaintext
05:43
20:51
18:12
17:16
04:28
23:38
07:45
21:55
```

Analysoimalla näitä aikoja on ilmeistä, että UTC-7- ja UTC-8-aikavyöhykkeet ovat useimpina aikoina sopusoinnussa ihmisten tavanomaisen toiminnan kanssa (klo 8.00-23.00 välillä):

```plaintext
05:43 UTC > 22:43 UTC-7
20:51 UTC > 13:51 UTC-7
18:12 UTC > 11:12 UTC-7
17:16 UTC > 10:16 UTC-7
04:28 UTC > 21:28 UTC-7
23:38 UTC > 16:38 UTC-7
07:45 UTC > 00:45 UTC-7
21:55 UTC > 14:55 UTC-7
05:43 UTC > 21:43 UTC-8
20:51 UTC > 12:51 UTC-8
18:12 UTC > 10:12 UTC-8
17:16 UTC > 09:16 UTC-8
04:28 UTC > 20:28 UTC-8
23:38 UTC > 15:38 UTC-8
07:45 UTC > 23:45 UTC-8
21:55 UTC > 13:55 UTC-8
```

UTC-7-aikavyöhyke on erityisen tärkeä kesällä, sillä siihen kuuluvat muun muassa seuraavat osavaltiot ja alueet:


- Kalifornia (Los Angelesin, San Franciscon ja San Diegon kaltaiset kaupungit);
- Nevada (Las Vegasin kanssa);
- Oregon (Portlandin kanssa);
- Washington (Seattlen kanssa);
- Kanadan Brittiläisen Kolumbian alue (jossa on Vancouverin ja Victorian kaltaisia kaupunkeja).

Näiden tietojen mukaan Loïc voisi mahdollisesti asua Yhdysvaltojen tai Kanadan länsirannikolla.

**_Harjoitus 8:_**

Tämän liiketoimen analyysi paljastaa 5 panosta ja yhden tuotoksen, mikä näyttää viittaavan konsolidointiin. CIOH-heuristiikan soveltaminen viittaa siihen, että kaikki panoksissa olevat UTXO:t ovat yhden yksikön hallussa ja että myös tuotoksessa oleva UTXO kuuluu tälle yksikölle. Vaikuttaa siltä, että käyttäjä päätti yhdistää useita omistamiaan UTXO:ita yhdeksi UTXO:ksi tuotoksessa tavoitteenaan yhdistää omat kolikkonsa. Tämän lähestymistavan taustalla oli todennäköisesti halu hyödyntää tämän hetken alhaisia transaktiomaksuja tulevien maksujen pienentämiseksi.

---
_Ketjuanalyysia käsittelevän osan 3 kirjoittamisessa käytin seuraavia lähteitä:_


- _Samourai Walletin vuonna 2021 tuottama neljän artikkelin sarja: [Understanding Bitcoin Privacy with OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923);_
- [OXT Researchin] (https://medium.com/oxt-research) erilaiset raportit sekä heidän ilmainen ketjuanalyysityökalunsa (joka ei tällä hetkellä ole enää saatavilla Samourai Walletin perustajien pidätyksen jälkeen);_
- _Yleisesti ottaen tietoni ovat peräisin [@LaurentMT](https://twitter.com/LaurentMT) ja [@ErgoBTC](https://twitter.com/ErgoBTC) eri twiiteistä ja sisällöstä;_
- \_The [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji), johon osallistuin yhdessä [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene\__\_](https://twitter.com/Sosthene___) ja [@LaurentMT](https://twitter.com/LaurentMT) kanssa.\_

haluan kiittää niiden tekijöitä, kehittäjiä ja tuottajia. Kiitokset myös arvostelijoille, jotka korjasivat huolellisesti tämän osan 3 pohjana toimineen artikkelin ja kunnioittivat minua asiantuntevilla neuvoillaan:_ _


- _[Gilles Cadignan](https://twitter.com/gillesCadignan);_
- _[Ludovic Lars](https://viresinnumeris.fr/)._

# Parhaiden käytäntöjen hallinta yksityisyyden suojaamiseksi

<partId>9bd04b63-f1af-4e50-9061-6bc90009df68</partId>

## Osoitteiden uudelleenkäyttö

<chapterId>f3e97645-3df3-41bc-a4ed-d2c740113d96</chapterId>

Tutkittuamme tekniikoita, jotka voivat vaarantaa yksityisyytesi Bitcoinissa, tarkastelemme tässä kolmannessa osassa parhaita käytäntöjä, joilla voit suojata itsesi. Tämän osan tarkoituksena ei ole tutkia menetelmiä yksityisyyden parantamiseen, sillä tätä aihetta käsitellään myöhemmin, vaan pikemminkin ymmärtää, miten toimia oikein Bitcoinin kanssa, jotta sen luonnollisesti tarjoama yksityisyys säilyy ilman lisätekniikoita.

Tämän kolmannen osan aluksi puhumme tietenkin osoitteiden uudelleenkäytöstä. Tämä ilmiö on suurin uhka käyttäjien yksityisyydelle. Siksi tämä luku on luultavasti koko kurssin tärkein.

### Mikä on vastaanottava osoite?

Bitcoinin vastaanottava osoite on merkkijono tai tunniste, jota käytetään bitcoinien vastaanottamiseen lompakkoon.

Teknisesti ottaen bitcoinin vastaanottava osoite ei "vastaanota" bitcoineja kirjaimellisessa merkityksessä, vaan pikemminkin määrittelee ehdot, joilla bitcoineja voidaan käyttää. Tarkemmin sanottuna, kun sinulle lähetetään maksu, lähettäjän transaktio luo sinulle tarkoitetun uuden UTXO:n tulosteessa niistä UTXO:ista, jotka se kulutti tulosteissa. Tähän tulosteeseen sovelletaan skriptiä, joka määrittelee, miten tämä UTXO voidaan käyttää myöhemmin. Tämä skripti tunnetaan nimellä "_ScriptPubKey_" tai "_Locking Script_"." Vastaanottava osoitteesi, tarkemmin sanottuna sen hyötykuorma, on upotettu tähän skriptiin. Yksinkertaistettuna tämä skripti sanoo lähinnä seuraavaa:

> "_Tämän uuden UTXO:n käyttämiseksi on annettava digitaalinen allekirjoitus, joka on tehty tähän vastaanottoosoitteeseen liittyvällä yksityisellä avaimella._"
![BTC204](assets/fr/067.webp)

Bitcoin-osoitteita on erityyppisiä riippuen käytetystä skriptimallista. Ensimmäisiin malleihin, jotka tunnetaan nimellä "_Legacy_", kuuluvat `P2PKH- (_Pay-to-PubKey-Hash_) ja `P2SH- (_Pay-to-Script-Hash_) osoitteet. P2PKH-osoitteet alkavat aina numerolla `1` ja P2SH-osoitteet numerolla `3`. Vaikka nämä muodot ovat edelleen turvallisia, ne ovat nyt vanhentuneita, sillä ne aiheuttavat korkeampia transaktiomaksuja ja tarjoavat vähemmän yksityisyyttä kuin uudet standardit.

SegWit V0 (`P2WPKH` ja `P2WSH`) ja Taproot / SegWit V1 (`P2TR`) osoitteet edustavat nykyaikaisia muotoja. SegWit-osoitteet alkavat kirjaimella `bc1q` ja vuonna 2021 käyttöön otetut Taproot-osoitteet kirjaimella `bc1p`.

Tässä on esimerkiksi Taprootin vastaanotto-osoite:

```text
bc1ps5gd2ys8kllz9alpmcwxqegn7kl3elrpnnlegwkm3xpq2h8da07spxwtf5
```

Se, miten ScriptPubKey muodostetaan, riippuu käyttämästäsi standardista:

| Script Template | ScriptPubKey || ---------------- | ----------------------------------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------- |

| P2PKH | OP_DUP OP_HASH160 `<pubKeyHash>` OP_EQUALVERIFY OP_CHECKSIG |

| P2SH | OP_HASH160 `<scriptHash>` OP_EQUAL |

| P2WPKH | 0 `<pubKeyHash>` |

| P2WSH | 0 `<<witnessScriptHash>` |

| P2SH - P2WPKH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2SH - P2WSH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2TR | 1 `<<pubKey>` |

Vastaanottavien osoitteiden rakenne riippuu myös valitusta komentosarjamallista:


- `P2PKH`- ja `P2WPKH`-osoitteissa hyötykuorma eli osoitteen ydin edustaa julkisen avaimen hash-määritystä;
- `P2SH`- ja `P2WSH`-osoitteissa hyötykuorma on komentosarjan hash;
- Kuten `P2TR`-osoitteiden kohdalla, hyötykuorma on muunnettu julkinen avain. `P2TR`-tulosteissa yhdistyvät sekä _Pay-to-PubKey_- että _Pay-to-Script_-ominaisuudet. Muunnettu julkinen avain on tulosta siitä, että klassiseen julkiseen rahankäyttöavaimeen on lisätty "modifikaatio", joka on johdettu skriptien joukon Merkle-juuresta, jota voidaan käyttää myös bitcoinien rahankäyttöön.

![BTC204](assets/it/67/01.webp)

Lompakko-ohjelmistossasi näkyvät osoitteet sisältävät myös HRP:n (_Human-Readable Part_), joka on tyypillisesti `bc` SegWitin jälkeisissä osoitteissa, erottimen `1` ja versionumeron `q` SegWit V0:lle ja `p` Taproot/SegWit V1:lle. Lisäksi lisätään tarkistussumma, jolla varmistetaan osoitteen eheys ja pätevyys lähetyksen aikana.

Lopuksi osoitteet saatetaan vakiomuotoon:


- Base58check vanhoille Legacy-osoitteille;
- Bech32 SegWit-osoitteita varten;
- Bech32m Taproot-osoitteita varten.

Tässä on yhteenlaskumatriisi bech32- ja bech32m-formaateille (SegWit ja Taproot) 10:stä lähtien:

| + | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |

| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| 0 | q | p | z | r | y | 9 | x | 8 | 8 | 8

| 8 | g | f | 2 | t | v | d | w | 0 | |

| 16 | s | 3 | j | n | 5 | 4 | k | h | | 24 | c | e | 6 | m | u | a | 7 | l | l

### Mitä on osoitteen uudelleenkäyttö?

Osoitteen uudelleenkäytöllä tarkoitetaan käytäntöä, jossa samaa vastaanottoosoitetta käytetään useiden eri UTXO:iden estämiseen.

Kuten edellisessä jaksossa todettiin, jokaisella UTXO:lla on oma ScriptPubKey, joka lukitsee sen ja jonka on täytyttävä, jotta UTXO voidaan käyttää syötteenä uudessa transaktiossa. Vastaanotto-osoitteet (hyötykuormat) on upotettu tähän ScriptPubKey-avaimeen.

Kun useat ScriptPubKeys-avaimet sisältävät saman vastaanottavan osoitteen, tätä kutsutaan osoitteen uudelleenkäytöksi. Käytännössä tämä tarkoittaa sitä, että käyttäjä on antanut saman osoitteen useita kertoja lähettäjille saadakseen bitcoineja useiden maksujen kautta. Ja todellakin, tämä käytäntö on katastrofaalinen yksityisyytesi kannalta.

### Miksi osoitteen uudelleenkäyttö on ongelma?

Koska lohkoketju on julkinen, on helppo nähdä, mitkä osoitteet lukitsevat mitkä UTXO:t ja kuinka monta bitcoinia. Jos samaa osoitetta käytetään useisiin transaktioihin, on mahdollista päätellä, että kaikki kyseiseen osoitteeseen liittyvät bitcoinit kuuluvat samalle henkilölle. Tämä käytäntö vaarantaa käyttäjien yksityisyyden, koska se mahdollistaa determinististen yhteyksien luomisen eri transaktioiden välille ja bitcoinien jäljittämisen lohkoketjussa. Satoshi Nakamoto itse korosti tätä ongelmaa Bitcoinin valkoisessa kirjassa:

> _Lisäpalomuurina voitaisiin käyttää uutta avainparia jokaiselle tapahtumalle, jotta niitä ei voitaisi yhdistää yhteiseen omistajaan._
![BTC204](assets/fr/055.webp)

Lähde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Satoshi pyrki tällä lausunnolla luomaan ylimääräisen palomuurin käyttäjän identiteetin ja Bitcoinin avainparin välille, jotta vältettäisiin se, että kaikki käyttäjän toiminta olisi julkisesti yhteydessä hänen identiteettiinsä. Nykyään, kun lohkoketjuanalytiikkayritykset ja KYC-säännökset ovat lisääntyneet, yksilöllisten osoitteiden käyttö ei ole enää "ylimääräinen palomuuri", vaan välttämätön käytäntö kaikille, jotka haluavat säilyttää yksityisyytensä mahdollisimman hyvin.

Kun käytät osoitetta uudelleen, luot lähes kiistattoman yhteyden kaikkien kyseiseen osoitteeseen liittyvien tapahtumien välille. Vaikka tämä ei suoraan vaaranna varojasi, koska elliptisillä käyrillä tapahtuva salaus takaa yksityisten avainten turvallisuuden, se helpottaa toimintojesi valvontaa. Itse asiassa kuka tahansa, jolla on solmu, voi tarkkailla transaktioitasi ja osoitesaldojasi, mikä vaarantaa anonymiteettisi täysin.

![BTC204](assets/it/34/01.webp)

Havainnollistetaan tätä asiaa esimerkillä Bobista, käyttäjästä, joka ostaa säännöllisesti pieniä määriä bitcoineja DCA:n (Dollar Cost Averaging) avulla ja lähettää ne aina samaan osoitteeseen. Kahden vuoden kuluttua tässä osoitteessa on huomattava määrä bitcoineja. Jos Bob käyttää tätä osoitetta suorittaakseen maksun paikalliselle kauppiaalle, kauppias voi nähdä kaikki siihen liittyvät varat ja vähentää Bobin varallisuuden. Tämä voisi johtaa henkilökohtaisiin turvallisuusriskeihin, kuten varkaus- tai kiristysyrityksiin. Jos Bob olisi käyttänyt uutta osoitetta jokaiseen säännölliseen ostokseen, hän olisi paljastanut kauppiaalle huomattavasti vähemmän tietoja.

Ketjuanalyysissä erotamme toisistaan 2 osoitteen uudelleenkäytön tyyppiä:


- Ulkoinen uudelleenkäyttö;
- Sisäinen uudelleenkäyttö tapahtuman sisällä.

Ensimmäinen havaitaan, kun osoitetta käytetään uudelleen useissa eri Bitcoin-tapahtumissa. Tästä keskustelimme aiemmin: tämän heuristiikan avulla voimme päätellä, että kaikki UTXO:t, jotka kulkevat tämän osoitteen kautta, kuuluvat yhdelle taholle.

Sisäisten osoitteiden uudelleenkäyttöä ei havaita silloin, kun uudelleenkäyttö tapahtuu useiden transaktioiden välillä, vaan silloin, kun se tapahtuu saman transaktion sisällä. Jos samaa osoitetta, jota käytettiin syötteen lukitsemiseen, käytetään transaktion tulosteena, voidaan päätellä, että tämä tuloste kuuluu edelleen samalle käyttäjälle (jäännös) ja että toinen tuloste edustaa todellista maksua. Tämän toisen heuristiikan avulla varoja voidaan seurata useiden tapahtumien kautta.

![BTC204](assets/it/33/02.webp)

Osoitteiden uudelleenkäyttö on Bitcoinin todellinen vitsaus. OXT.me-sivuston (johon ei tällä hetkellä pääse käsiksi) mukaan osoitteiden uudelleenkäyttöaste Bitcoinissa oli noin 52 prosenttia vuonna 2022:

![BTC204](assets/fr/069.webp)

Tämä määrä on valtava, mutta se tulee valtaosin pikemminkin vaihtofoorumeilta kuin yksittäisiltä käyttäjiltä.

### Miten vältetään osoitteen uudelleenkäyttö?

Osoitteiden uudelleenkäytön välttäminen on melko yksinkertaista: **käytä vain uutta osoitetta jokaista uutta lompakkoon saapuvaa maksua varten**.

BIP32:n ansiosta nykyaikaiset salkut ovat nyt deterministisiä ja hierarkkisia. Tämä tarkoittaa, että käyttäjä voi luoda suuren määrän osoitteita yhdestä ainoasta lähtötiedosta: siemenestä. Tallentamalla tämän yksittäisen tiedon voi palauttaa kaikki lompakon yksityiset avaimet, jolloin pääsee käsiksi vastaavien osoitteiden suojaamiin varoihin.

![BTC204](assets/fr/070.webp)

Kun painat lompakko-ohjelmiston "_vastaanottaa_"-painiketta, sinulle tarjotaan joka kerta käyttämätöntä vastaanottoosoitetta. Kun olet vastaanottanut bitcoineja tähän osoitteeseen, ohjelmisto ehdottaa automaattisesti uutta osoitetta.

> _PS: Viime aikoina eräät lompakko-ohjelmistot ovat ilmoittaneet aikovansa lopettaa tyhjien osoitteiden luomisen, koska ne pelkäävät, että viranomaiset voivat pitää tätä rahanpesun muotona. Jos ohjelmistonne on yksi näistä, suosittelen teitä vaihtamaan sen välittömästi, koska tämä ei ole hyväksyttävää käyttäjän kannalta._ _
Jos tarvitset staattisen tunnisteen maksujen vastaanottamiseen, kuten esimerkiksi lahjoitusten vastaanottamiseen, klassisen Bitcoin-osoitteen käyttäminen ei ole suositeltavaa uudelleenkäytön riskin vuoksi. Käytät mieluummin Lightning-osoitetta, tai jos haluat staattisen onchain-maksutunnisteen, voit valita BIP47:n tai Silent Paymentsin. Näiden protokollien toiminnasta kerrotaan yksityiskohtaisesti tämän koulutuksen osassa 6.

## Kolikoiden merkitseminen ja valvonta

<chapterId>fbdb07cd-c025-48f2-97b0-bd1bc21c68a8</chapterId>

Kuten havaitsimme ketjuanalyysia käsittelevässä osassa, on olemassa lukuisia heuristiikkoja ja malleja, joiden avulla voidaan päätellä tietoja tapahtumasta. Käyttäjänä on tärkeää olla tietoinen näistä tekniikoista, jotta voit suojautua paremmin.

Tähän liittyy suuresti lompakon tiukka hallinnointi henkilökohtaisessa säilytyksessä, johon kuuluu UTXO:iden alkuperän tunteminen sekä maksujen aikana käytettävien UTXO:iden harkittu valinta. Tämä tehokas lompakon hallinta perustuu hyvien Bitcoin-lompakoiden kahteen tärkeään ominaisuuteen: merkintöihin ja kolikoiden valvontaan.

Tässä luvussa tarkastelemme näitä ominaisuuksia ja katsomme, miten voit käyttää niitä älykkäästi, lisäämättä liikaa työmäärää, optimoidaksesi yksityisyytesi Bitcoinissa.

### Mitä on merkintä?

Merkitseminen on käytäntö, jossa tiettyyn UTXO:hon annetaan merkintä tai etiketti Bitcoin-lompakossa. Lompakko-ohjelmisto tallentaa nämä merkinnät paikallisesti, eikä niitä koskaan lähetetä Bitcoin-verkon kautta. Merkitseminen on siis henkilökohtaisen hallinnan väline.

Jos esimerkiksi omistan UTXO:n, joka on peräisin P2P-ostosta Bisqistä Charlesin kanssa, saatan antaa sille merkinnän "`Non-KYC Bisq Charles`".

Merkitseminen on hyvä käytäntö, joka auttaa muistamaan UTXO:n alkuperän tai aiotun määränpään, mikä helpottaa varojen hallinnointia ja optimoi yksityisyyden suojan. Bitcoin-lompakossasi on todennäköisesti useita UTXO:ita. Jos näiden UTXO:iden lähteet ovat erilaiset, et ehkä halua yhdistää näitä UTXO:ita tulevaisuudessa, sillä muuten saatat paljastaa niiden yhteisen omistajuuden. Merkitsemällä kaikki kolikkosi asianmukaisesti varmistat, että muistat niiden alkuperän, kun tarvitset niitä, vaikka se tapahtuisi vasta vuosien kuluttua.

### Mitä on kolikoiden valvonta?

Tunnisteiden aktiivinen käyttö on entistäkin houkuttelevampaa, kun se yhdistetään lompakko-ohjelmiston kolikonhallintavaihtoehtoon.

Kolikonhallinta on hyvässä Bitcoin-lompakko-ohjelmistossa oleva ominaisuus, jonka avulla voit manuaalisesti valita tiettyjä UTXO:ita käytettäväksi transaktion suorittamiseen. Itse asiassa lähtevän maksun tyydyttämiseksi sinun on kulutettava vastineeksi saapuva UTXO. Useista syistä, jotka käyvät ilmi myöhemmin, voit haluta valita tarkasti, mitä kolikoita haluat kuluttaa syötteenä tietyn maksun suorittamiseksi. Juuri tämän kolikoiden hallinta mahdollistaa. Vertailun vuoksi sanoisin, että tämä toiminto on samanlainen kuin tietyn kolikon valitseminen lompakostasi, kun maksat patonkia.

Kolikko-ohjatun lompakko-ohjelmiston käyttö yhdistettynä UTXO-kolikoiden merkitsemiseen antaa käyttäjille mahdollisuuden erottaa UTXO-kolikot tarkasti ja valita ne liiketoimia varten.

### Kuinka merkitä UTXO:t oikein?

UTXO:iden merkitsemiseen ei ole olemassa yleispätevää menetelmää, joka sopisi kaikille. On sinun tehtäväsi määritellä merkintäjärjestelmä, jotta voit helposti navigoida salkussasi. Pidä joka tapauksessa mielessä, että hyvä merkintä on se, mitä pystyt ymmärtämään, kun tarvitset sitä. Jos Bitcoin-lompakkosi on ensisijaisesti säästöjä varten, voi olla, että merkinnöistä on sinulle hyötyä vasta useiden vuosikymmenten kuluttua. Varmista siksi, että ne ovat selkeitä, tarkkoja ja kattavia.

On tärkeää, että läheisesi voivat helposti tunnistaa varojen lähteen, jos he jonain päivänä tarvitsevat salkkuasi käyttöönsä. Tämä voi auttaa heitä sekä yksityisyydensuojasyistä että oikeudellisista syistä, jos heidän on perusteltava varojen alkuperä jollekin viranomaiselle.

Merkinnöissä tärkeintä on merkitä UTXO:n lähde. Sinun on yksinkertaisesti ilmoitettava, miten kolikko on päätynyt lompakkoosi. Tuliko se pörssialustalta tehdystä ostosta? Asiakkaan suorittamasta maksusta? Vertaisverkkopörssistä? Vai onko se ostoksen jäännös? Voisit siis ilmoittaa:


- `Pickup Exchange.com`;
- "Maksuasiakas David";
- `Osta P2P Charles`;
- `Sohvan ostamisesta luopuminen`

Jos haluat tarkentaa UTXO-rahastojen hallintaa ja noudattaa salkun sisäistä rahastojen erottelua koskevia strategioita, voit lisätä merkintöjäsi lisämerkinnällä, joka kuvastaa näitä erotteluja. Jos salkussasi on kaksi UTXO-rahastoluokkaa, joita et halua sekoittaa keskenään, voit lisätä merkinnän merkintöihisi, jotta nämä ryhmät voidaan erottaa selvästi toisistaan. Nämä erottelumerkinnät riippuvat kriteereistäsi, kuten KYC:tä sisältävän hankintaprosessin yhteydessä syntyneiden UTXO:iden tai ammatillisten ja henkilökohtaisten rahastojen erottelusta. Kun otetaan huomioon aiemmin mainitut esimerkit merkinnöistä, tämä voisi tarkoittaa seuraavaa:


- `KYC - Exchange.com Withdrawal`;
- `KYC - Customer Payment David`;
- `NO KYC - osta P2P Charles`;
- `NO KYC - Jäännös sohvan ostosta`

On myös suositeltavaa säilyttää kolikon merkintä liiketoimien aikana. Kun esimerkiksi konsolidoit UTXO-rahoja ilman KYC:tä, muista merkitä tuloksena syntyvä UTXO-rahayksikkö paitsi "konsolidoinniksi", myös erityisesti "ei-KYC-konsolidoinniksi", jotta kolikon alkuperä voidaan jäljittää selkeästi.

Lopuksi on todettava, että päivämäärän merkitseminen etikettiin ei ole pakollista. Useimmissa lompakko-ohjelmistoissa näkyy jo tapahtuman päivämäärä, ja tämä tieto on aina mahdollista hakea lohko-etsintäohjelmalla TXID-tunnuksen avulla.

### Miten valita kolikot oikein?

Kun teet maksutapahtuman, voit kolikkovalvonnan avulla valita erikseen, mitä UTXO:ita käytät syötteenä maksun tuotoksen tyydyttämiseksi. Tässä valinnassa on otettava huomioon kaksi näkökohtaa:


- Maksun vastaanottajan mahdollisuus yhdistää osa henkilöllisyydestäsi syötteenä käytettyihin UTXO-tunnuksiin;
- Ulkopuolisen tarkkailijan kyky muodostaa yhteyksiä kaikkien syötteenä käytettyjen UTXO:iden välillä.

Ensimmäisen kohdan havainnollistamiseksi otetaan konkreettinen esimerkki. Oletetaan, että ostat patongin bitcoineilla paikalliselta leipurilta. Käytät panoksena yhtä tai useampaa omaa UTXOa, jotta voit kattaa vähintään patongin hinnan tuotoksena sekä transaktiomaksut. Leipurisi voi sitten mahdollisesti yhdistää kasvosi tai minkä tahansa muun tuntemansa osan henkilöllisyydestäsi panoksena käytettyihin kolikoihin. Kun tiedät tämän yhteyden olemassaolon, saatat valita maksua suorittaessasi mieluummin tietyn UTXO:n kuin toisen.

Jos esimerkiksi yksi UTXO-tilisi on peräisin vaihtopalvelusta ja haluat, että leipuri ei tiedä tilistäsi kyseisellä alustalla, sinun on vältettävä tämän UTXO-tilisi käyttämistä maksamiseen. Jos sinulla on arvokas UTXO, joka paljastaa merkittävän määrän bitcoineja, saatat myös päättää olla käyttämättä sitä, jotta leipuri ei saisi tietää BTC-varallisuudestasi.

Ensimmäisessä kohdassa käytettävien UTXO:iden valinta perustuu siis henkilökohtaiseen päätökseen, johon vaikuttaa se, mitä olet valmis paljastamaan ja mitä et. UTXO-asiakirjoille vastaanottamisen yhteydessä antamasi merkinnät auttavat sinua valitsemaan ne, jotka käytettäessäsi näyttävät vain ne tiedot, jotka voit mielelläsi paljastaa vastaanottajalle.

Vastaanottajalle mahdollisesti paljastuvien tietojen lisäksi syötteiden valinta vaikuttaa myös siihen, mitä paljastat kaikille lohkoketjun tarkkailijoille. Käyttämällä useita UTXO:ita transaktiosi syötteinä paljastat itse asiassa, että ne ovat saman tahon omistuksessa syötteiden yhteisen omistusheuristiikan (Common Ownership Heuristics of Inputs, CIOH) mukaan.

Kun valitset kolikoita, sinun on siis syytä olla tietoinen siitä, että lähetettävä transaktio luo linkin kaikkien käytettyjen UTXO:iden välille. Tämä linkki voi olla ongelmallinen yksityisyytesi kannalta, varsinkin jos UTXO:t ovat peräisin eri lähteistä.

Takaisin esimerkkiin UTXO:sta ilman KYC:tä Bisqiltä; haluan välttää sen yhdistämistä UTXO:n kanssa esimerkiksi säännellystä pörssialustasta, joka tuntee henkilöllisyyteni. Jos käyttäisin näitä kahta UTXO:ta syöttötietoina samassa transaktiossa, säännelty foorumi voisi yhdistää henkilöllisyyteni Bisqistä ostamaani UTXO:hon, kun taas aiemmin sitä ei yhdistetty henkilöllisyyteeni.

Lopuksi, jotta voit valita oikein, mitä UTXO:ta käytät tapahtuman syötteenä, on tärkeintä välttää useiden UTXO:iden käyttöä. Valitse aina kun mahdollista yksi kolikko, joka on tarpeeksi suuri maksun kattamiseen. Näin toimimalla vältät kokonaan COINJOINiin liittyvät riskit. Jos mikään yksittäinen UTXO ei kuitenkaan riitä maksuusi ja sinun on käytettävä useita, varmista, että ne ovat peräisin samankaltaisista lähteistä, jotta ei-toivottujen yhteyksien riski on mahdollisimman pieni. Muista myös, että vastaanottaja voi yhdistää sinusta saamansa tiedot syötteenä käytettyjen kolikoiden historiaan.

### Automaattisen kolikonvalinnan ymmärtäminen

Edellisissä jaksoissa käsiteltiin UTXO:iden manuaalista valintaa tapahtumaa varten. Mutta mitä tapahtuu, kun lompakko-ohjelmisto tekee tämän valinnan automaattisesti? Kulutettavien kolikoiden määrittämiseen on olemassa useita menetelmiä, ja UTXO:iden valinta on todellinen Bitcoin-tutkimusalue. Tämän automaattisen prosessin päätavoitteena on usein minimoida käyttäjälle aiheutuvat transaktiomaksut.

UTXO-valintamenetelmät, kuten FIFO (_First In First Out_) ja LIFO (_Last In First Out_), ovat yksinkertaisimpia mutta myös tehottomimpia. FIFO-menetelmässä salkun vanhimmat kolikot käytetään ensin. Tämä lähestymistapa on yleensä tehoton sekä transaktiomaksujen minimoimiseksi että yksityisyyden suojan säilyttämiseksi, paitsi tapauksissa, joissa käytetään suhteellisia aikarajoja, jotka on uusittava säännöllisesti. Sitä vastoin LIFO:ssa etusijalle asetetaan viimeisimpien UTXO:iden käyttö. Vaikka nämä kaksi menetelmää ovat yksinkertaisia, ne osoittautuvat usein tehottomiksi.

Edistyneempi menetelmä on _Knapsack Solver_. Tätä menetelmää käytettiin Bitcoin Core -lompakossa versioon 0.17 asti. Siinä lompakosta valitaan iteratiivisesti ja satunnaisesti UTXO:t, lasketaan ne yhteen alaryhmiin ja säilytetään ratkaisu, joka pienentää transaktiopainoa mahdollisimman paljon, jotta käyttäjämaksuja voidaan pienentää.

_Branch-and-Bound_ (BNB), joka on usein saanut lempinimen "Murchin algoritmi" keksijänsä mukaan, korvasi _Knapsack Solver_ -algoritmin Bitcoin Coressa versiosta 0.17 alkaen. Tämän kehittyneemmän menetelmän tavoitteena on löytää UTXO-joukko, joka vastaa täsmälleen transaktion tuottojen tyydyttämiseen tarvittavaa määrää. BNB:n tavoitteena on minimoida sekä jäännösmäärän että maksujen määrä vähentämällä niin sanottua hukkakriteeriä, jossa otetaan huomioon sekä välittömät kustannukset että jäännösmäärän odotetut tulevat kustannukset. Tämä menetelmä on johdettu alkuperäisestä _Branch-and-Bound_-käsitteestä, jonka Ailsa Land ja Alison Harcourt suunnittelivat vuonna 1960, ja se tarjoaa tarkemman provisio-optimoinnin kuin _Knapsack Solver_.

Kaikki nämä automaattiset UTXO-valintamenetelmät voivat olla tehokkaita transaktiomaksujen alentamisessa, mutta ne ovat usein tehottomia käyttäjän yksityisyyden säilyttämisessä. Itse asiassa nämä algoritmit voivat yhdistää useita UTXO:ita syötteeksi, jolloin näiden UTXO:iden yhteinen omistus paljastuu COH:n vuoksi. Näissä menetelmissä ei luonnollisestikaan voida ottaa huomioon UTXO-olioihin liitettyjä merkintöjä, jotka ovat ratkaisevia, kun tietoisesti valitaan, mitkä kolikot paljastetaan transaktion vastaanottajalle. Tällä hetkellä ainoa ratkaisu yksityisyyden suojan optimoimiseksi kolikoiden valinnassa on tehdä se manuaalisesti.

### UTXO:n merkintäopas

Jos haluat tietää, miten UTXO:t merkitään, olemme koonneet kattavan oppaan tärkeimmistä nykyisistä Bitcoin-lompakko-ohjelmistoista:

https://planb.network/tutorials/privacy/on-chain/utxo-labelling-d997f80f-8a96-45b5-8a4e-a3e1b7788c52
## KYC ja avaintunnistus

<chapterId>cec6b9d9-0eed-4f85-bc4e-1e9aa59ca605</chapterId>

KYC on lyhenne sanoista "Know Your Customer" (tunne asiakkaasi), joka on sääntelymenettely, jonka jotkin Bitcoin-alalla toimivat yritykset ovat ottaneet käyttöön. Menettelyn tarkoituksena on tarkistaa ja kirjata asiakkaidensa henkilöllisyys, ja sen tavoitteena on torjua rahanpesua ja terrorismin rahoitusta.

Konkreettisesti KYC tarkoittaa, että asiakkaalta kerätään erilaisia henkilötietoja, jotka voivat vaihdella lainkäyttöalueittain, mutta yleensä ne sisältävät henkilöllisyystodistuksen, valokuvan ja todisteen asuinpaikasta. Nämä tiedot tarkistetaan ja tallennetaan myöhempää käyttöä varten.

Tämä menettely on tullut pakolliseksi kaikille säännellyille pörssifoorumeille useimmissa länsimaissa. Tämä tarkoittaa, että kaikkien, jotka haluavat vaihtaa fiat-valuuttaa bitcoiniin näiden alustojen kautta, on noudatettava KYC-vaatimuksia.

Tämä menettely ei ole riskitön käyttäjän yksityisyyden ja turvallisuuden kannalta. Tässä luvussa tarkastelemme näitä riskejä yksityiskohtaisesti ja analysoimme KYC- ja tunnistamisprosessien erityisiä vaikutuksia Bitcoin-käyttäjien yksityisyyteen.

### Onchain-seurannan helpottaminen

Ensimmäinen KYC:hen liittyvä riski on se, että se tarjoaa ensisijaisen lähtökohdan lohkoketjuanalyysille. Kuten edellisessä jaksossa nähtiin, analyytikot voivat ryhmitellä ja seurata toimintaa lohkoketjussa transaktiomallien ja heuristiikan avulla. Kun he ovat onnistuneet klusteroimaan käyttäjän lohkoketjuaktiivisuuden, riittää vain yhden sisäänpääsypisteen löytäminen kaikkien hänen transaktioidensa ja avaintensa joukosta vaarantamaan käyttäjän yksityisyyden täysin.

![BTC204](assets/fr/078.webp)

Kun ilmoittaudut KYC:hen, tarjoat erittäin laadukkaan lähtökohdan ketjuanalyysille, sillä yhdistät bitcoinien nostamisessa vaihtopalvelusta käytetyt vastaanottoosoitteet täydelliseen, todennettuun henkilöllisyyteesi. Teoriassa nämä tiedot ovat vain sen yrityksen tiedossa, jolle ne annoit, mutta kuten myöhemmin nähdään, tietojen katoamisen riski on todellinen. Lisäksi pelkkä se, että yrityksellä on nämä tiedot hallussaan, voi olla ongelmallista, vaikka se ei jakaisikaan niitä.

Jos siis ei toteuteta muita toimenpiteitä, joilla rajoitetaan henkilön toimintojen yhdistämistä lohkoketjussa, kuka tahansa, joka on tietoinen KYC:n kaltaisesta sisäänkäyntikohdasta, voi mahdollisesti yhdistää kaiken Bitcoiniin liittyvän toimintansa henkilöllisyyteensä. Tämän yrityksen näkökulmasta Bitcoinin käyttö menettää näin ollen kaiken luottamuksellisuuden.

![BTC204](assets/fr/079.webp)

Vertailun avulla voidaan havainnollistaa, että _Pankki X:n_ pankkivirkailijalla olisi pääsy kaikkiin _Pankki X:n_ kanssa tehtyihin maksutapahtumiin, mutta hän voisi myös tarkkailla _Pankki Y:n_ kanssa tehtyjä maksutapahtumia ja kaikkia omia käteistapahtumia.

Muista tämän koulutuksen ensimmäisestä osasta: Satoshi Nakamoton suunnittelema Bitcoinin yksityisyysmalli perustuu käyttäjän identiteetin ja hänen avainpariensa erottamiseen toisistaan. Vaikka tämä yksityisyyden suojakerros ei enää nykyään riitä, on silti viisasta rajoittaa sen heikkenemistä mahdollisimman paljon.

### Altistuminen valtion valvonnalle

KYC:n toinen suuri ongelma on se, että se paljastaa valtiolle, että henkilöllä on joskus ollut hallussaan bitcoineja. Kun ostat bitcoineja säännellyn toimijan kautta, valtion on mahdollista saada tieto tästä hallussapidosta. Tällä hetkellä tämä saattaa vaikuttaa triviaalilta, mutta on tärkeää muistaa, että oman maan poliittinen ja taloudellinen tulevaisuus ei ole omissa käsissä.

Ensinnäkin valtio voi nopeasti omaksua autoritaarisen asenteen. Historia on täynnä esimerkkejä, joissa politiikka on muuttunut äkillisesti. Nykyään Euroopassa Bitcoin-harrastajat voivat kirjoittaa artikkeleita Bitcoinista, osallistua konferensseihin ja hallinnoida omia itsesäilyttäviä lompakoitaan. Mutta kuka voi sanoa, mitä huominen tuo tullessaan? Jos Bitcoinista tulee yhtäkkiä yleinen vihollinen numero yksi, siihen liittyminen valtion rekistereissä voi osoittautua ongelmalliseksi.

Myöhemmin vakavien talouskriisien sattuessa valtio saattaa harkita kansalaisten hallussa olevien bitcoinien takavarikointia. Ehkäpä huomenna bitcoinin omistajien katsotaan käyttävän kriisiä hyväkseen, ja heitä verotetaan liikaa, koska he ovat saaneet pääomavoittoja fiat-valuutan devalvoitumisen vuoksi.

Saatat ajatella, että tämä ei ole ongelma, koska bitcoinisi ovat sekoitettuja ja siten jäljittämättömiä. Jäljitettävyys ei kuitenkaan ole ongelma. Todellinen ongelma on se, että valtio tietää, että sinulla on hallussasi bitcoineja. Tämä yksinkertainen tieto voi riittää syyttämään sinua tai vaatimaan tiliä. Voisit yrittää väittää, että olet käyttänyt bitcoinisi, mutta se pitäisi näkyä veroilmoituksessasi, ja se paljastuisi. Voisit myös sanoa, että hukkasit avaimesi veneonnettomuudessa, mutta luuletko todella, että se riittäisi Twitter-vitsin lisäksi vapauttamaan sinut syytteistä?

Siksi on tärkeää ottaa huomioon riski, joka liittyy pelkästään siihen, että valtio saattaa tietää, että omistat BTC:tä, vaikka tämä riski saattaa tuntua nykyään kaukaiselta.

Toinen KYC:n aiheuttama kysymys valtion valvonnan kannalta on säänneltyjen alustojen pakollinen raportointi. En tunne muiden lainkäyttöalueiden säännöksiä, mutta Ranskassa _digitaalisten omaisuuserien palveluntarjoajien_ (PSAN) on ilmoitettava rahoitusvalvojille kaikista epäilyttäviksi katsomistaan varainsiirroista.

Näin ollen Ranskassa vuonna 2023 PSAN ilmoitti 1 449 epäilyttävää tekoa. Toistaiseksi suurin osa näistä teoista liittyy rikoksiin. Viranomaiset pyytävät kuitenkin myös säänneltyjä alustoja ilmoittamaan kaikista epäilyttävistä Bitcoin-tapahtumista, jotka perustuvat pelkästään sen rakenteeseen. Jos teet yhteistoiminnallisen transaktion tai jopa vain transaktion, jolla on hieman epätyypillinen malli, ja tämä transaktio tapahtuu lähellä bitcoinien nostoa näiltä alustoilta, saatat joutua raportoitavaksi viranomaisille. Vaikka et tekisi mitään väärää ja käyttäisit oikeutetusti oikeuksiasi, tämä raportointi voi johtaa lisääntyneeseen tarkkailuun ja valvontaan, haittoihin, jotka olisit välttänyt ilman KYC:tä.

### Henkilötietojen katoamisriski

Toinen KYC:n ongelma on se, että se edellyttää kaikkien henkilötietojesi tallentamista yksityisen yrityksen palvelimille. Viimeaikaiset tapahtumat ovat muistuttaneet meitä siitä, että kukaan ei ole immuuni epäonnistumisille, olipa kyse sitten taloudesta tai tietotekniikasta. Vuonna 2022 Celsiuksen asiakkaat kärsivät seurauksista. Yrityksen konkurssin seurauksena Yhdysvaltain oikeuslaitos julkisti velkojien nimet ja heidän varojensa määrän hallintomenettelyn aikana.

Hieman yli kaksi vuotta sitten eräs johtava kryptovaluutta-alalla toimiva kyberturvallisuusyritys kärsi asiakkaidensa henkilötietojen varastamisesta. Vaikka tämä tapaus ei liittynyt suoraan bitcoinin ostamiseen, tämä riski koskee edelleen myös vaihtofoorumeita. Siksi näihin henkilötietoihin liittyy ehdottomasti riski.

On totta, että annamme jo nyt suuren osan henkilötiedoistamme yksityisten yritysten haltuun. Riski on kuitenkin kaksinkertainen, sillä näiden tietojen avulla sinut voidaan tunnistaa, mutta ne liittyvät myös bitcoin-aktiviteetteihin. Kun hakkeri pääsee käsiksi pörssialustan asiakkaiden tietoihin, hän voi nimittäin kohtuudella olettaa, että nämä asiakkaat omistavat bitcoineja. Tätä riskiä lisää siis se, että bitcoin, kuten mikä tahansa muu arvokas omaisuus, herättää varkaiden kiinnostuksen.

Tietomurron sattuessa voit parhaimmillaan joutua kohdennettujen phishing-yritysten kohteeksi. Pahimmillaan saatat joutua kotiisi kohdistuvien fyysisten uhkien kohteeksi.

Bitcoiniin liittyvien erityisten riskien lisäksi on otettava huomioon myös henkilöllisyysasiakirjojen siirtämiseen liittyvät vaarat. Tietovuodon sattuessa on nimittäin mahdollista joutua identiteettivarkauden uhriksi. Näin ollen kyseessä olevat kysymykset eivät rajoitu ainoastaan transaktioiden luottamuksellisuuden suojaamiseen, vaan ne vaikuttavat myös jokaisen yksilön henkilökohtaiseen turvallisuuteen.

### Yleiset väärinkäsitykset KYC:n osalta

On tärkeää hälventää joitakin yleisiä väärinkäsityksiä KYC:stä, joita esiintyy usein Twitterissä tai bitcoin-asiakkaiden keskusteluissa.

Ensinnäkin on väärin ajatella, että KYC:n (Know Your Customer) avulla hankittujen bitcoinien yksityisyyden suojaaminen on hyödytöntä. Bitcoineihin liittyvät yksityisyyden suojaamisen välineet ja menetelmät ovat erilaisia ja palvelevat eri tarkoituksia. Esimerkiksi coinjoin-transaktioiden käyttäminen bitcoinissa KYC:stä ei ole huono idea. Säänneltyjen vaihtoalustojen kanssa on tietysti oltava varovainen, jotta tilisi ei jäädytetä tai kielletä, mutta puhtaasti teknisestä näkökulmasta nämä käytännöt eivät ole yhteensopimattomia. Coinjoinilla on se vaikutus, että ne häiritsevät kolikon historiaa, mikä auttaa torjumaan joitakin KYC:hen liittyviä ketjuanalyysiriskejä. Vaikka se ei poista kaikkia riskejä, se on jo merkittävä etu.

Bitcoinin yksityisyyttä ei pitäisi tarkastella binäärisesti, erona "nimettömien" bitcoinien ja muiden kuin nimettömien bitcoinien välillä. KYC:n kautta hankittujen bitcoinien omistaminen ei tarkoita sitä, että kaikki olisi menetetty, vaan päinvastoin, yksityisyydensuojatyökalujen käyttö voi osoittautua jopa hyödyllisemmäksi.

Sitä vastoin bitcoinien hankkiminen muulla kuin KYC-menetelmällä ei takaa täydellistä yksityisyyttä eikä vapauta sinua tarpeesta ryhtyä muihin suojatoimenpiteisiin. Jos sinulla on hallussasi muita kuin KYC-bitcoineja, mutta käytät vastaanottoosoitteita useaan kertaan, transaktioitasi voidaan jäljittää ja ryhmitellä. Pienikin yhteys bitcoinin ulkopuoliseen maailmaan voi vaarantaa sen ainoan yksityisyyden suojan, joka sinulla oli. Siksi on tärkeää pitää kaikkia työkaluja ja menetelmiä, jotka parantavat yksityisyyttä Bitcoinissa, toisiaan täydentävinä. Jokainen tekniikka kohdistuu tiettyyn riskiin ja voi lisätä lisäsuojakerroksen. Näin ollen muiden kuin KYC-bitcoinien omistaminen ei missään nimessä vapauta sinua muiden varotoimien toteuttamisesta.

### Voiko KYC:n peruuttaa?

Minulta kysytään joskus, onko KYC:n suorittamisen jälkeen mahdollista "palata takaisin", ja kuten edellisistä kappaleista voitte kuvitella, vastaus on monivivahteinen. KYC:hen liittyvien riskien välttämiseksi yksinkertaisin tapa on olla käyttämättä sitä bitcoinien hankinnassa. Käsittelemme tätä aihetta tarkemmin seuraavassa luvussa. Jos KYC on kuitenkin jo suoritettu ja bitcoineja on ostettu, onko olemassa keinoja, joilla aiheutuvia riskejä voidaan lieventää?

Mitä tulee transaktioiden seurantaan liittyvään riskiin, coinjoinin käyttö on yksi ratkaisu. Keskustelemme tästä menetelmästä yksityiskohtaisesti myöhemmin koulutuksessa, mutta tiedä, että coinjoin voi häiritä kolikon historiaa ja estää sen jäljitettävyyden menneisyydestä nykyhetkeen ja nykyisyydestä menneisyyteen. Jopa säännellyn alustan kautta saadun BTC:n osalta tämä tekniikka voi estää sen jäljitettävyyden.

Coinjoin ei kuitenkaan poista KYC:hen liittyvää toista riskiä: sitä, että valtio saa tiedon bitcoin-omistuksistasi. Itse asiassa, vaikka kolikkosi eivät olisikaan enää jäljitettävissä, valtio voi lainkäyttöalueesta riippuen päästä käsiksi kryptoaktiivisiin vieraantumisilmoituksiisi. Koska tämä riski ei ole tekninen vaan hallinnollinen, ei ole olemassa bitcoin-kohtaisia ratkaisuja sen poistamiseksi, lukuun ottamatta KYC:lle altistumisen välttämistä aluksi. Ainoa laillinen lähestymistapa tämän riskin pienentämiseksi on myydä säänneltyjen alustojen kautta hankitut bitcoinit säännellyillä alustoilla ja ostaa ne sitten takaisin keinoin ilman KYC:tä. Myymällä ja ilmoittamalla myynnistä hallinnon pitäisi huomata, että et enää omista niitä.

Henkilötietojesi ja henkilöllisyysasiakirjojesi paljastumisen riski on Bitcoinin ulkopuolinen vaara, eikä sen välttämiseksi ole olemassa teknistä ratkaisua. Kun tietosi on kerran paljastettu, sitä on vaikea peruuttaa. Voit yrittää sulkea tilisi alustalla, mutta tämä ei takaa KYC-tietojesi poistamista, varsinkin kun henkilöllisyyden todentaminen on ulkoistettu. Tietojesi täydellisen poistamisen todentaminen on mahdotonta. Siksi ei ole olemassa ratkaisua, jolla tämä riski voitaisiin estää kokonaan ja varmistaa, ettei sitä enää ole.

### KYC:n ja avaintunnistuksen ero

Joskus jotkut bitcoin-asiakkaat pyrkivät laajentamaan termin "KYC" koskemaan kaikkia BTC-vaihtoja, joihin liittyy tilisiirto tai luottokorttimaksu, koska nämä keinot voivat myös paljastaa maksun alkuperän, aivan kuten KYC. On kuitenkin tärkeää, ettei KYC:tä sekoiteta avaintunnistukseen. Henkilökohtaisesti minun on myönnettävä, että käsitykseni tästä aiheesta on kehittynyt ajan myötä.

KYC tarkoittaa erityisesti sääntelymenettelyä, jonka jotkin yritykset ovat ottaneet käyttöön asiakkaidensa henkilöllisyyden todentamiseksi ja rekisteröimiseksi. Se on binäärinen asia: kun hankit bitcoineja, joko suostut KYC:hen tai et. Avaintunnistus, jossa on kyse käyttäjän henkilöllisyyden ja ketjussa tapahtuvan toiminnan yhdistämisestä, ei kuitenkaan ole niinkään binäärinen vaan pikemminkin jatkumo. Bitcoinien ostamisen tai myymisen yhteydessä tämä tunnistaminen on aina mahdollista vaihtelevassa määrin.

Jos esimerkiksi ostat bitcoineja säännellyltä alustalta Sveitsissä, KYC (Know Your Customer) ei ole pakollinen. Avaimesi saatetaan kuitenkin tunnistaa, koska osto tehtiin pankkitilisi kautta. Tällöin syntyy kaksi ensimmäistä KYC:hen liittyvää riskiä - ketjussa tapahtuvan jäljittämisen helpottaminen ja altistuminen viranomaisvalvonnalle - jotka voivat ilmetä myös muussa kuin KYC-vaihdossa. Jos sveitsiläinen yksikkö ilmoittaa epäilyttävistä liiketoimista maasi viranomaisille, he voivat yksinkertaisesti tarkistaa ostoon käytetyn pankkitilin selvittääkseen henkilöllisyytesi. Näin ollen ostaminen ilman KYC:tä säännellyillä alustoilla on melko korkealla riskiskaalassa avaintunnistuksen kannalta.

Säänneltyjen alustojen välttäminen ja P2P-hankintamenetelmien (Peer-to-Peer) valitseminen ei kuitenkaan poista täysin avainten tunnistamisen riskiä, vaan ainoastaan vähentää sitä. Esimerkkinä mainittakoon osto Bisqin tai muun P2P-alustan kautta. Maksat vastapuolen kanssa todennäköisesti pankkitililläsi. Jos viranomaiset kuulustelevat henkilöä, jonka kanssa kävit kauppaa, ja kysyvät nimeäsi, kohtaamme edellä mainitut riskit 1 ja 2. Nämä riskit ovat varmasti paljon pienemmät kuin osto alustalla, jossa ei ole KYC:tä, ja jopa pienemmät kuin osto KYC:n avulla, mutta ne ovat silti läsnä vähäisessä määrin.

Vaikka ostaisit bitcoinit fyysisen rahanvaihtopisteen kautta, et ole täysin anonyymi. Henkilö, jonka kanssa asioit, näki kasvosi, jotka ovat osa henkilöllisyyttäsi. Vaikka tunnistamisen mahdollisuus on tässä esimerkissä minimaalinen, se on silti olemassa.

Yhteenvetona voidaan todeta, että bitcoinin vaihtamisen aikana muihin omaisuuseriin, olipa kyseessä sitten fiat-valuutan osto tai myynti reaalivaroihin, on aina olemassa eräänlainen avaintunnistus. Valitusta vaihtomenetelmästä riippuen tämä tunnistaminen voi vaihdella voimakkuudeltaan. On tärkeää, ettei tätä tunnistamista sekoiteta KYC:hen, joka on hyvin määritelty sääntelyprosessi. KYC:n ja tunnistamisen välillä on kuitenkin yhteys, sillä KYC on tämän spektrin yläpäässä, koska se helpottaa järjestelmällisesti viranomaisten suorittamaa käyttäjien avainten tunnistamista.

## Myynti- ja hankintamenetelmät

<chapterId>756598af-95aa-4c77-ac48-243c7ad89530</chapterId>

Kun olet lukenut edellisen luvun, saatat miettiä, miten voit ostaa tai myydä bitcoineja joutumatta käymään läpi henkilöllisyyden todentamisprosessin välttääkseen KYC:hen liittyvät riskit. Vaihdon tekemiseen on useita menetelmiä.

### P2P-vaihdot käteisenä

Kuten olemme nähneet, yksityisyyden kannalta paras menetelmä on edelleen P2P (peer-to-peer) -vaihto käteismaksulla. Tämän menetelmän avulla voit minimoida jäljelle jäävät jäljet ja vähentää merkittävästi avaimen tunnistamisen mahdollisuutta, olitpa sitten ostaja tai myyjä.

Tähän käytäntöön liittyy kuitenkin henkilökohtaisia turvallisuusriskejä. Suurin vaara piilee siinä, että vaihdon aikana vastapuoli tietää, että sinulla on hallussasi merkittävä summa joko käteisenä tai bitcoineina. Tämä tieto voi herättää pahansuopaisten henkilöiden huomion. Itse asiassa bitcoinien hallussapidon suhteen on yleensä suositeltavaa pysyä hienovaraisena. Tätä neuvoa voidaan soveltaa myös käteiseen. Henkilökohtaisen vaihdon aikana on kuitenkin väistämätöntä paljastaa, että omistaa bitcoinia, mikä voi herättää ahneutta.

Tämän riskin rajoittamiseksi suosittelen, että etusijalle asetat käteiskaupat luotettavien henkilöiden, kuten perheenjäsenten tai läheisten ystävien kanssa. Vaihtoehtoisesti voit myös harkita vaihtojen tekemistä [paikallisissa Bitcoin-kokouksissa](https://btcmap.org/communities/map), kun olet osallistunut niihin useita kertoja. Näin voit tutustua muihin osallistujiin paremmin etkä ole yksin fyysisen vaihdon aikana. On kuitenkin tärkeää tiedostaa, että P2P-käteisvaihto sisältää luonnostaan henkilökohtaiseen turvallisuuteesi kohdistuvia riskejä, joita ei ole, kun teet ostoksia säännellyn alustan ja pankkitilisi kautta.

Asuinpaikasta riippuen myös suurten rahasummien kuljettaminen ja säilyttäminen voi aiheuttaa riskejä, olipa kyseessä sitten Bitcoin tai käteinen raha.

Käteisen vaihtaminen voi myös aiheuttaa oikeudellisia riskejä poliisin tai muiden tarkastusten yhteydessä. Vaikka useimmissa maissa ei ole rajoituksia käteisen rahan määrälle, liian suuret summat voivat herättää epäilyksiä. Ole siis varovainen, varsinkin jos joudut matkustamaan pitkiä matkoja, ja vältä liian suuria summia kerralla, jotta sinun ei tarvitse perustella, että sinulla on hallussasi huomattavia summia.

Toinen P2P-ostojen haittapuoli on se, että hinta on usein korkeampi kuin säännellyillä alustoilla. Myyjät perivät usein lisämaksun, joka vaihtelee 1 prosentista joskus yli 10 prosenttiin. Hintaero johtuu useista syistä. Ensinnäkin se on P2P-myyjien yleinen käytäntö, joka on vakiintunut ajan myötä. Lisäksi myyjillä on transaktiomaksuja, jotka liittyvät varojen lähettämiseen ostajalle. P2P-myynnissä on myös suurempi varkausriski kuin alustakaupoissa, mikä oikeuttaa maksun perimiseen riskin vuoksi. Lisäksi palkkio voi olla suhteessa kysyntään ja vaihdannan laatuun yksityisyyden suojan kannalta. Ostajana yksityisyyden suojaa koskeva hyöty on hinnoiteltu myyjän perimään lisämaksuun. Jotkut bitcoin-asiakkaat uskovat myös, että P2P-palvelussa ostettujen BTC:iden kohonnut hinta kuvastaa niiden todellista arvoa, ja väittävät, että säänneltyjen alustojen alhaisemmat hinnat ovat seurausta yksityisyyden suojaa koskevasta kompromissista.

### P2P-vaihdot Matching Platformin kautta

Henkilökohtaisen turvallisuuden kannalta riskittömämpi vaihtoehto on tehdä P2P-vaihdot yksinomaan verkossa sähköisten maksutapojen, kuten PayPalin, pankkisiirtojen tai Revolutin, kautta.

Tällä lähestymistavalla vältetään monet käteistapahtumiin liittyvät riskit. Riski siitä, että vastapuoli ei noudata sitoumuksiaan verkkokaupan aikana, on kuitenkin suurempi. Itse asiassa fyysisen vaihdon aikana, jos annat rahaa myyjälle, joka ei lähetä sinulle vastineeksi bitcoineja, voit välittömästi vaatia häntä kertomaan siitä, koska hän seisoo edessäsi. Verkossa sen sijaan on usein mahdotonta löytää henkilöä, joka on varastanut sinulta.

Tämän riskin pienentämiseksi P2P-vaihdoissa voidaan käyttää erikoistuneita matching-alustoja. Näissä alustoissa käytetään konfliktinratkaisumekanismeja loukkaantuneiden käyttäjien suojelemiseksi. Yleensä ne tarjoavat escrow-järjestelmän, jossa bitcoineja säilytetään, kunnes myyjä on vahvistanut maksun fiat-valuutassa.

Henkilökohtaisen turvallisuuden kannalta tämä ostomenetelmä on huomattavasti turvallisempi kuin fyysinen käteisrahan vaihto. Kuten aiemmin mainittiin, P2P-verkkopörssit jättävät kuitenkin enemmän jälkiä kuin fyysinen vaihto, mikä voi olla haitaksi Bitcoinin yksityisyydelle. Käyttämällä verkossa fiat-maksutapaa, kuten pankkia, paljastat enemmän tietoja, jotka voivat helpottaa avaintunnistusta.

Jälleen kerran suosittelen, että näillä alustoilla ei tehdä suuria kauppoja yhdellä kertaa. Jakamalla transaktiot hajautat vastapuolen mahdolliseen varkauteen liittyvät riskit.

Toinen P2P-ostojen haittapuoli on se, että hinta on usein korkeampi kuin säännellyillä alustoilla. Myyjät perivät usein lisämaksun, joka vaihtelee 1 prosentista joskus yli 10 prosenttiin. Hintaeroa selittävät useat syyt. Ensinnäkin se on P2P-myyjien yleinen käytäntö, joka on vakiintunut ajan myötä. Lisäksi myyjillä on transaktiomaksuja, jotka liittyvät varojen lähettämiseen ostajalle. P2P-myynnissä on myös suurempi varkausriski kuin alustakaupoissa, mikä oikeuttaa maksun perimiseen riskin vuoksi. Lisäksi palkkio voi olla suhteessa kysyntään ja vaihdannan laatuun yksityisyyden suojan kannalta. Ostajana yksityisyyden suojaa koskeva hyöty on hinnoiteltu myyjän perimään lisämaksuun. Jotkut bitcoin-asiakkaat uskovat myös, että P2P-kaupasta ostetun BTC:n korkeampi hinta kuvastaa sen todellista arvoa, ja väittävät, että säänneltyjen alustojen alhaisemmat hinnat ovat seurausta yksityisyyden suojaa koskevasta kompromissista.

Mitä tulee ratkaisuihin, olen itse aina käyttänyt [Bisq](https://bisq.network/) ja olen erittäin tyytyväinen niihin. Heidän järjestelmänsä on vakiintunut ja vaikuttaa luotettavalta. Bisq on kuitenkin saatavilla vain PC:lle, ja sen käyttöliittymä voi olla liian monimutkainen aloittelijoille. Toinen haittapuoli on se, että Bisq toimii yksinomaan onchain-tapahtumilla, mikä voi tulla kalliiksi aikoina, jolloin Bitcoinin transaktiomaksut ovat korkeat.

-> Tutustu Bisqin opetusohjelmaan.

https://planb.network/tutorials/exchange/peer-to-peer/bisq-fe244bfa-dcc4-4522-8ec7-92223373ed04
Helpompaa on kokeilla [Peach](https://peachbitcoin.com/), mobiilisovellusta, joka helpottaa ostajien ja myyjien välistä yhteyttä integroidun riidanratkaisujärjestelmän avulla. Prosessi on intuitiivisempi kuin Bisqin.

-> Tutustu oppaaseemme Peachista.

Toinen online-vaihtoehto on [HodlHodl](https://hodlhodl.com/), vakiintunut alusta, joka tarjoaa hyvää likviditeettiä, vaikka en olekaan itse testannut sitä.

-> Tutustu HodlHodlin opetusohjelmaan.

https://planb.network/tutorials/exchange/peer-to-peer/peach-wallet-db64fe42-17ca-4b24-abb8-e7d4c03b2028
https://planb.network/tutorials/exchange/peer-to-peer/hodlhodl-d7344cd5-6b18-40f5-8e78-2574a93a3879
Lightning Network -pohjaisia ratkaisuja varten voit kokeilla [RoboSats](https://learn.robosats.com/) ja [LNP2PBot](https://lnp2pbot.com/). RoboSatsiin pääsee verkkosivuston kautta, ja se on suhteellisen helppokäyttöinen. LNP2PBot on epätyypillisempi siinä mielessä, että se toimii Telegram-viestisovelluksen vaihtojärjestelmän kautta.

-> Tutustu oppaaseemme RoboSateista.

-> Tutustu LNP2PBot-oppaaseen.

https://planb.network/tutorials/exchange/peer-to-peer/robosats-b60e4f7c-533a-4295-9f6d-5368152e8c06
https://planb.network/tutorials/exchange/peer-to-peer/lnp2pbot-v2-e6bcb210-610b-487d-970c-7cce85273e3c
### Säännellyt alustat ilman KYC:tä

Riippuen siitä, missä maassa asut, sinulla voi olla pääsy säänneltyihin alustoihin, jotka eivät vaadi KYC-menettelyä bitcoinin ostamiseen tai myymiseen. Esimerkiksi Sveitsissä voit käyttää sellaisia alustoja kuin [Relai](https://relai.app/) ja [MtPelerin](https://www.mtpelerin.com/).

-> Tutustu Relai-oppaaseemme.

Kuten edellisessä luvussa todettiin, tämäntyyppiset alustat säästävät sinua KYC-menettelyihin liittyviltä riskeiltä, mutta ne aiheuttavat suuremman riskin avainten tunnistamisen kannalta. Bitcoinin yksityisyyden kannalta nämä alustat tarjoavat siis paremman suojan kuin KYC-ostomenetelmät, mutta ne eivät ole yhtä houkuttelevia kuin P2P-pörssit.

Henkilökohtaisen turvallisuuden kannalta näiden alustojen käyttö on kuitenkin huomattavasti vähemmän riskialtista kuin P2P-pörssien. Ne ovat usein myös helpompia käyttää kuin P2P-vaihtoa helpottavat alustat.

https://planb.network/tutorials/exchange/centralized/relai-v2-30a9671d-e407-459d-9203-4c3eae15b30e
### PANKKIAUTOMAATTI

Toinen vaihtoehto ostaa tai myydä bitcoinia ilman KYC:tä ovat kryptovaluutta-automaatit (ATM). Henkilökohtaisesti minulla ei ole koskaan ollut tilaisuutta testata tätä ratkaisua, sillä kotimaassani ei ole yhtään. Mutta tämä menetelmä voi olla hyvin mielenkiintoinen riippuen siitä, missä asut.

Pankkiautomaatteihin liittyy se ongelma, että ne ovat joissakin maissa kiellettyjä tai tiukasti säänneltyjä. Jos pankkiautomaatti edellyttää henkilöllisyyden todentamisprosessia, siihen kohdistuu samat riskit kuin säänneltyihin KYC-alustoihin. Jos pankkiautomaatti kuitenkin sallii liiketoimet ilman henkilöllisyyden todentamista pienten summien osalta, sen käyttö voi tarjota käteispohjaiseen P2P-vaihtoon verrattavan yksityisyyden suojan, jolloin vältytään suurimmalta osin tämäntyyppiseen vaihtoon liittyviltä riskeiltä.

Pankkiautomaattien suurin haittapuoli on niiden usein korkeat valuutanvaihtomaksut, jotka vaihtelevat muutamasta prosentista joskus jopa 15 prosenttiin vaihdetusta summasta.

### Lahjakortit

Lopuksi halusin myös esitellä ratkaisun, joka toimii hyvin niille, jotka haluavat käyttää bitcoinejaan päivittäin ostoksiin sen sijaan, että myisivät niitä fiat-valuuttoihin.

Paras tapa käyttää BTC:tä on luonnollisesti käyttää Bitcoinia suoraan tai Lightning Networkin kautta tavaroiden tai palveluiden ostamiseen. Monissa maissa bitcoinin hyväksyvien kauppiaiden määrä on kuitenkin edelleen rajallinen. Käytännöllinen vaihtoehto on siksi lahjakorttien käyttö.

Useat alustat, jotka eivät vaadi KYC-menettelyä, tarjoavat mahdollisuuden vaihtaa bitcoinit lahjakortteihin, joita voi käyttää suurimmissa kaupoissa. Näitä alustoja ovat [CoinsBee](https://www.coinsbee.com/), [The Bitcoin Company](https://thebitcoincompany.com/) ja [Bitrefill](https://www.bitrefill.com/). Nämä alustat helpottavat suuresti bitcoinien päivittäistä käyttöä, sillä niiden avulla voit käyttää monenlaisia tuotteita ja palveluita ilman, että sinun tarvitsee käydä läpi fiat-valuutan muuntamista.

https://planb.network/tutorials/exchange/centralized/bitrefill-8c588412-1bfc-465b-9bca-e647a647fbc1
### Muut hankintamenetelmät

Muita tapoja hankkia bitcoineja yksityisyyttä suojellen on tietenkin louhinta. Aloittaaksesi satsin louhinnan sinun ei tarvitse paljastaa henkilöllisyyttäsi; etsi vain voimassa oleva työtodistus ja lähetä se verkkoon. Jos valitset yhdistetyn louhinnan, jotkin poolit vaativat jonkinlaisen henkilöllisyystodistuksen, kuten KYC:n, kun taas toiset eivät.

Toinen tapa on työskennellä bitcoinia vastaan. Tämä hankintamenetelmä voi olla houkutteleva, mutta vaadittava tunnistautumisaste vaihtelee suuresti olosuhteista riippuen.

\_Kirjoittaakseni tämän luvun käytin [@pivi\_\_](https://x.com/pivi___) Plan ₿ Network -verkossa luomaa BTC205-kurssia (toistaiseksi saatavilla vain ranskaksi).\_

## Konsolidointi, UTXO ja CIOH Hallinto

<chapterId>d0486c8f-332d-402b-ae2e-949416752b9c</chapterId>

Yksi monimutkaisimmista hallinnoitavista seikoista, kun sinulla on oma itsevarastointisalkku, on epäilemättä konsolidointi. Pitäisikö sinun konsolidoida? Mikä on tarkoitus? Minkä kokoiseen UTXO:n olisi pyrittävä? Mitkä ovat yksityisyyden suojaa koskevat kompromissit? Tätä yritämme tutkia tässä jaksossa.

### Mitä on konsolidointi?

Bitcoinin toiminta muistuttaa huutokauppamarkkinoita, joilla louhijat suosivat parhaita maksuja tarjoavia tapahtumia. Kullakin lohkolla on kuitenkin enimmäispaino, joka rajoittaa mukaan otettavien transaktioiden määrää. Koska lohko tuotetaan keskimäärin 10 minuutin välein, kussakin lohkossa käytettävissä oleva tila on harvinainen resurssi.

Kaivostoiminnan harjoittajat, joiden liiketoimintaan liittyy merkittäviä sähkö-, pääoma- ja ylläpitokustannuksia, pyrkivät luonnollisesti maksimoimaan kannattavuutensa. Niillä on taipumus suosia transaktioita, jotka tarjoavat niille korkeimmat maksut suhteessa niiden painoon.

Itse asiassa kaikki Bitcoin-tapahtumat eivät paina samalla tavalla. Ne, joissa on enemmän panoksia ja tuotoksia, painavat enemmän. Tarkastellaan esimerkiksi kahta transaktiota:


- Tapahtuma A sisältää 1 tulon ja 1 lähdön. Siitä peritään 1 994 maksusataa ja sen painoarvo on 141 vB;
- Monimutkaisempi tapahtuma B, jossa on 2 tuloa ja 2 lähtöä, jakaa 2 640 satsia palkkioita, joiden paino on 220 vB.

Esimerkissä, vaikka transaktio B tarjoaa korkeampaa kokonaispalkkiota, louhijat suosivat transaktiota A, koska se tarjoaa paremman palkkio-painosuhteen. Seuraavassa on laskelma kullekin transaktiolle ilmaistuna sateina virtuaalista tavua kohti (sat/vB):

```text
TXA: 1994 / 141 = 14 sat/vB
TXB: 2640 / 220 = 12 sat / vB
```

Tämä tarkoittaa, että jokaisesta painoyksiköstä tapahtuma A tarjoaa enemmän maksuja kuin tapahtuma B, vaikka jälkimmäinen tarjoaa absoluuttisesti enemmän maksuja.

Siksi käyttäjän kannalta on yhä houkuttelevampaa käyttää mahdollisimman vähän panoksia maksutapahtumiinsa. On kuitenkin välttämätöntä kuluttaa riittävästi, jotta tuotosmaksu voidaan maksaa. Oman salkun hallinnoinnissa on siis välttämätöntä, että UTXO:t ovat riittävän suuria.

Konsolidoinnin periaatteena on nimenomaan hyödyntää ajanjaksoja, jolloin Bitcoinin maksut ovat alhaiset, ja yhdistää pienet UTXO:t yhdeksi suuremmaksi UTXO:ksi. Kun Bitcoinin maksut nousevat, voidaan tehdä liiketoimia mahdollisimman pienellä panostuksella ja siten käyttää vähemmän absoluuttisia maksuja. Tavoitteena on suunnitella pakolliset transaktiot korkeiden palkkioiden kausina.

Transaktiomaksujen säästämisen lisäksi UTXO:iden yhdistäminen auttaa välttämään "pölyn" syntymistä Pölyllä tarkoitetaan UTXO:ita, joiden arvo sateina on niin alhainen, että se ei riitä kattamaan niiden käyttämiseen tarvittavia transaktiomaksuja. Tämä tekee näiden UTXO:iden käytöstä taloudellisesti järjenvastaista niin kauan kuin transaktiomaksut pysyvät korkeina. Ryhmittelemällä UTXO:t ennakoivasti, estät niiden muuttumisen pölyksi ja varmistat, että kaikki varasi pysyvät käyttökelpoisina.

### Mikä on UTXO:n vähimmäiskoko?

Minulta kysytään joskus, mikä on UTXO:n suositeltu vähimmäisarvo. Valitettavasti ei ole olemassa yleispätevää vastausta, koska se riippuu mieltymyksistäsi ja palkkiomarkkinoiden olosuhteista. Tässä on kuitenkin kaava, jonka avulla voit määrittää tarpeisiisi sopivan kynnysarvon:

$$
\frac {P \times F}T = M
$$

Missä:


- $P$ on tapahtuman paino;
- $F$ edustaa enimmäishintaa satosheina per vbyte (sats/vB), jonka olet valmis maksamaan;
- $T$ on transaktiomaksun prosenttiosuus, jonka olet valmis maksamaan suhteessa UTXO:n kokonaisarvoon;
- $M$ on kunkin UTXO:n vähimmäissumma satoshina.

Jos oletetaan, että haluat kattaa tavallisen SegWit-tapahtuman, jossa on 1 tulo ja 2 lähtöä, palkkiot, jotka painavat 141 vB. Jos katat enintään 800 sats/vB ja olet valmis käyttämään enintään 12 prosenttia UTXO-arvosta palkkioihin, laskelma olisi seuraava:

$$
\frac{141 \times 800}{0.12} = 940\ 000
$$

Tässä esimerkissä olisi viisasta säilyttää salkussa UTXO:n vähimmäisarvo 940 000 sat.

### Konsolidointi ja COIH

Yksi laajimmin käytetyistä heuristiikoista lohkoketjujen analysoinnissa on COIH (__Common Input Ownership Heuristic_), jonka avulla voidaan olettaa, että kaikki Bitcoin-tapahtuman syötteet kuuluvat samalle taholle. Tarkalleen ottaen konsolidoinnin periaatteena on, että syötteenä kulutetaan useita UTXO:ita ja tuotoksena luodaan yksi UTXO. Näin ollen konsolidointi mahdollistaa COIH:n soveltamisen.

![BTC204](assets/fr/097.webp)

Käytännössä tämä tarkoittaa, että ulkopuolinen tarkkailija voi päätellä, että kaikki konsolidoidut UTXO:t kuuluvat todennäköisesti samalle henkilölle ja että myös ainoa tuotettu tuloste kuuluu hänelle. Tämä tilanne voi vaarantaa yksityisyytesi, kun eri tapahtumahistoriat yhdistetään toisiinsa. Oletetaan esimerkiksi, että yhdistän 3 P2P-kaupassa hankittua UTXO:ta yhteen UTXO:hon, joka on hankittu KYC:tä edellyttävän alustan kautta:

![BTC204](assets/fr/098.webp)

Näin toimimalla mikä tahansa taho, jolla on pääsy pörssialustan tietoihin, mahdollisesti myös valtion virastot, voi tunnistaa, että minulla on hallussani muita määriä BTC:tä. Aiemmin nämä UTXO:t eivät olleet suoraan yhteydessä henkilöllisyyteeni; nyt ne ovat. Lisäksi tämä paljastaa kaikille lähteille, että minulla on hallussani tietty määrä bitcoineja.

UTXO:iden hallinnoinnissa taloudelliset näkökohdat, jotka kannustavat yhdistämiseen maksujen alentamiseksi, ovat näin ollen ristiriidassa hyvien tietosuojakäytäntöjen kanssa, joiden mukaan UTXO:iden yhdistämistä ei pitäisi koskaan tehdä. Valinta talouden ja yksityisyyden suojan välillä riippuu siis kunkin käyttäjän prioriteeteista.

Jos voit välttää konsolidoinnin ja säilyttää samalla UTXO-rahastojen huomattavan koon, se on ihanteellista. Tätä varten optimoi hankintamenetelmät. Jos ostat bitcoineja DCA:sta, yritä sijoittaa kertaluonteiset ostosi mahdollisimman laajalle, jotta arvo voidaan ryhmitellä pienempiin UTXO-yksiköihin. On helpompi hallita 1000 euron kertaluonteinen osto kahden kuukauden välein kuin 120 euron osto joka viikko. Tämä minimoi syntyvien UTXO:iden määrän ja yksinkertaistaa salkkusi hallintaa säilyttäen samalla yksityisyytesi.

Jos huomaat tarvitsevasi bitcoinien konsolidointia, aseta etusijalle samasta lähteestä peräisin olevien UTXO:iden konsolidointi. Esimerkiksi 10 UTXO:n yhdistäminen yhdeltä alustalta vaikuttaa vähemmän yksityisyyteesi kuin 5 UTXO:n yhdistäminen alustalta A ja 5 UTXO:n yhdistäminen alustalta B. Jos eri lähteistä peräisin olevien UTXO:iden yhdistäminen on väistämätöntä, yritä erottaa ne toisistaan niiden ominaisuuksien mukaan. Ryhmittele esimerkiksi KYC:n kautta hankitut UTXO:t yhdeksi tapahtumaksi ja P2P:n kautta hankitut UTXO:t toiseksi.

Muista joka tapauksessa, että kaikki konsolidointi johtaa väistämättä yksityisyyden menetykseen. Arvioi siksi huolellisesti, onko se tarpeen ja mitkä ovat mahdolliset vaikutukset yksityisyyteesi, ottaen huomioon riskit.

## Muut hyvät käytännöt

<chapterId>b5216965-7d13-4ea1-9b7c-e292966a487b</chapterId>

Tutustutaan yhdessä muutamiin muihin parhaisiin käytäntöihin, jotka voivat auttaa sinua optimoimaan yksityisyytesi Bitcoinissa.

### Täydellinen solmu

Bitcoineidesi säilyttäminen on hyvä asia, mutta oman kokonaisen solmun käyttäminen on vielä parempi! Tämän vuoksi oman solmun omistaminen on ratkaisevan tärkeää bitcoinin täysin suvereenille käytölle:


- Sensuurin vastustaminen**: Kukaan ei voi estää tapahtumiesi käsittelyä;
- Riippumattomuus kolmansista osapuolista**: Lohkoketjutietojen varmentaminen ei ole enää riippuvainen mistään ulkoisesta palvelusta;
- Aktiivinen osallistuminen**: Sinulla on mahdollisuus asettaa omat validointisääntösi ja osallistua suoraan konsensukseen;
- Osallistuminen verkostoon**: Käyttämällä solmua autat vahvistamaan ja jakamaan Bitcoin-verkkoa;
- Tekninen koulutus**: Tämä on hyvä tapa syventää teknistä tietämystäsi Bitcoinista.

Näiden etujen lisäksi täyden solmupisteen käyttö parantaa myös yksityisyyttäsi, kun siirrät tapahtumia. Kun lähetät transaktion, se luodaan ja allekirjoitetaan ensin lompakkosi kautta. Jotta se voidaan lähettää Bitcoin-verkossa, sen on oltava vähintään yhden solmun tiedossa. Käyttämällä omaa solmua hallitset suoraan tätä lähetystä, mikä parantaa yksityisyyttäsi ja rajoittaa tietojen katoamisen riskiä.

![BTC204](assets/fr/099.webp)

Jos sinulla ei ole omaa Bitcoin-solmua, joudut käyttämään kolmannen osapuolen solmua, esimerkiksi lompakko-ohjelmiston tarjoajan tarjoamaa solmua. Tapahtumien lähettämisen lisäksi lompakkosi tarvitsee pääsyn erilaisiin tietoihin, kuten vireillä oleviin tapahtumiin, osoitteisiisi liittyviin saldoihin tai tapahtumiesi vahvistusten määrään. Kaikkiin näihin tietoihin pääsemiseksi sinun on tehtävä kysely solmulle.

![BTC204](assets/fr/100.webp)

Suurin riski, kun et käytä Bitcoin-solmua, on se, että kolmannen osapuolen solmun ylläpitäjä voi tarkkailla toimintaasi lohkoketjussa tai jopa jakaa nämä tiedot muiden tahojen kanssa. Tämän riskin rajoittamiseksi välivaiheen ratkaisu on käyttää lompakko-ohjelmistoa, jonka avulla voit peittää yhteytesi Torin kautta. Tämä voi vähentää tietojesi paljastumista. Optimaalinen ratkaisu on kuitenkin edelleen oma Bitcoin-solmu ja sen käyttäminen transaktioiden välittämiseen. Tietenkin sinun on myös varmistettava, ettei solmusta vuoda tietoja ulos, mutta tämä on toinen aihe, jota käsittelemme seuraavissa osioissa.

Yksityisyytesi kannalta ilmeisen hyödyn lisäksi oman täydellisen solmun omistaminen varmistaa lohkoketjun tietojen todenperäisyyden, suojaa sensuurilta ja antaa sinulle mahdollisuuden osallistua aktiivisesti Bitcoinin hallintoon. Käyttämällä omaa solmua annat oman taloudellisen painosi valitsemallesi lohkoketjulle, mikä on tärkeää yhteisön sisäisten konfliktien aikana, kuten esimerkiksi lohkokokosodan aikana vuosina 2015-2017. Haarautumistapauksessa kolmannen osapuolen solmun käyttäminen voi johtaa siihen, että tuet ketjua, jota et halua suosia, sillä solmun ylläpitäjä tekee valinnan puolestasi. Kuten voit ymmärtää, yksityisyyden ja yleisemmin yksilön suvereniteetin näkökulmasta on olennaista pyörittää ja käyttää omaa täyttä solmua!

### Harhaanjohtava analyysi Heuristiikka

Yleisemmin ottaen on tärkeää ymmärtää edellisessä jaksossa käsiteltyjä heuristiikkoja, jotta niitä voidaan paremmin välttää tai huijata. Useiden parhaiden käytäntöjen omaksuminen voi osoittautua hyödylliseksi, vaikka ne eivät olisikaan välttämättömiä. Ne tarjoavat lisäsuojakerroksen, joka voi olla tärkeä hyvän yksityisyyden säilyttämiseksi Bitcoinia käytettäessä.

Ensimmäinen neuvo, jonka voisin antaa, on sulautua tiheimpään väkijoukkoon. Bitcoinissa tämä tarkoittaa laajimmin hyväksyttyjen skriptipohjien käyttöä. Esimerkiksi P2WSH-skriptit, joita käytetään usein multisig SegWit V0 -konfiguraatioissa, ovat hyvin harvinaisia. Niiden avulla et voi piiloutua suureen joukkoon anonymiteettiä. Sama pätee vanhempiin malleihin, kuten P2PKH tai P2SH. Vaikka ne ovat laajalti läsnä UTXO-joukossa, niitä käytetään yhä harvemmin uusissa transaktioissa.

Yleensä on turvallisempaa siirtyä uusimpaan käsikirjoitusstandardiin, kunhan se on hyväksytty riittävästi. Näin ollen, kun vuonna 2022 olisin neuvonut olemaan käyttämättä P2TR-skriptiä (Taproot) sen vähäisen hyväksynnän vuoksi, vuonna 2024 suosittelisin valitsemaan tämäntyyppisen skriptin tai, jos se ei onnistu, SegWit V0 -skriptin, koska P2TR-skriptiä käyttävien transaktioiden määrä alkaa olla hyvin merkittävä.

Lähde:[txstats.com](https://txstats.com/d/000000054/utxo-set-repartition-by-output-type)

Toinen vinkki yksityisyyden säilyttämiseksi on yrittää kiertää sisäisten tapahtumien heuristiikkaa. Kun esimerkiksi suoritat maksun, voit yrittää välttää luomasta tulostetta, jossa summa on pyöreä, koska se saattaisi viestiä, että toinen tuloste edustaa muutosta. Jos sinun on lähetettävä 100 000 satoshia ystävällesi, harkitse hieman suuremman summan siirtämistä välttyäksesi tältä heuristiikalta. Yritä myös välttää luomasta jäännöstuloksia, jotka ovat suhteettoman suuria verrattuna suoritettuun maksuun, sillä tämä voisi myös paljastaa, mikä tuloksista edustaa jäännöstä.

Jos suoritat Bitcoin-tapahtumia säännöllisesti, varmista, ettet lähetä niitä aina samaan aikaan. Jakamalla transaktioiden lähettämisen päivän ja viikon ajalle vältät sen, että ulkopuoliset tarkkailijat voivat havaita aikavyöhykkeisiin perustuvan aikamallin, joka voisi parantaa heidän analyysiään.

Kaikkien näiden parhaiden käytäntöjen lisäksi, jotka kannattaa ottaa käyttöön päivittäin, on olemassa vielä tehokkaampia menetelmiä, joilla bitcoinien jäljitettävyys voidaan katkaista kokonaan. Näihin kuuluvat tietenkin coinjoin-transaktiot, joita tutkimme perusteellisesti seuraavassa osiossa.

# Coinjoin-transaktioiden ymmärtäminen

<partId>6d0bbf16-3714-4db1-9897-2d45019f6bdc</partId>

## Mikä on Coinjoin-transaktio?

<chapterId>0862bc6b-1c48-4aa4-b76d-4f547b469008</chapterId>

Tutustuttuamme yksityisyyden suojan perusteisiin käsittelemme nyt kehittyneempiä tekniikoita, joiden tarkoituksena on suojella yksityisyyttäsi aktiivisesti, erityisesti irrottamalla bitcoin-historiasi. Seuraavassa osassa tutkimme monia pieniä tekniikoita, mutta ensin haluan kertoa sinulle coinjoinista.

Coinjoinia pidetään usein tehokkaimpana tapana suojata Bitcoin-käyttäjien yksityisyyttä. Mutta mitä coinjoin-transaktio tarkalleen ottaen on? Selvitetään se yhdessä.

### Coinjoinin perusperiaatteet

Coinjoin on tekniikka, joka häiritsee bitcoinien seurantaa lohkoketjussa. Se perustuu yhteistoiminnalliseen transaktioon, jolla on samanniminen erityinen rakenne: coinjoin-transaktio.

Kuten näimme tämän koulutuksen ensimmäisissä osissa, Bitcoinin transaktiot ovat kaikkien käyttäjien tiedossa heidän solmunsa kautta. Siksi on helppo tarkistaa kunkin kolikon sähköinen allekirjoitusketju ja tarkkailla sen historiaa. Tämä tarkoittaa, että kaikki käyttäjät voivat yrittää analysoida muiden käyttäjien transaktioita. Tämän seurauksena anonymiteetti transaktiotasolla on mahdotonta. Anonymiteetti säilyy kuitenkin yksilöllisen tunnistamisen tasolla. Toisin kuin perinteisessä pankkitoiminnassa, jossa jokainen tili on sidottu henkilökohtaiseen henkilöllisyyteen, Bitcoinissa varat liitetään kryptografisiin avainpareihin (tai skripteihin), mikä tarjoaa käyttäjille eräänlaisen pseudonymiteetin kryptografisten tunnisteiden takana.

![BTC204](assets/it/51/01.webp)

Näin ollen bitcoinin luottamuksellisuus vaarantuu, kun ulkopuoliset tarkkailijat pystyvät yhdistämään tietyt UTXO:t tunnistettuihin käyttäjiin. Kun tämä yhteys on luotu, on mahdollista seurata heidän transaktioitaan ja analysoida heidän bitcoin-historiaansa. Coinjoin on nimenomaan tekniikka, joka on kehitetty häiritsemään UTXO:iden seurantaa, jotta Bitcoin-käyttäjille voidaan tarjota jonkinasteinen luottamuksellisuus transaktiotasolla.

Coinjoins parantaa Bitcoin-käyttäjien luottamuksellisuutta vaikeuttamalla ketjun analysointia ulkopuolisten tarkkailijoiden kannalta. Niiden rakenne mahdollistaa useiden eri käyttäjien kolikoiden yhdistämisen yhdeksi transaktioksi, mikä hämärtää jälkiä ja vaikeuttaa tulo- ja lähtöosoitteiden välisten yhteyksien määrittämistä.

On tärkeää ymmärtää, että coinjoin-transaktion tavoitteena on häiritä kolikon historiaa. Tämä tekniikka ei anna pysyvää anonymiteettiä tai lopeta pysyvästi bitcoinien jäljitettävyyttä, toisin kuin voisi luulla. Coinjoinin tavoitteena on vain keskeyttää historia siinä vaiheessa, kun coinjoin-transaktio suoritetaan. Kolikko on kuitenkin ennen tätä transaktiota ja sen jälkeen edelleen samojen yksityisyysriskien kohteena.

![BTC204](assets/fr/104.webp)

### Miten coinjoinit toimivat?

Coinjoinin periaate perustuu yhteistoiminnalliseen lähestymistapaan: useat käyttäjät, jotka haluavat sekoittaa bitcoinejaan, tallettavat identtiset summat saman transaktion syötteisiin. Nämä summat jaetaan sitten uudelleen kullekin käyttäjälle samanarvoisina tuloina.

![BTC204](assets/fr/105.webp)

Tapahtuman lopussa on mahdotonta yhdistää tiettyä tulosta tunnettuun käyttäjän syötteeseen. Syötteiden ja tuotosten välillä ei ole suoraa yhteyttä, mikä rikkoo käyttäjien ja heidän UTXO:nsa välisen yhteyden sekä kunkin kolikon historian.

![BTC204](assets/fr/106.webp)

Otetaanpa esimerkki Alicesta. Hän haluaa lähettää noin 100 000 satoshia (satsia) siskolleen Eevelle tämän syntymäpäiväksi. Alice ei kuitenkaan halua, että Eve pystyy seuraamaan hänen tapahtumahistoriaansa, koska hän ei halua paljastaa, kuinka monta bitcoinia hän omistaa tai miten hän on ne saanut. Tätä varten Alice päättää häiritä UTXO-historiaansa coinjoin-transaktiolla. Hän sopii Bobin, Charlesin, Davidin ja Frankin kanssa yhteistransaktion toteuttamisesta: Alice, Bob, Charles, David ja Frank sitoutuvat kukin antamaan 105 000 satsin UTXO:n (josta 5 000 satsia on louhintamaksuja) transaktion panoksena:

![BTC204](assets/fr/107.webp)


- Vastineeksi näiden syötteiden käytöstä kukin tuottaa uuden osoitteen, jolla luodaan viisi samanlaista 100 000 satsin tuotosta. Kukin osallistuja hakee yhden tuotoksen:

![BTC204](assets/fr/108.webp)


- Alice saa lopulta 100 000 satelliitin UTXO:n, jonka historia on sekalainen. Hän käyttää tätä UTXO:ta uudessa transaktiossa lähettääkseen summan Eevalle tämän syntymäpäiväksi:

![BTC204](assets/fr/109.webp)


- Jos Eve yrittää analysoida tätä transaktiota poimiakseen tietoa, hän törmää coinjoin-transaktioon, jossa ovat mukana Alice, Bob, Charles, David ja Frank. Koska Eve ei voi erottaa, kenelle kukin panos kuuluu määrien yhdenmukaisuuden vuoksi, hän ei voi jäljittää Alicen UTXO:n historiaa tai määrittää, kuinka monta bitcoinia hänen sisarensa omistaa tai miten hän on ne hankkinut:

![BTC204](assets/fr/110.webp)

Tässä skenaariossa Alice käytti coinjoin-tekniikkaa lisätäkseen yksityisyyttään taaksepäin suuntautuvaa analyysia vastaan. Alice suojaa itse asiassa itseään Evan mahdolliselta analyysiltä, joka aloittaisi tietystä transaktiosta ja jäljittäisi UTXO:n historiaa taaksepäin. Tätä suojaa nykyhetkestä menneisyyteen suuntautuvaa analyysia vastaan kutsumme takautuvaksi anonsetiksi. Tutustumme tähän käsitteeseen tarkemmin tämän osan viimeisissä luvuissa.

Coinjoin tarjoaa kuitenkin myös mahdollisuuden parantaa yksityisyyttä menneisyydestä nykyhetkeen ulottuvaa analyysia vastaan, mitä kutsutaan prospektiiviseksi anonsetiksi. Palataanpa esimerkkiin, jossa Alice lähetti 98 000 satsia Eevalle tämän syntymäpäivänä, mutta vaihdetaan roolit. Kuvitellaan nyt, että Eve on huolissaan yksityisyydestään. Itse asiassa Liisa saattaisi houkutella seuraamaan Eevalle lähettämäänsä kolikkoa tietojen keräämiseksi. Eve voisi yhdistää tämän äskettäin saamansa UTXO:n kaikkien muiden UTXO:idensa kanssa, mikä voisi paljastaa Alicelle lompakossaan olevan bitcoinin määrän. Tämän välttämiseksi Eve voi myös häiritä äskettäin vastaanotetun kolikon historiaa.


- Eve, Grace, Mallory, Oscar ja Victor laittoivat kukin 98 000 satsin UTXO:n Bitcoin-tapahtuman syötteeksi:

![BTC204](assets/fr/111.webp)


- Vastineeksi näiden syötteiden käytöstä kukin antaa uuden osoitteen, jonka avulla luodaan 5 tuotosta, joista kukin on 97 500 satelliittia, jotka ovat täysin samanarvoisia. Kukin käyttäjä saa yhden ulostulon:

![BTC204](assets/fr/112.webp)


- Eevalla on nyt 97 500 satelliitin UTXO, jonka historia on rikkinäinen. Hän voi käyttää sitä pelkäämättä tulevissa liiketoimissa. Itse asiassa, jos Alice yrittää seurata Eevelle lähettämiään bitcoineja, hän törmää coinjoin-transaktioon. Hän ei pysty määrittämään, mihin UTXO-lähtöön Eve kuuluu. Analysointi on tällöin mahdotonta:

![BTC204](assets/fr/113.webp)

Ensimmäisessä esimerkissä näimme, miten coinjoin voi suojata kolikon yksityisyyden suhteessa sen menneisyyteen, ja toisessa esimerkissä, miten se voi turvata kolikon historian myös suhteessa sen tulevaisuuteen. Siksi mainitsin, että coinjoin olisi nähtävä kertaluonteisena tapahtumana, joka segmentoi kolikon historian molempiin suuntiin:

![BTC204](assets/fr/104.webp)

### Sekoittaminen, yhteisliitokset, sekoittimet... Mitä eroa niillä on?

Termiä "sekoittaminen" käytetään joskus kuvaamaan kolikkoliitoksia, ja jotkut bitcoin-asiakkaat hylkäävät tämän termin, koska he pelkäävät sekoittamista säilytyssekoittajiin. Mielestäni tämä pelko on kuitenkin aiheeton, koska matemaattisessa kontekstissa coinjoin ilmentää juuri sekoittamisen käsitettä.

Yleisellä matematiikan alalla sekoittumisella tarkoitetaan dynaamisen systeemin ominaisuutta, jossa tietyn ajan kuluttua kaikki alkuavaruuden osat voidaan teoriassa sekoittaa mihin tahansa muuhun osaan. Sekoittuminen merkitsee sitä, että hiukkasen sijainti tai systeemin tila kehittyy siten, että sen tuleva jakauma on riippumaton sen alkujakaumasta, jolloin saavutetaan tila, jossa alkutilan ominaisuudet jakautuvat tasaisesti systeemin avaruuteen. Juuri näin tapahtuu kolikkoliitoksessa bitcoineilla. Mielestäni coinjoin on siis oikeastaan kolikoiden sekoitusmenetelmä.

![BTC204](assets/fr/114.webp)

On kuitenkin tärkeää erottaa rinnakkaisliitokset ja sekoitukset toisistaan. Sekoittaja on palvelu, johon käyttäjät lähettävät bitcoinejaan sekoitettavaksi. Nämä palvelut olivat suosittuja 2010-luvulla, mutta niiden käyttö on vähentynyt, koska niillä on kaksi suurta haittaa coinjoiniin verrattuna:


- Ne edellyttävät, että käyttäjät luopuvat varojensa säilytyksestä sekoitusprosessin aikana, mikä altistaa heidät varkausriskille;
- Ei ole mitään takeita siitä, että sekoittaja ei tallenna transaktiotietoja tai edes myy näitä tietoja lohkoketjuanalytiikkayrityksille.

![BTC204](assets/fr/115.webp)

Nykyään käyttäjät suosivat kolikkoyhteyttä, koska sen avulla he voivat pitää rahansa täysin hallinnassa koko prosessin ajan. Coinjoiniin osallistujat eivät ole vaarassa, että muut osapuolet varastavat heidän bitcoininsa. Tutkitaan yhdessä, miten tämä on mahdollista seuraavassa luvussa.

## Zerolinkin ja Chaumianin kolikkoliitokset

<chapterId>326c9654-b359-4906-b23d-d6518dd5dc3e</chapterId>

Yhteenliittymän tarjoama yksityisyys perustuu sen ryhmän kokoon, johon kappaleemme on piilotettu. Siksi on välttämätöntä löytää mahdollisimman monta osallistujaa. On täysin mahdollista suorittaa coinjoin manuaalisesti itsenäisesti löytyneiden käyttäjien avulla, mutta tämä menetelmä on monimutkainen eikä mahdollista suuria anonsetteja.

Tämän vuoksi Bitcoiniin on kehitetty coinjoin-koordinaattoreita. Heidän tehtävänään on yhdistää eri käyttäjät ja välittää tiedot, joita tarvitaan yhteistapahtuman onnistuneeseen loppuunsaattamiseen.

![BTC204](assets/fr/116.webp)

Mutta miten voimme varmistaa, että koordinaattori ei koskaan voi hallita käyttäjien bitcoineja, ja vaikka hän on henkilö, joka rakentaa coinjoin-transaktion, miten voimme varmistaa, että hän ei voi yhdistää käyttäjien syötteitä ja tuotoksia, mikä voisi merkitä yksityisyyden menetystä?

### Chaumin sokeat allekirjoitukset

Nykyaikaisissa coinjoin-toteutuksissa käytetään David Chaumin sokeita allekirjoituksia tietovuodon estämiseksi. Tutkitaan yhdessä nopeasti, miten nämä sokeat allekirjoitukset toimivat.

Chaum-sokea allekirjoitus on digitaalisen allekirjoituksen muoto, jossa allekirjoituksen antaja ei tiedä allekirjoitettavan viestin sisältöä. Allekirjoitus voidaan kuitenkin myöhemmin todentaa alkuperäisen viestin avulla. Tämän tekniikan kehitti salakirjoittaja David Chaum vuonna 1983.

Esimerkkinä voidaan ottaa yritys, joka haluaa todentaa luottamuksellisen asiakirjan, kuten sopimuksen, paljastamatta sen sisältöä. Yritys soveltaa peittämisprosessia, joka muuttaa alkuperäisen asiakirjan kryptografisesti palautuvalla tavalla. Tämä muunnettu asiakirja lähetetään varmentajalle, joka allekirjoittaa sen sokeasti tietämättä asiakirjan sisältöä. Kun yritys on saanut allekirjoitetun asiakirjan, se poistaa peittämisen allekirjoituksesta. Tuloksena on alkuperäinen asiakirja, joka on varmennettu viranomaisen allekirjoituksella ilman, että viranomainen on koskaan nähnyt alkuperäistä sisältöä.

Chaumin sokeat allekirjoitukset mahdollistavat siis asiakirjan aitouden varmentamisen tuntematta sen sisältöä, mikä takaa sekä käyttäjän tietojen luottamuksellisuuden että allekirjoitetun asiakirjan eheyden.

### Chaumian Coinjoins

Chaumian CoinJoins -järjestelmässä Torin käyttö ja David Chaumin sokeat allekirjoitukset yhdistetään sen varmistamiseksi, että koordinaattori ei voi tietää, mille käyttäjälle kukin tuotos kuuluu. Coinjoin-transaktioiden rakentaminen koostuu kolmesta päävaiheesta: syötteen rekisteröinti, tuotoksen rekisteröinti ja transaktion allekirjoittaminen. Tarkastellaan tätä prosessia esimerkin Alice, yksi coinjoinin osallistujista. Kaikki muut osallistujat noudattavat samoja vaiheita kuin Alice, kukin omana itsenään.

**Vaihe 1: Syötteiden rekisteröinti.**


- Alice lähettää koordinaattorille UTXO-osoitteen, jota hän haluaa käyttää transaktion syötteenä, sekä naamioidun vastaanottoosoitteen, jota hän haluaa käyttää lähtönä bitcoiniensa vastaanottamiseen. Näin ollen koordinaattori ei voi tietää Alicen osoitetta. Se näkee vain hänen naamioidun versionsa.
- Koordinaattori tarkistaa syötteiden oikeellisuuden ja allekirjoittaa sitten Alicen peitetyn osoitteen hänen yksityisellä avaimellaan. Sen jälkeen hän lähettää Liisalle sokean allekirjoituksen.

**Vaihe 2: Lähtöjen tallentaminen.**


- Alice voi nyt poistaa naamion osoitteestaan, joka on allekirjoitettu koordinaattorin yksityisellä avaimella. Hän luo uuden yhteyden eri Tor-tunnuksella. Koordinaattori ei voi tunnistaa, että Alice on se, joka muodostaa yhteyden tällä uudella identiteetillä.
- Alice lähettää peittelemättömän osoitteen ja allekirjoituksen koordinaattorille (joka ei edelleenkään tiedä, että kyseessä on Alice).

**Vaihe 3: Allekirjoita transaktio.**


- Koordinaattori hakee samalla tavoin kaikkien osallistujien peittämättömät tuotokset. Koordinaattori voi tarkistaa allekirjoitusten avulla, että jokainen anonyymisti lähetetty tuotos on todella allekirjoitettu hänen yksityisellä avaimellaan, mikä varmistaa sen laillisuuden. Tämän jälkeen koordinaattori on valmis rakentamaan kolikkoyhteystapahtuman ja lähettää sen osallistujille allekirjoitettavaksi.
- Liisa tarkistaa muiden osallistujien tavoin, että hänen syötteensä ja tuotoksensa sisältyvät oikein koordinaattorin rakentamaan tapahtumaan. Jos kaikki on kunnossa, hän lähettää koordinaattorille allekirjoituksen, joka avaa hänen panoksensa käsikirjoituksen.
- Kun koordinaattori on kerännyt allekirjoitukset kaikilta coinjoin-osallistujilta, hän voi lähettää transaktion Bitcoin-verkon kautta, jotta se voidaan lisätä lohkoon.

Tässä järjestelmässä koordinaattori ei pysty yhdistämään syötettä tiettyyn tuotokseen. Lisäksi hän ei voi ottaa haltuunsa osallistujien varoja, koska hänellä ei ole koskaan pääsyä UTXO:iden avaamiseen tarvittaviin yksityisiin avaimiin. Koko prosessin ajan ja vaiheen 3 loppuun asti hänellä ei ole pääsyä edes allekirjoituksiin. Kun Alice ja muut osallistujat ovat allekirjoittaneet globaalin transaktion varmistettuaan, että kaikki on oikein, koordinaattori ei voi enää muuttaa tätä transaktiota, mukaan lukien tuotokset, mitätöimättä sitä. Näin estetään koordinaattorin tekemä bitcoin-varkaus.

Kun coinjoin-käyttäjä rekisteröi tuotoksensa transaktioon, hän haluaa samanlaiset takuut kuin vaaleissa äänestävä kansalainen. Näiden toimien julkisten ja yksityisten näkökohtien välillä on kaksijakoisuus. Toisaalta on se, mikä halutaan pitää yksityisenä: äänestäjä ei halua, että hänen äänestyslippuaan yhdistetään hänen henkilöllisyyteensä, ja kolikkoyhdistelmän käyttäjä ei halua, että hänen tulostaan yhdistetään hänen panokseensa. Jos koordinaattori tai joku muu osapuoli onnistuu luomaan yhteyden syötteen ja tuloksen välille, coinjoin menettää koko tarkoituksensa. Kuten aiemmin selitettiin, coinjoinin on toimittava katkoksena kolikon historiassa. Tämä tauko syntyy juuri siksi, että coinjoin-transaktiossa ei voida yhdistää tiettyä panosta tiettyyn tuotokseen (prospektiivinen anonset) ja päinvastoin (retrospektiivinen anonset).

Toisaalta on olemassa julkinen näkökulma: äänestäjä haluaa varmistaa, että hänen äänestyslippunsa on mukana vaaliuurnassa; samoin kolikkojohdon käyttäjä haluaa varmistaa, että hänen tuloksensa on mukana kolikkojohdon tapahtumassa. Itse asiassa on ehdottoman tärkeää, että coinjoin-osallistujat voivat varmistaa tuotoksensa olemassaolon ennen transaktion allekirjoittamista, sillä muuten koordinaattori voisi varastaa varat.

Juuri nämä kaksi julkista ja yksityistä näkökohtaa, jotka David Chaumin sokeat allekirjoitukset mahdollistavat, takaavat Chaumin coinjoin-osallistujille, että heidän bitcoinejaan ei varasteta ja että heidän varojaan ei voida jäljittää.

### Kuka keksi käsitteen coinjoin?

On vaikea määritellä varmasti, kuka esitteli ensimmäisenä Bitcoinin coinjoinin idean ja kuka keksi käyttää David Chaumin sokeita allekirjoituksia tässä yhteydessä. Usein ajatellaan, että Gregory Maxwell mainitsi sen ensimmäisenä [BitcoinTalkissa vuonna 2013 julkaistussa viestissä] (https://bitcointalk.org/index.php?topic=279249.0):

Chaumin sokeiden allekirjoitusten käyttäminen: Palvelin allekirjoittaa merkit ja palauttaa ne käyttäjille. Palvelin allekirjoittaa merkit ja palauttaa ne käyttäjille. Käyttäjät yhdistyvät uudelleen anonyymisti, paljastavat lähtöosoitteensa ja lähettävät ne takaisin palvelimelle. Palvelin näkee, että se on allekirjoittanut kaikki lähetykset ja että näin ollen kaikki lähetykset ovat kelvollisilta osallistujilta. Myöhemmin ihmiset ottavat uudelleen yhteyttä ja allekirjoittavat.

Maxwell, G. (2013, 22. elokuuta). _CoinJoin: Bitcoinin yksityisyys reaalimaailmassa_. BitcoinTalk Forum. https://bitcointalk.org/index.php?topic=279249.0

Molemmat Chaum-signatuurit on kuitenkin aiemmin mainittu sekoittumisen ja rinnakkaisliitosten yhteydessä. [Kesäkuussa 2011 Duncan Townsend esitteli BitcoinTalkissa](https://bitcointalk.org/index.php?topic=12751.0) sekoittajan, joka käyttää Chaumin allekirjoituksia tavalla, joka on melko samanlainen kuin nykyaikaiset Chaumin coinjoinit.

Samassa viestiketjussa on [hashcoin-viesti vastauksena Duncan Townsendille](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793) hänen miksaajansa parantamiseksi. Tässä viestissä kuvattu prosessi edustaa juuri sitä, mikä on lähimpänä coinjoineja. Samankaltainen järjestelmä mainitaan myös [Alex Mizrahin viestissä vuodelta 2012](https://gist.github.com/killerstorm/6f843e1d3ffc38191aebca67d483bd88#file-laundry), kun hän neuvoi Tenebrixin, yhden ensimmäisten altcoinien, perustana myöhemmin Litecoinin luomiselle toimineen Tenebrixin luojia. Edes itse termi "coinjoin" ei ollut Greg Maxwellin keksimä, vaan se tuli Peter Toddin ideasta.

![BTC204](assets/fr/125.webp)

### Zerolink

Zerolink on kattava sekoitusprotokolla, joka integroi Chaumiani-kolikkoliitokset ja erilaiset strategiat käyttäjien anonymiteetin suojaamiseksi erilaisilta ketjuanalyyseiltä, mikä vähentää huomattavasti lompakonhallintaan liittyviä virheitä. Tämän protokollan [esittivät nopara73 ja TDevD vuonna 2017](https://github.com/nopara73/ZeroLink/blob/master/README.md).

![BTC204](assets/fr/126.webp)

Kuten nimestä voi päätellä, Zerolinkin periaatteena on suorittaa coinjoin-transaktioita, joilla varmistetaan, että syötteiden ja tulosteiden välisiä yhteyksiä ei voida jäljittää. Tämä ominaisuus saavutetaan varmistamalla, että kaikilla tuotoksilla on täysin identtiset määrät.

![BTC204](assets/fr/127.webp)

Yksi Zerolinkin tärkeistä ennaltaehkäisevistä toimenpiteistä on sekoittamattomien ja sekoitettujen UTXO:iden täydellinen erottaminen toisistaan käyttämällä erillisiä salausavainten sarjoja tai jopa erillisiä lompakoita. Tällä tavoin "pre-mix"-lompakko, joka on tarkoitettu kolikoille ennen sekoittamista, erotetaan "post-mix"-lompakosta, joka on varattu kolikoille, jotka on sekoitettu.

![BTC204](assets/fr/128.webp)

UTXO:iden tiukalla erottelulla pyritään ensisijaisesti estämään sekoitetun ja sekoittamattoman UTXO:n vahingossa tapahtuva yhdistäminen. Jos tällaisia yhteyksiä tapahtuu, coinjoinin tehokkuus sekoitetussa UTXO:ssa mitätöityy käyttäjän tietämättä, mikä vaarantaa sellaisen UTXO:n luottamuksellisuuden, jonka historian uskottiin rikkoutuneen. Tällaisia yhteyksiä voi syntyä joko osoitteiden uudelleenkäytöstä, jolla sekoitettu UTXO suojataan sekoittamattomalla UTXO:lla, tai soveltamalla Common Input Ownership Heuristics (CIOH) -tekniikkaa, jos käyttäjä käyttää sekoitettuja ja sekoittamattomia UTXO:ita saman tapahtuman syötteinä. Kun sekoittamista edeltävät ja sen jälkeiset portfoliot erotetaan toisistaan, nämä tahattomat yhdistelmät vältetään ja käyttäjää suojellaan tahattomilta virheiltä.

![BTC204](assets/fr/129.webp)

Tämä erottelu tarjoaa myös mahdollisuuden soveltaa erillisiä sääntöjä salkkujen sekoittamista edeltäviin ja sen jälkeisiin salkkuihin salkkuohjelmiston tasolla. Esimerkiksi sekoittamisen jälkeisessä salkussa ohjelmisto voi kieltää syötettyjen UTXO:iden yhdistämisen estääkseen CIOH:n soveltamisen, joka vaarantaisi käyttäjän anonsetin. On myös mahdollista standardoida skriptien ja transaktiovaihtoehtojen (kuten esimerkiksi RBF-signalointi) käyttö, jotta estetään tunnistaminen lompakon sormenjälkien avulla.

Tällä hetkellä Whirlpool on ainoa coinjoin-toteutus, joka noudattaa tiukasti Zerolink-protokollaa. Seuraavassa luvussa tarkastelemme erilaisia olemassa olevia coinjoin-toteutuksia ja niiden etuja ja haittoja.

## Coinjoin-toteutukset

<chapterId>e37ed073-9498-4e4f-820b-30951e829596</chapterId>

_Vuonna 2024 näemme merkittäviä muutoksia niiden käyttäjien käytettävissä olevissa työkaluissa, jotka haluavat käyttää Bitcoinin kolikkoliitoksia. Elämme tällä hetkellä ratkaisevaa aikaa, ja coinjoin-markkinat käyvät läpi merkittävää rakennemuutosta. Siksi tätä lukua päivitetään todennäköisesti ajan myötä._

Tällä hetkellä Bitcoinissa on pääasiassa kolme erilaista coinjoin-toteutusta:


- Whirlpool;
- Wabisabi;
- JoinMarket.

Jokaisella näistä toteutuksista pyritään rikkomaan UTXO:iden historia coinjoin-transaktioiden avulla. Niiden mekanismit eroavat kuitenkin merkittävästi toisistaan. Siksi on tärkeää ymmärtää, miten kukin toimii, jotta voit valita tarpeisiisi parhaiten sopivan vaihtoehdon.

### JoinMarket

Adam Gibsonin ja Chris Belcherin vuonna 2015 luoma JoinMarket eroaa muista coinjoin-toteutuksista ainutlaatuisen käyttäjä-matching-mallinsa ansiosta. Järjestelmä perustuu P2P-vaihtomarkkinapaikkaan, jossa jotkut käyttäjät, "tekijät", tarjoavat bitcoinejaan sekoitettavaksi, kun taas toiset, "ottajat", käyttävät näitä varoja coinjoinien toteuttamiseen maksua vastaan.

![BTC204](assets/fr/130.webp)

Tässä mallissa "tekijät" jättävät bitcoininsa "ottajien" saataville ja saavat maksun palvelustaan. "Ottajat" puolestaan maksavat siitä, että he voivat käyttää "tekijöiden" bitcoineja omiin coinjoin-transaktioihinsa. Palvelumaksut vaihtelevat roolin mukaan: "päättäjät" keräävät maksuja likviditeettitarjouksistaan, kun taas "ottajat" maksavat palkkioita. Tämä markkinapaikka toimii vapaasti ilman käyttöehtoja.

JoinMarketin suuri haittapuoli on sen käytön monimutkaisuus, joka edellyttää jonkin verran perehtyneisyyttä päätelaitteisiin, jotta sitä voidaan hyödyntää tehokkaasti. Vaikka tämä monimutkaisuus ei ole este kokeneelle käyttäjälle, se voi rajoittaa suuren yleisön mahdollisuuksia käyttää sitä. Hiljattain käyttöön otettu JAM-niminen verkkokäyttöliittymä on kuitenkin helpottanut jonkin verran sen käyttöä.

![BTC204](assets/fr/131.webp)

Lähde: [JAM](https://github.com/joinmarket-webui/jam/blob/devel/docs/assets/screenshot-dark.webp)

Tekniset esteet ovat kuitenkin edelleen suuri este. Coinjoinin ekosysteemissä, jossa luottamuksellisuutta lisää osallistujien määrä, kaikki rajoitukset, jotka vähentävät saatavuutta, vaikuttavat suoraan käytettävissä olevaan likviditeettiin, joka on ratkaiseva tekijä sekoitustehokkuuden kannalta. Bitcoin, joka on jo ennestään markkinarako finanssitransaktioissa, näkee coinjoinin käytön alaryhmänä, ja JoinMarket edustaa vieläkin erikoistuneempaa fraktiota, mikä rajoittaa sen mahdollisuuksia lisätä käyttäjiensä anonsettiä.

Huolimatta innovatiivisesta P2P-vertailumallista kolikkoliitoksia varten JoinMarketilla on joitakin merkittäviä puutteita, erityisesti transaktiorakenteen osalta. Toisin kuin muut toteutukset, kuten Whirlpool, JoinMarket ei takaa täydellistä tasa-arvoa tuotosten välillä, ja syötteiden ja tuotosten välille voidaan luoda deterministisiä linkkejä. Siitä puuttuvat myös välineet, joilla estetään jo sekoitettujen kolikoiden sekoittuminen uudelleen, mikä voisi vaarantaa käyttäjien toivoman luottamuksellisuuden. Lopuksi totean, että vaikka JoinMarketin konsepti on houkutteleva erityisesti niille, jotka ovat kiinnostuneita dynaamisista likviditeettimarkkinoista, sen rakenteelliset heikkoudet ja tekninen monimutkaisuus tekevät siitä mielestäni vähemmän houkuttelevan sekä aloittelijoille että asiantuntijoille, jotka etsivät coinjoin-toteutusta.

### Wabisabi

Wabisabi on toinen coinjoin-toteutus, jonka lähestymistapa keskittää transaktioiden koordinoinnin. Tämän mallin suunnittelivat Ádám Ficsór (nopara73), Yuval Kogman, Lucas Ontivero ja István András Seres vuonna 2021, ja se sisällytettiin Wasabi 2.0 -ohjelmistoon seuraavana vuonna. Wabisabi edustaa nimenomaan vuonna 2018 lanseeratun Wasabi-ohjelmiston coinjoin-mallin evoluutiota.

Wasabi otti 2010-luvun lopulla käyttöön yhteisliittymiä varten transaktiorakenteen, joka poikkesi radikaalisti Whirlpoolin rakenteesta. Osallistujiensa anonsetin lisäämiseksi Wasabi käytti hyvin suuria coinjoin-transaktioita, jotka yhdistivät kymmeniä osallistujia. Whirlpool sen sijaan käytti useita pieniä transaktioita, mikä mahdollisti eksponentiaalisen lisäyksen anonseteissa jokaisella syklillä.

Jäljelle jäävien osien käsittelymenetelmät erosivat myös toisistaan näiden kahden toteutuksen välillä. Whirlpoolissa jäännös jätettiin pois ja eristettiin UTXO:sta ennen TX0:n coinjoin-sykliä, ja tätä käsitettä selitän tarkemmin seuraavassa luvussa. Wasabilla taas jäännös muodostui yhdeksi coinjoin-transaktion ulostuloista, jolloin joidenkin syötteiden ja ulostulojen välillä säilyi deterministinen yhteys.

Wabisabin avulla Wasabin versio 2.0 on mukauttanut lähestymistapaansa coinjoineihin siten, että se on lähellä Whirlpoolin lähestymistapaa. Vaikka coinjoin-transaktiot ovat edelleen hyvin suuria, on nyt mahdollista ketjuttaa useita peräkkäisiä kierroksia Whirlpoolin mallin mukaisesti. Erityistä huomiota on kiinnitetty myös vaihtorahojen hallintaan: toisin kuin Wasabi 1.0:ssa, jossa vaihtorahat olivat suoraan sidoksissa käyttäjän syötteisiin, Wabisabissa vaihtorahat pyritään jakamaan useisiin pieniin määriin, jotka jaetaan kaikille osallistujille samansuuruisina summina.

Havainnollistamme tätä yksinkertaistetulla esimerkillä, jossa on vain kaksi käyttäjää: Alice haluaa sekoittaa 115 000 satsia ja Bob 210 000 satsia. Jos jätetään huomiotta provisiot, Wasabi 1.0:lla coinjoin-transaktio olisi tuottanut kolme 100 000 satsin tuotosta sekä yhden 15 000 satsin jäännöserän Alicelle ja yhden 10 000 satsin jäännöserän Bobille. Jäljelle jäävät tuotokset olisivat aina yhteydessä syötteisiin:

Wabisabissa sama liiketoimi tuottaisi kolme 100 000 satsin tuotosta ja viisi 5 000 satsin tuotosta, jolloin loppuosa hajautuisi siten, ettei sitä voida suoraan jäljittää tiettyyn panokseen:

Henkilökohtaisesti uskon, että muutoksenhallintaan Wabisabissa liittyy useita riskejä, jotka voivat vaarantaa sen tehokkuuden yksityisyyden suojan kannalta:


- Kun käyttäjä antaa huomattavasti suuremman UTXO:n kuin muut osallistujat, hän saa väistämättä muutoksen määrän, joka on sidoksissa hänen panokseensa. Tämä on vastoin protokollan alkuperäistä tavoitetta, jonka mukaan kaikki tunnistettavat muutokset pyritään eliminoimaan;
- Nimitysten moninkertaistaminen lopun pirstaloimiseksi voi paradoksaalisesti haitata sekoituksen tehokkuutta. Prosessi voi johtaa tiettyjen tuotosten anonsettien vähenemiseen, koska ne ovat helpommin tunnistettavissa;
- Tämä menetelmä tuottaa myös arvoltaan vähäisiä UTXO:ita, jotka aiheuttavat käyttäjälle hallinnointiongelmia. Nämä pienet UTXO:t voivat muuttua "pölyksi", jos niiden käyttäminen tulee liian kalliiksi suhteessa niiden arvoon Tämä ilmiö kannustaa käyttäjää yhdistämään useita syötettyjä UTXO:ita tulevissa tapahtumissaan tai konsolidoimaan niitä. Kummassakin tapauksessa tämä voi COH:n vuoksi vähentää saatuja anonsetteja tai mitätöidä kokonaan alkuperäisestä kolikkoliitoksesta saadut yksityisyyshyödyt.

Toisin kuin Whirlpool, joka toteuttaa ZeroLink-protokollaa varmistamalla, että UTXO:n esisekoitus ja jälkisekoitus erotetaan tiukasti toisistaan, Wabisabi ei pidä yllä tätä tiukkaa erottelua. Joillakin Wasabin asiakkailla on myös ollut ongelmia osoitteiden uudelleenkäytön kanssa, mikä on ilmeisesti erittäin haitallista käyttäjälle.

Wasabin versiossa 2.0 otettiin käyttöön uusi coinjoin-hinnoittelukäytäntö. Nyt koordinaattoripalkkiot on asetettu 0,3 prosenttiin yli 0,01 bitcoinin UTXOille, kun taas pienemmille UTXOille nämä palkkiot nollataan kokonaan. Lisäksi näiden pienempien UTXO:iden remixit ovat ilmaisia, vaikka louhintamaksut säilyvät kaikista transaktioista, myös remixeistä.

Tämä politiikka poikkeaa Whirlpoolin politiikasta, jossa palkkiot pysyvät kiinteinä riippumatta saatujen anoneettien suuruudesta. Wasabi 2.0:ssa koordinaattoripalkkiot nollataan pienistä UTXO:ista, mutta käyttäjän on silti maksettava louhintapalkkiot kaikista transaktioista, myös remixeistä.

Tätä kirjoitettaessa Wabisabin käyttö on monimutkaistunut huomattavasti viimeaikaisten tapahtumien seurauksena. Samourai Walletin perustajien pidätyksen jälkeen Wasabin kehitystä rahoittava ja hallinnoiva yritys zkSNACKs ilmoitti nimittäin lopettavansa coinjoin-koordinointipalvelunsa 1. kesäkuuta 2024. Tällä koordinaattorilla, joka oli asetettu oletusarvoisesti Wasabiin, oli valtaosa likviditeetistä.

Kun tämä pääkoordinaattori suljetaan, käyttäjien on nyt otettava yhteys uusiin itsenäisiin koordinaattoreihin. Tämä muutos herättää huolenaiheita: toisaalta uusilla koordinaattoreilla ei ehkä ole riittävästi likviditeettiä, mikä vähentää kolikkoliitosten tehokkuutta yksityisyyden suojan kannalta. Toisaalta on olemassa vaara, että koordinaattori on pahantahtoinen. Tämä tilanne lisää merkittävästi uusia riskejä niille, jotka haluavat käyttää Wabisabia.

Teknisten ongelmien lisäksi Wasabin takana olevan yrityksen zkSNACKsin päätös käyttää lohkoketjuanalytiikkayrityksen palveluja kolikkoliitoksiin osallistujien suodattamiseen herättää vakavia eettisiä ja strategisia kysymyksiä. Alkuperäisenä ajatuksena oli estää rikollisia käyttämästä kolikkojoineja Wasabilla, mikä saattaa vaikuttaa oikeutetulta. Se herättää kuitenkin paradoksin: maksetaan maksuja koordinaattorille, jonka päätehtävänä on lisätä käyttäjien yksityisyyttä, ja sitten rahoitetaan yritystä, jonka tavoitteena on vaarantaa sama yksityisyys.

Vielä huolestuttavampaa on suodatusperiaate, joka on jyrkässä ristiriidassa Bitcoinin filosofian kanssa, jonka mukaan se tarjoaa avoimen ja sensuroimattoman rahoitusjärjestelmän. Vaikka voi tuntua perustellulta haluta sulkea pois rikollinen toiminta, tämä suodatus voi kohdistua myös henkilöihin, joiden toiminta voi olla moraalisesti perusteltua tai yhteiskunnallisesti hyödyllistä, vaikka se luokitellaankin joissakin yhteyksissä laittomaksi. Edward Snowdenin esimerkki havainnollistaa tätä kahtiajakoa erinomaisesti: jotkut hallitukset pitävät häntä rikollisena paljastustensa vuoksi, kun taas toiset pitävät häntä ilmiantajana, joka toimi yleisen edun nimissä. Tämä monitahoisuus korostaa suodatuksen potentiaalista vaaraa, sillä vaikka suodatuksen lähtökohtana on hyvä tarkoitus, se voi lopulta vahingoittaa laillisten käyttäjien oikeuksia ja turvallisuutta. Olisin voinut mainita myös vainotut aktivistit ja toimittajat tietyissä autoritaarisissa järjestelmissä. Kuten ehkä arvasitkin, suosin epäilemättä Whirlpool-mallia Bitcoinin kolikkoliitosten toteuttamisessa. Tämä järjestelmä erottuu edukseen tiukkuutensa vuoksi ja tarjoaa paremmat takeet yksityisyyden suojan suhteen. Se on myös ainoa, joka ehdottaa sekoitusta, jota pidetään matemaattisesti täydellisenä. Mielestäni tämä malli edustaa Bitcoinin kolikkoliittymien tulevaisuutta. Siksi kutsun sinut tutustumaan tähän malliin syvällisemmin seuraavassa luvussa.

## Whirlpoolin toiminta

<chapterId>bdbd7109-e36d-4b4f-a3c6-928df4e9bfda</chapterId>

Whirlpool eroaa muista coinjoin-menetelmistä käyttämällä "_ZeroLink_"-tapahtumia, joilla varmistetaan, että kaikkien syötteiden ja kaikkien tulosteiden välillä ei ole teknisesti mahdollista yhteyttä. Tämä täydellinen sekoittuminen saavutetaan rakenteella, jossa jokainen osallistuja osallistuu panoksina identtisellä määrällä (lukuun ottamatta louhintamaksuja), jolloin tuotokset ovat täysin samansuuruisia.

Tämä panoksia koskeva rajoittava lähestymistapa antaa Whirlpoolin coinjoin-transaktioille ainutlaatuisen ominaisuuden: panosten ja tuotosten väliset deterministiset yhteydet puuttuvat kokonaan. Toisin sanoen kullakin tuotoksella on sama todennäköisyys kuulua mille tahansa osallistujalle suhteessa kaikkiin muihin liiketoimen tuotoksiin.

![BTC204](assets/fr/136.webp)

### Whirlpoolin yleinen toiminta

Aluksi osallistujien määrä kussakin Whirlpool-yhteenliittymässä oli rajoitettu viiteen, joista kaksi oli uusia osallistujia ja kolme remixaajia (selitämme nämä käsitteet myöhemmin). Vuonna 2023 havaittu ketjussa tapahtuvista transaktioista perittävien maksujen kasvu sai kuitenkin Samourain tiimit miettimään mallia uudelleen yksityisyyden parantamiseksi ja samalla kustannusten vähentämiseksi. Näin ollen, ottaen huomioon palkkiomarkkinoiden tilanteen ja osallistujien määrän, koordinaattori voi nyt järjestää coinjoineja, joissa on 6, 7 tai 8 osallistujaa. Nämä parannetut istunnot on nimetty nimellä "_Surge Cycles_" On tärkeää huomata, että kokoonpanosta riippumatta Whirlpool-coinjoineissa on aina vain kaksi uutta osallistujaa.

Whirlpoolin liiketoimille on siis ominaista sama määrä panoksia ja tuotoksia, jotka voivat olla:


- 5 tuloa ja 5 lähtöä;

![BTC204](assets/fr/137.webp)


- 6 tuloa ja 6 lähtöä;

![BTC204](assets/fr/138.webp)


- 7 tuloa ja 7 lähtöä;

![BTC204](assets/fr/139.webp)


- 8 tuloa ja 8 lähtöä.

![BTC204](assets/fr/140.webp)

Whirlpoolin ehdottama malli perustuu siis pieniin coinjoin-transaktioihin. Toisin kuin Wabisabissa ja JoinMarketissa, joissa anonsettien kestävyys perustuu osallistujien määrään yhdessä syklissä (tai muutamassa syklissä), Whirlpool luottaa useiden pienten syklien ketjuttamiseen. Tässä mallissa käyttäjille aiheutuu kustannuksia vain heidän ensimmäisestä liittymisestään pooliin, jolloin he voivat osallistua useisiin remixeihin ilman lisäkustannuksia. Uudet osallistujat kattavat remixereiden louhintakustannukset.

Jokaisen uuden coinjoinin myötä, johon kolikko osallistuu yhdessä aiemmin kohdattujen vertaistensa kanssa, anonsetit kasvavat eksponentiaalisesti. Tavoitteena on siis hyödyntää näitä ilmaisia remixejä, jotka auttavat jokaisen esiintymisen myötä vahvistamaan kuhunkin coinmixiin liittyvien anonsettien tiheyttä.

Whirlpoolin suunnittelussa on otettu huomioon kaksi tärkeää vaatimusta:


- Mobiililaitteiden käyttömahdollisuudet, sillä Samourai Wallet on ensisijaisesti älypuhelinsovellus;
- Uudelleensekoitusjaksojen nopeus kannustaa lisäämään merkittävästi anonettien määrää.

Nämä vaatimukset ohjasivat Samourain lompakon kehittäjien valintoja Whirlpoolin suunnittelussa, minkä vuoksi he rajoittivat osallistujien määrää sykliä kohden. Liian harvat osallistujat olisivat vaarantaneet coinjoinin tehokkuuden vähentämällä huomattavasti kussakin syklissä syntyviä anonsetteja, kun taas liian moni osallistuja olisi aiheuttanut hallinto-ongelmia mobiilisovelluksissa ja haitannut syklien sujuvuutta.

Loppujen lopuksi Whirlpoolissa ei tarvita suurta osallistujamäärää coinjoiniin, koska anonsetit toteutetaan useiden coinjoin-syklien kasautumisena. Tärkein periaate tässä on kaikkien osallistujien UTXO:iden homogeenisuus, koska se mahdollistaa täydellisen sekoituksen ja siten täyden hyödyn sekoitus- ja uudelleen sekoitussykleistä.

### Coinjoin poolit ja hinnat

Jotta nämä moninkertaiset syklit lisäisivät tehokkaasti sekoitettujen kolikoiden anonsettien määrää, on luotava puitteet, joilla rajoitetaan käytettävän UTXO:n määrää. Whirlpool määrittelee sen vuoksi useita pooleja.

Pool edustaa ryhmää käyttäjiä, jotka haluavat yhdistyä ja jotka sopivat käytettävän UTXO:n määrästä, jotta kolikoiden yhdistymisprosessi voidaan optimoida ja samalla säilyttää täydellinen kolikoiden homogeenisuus. Kukin pooli määrittelee UTXO:lle kiinteän määrän, joka käyttäjän on täytettävä osallistuakseen. Näin ollen Whirlpoolin avulla tapahtuvien kolikkoyhdistämisten suorittamiseksi on valittava pooli. Tällä hetkellä käytettävissä olevat poolit ovat seuraavat:


- 0.5 bitcoinia;
- 0.05 bitcoin;
- 0.01 bitcoin;
- 0.001 bitcoin (= 100 000 satsia).

Kun liityt pooliin bitcoineillasi, ne jaetaan siten, että ne tuottavat UTXO:t, jotka ovat täysin samanlaisia kuin poolin muiden osallistujien UTXO:t. Kullakin poolilla on enimmäisraja, joten jos summat ylittävät tämän rajan, sinun on joko tehtävä kaksi erillistä merkintää samaan pooliin tai käänny toisen poolin puoleen, jossa on suurempi summa:

| Pool (bitcoin) | Maksimimäärä per merkintä (bitcoin) |

|----------------|----------------------------------------|

| 0,5 | 35 |

| 0,05 | 3,5 |

| 0,01 | 0,7 |

| 0,001 | 0,025 |

UTXO:n katsotaan kuuluvan pooliin, kun se on valmis liitettäväksi coinjoiniin. Tämä ei kuitenkaan tarkoita, että käyttäjä menettää sen hallinnan. Kuten tämän osan ensimmäisissä luvuissa nähtiin, eri sekoitussyklien aikana säilytät täyden määräysvallan avaimiisi ja näin ollen myös bitcoineihisi. Tämä erottaa coinjoin-tekniikan muista keskitetyistä sekoitustekniikoista.

Liittyminen coinjoin-pooliin edellyttää palvelumaksujen ja louhintamaksujen maksamista. Palvelumaksut ovat kiinteät jokaiselle poolille, ja niiden tarkoituksena on korvata Whirlpoolin kehittämisestä ja ylläpidosta vastaaville tiimeille.

Porealtaan käytöstä perittävä palvelumaksu on maksettava kerran altaaseen mentäessä. Kun tämä vaihe on suoritettu, voit osallistua rajoittamattomaan määrään remixejä ilman lisämaksuja. Tässä ovat kunkin altaan nykyiset kiinteät maksut:

| Pool (bitcoin) | Syöttömaksu (bitcoin) |

| -------------- | --------------------------------- |

| 0.5 | 0.0175 |

| 0.05 | 0.00175 |

| 0,01 | 0,0005 (50 000 satelliittia) |

| 0,001 | 0,00005 (5 000 satelliittia) |

Nämä maksut toimivat lähinnä pääsylippuna valitsemaasi altaaseen, riippumatta siitä, minkä verran syötät coinjoiniin. Joten riippumatta siitä, osallistutko 0,01 BTC:n altaaseen tasan 0,01 BTC:llä vai 0,5 BTC:llä, maksut pysyvät absoluuttisesti samoina.

Ennen kuin jatkat Whirlpool-yhteenliittämistä, käyttäjä voi valita kahden strategian välillä:


- Valitse pienempi pooli minimoidaksesi palvelumaksut tietäen, että he saavat vastineeksi useita pienempiä UTXO:ita;
- Tai haluat mieluummin suuremman pooliin ja suostut maksamaan korkeampia maksuja saadaksesi lopulta pienen määrän arvokkaampia UTXO-rahastoja.

Yleisesti ottaen ei ole suositeltavaa yhdistää useita sekalaisia UTXO:ita coinjoin-syklien jälkeen, koska tämä voi vaarantaa saavutetun yksityisyyden suojan, erityisesti yhteisen syötteen omistajuuden heuristiikan (CIOH: _Common-Input-Ownership-Heuristic_) vuoksi. Sen vuoksi voi olla viisasta valita suurempi pooli, vaikka se tarkoittaisikin suurempaa maksua, jotta vältetään liian monen pienen arvoisen UTXO:n saaminen tuotokseksi. Käyttäjän on arvioitava nämä kompromissit valitakseen haluamansa poolin.

Palvelumaksujen lisäksi on otettava huomioon kaikkiin Bitcoin-tapahtumiin liittyvät louhintamaksut. Whirlpool-käyttäjänä sinun on maksettava kaivosmaksut valmistelutransaktiosta (`Tx0`) sekä ensimmäisestä coinjoinista. Kaikki myöhemmät remixit ovat ilmaisia, koska Whirlpoolin malli maksaa uusille liittyjille.

Itse asiassa jokaisessa Whirlpool-yhteenliittymässä 2 käyttäjää syötteiden joukossa on uusia osallistujia. Muut syötteet tulevat remixereiltä. Tämän seurauksena kaikkien transaktioon osallistuvien louhintamaksut katetaan näillä kahdella uudella osallistujalla, jotka sitten myös hyötyvät ilmaisista remixeistä:

![BTC204](assets/it/54/07.webp)

Tämän maksujärjestelmän vuoksi Whirlpool eroaa muista coinjoin-toteutuksista, koska UTXO:iden anonsetit eivät ole suhteessa käyttäjän maksamaan hintaan. Näin ollen huomattavan korkea anonymiteettitaso voidaan saavuttaa maksamalla vain poolin sisäänpääsymaksu ja louhintamaksut kahdesta transaktiosta (`Tx0` ja alkusekoitus).

On tärkeää huomata, että käyttäjän on myös katettava kaivosmaksut UTXO-varojensa nostamisesta altaasta useiden coinjoinien suorittamisen jälkeen, elleivät he ole valinneet "mix to" -vaihtoehtoa, jonka avulla he voivat antaa ulkoisen osoitteen, joka vastaanottaa varat suoraan coinjoinin tuloksena ilman lisätransaktioita.

### HD Wallet -tilit

Whirlpoolin kautta tapahtuvaa kolikkoliitosta varten lompakon on luotava useita erillisiä tilejä. Tämä on ZeroLink-protokollan periaate. HD-lompakossa (_Hierarchical Deterministic_) tili muodostaa muista täysin eristetyn osion, ja tämä erottelu tapahtuu lompakkohierarkian kolmannella syvyystasolla eli `xpub`-tasolla.

![BTC204](assets/it/54/08.webp)

HD-lompakko voi teoriassa johtaa jopa `2^(32/2)` eri tilejä. Alkuperäinen tili, jota käytetään oletuksena kaikissa Bitcoin-lompakoissa, vastaa `0'`-indeksiä.

Whirlpooliin mukautetuissa salkuissa käytetään 4 tiliä ZeroLink-prosessin vaatimusten täyttämiseksi:


- **Talletustili**, jonka tunnus on "0";
- **Paha pankkitili** (tai "myrkyllinen pörssi"), jonka tunnus on `2 147 483 644'`;
- **Ensekoitustili**, jonka tunnus on "2 147 483 645";
- **postmix-tili**, jonka tunnus on "2 147 483 646".

Kullakin näistä tileistä on oma tehtävänsä koliittamisprosessissa, jota tarkastellaan seuraavissa jaksoissa.

Kaikki nämä tilit on yhdistetty yhteen siemeneen, jolloin käyttäjä voi palauttaa pääsyn kaikkiin bitcoineihinsa käyttämällä palautuslausettaan ja tarvittaessa salasanaansa. Ohjelmistolle on kuitenkin määriteltävä tämän palautustoiminnon aikana käytettyjen tilien eri indeksit.

Tarkastellaan seuraavaksi Whirlpool-yhteenliittämisen eri vaiheita näillä tileillä.

### TX0

Kaikkien Whirlpool-kolikkoliittymien lähtökohtana on **talletustili**. Tätä tiliä käytät automaattisesti, kun luot uuden Bitcoin-lompakon. Tälle tilille on hyvitettävä bitcoinit, jotka haluat yhdistää.

Tx0 edustaa Whirlpool-sekoitusprosessin ensimmäistä vaihetta. Sen tarkoituksena on valmistella ja tasata UTXO:t yhteismitoitusta varten jakamalla ne yksiköihin, jotka vastaavat valitun altaan määrää, jotta varmistetaan sekoituksen homogeenisuus. Tasoitetut UTXO:t lähetetään sitten **esisekoitustilille**. Erotus, joka ei voi päästä pooliin, erotetaan erityiselle tilille: **paha pankki** (tai "myrkyllinen vaihto").

Tämän ensimmäisen "Tx0"-tapahtuman avulla maksetaan myös kolikkoyhdistyskoordinaattorille maksettavat palvelumaksut. Toisin kuin seuraavat vaiheet, tämä transaktio ei ole yhteistoiminnallinen, joten käyttäjän on maksettava louhintamaksut kokonaisuudessaan:

![BTC204](assets/it/54/09.webp)

Tässä "Tx0"-tapahtumaesimerkissä "372 000 satsin" panos **talletustililtämme** jaetaan useiksi UTXO-tuotoksiksi, jotka jakautuvat seuraavasti:


- Koordinaattorille palvelumaksuja varten varattu 5 000 satsin määrä, joka vastaa 100 000 satsin altaaseen liittymistä;
- 3 UTXO:ta valmistellaan sekoittamista varten, ohjataan **premix-tilillemme** ja rekisteröidään koordinaattorille. Nämä UTXO:t tasataan 108 000 satsin kappalehintaan, jotta niiden tulevan alkusekoituksen kaivosmaksut voidaan kattaa;
- Ylijäämää, joka ei pääse altaaseen, koska se on liian pieni, pidetään myrkyllisenä vaihtona. Se lähetetään omalle tililleen. Tässä tapauksessa tämä vaihto on 40 000 satsia;
- Lopuksi on vielä "3000 satsia", jotka eivät ole tuotosta, vaan ne ovat kaivosmaksuja, joita tarvitaan "Tx0":n vahvistamiseksi.

Esimerkiksi tässä on todellinen Tx0 Whirlpool (ei minun):[edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/fr/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

![BTC204](assets/fr/145.webp)

### Myrkyllinen muutos

Ylijäämä, jota ei voitu integroida pooliin, tässä tapauksessa 40 000 satsia, ohjataan **pahan pankin** tilille, jota kutsutaan myös "myrkylliseksi vaihdoksi", jotta varmistetaan, että se erotetaan tiukasti muista salkun UTXO:ista.

Tämä UTXO on vaarallinen käyttäjän yksityisyydelle, koska se on edelleen yhteydessä käyttäjän menneisyyteen ja siten mahdollisesti sen omistajan henkilöllisyyteen, mutta se on myös merkitty kuuluvaksi käyttäjälle, joka on osallistunut kolikkojatkamiseen.

![BTC204](assets/fr/146.webp)

Jos tämä UTXO yhdistetään sekoitettujen ulostulojen kanssa, ne menettävät kaiken coinjoin-syklien aikana saavutetun yksityisyyden, mikä johtuu suurelta osin CIOH:sta (Common-Input-Ownership-Heuristic_). Jos se yhdistetään muihin myrkyllisiin muutoksiin, käyttäjä on vaarassa menettää yksityisyyden, koska tämä yhdistää eri syötteet coinjoin-sykleistä. Siksi sitä olisi käsiteltävä varoen. Käsittelemme näiden myrkyllisten UTXO:iden hallintaa tarkemmin tämän luvun viimeisessä osassa.

### Alkuperäinen sekoitus

Kun `Tx0` on suoritettu, tasatut UTXO:t lähetetään salkkumme **premix**-tilille, joka on valmiina ensimmäiseen coinjoin-sykliinsä, jota kutsutaan myös "alkusekoitukseksi" Jos, kuten esimerkissämme, `Tx0` tuottaa useita sekoitettavaksi tarkoitettuja UTXO:ita, kukin niistä yhdistetään erilliseen alkusekoitukseen.

Näiden ensimmäisten sekoitusten päätyttyä **premix**-tili on tyhjä, kun taas kolikkomme, jotka ovat maksaneet louhintapalkkiot tästä ensimmäisestä coinjoinista, maksetaan täsmälleen valitun poolin määrittelemällä määrällä. Esimerkissämme alkuperäiset UTXO:t, jotka olivat 108 000 satsia, ovat pienentyneet tasan 100 000 satsiksi.

![BTC204](assets/fr/147.webp)

### Remixit

Ensimmäisen sekoituksen jälkeen UTXO:t siirretään **postmix**-tilille. Tälle tilille kerätään sekä jo miksattuja että uudelleen miksattuja UTXO:ita odottavia UTXO:ita. Kun Whirlpool-asiakasohjelma on aktiivinen, **postmix**-tilillä olevat UTXO:t ovat automaattisesti käytettävissä remixiä varten, ja ne valitaan satunnaisesti osallistumaan näihin uusiin kierroksiin.

Muistutuksena mainittakoon, että remixit ovat täysin ilmaisia: mitään ylimääräisiä palvelumaksuja tai louhintamaksuja ei vaadita. UTXO:iden pitäminen **postmix**-tilillä pitää näin ollen niiden arvon ennallaan ja parantaa samalla niiden anonsettiä. Siksi on tärkeää, että nämä kolikot voivat osallistua useisiin coinjoin-sykleihin. Se ei maksa sinulle yhtään mitään ja nostaa niiden anonset-tasoja.

Kun päätät käyttää UTXO-sekoituksia, voit tehdä sen suoraan tältä **postmix**-tililtä. On suositeltavaa pitää sekoitetut UTXO:t tällä tilillä, jotta voit hyötyä ilmaisista remixeistä ja estää niiden poistumisen Whirlpool-piiristä, mikä voi heikentää niiden yksityisyyttä.

### Miten hallita postmix-tiliä oikein?

Kun olet suorittanut coinjoin-syklejä, paras strategia on pitää UTXO:t **postmix**-tilillä odottamassa niiden tulevaa käyttöä. On jopa suositeltavaa antaa niiden remixata loputtomiin, kunnes ne on käytettävä.

Jotkut käyttäjät saattavat harkita sekoitettujen bitcoinien siirtämistä suojattuun laitteistolompakkoon. Tämä on mahdollista, mutta on tärkeää noudattaa huolellisesti Samourai Walletin suosituksia, jotta saavutettu luottamuksellisuus ei vaarannu.

UTXO:iden yhdistäminen on yleisin virhe, joka tehdään. Sekoitettujen UTXO:iden ja sekoittamattomien UTXO:iden yhdistämistä samassa transaktiossa on vältettävä, jotta voidaan välttää Common-Input-Ownership (CIOH) -heuristiikat. Tämä edellyttää UTXO:iden huolellista hallintaa salkussa, erityisesti merkintöjen osalta.

![BTC204](assets/fr/148.webp)

On myös tärkeää olla varovainen yhdistettäessä UTXO-yhtiöitä yhteen. Maltilliset yhdistämiset ovat mahdollisia, jos UTXO-olioiden yhdistelmillä on huomattavia anonsetteja, mutta tämä vähentää väistämättä kolikoidesi luottamuksellisuutta. Varmista, että konsolidoinnit eivät ole liian merkittäviä tai että niitä ei tehdä riittävän monen remixin jälkeen, sillä vaarana on, että UTXO-olioidenne välille syntyy pääteltyjä yhteyksiä ennen ja jälkeen coinjoin-syklien. Kun olet epävarma näistä manipuloinneista, paras käytäntö on olla konsolidoimatta UTXO:ita yhdistämisen jälkeen ja siirtää ne yksi kerrallaan laitteistolompakkoosi luoden joka kerta uuden tyhjän osoitteen. Muista silti merkitä jokainen vastaanotettu UTXO asianmukaisesti.

Ei myöskään ole suositeltavaa siirtää UTXO-postmixejä lompakkoon, joka käyttää epätavallisia skriptejä. Jos esimerkiksi siirryt Whirlpooliin multisig-lompakosta, joka käyttää `P2WSH`-skriptejä, on pieni mahdollisuus, että sinut sekoitetaan muiden käyttäjien kanssa, joilla on alun perin samantyyppinen lompakko. Jos nostat postmixejäsi tästä samasta multisig-lompakosta, sekoitettujen bitcoinien yksityisyyden taso heikkenee huomattavasti. Skriptien lisäksi on olemassa monia muita lompakon sormenjälkiä, jotka voivat huijata sinua.

Kuten minkä tahansa Bitcoin-tapahtuman kohdalla, on myös tärkeää, että vastaanottavia osoitteita ei käytetä uudelleen. Jokainen uusi transaktio tulisi vastaanottaa uuteen, tyhjään osoitteeseen.

Yksinkertaisin ja turvallisin ratkaisu on antaa sekoitettujen UTXO:iden levätä **postmix**-tilillään, jolloin ne voivat remixata ja koskettaa niitä vain käyttääkseen niitä. Samourai- ja Sparrow-salkuissa on lisäsuojaus kaikkia näitä ketjuanalyysin riskejä vastaan. Nämä suojaukset auttavat sinua välttämään virheitä.

### Miten hallita myrkyllistä muutosta oikein?

Seuraavaksi sinun on oltava varovainen käsitellessäsi myrkyllisiä vaihtorahoja, eli vaihtorahoja, jotka eivät pääse kolikkojoin-pooliin. Nämä myrkylliset UTXO:t, jotka ovat peräisin Whirlpoolin käytöstä, ovat riski yksityisyydellesi, koska ne luovat yhteyden sinun ja kolikkojohdon käytön välille. Siksi niitä on ehdottomasti käsiteltävä varoen, eikä niitä saa yhdistää muihin UTXOihin, varsinkaan sekamuotoisiin UTXOihin.

Seuraavassa on useita strategioita, joita kannattaa harkita niiden käyttämiseksi:


- Sekoita ne pienempiin altaisiin:** Jos myrkyllinen UTXO on tarpeeksi suuri mahtuakseen yksin pienempään altaaseen, harkitse sen sekoittamista. Tämä on usein paras vaihtoehto. Usean myrkyllisen UTXO:n sekoittamista yhteen altaaseen pääsemiseksi ei kuitenkaan suositella, sillä tämä voi yhdistää eri sisäänkäynnit.
- Merkitse ne "käyttökelvottomiksi":** Toinen tapa on lopettaa niiden käyttö, merkitä ne "käyttökelvottomiksi" niiden omalle tilille ja yksinkertaisesti hodlata ne. Näin varmistat, ettet käytä niitä vahingossa. Jos bitcoinin arvo nousee, voi syntyä uusia pooleja, jotka sopivat paremmin myrkyllisille UTXO-varoillesi;
- Lahjoitusten tekeminen:** Harkitse lahjoitusten tekemistä, jopa vaatimattomienkin, kehittäjille, jotka työskentelevät Bitcoinin ja siihen liittyvien ohjelmistojen parissa. Voit myös lahjoittaa järjestöille, jotka hyväksyvät BTC:tä. Jos myrkyllisten UTXO:iden hallinta tuntuu liian monimutkaiselta, voit yksinkertaisesti päästä niistä eroon lahjoittamalla.
- Osta lahjakortteja:** Alustojen, kuten [Bitrefill](https://www.bitrefill.com/), avulla voit vaihtaa bitcoineja lahjakortteihin, joita voit käyttää eri kauppiailla. Tämä voi olla tapa hävittää myrkylliset UTXO:t menettämättä niihin liittyvää arvoa.
- Yhdistä ne Moneroon:** Samourai Wallet tarjoaa atomivaihtopalvelun BTC:n ja XMR:n välillä. Tämä on ihanteellinen myrkyllisten UTXO:iden hallintaan konsolidoimalla ne Moneroon vaarantamatta yksityisyyttäsi KYC:n kautta, ennen kuin lähetät ne takaisin Bitcoiniin. Tämä vaihtoehto voi kuitenkin olla kallis kaivosmaksujen ja palkkioiden osalta likviditeettirajoitusten vuoksi.
- Lähetä ne Lightning Networkiin:** Näiden UTXO:iden siirtäminen Lightning Networkiin alennettujen transaktiomaksujen hyödyntämiseksi on houkutteleva vaihtoehto. Tämä menetelmä voi kuitenkin paljastaa joitakin tietoja riippuen Lightningin käytöstäsi, ja siksi sitä tulisi harjoittaa varoen.

### Miten Whirlpoolia käytetään?

Samourai Walletin perustajien pidätyksen ja heidän palvelimiensa takavarikoimisen jälkeen 24. huhtikuuta 2024 Whirlpool-työkalu ei enää toimi, ei edes niillä, joilla on oma Dojo. Aiemmin se oli käytettävissä Samourai Walletissa ja Sparrow Walletissa.

![BTC204](assets/fr/149.webp)

On kuitenkin edelleen mahdollista, että tämä väline otetaan uudelleen käyttöön lähiviikkoina, riippuen kokeilujen tuloksista, tai että se käynnistetään uudelleen eri tavalla. Joka tapauksessa uskon, että Bitcoinin coinjoin-markkinat eivät pysy pitkään ilman tarjontaa, sillä kysyntää on selvästi. Lisäksi Whirlpool-mallia, joka on yksityisyyden suojan kannalta edistynein, tullaan varmasti käyttämään tulevaisuudessa myös muissa toteutuksissa.

Seuraamme tiiviisti tämän tapauksen kehittymistä ja siihen liittyvien välineiden kehitystä. Voitte olla varmoja, että päivitämme tätä koulutusta sitä mukaa kuin uutta tietoa saadaan.

Seuraavassa luvussa selvitetään, mitä "anonsetit" ovat, miten nämä indikaattorit lasketaan ja miten niiden avulla voidaan arvioida coinjoin-syklien tehokkuutta.

https://planb.network/tutorials/privacy/on-chain/coinjoin-sparrow-wallet-84def86d-faf5-4589-807a-83be60720c8b
https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/tutorials/privacy/on-chain/coinjoin-dojo-c4b20263-5b30-4c74-ae59-dc8d0f8715c2
## Anonymiteetti Asetettu

<chapterId>be1093dc-1a74-40e5-9545-2b97a7d7d431</chapterId>

Kun olemme tutkineet, miten rinnakkaisliitokset toimivat ja millaisia haasteita tehokkaaseen yhdistämiseen liittyy, opimme nyt, miten tehokkuutta voidaan mitata. Miten määritetään, oliko coinjoin-prosessi tehokas ja minkäasteisen anonymiteetin kolikko sai? Tätä tutkimme tässä luvussa anonymiteettijoukkojen eli englanniksi "anonsets" -joukkojen avulla.

### Muistutus Coinjoinin hyödyllisyydestä

CoinJoinin hyödyllisyys perustuu sen kykyyn tuottaa uskottavaa kieltämistä upottamalla kolikkosi erottamattomien kolikoiden ryhmään. Tämän toiminnon tavoitteena on katkaista jäljitettävyysyhteydet sekä menneisyydestä nykyhetkeen että nykyisyydestä menneisyyteen.

Toisin sanoen analyytikko, joka tuntee alkuperäisen transaktiosi (`Tx0`) CoinJoin-syklien alkaessa, ei pitäisi pystyä tunnistamaan varmuudella UTXO:tasi remix-syklien päättyessä (analyysi syklin alkamisesta syklin päättymiseen).

![BTC204](assets/it/55/01.webp)

Sitä vastoin analyytikko, joka tuntee UTXO:n CoinJoin-syklien ulostulon kohdalla, ei pysty määrittämään alkuperäistä transaktiota syklien sisääntulon kohdalla (analyysi syklin ulostulosta syklin sisääntuloon).

![BTC204](assets/it/55/02.webp)

Jotta voidaan arvioida, kuinka vaikeaa analyytikon on yhdistää menneisyys nykyhetkeen ja päinvastoin, on tarpeen määrittää niiden homogeenisten kolikkoryhmien koko, joihin kolikkosi on piilotettu. Tämä mitta kertoo meille niiden analyysien lukumäärän, joilla on identtinen todennäköisyys. Näin ollen, jos oikea analyysi hukkuu kolmen muun yhtä todennäköisen analyysin joukkoon, piilotuksenne taso on hyvin alhainen. Jos oikea analyysi on kuitenkin 20 000 analyysin joukossa, jotka kaikki ovat yhtä todennäköisiä, kolikkosi on hyvin piilotettu. Ja nimenomaan näiden joukkojen koko edustaa indikaattoreita, joita kutsutaan anonseteiksi.

### Anonsettien ymmärtäminen

Anonyymit toimivat indikaattoreina, joiden avulla voidaan arvioida tietyn UTXO:n yksityisyyden astetta. Tarkemmin sanottuna ne mittaavat erottamattomien UTXO:iden lukumäärää joukossa, joka sisältää tutkittavan kolikon. Homogeenisen UTXO-joukon vaatimus tarkoittaa, että anonsetit lasketaan yleensä CoinJoin-sykleillä. Näiden indikaattoreiden käyttö on erityisen tärkeää Whirlpool CoinJoineille niiden yhtenäisyyden vuoksi.

Anonsetin avulla voidaan tarvittaessa arvioida CoinJoinsin laatua. Suuri anonset-koko tarkoittaa korkeaa anonymiteetin tasoa, koska tiettyä UTXO:ta on vaikea erottaa homogeenisesta joukosta.

On olemassa 2 erilaista anonsettityyppiä:


- Tuleva anonset;**
- Takautuva anonset.**

### Tuleva Anonset

Ennakoiva anonset ilmoittaa sen ryhmän koon, jonka joukossa tutkittu UTXO on piilossa syklin päättyessä, kun tiedetään UTXO sisääntulossa, eli tässä ryhmässä olevien erottamattomien kolikoiden lukumäärän. Englanniksi tämän indikaattorin nimi on "forward anonset" tai "forward-looking metrics"

Tämä indikaattori mittaa valuutan yksityisyyden suojaa menneisyydestä nykyhetkeen (panoksesta tuotokseen) -analyysin perusteella.

![BTC204](assets/it/55/03.webp)

Tämä mittari arvioi, missä määrin UTXO on suojattu yrityksiltä rekonstruoida sen historiaa koliittoprosessin tulopisteestä poistumispisteeseen.

Jos esimerkiksi transaktiosi osallistui ensimmäiseen coinjoin-sykliin ja kaksi muuta laskevaa sykliä saatiin päätökseen, kolikkosi todennäköinen anonset olisi `13`:

![BTC204](assets/fr/153.webp)

Kuvitellaan esimerkiksi, että kolikkomme kolikkoliitossyklin alkupäässä hyötyy mahdollisesta anonsetista, joka on "86,871". Käytännössä tämä tarkoittaa, että se on piilossa `86,871` erottamattoman kolikon joukossa. Ulkopuolinen tarkkailija, joka on tietoinen tästä kolikosta kolikkoyhdistymissyklin alussa ja yrittää seurata sen poistumista, joutuisi kohtaamaan `86,871` mahdollista UTXO:ta, joista jokaisella on sama todennäköisyys olla etsitty kolikko.

![BTC204](assets/it/55/05.webp)

### Jälkikäteen tapahtuva anonset

Retrospektiivinen anonset ilmoittaa tietyn kolikon mahdollisten lähteiden määrän, kun tiedetään UTXO syklin päättyessä. Tämä indikaattori mittaa kolikon yksityisyyden vastustuskykyä nykyhetkestä menneisyyteen -analyysiä (exit to entry) vastaan, eli kuinka vaikeaa analyytikon on jäljittää kolikkosi alkuperä ennen coinjoin-syklejä. Englanniksi tämän indikaattorin nimi on "backward anonset" eli "takautuva metriikka"

Kun tiedetään UTXO-arvosi syklien päättyessä, retrospektiivinen anonset määrittää niiden mahdollisten Tx0-transaktioiden määrän, jotka olisivat voineet muodostaa tulosi kolikoiden yhdistämissykleihin. Alla olevassa kaaviossa tämä vastaa kaikkien oranssien kuplien summaa.

Kuvitellaan esimerkiksi, että kolikkomme kolikkoliitossyklin päättyessä hyötyy 42,185 euron takautuvasta anonsetista. Käytännössä tämä tarkoittaa, että tälle UTXO:lle on `42,185` mahdollista lähdettä. Jos ulkopuolinen tarkkailija tunnistaa tämän kolikon syklien lopussa ja yrittää jäljittää sen alkuperän, hän kohtaa `42,185` mahdollista lähdettä, joilla kaikilla on yhtä suuri todennäköisyys olla etsitty alkuperä.

### Kuinka konkreettisesti laskea anonsetit?

Voit laskea anonsetit manuaalisesti lohko-etsintäohjelmalla pienille sarjoille. Suurempien anonsettien osalta on kuitenkin välttämätöntä käyttää erikoistunutta työkalua. Tietääkseni ainoa tähän tehtävään kykenevä ohjelmisto on _Whirlpool Stats Tool_, Samourain ja OXT:n tiimien kehittämä Python-työkalu. Valitettavasti tämä työkalu on tällä hetkellä poissa käytöstä Samourain perustajien pidätyksen ja OXT:n lopettamisen jälkeen, sillä sitä käytettiin tietojen poimimiseen lohkoketjusta.

Kuten olemme nähneet tässä luvussa, anonsetit voidaan laskea vain, jos coinjoin-rakenteessa on jonkin verran homogeenisuutta. Seuraavassa luvussa selvitetään, miten tämä homogeenisuus voidaan määrittää Bitcoin-tapahtumassa, olipa kyseessä sitten coinjoin tai perinteisempi tapahtuma.

https://planb.network/tutorials/privacy/analysis/wst-anonsets-0354b793-c301-48af-af75-f87569756375
## Entropia

<chapterId>e4fe289d-618b-49a2-84c9-68c562e708b4</chapterId>

Kuten tässä coinjoineja käsittelevässä osassa on todettu, UTXO:iden homogeenisuus syötteiden ja tulosteiden osalta on tärkeä tekijä Bitcoin-tapahtuman luottamuksellisuuden parantamisessa. Tämä parametri mahdollistaa uskottavan kiistettävyyden ketjuanalyysia vastaan. Tätä homogeenisuutta voidaan mitata useilla menetelmillä, mutta yksi tehokkaimmista on mielestäni OXT- ja Samourai Wallet -tiimien kehittämän _Boltzmann_-työkalun tarjoamien indikaattoreiden käyttö, erityisesti transaktioiden entropia. Tätä tutkimme yksityiskohtaisesti tässä luvussa.

Toisin kuin anonsetit, jotka lasketaan joukosta transaktioita, tässä esittelemämme indikaattorit keskittyvät yksinomaan yhteen transaktioon, olipa se sitten coinjoin tai perinteisempi transaktio.

### Tulkintojen määrä

Ensimmäinen indikaattori, joka voidaan havaita Bitcoin-tapahtumassa, on tapahtumaa analysoivan ulkopuolisen tarkkailijan silmissä mahdollisten tulkintojen kokonaismäärä. Kun otetaan huomioon transaktioon osallistuvien UTXO:iden arvot, tämä indikaattori osoittaa, kuinka monella eri tavalla syötteet voidaan liittää tuotoksiin. Toisin sanoen se määrittää niiden mahdollisten tulkintojen määrän, joita transaktio voi synnyttää bitcoin-virrassa sitä analysoivan ulkopuolisen tarkkailijan näkökulmasta.

Esimerkiksi yksinkertaisella maksutapahtumalla, jossa on 1 tulo ja 2 lähtöä, on vain yksi tulkinta, nimittäin että tulo #0 rahoitti tuloksen #0 ja tuloksen #1. Muita mahdollisia tulkintoja ei ole:

![BTC204](assets/fr/159.webp)

Sitä vastoin Whirlpoolin 5x5-mallin mukaisesti jäsennellyssä kolikkoliitoksessa on 1 496 mahdollista yhdistelmää:

![BTC204](assets/fr/160.webp)

Whirlpool Surge Cycle 8x8 -kolikkoliitoksella saadaan 9 934 563 dollaria mahdollisia tulkintoja:

![BTC204](assets/fr/161.webp)

### Entropia

Bitcoin-tapahtuman tulkintojen määrästä voidaan laskea sen entropia.

Kryptografian ja informaation yleisessä yhteydessä entropia on tietolähteeseen tai satunnaisprosessiin liittyvän epävarmuuden tai arvaamattomuuden määrällinen mitta. Toisin sanoen entropia on tapa mitata, kuinka vaikeaa on ennustaa tai arvata tietoa.

Ketjuanalyysin yhteydessä entropia on myös nimi indikaattorille, joka on johdettu Shannonin entropiasta ja [LaurentMT:n keksimä](https://gist.github.com/LaurentMT/e758767ca4038ac40aaf) ja joka voidaan laskea Bitcoin-tapahtumasta.

Kun tapahtumalla on suuri määrä mahdollisia tulkintoja, on usein tarkoituksenmukaisempaa viitata sen entropiaan. Tämä indikaattori mittaa analyytikoiden tietämättömyyttä tapahtuman tarkasta kokoonpanosta. Toisin sanoen mitä suurempi entropia on, sitä vaikeampaa analyytikkojen on tunnistaa bitcoin-virtoja tulojen ja lähtöjen välillä.

Käytännössä entropia paljastaa, onko tapahtumalla ulkopuolisen tarkkailijan näkökulmasta useita mahdollisia tulkintoja, jotka perustuvat pelkästään panos- ja tulosmääriin, ottamatta huomioon muita ulkoisia tai sisäisiä malleja ja heuristiikkoja. Korkea entropia on siten synonyymi transaktion korkeammalle luottamuksellisuudelle.

Entropia määritellään mahdollisten yhdistelmien lukumäärän binäärilogaritmiksi. Tässä on käytetty kaavaa, jossa $E$ edustaa tapahtuman entropiaa ja $C$ mahdollisten tulkintojen lukumäärää:

$$
E = \log_2(C)
$$

Matematiikassa binäärilogaritmi (logaritmi emäksellä 2) vastaa käänteisoperaatiota, jossa 2 nostetaan tiettyyn potenssiin. Toisin sanoen $x$:n binäärilogaritmi on eksponentti, johon $2$ on nostettava, jotta saadaan $x$. Tämä indikaattori ilmaistaan siis bitteinä.

Otetaan esimerkiksi 5x5 Whirlpool-mallin mukaisesti jäsennellyn coinjoin-transaktion entropialaskelma, jossa, kuten edellisessä jaksossa mainittiin, mahdollisten tulkintojen määrä on 1496 dollaria:

$$
\begin{align*}
C &= 1.496 \\
E &= \log_2(1.496) \\
E &= 10.5469 \text{ bit}
\end{align*}
$$

Näin ollen tämän coinjoin-transaktion entropia on 10,5469$ bittiä, mitä pidetään erittäin tyydyttävänä. Mitä suurempi tämä arvo on, sitä enemmän erilaisia tulkintoja tapahtumasta voidaan tehdä, mikä parantaa sen yksityisyyden suojaa.

Jos 8x8 coinjoin-transaktiossa on 9 934 563 tulkintaa, entropia on:

$$
\begin{align*}
C &= 9.934.563 \\
E &= \log_2(9.934.563) \\
E &= 23,244 \text{ bit}
\end{align*}
$$

Otetaan toinen esimerkki tavallisesta maksutapahtumasta, jossa on 1 tulo ja 2 lähtöä: [1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce](https://mempool.space/tx/1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce)

![BTC204](assets/fr/162.webp)

Tämän tapahtuman tapauksessa ainoa mahdollinen tulkinta on: `(In.0) > (Out.0 ; Out.1)`. Näin ollen sen entropia on $0$:

$$
\begin{align*}
C &= 1 \\
E &= \log_2(1) \\
E &= 0 \text{ bit}
\end{align*}
$$

### Tehokkuus

Tapahtuman entropian perusteella voimme myös laskea sen yksityisyyden suojaamisen tehokkuuden. Tämä indikaattori arvioi transaktion tehokkuutta vertaamalla sitä optimaaliseen transaktioon, joka on mahdollista toteuttaa samassa kokoonpanossa.

Tämä johtaa meidät keskustelemaan käsitteestä maksimaalinen entropia, joka vastaa suurinta entropiaa, jonka tietty transaktiorakenne voisi teoreettisesti saavuttaa. Tapahtuman tehokkuus lasketaan sitten vertaamalla tätä maksimikentropiaa analysoidun tapahtuman todelliseen entropiaan.

Käytetty kaava on seuraava:


- $E_R$: tapahtuman todellinen entropia bitteinä ilmaistuna;
- $E_M$: transaktiorakenteen suurin mahdollinen entropia, joka ilmaistaan myös bitteinä;
- $Ef$: transaktion tehokkuus bitteinä:

$$
Ef = E_R - E_M
$$

Esimerkiksi Whirlpool 5x5 -tyyppisen coinjoin-rakenteen suurin entropia on $10.5469$:

$$
\begin{align*}
E_R &= 10,5469 \\
E_M &= 10,5469 \\
Ef &= E_R - E_M \\
Ef &= 10,5469 - 10,5469 \\
Ef &= 0 \text{ bit}
\end{align*}
$$

Tämä indikaattori ilmaistaan myös prosentteina. Käytetty kaava on seuraava:


- $C_R$: mahdollisten reaalisten tulkintojen lukumäärä;
- $C_M$: saman rakenteen omaavien mahdollisten tulkintojen enimmäismäärä;
- $Ef$: tehokkuus prosentteina ilmaistuna:

$$
\begin{align*}
E_f &= \frac{C_R}{C_M} \\
E_f &= \frac{1.496}{1.496} \\
E_f &= 100\%
\end{align*}
$$

Tehokkuus $100\%$ tarkoittaa siis sitä, että transaktio maksimoi yksityisyyden suojan potentiaalin sen rakenteen perusteella.

### Entropian tiheys

Entropia on hyvä indikaattori mittaamaan tapahtuman yksityisyyttä, mutta se riippuu osittain tapahtuman tulojen ja lähtöjen määrästä. Jos halutaan verrata kahden eri transaktion entropiaa, joissa ei ole sama määrä syötteitä ja lähtöjä, voidaan laskea entropian tiheys. Tämä indikaattori antaa näkökulman tapahtuman kunkin panoksen tai lähdön entropiaan. Tiheys on hyödyllinen arvioitaessa ja vertailtaessa erikokoisten transaktioiden tehokkuutta.

Se lasketaan jakamalla transaktion kokonaisentropia transaktioon osallistuvien tulojen ja lähtöjen kokonaismäärällä:


- $E_D$: entropian tiheys bitteinä ilmaistuna;
- $E$: transaktion entropia bitteinä ilmaistuna;
- $T$: tapahtuman tulojen ja lähtöjen kokonaismäärä:

$$
E_D = \frac{E}{T}
$$

Esimerkkinä 5x5 Whirlpoolin yhteisliitäntä:

$$
\begin{align*}
T &= 5 + 5 = 10 \\
E &= 10.5469 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{10.5469}{10} \\
E_D &= 1.054 \text{ bit}
\end{align*}
$$

Laskemme myös 8x8 Whirlpool coinjoinin entropiatiheyden:

$$
\begin{align*}
T &= 8 + 8 = 16 \\
E &= 23.244 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{23.244}{16} \\
E_D &= 1.453 \text{ bit}
\end{align*}
$$

Analysoimalla näiden kahden rinnakkaisliitostyypin entropiatiheyttä käy ilmi, että vaikka entropia normalisoidaan elementtien lukumäärän mukaan, "Surge Cycle 8x8" - rinnakkaisliitos tuottaa enemmän epävarmuutta analyysia varten.

### Boltzmannin pistemäärä

Toinen transaktiossa analysoitava tieto on kunkin elementin Boltzmann-pistemäärä suhteessa toiseen elementtiin. Kyseessä on taulukko, jossa esitetään syötteiden ja tuotosten vastaavuuden todennäköisyydet. Taulukosta käy ilmi Boltzmann-pistemäärän avulla ehdollinen todennäköisyys sille, että tietty panos liittyy tiettyyn tuotokseen. Kyseessä on siis kvantitatiivinen mittari, joka kuvaa ehdollista todennäköisyyttä, että jonkin panoksen ja tuotoksen välinen yhteys toteutuu transaktiossa, ja joka määräytyy tämän tapahtuman suotuisien esiintymisten lukumäärän ja mahdollisten esiintymisten kokonaislukumäärän suhteen perusteella tulkintakokonaisuudessa.

Esimerkkinä Whirlpoolin coinjoin, ehdollinen todennäköisyystaulukko toisi esiin kunkin syötteen ja tuloksen välisen yhteyden mahdollisuudet ja tarjoaisi kvantitatiivisen mittarin tapahtuman assosiaatioiden moniselitteisyydestä:

| % | Lähtö 0 | Lähtö 1 | Lähtö 2 | Lähtö 3 | Lähtö 4 | Lähtö 4 |

| ------- | -------- | -------- | -------- | -------- | -------- |

Tässä tapauksessa on selvää, että jokaisella syötteellä on sama todennäköisyys liittyä mihin tahansa tuotokseen, mikä lisää tapahtuman luottamuksellisuutta.

Boltzmann-pistemäärän laskeminen tarkoittaa, että niiden tulkintojen lukumäärä, joissa tietty tapahtuma esiintyy, jaetaan käytettävissä olevien tulkintojen kokonaismäärällä. Jos siis halutaan määrittää pistemäärä yhdistämällä tulo #0 tulosteeseen #3 (tapahtuma, joka esiintyy $512$ tulkinnoissa), prosessi on seuraava:

$$
\begin{align*}
\text{Interpretazioni (IN.0 > OUT.3)} &= 512 \\
\text{Interpretazioni Totali} &= 1496 \\
\text{Punteggio} &= \frac{512}{1496} \\
\text{Punteggio} &= 34\%
\end{align*}
$$

Jos tarkastelemme uudestaan esimerkkiä Surge 8x8 Whirlpoolin coinjoin-syklistä, Boltzmannin taulukko näyttää seuraavalta:

| | OUT.0 | OUT.1 | OUT.2 | OUT.3 | OUT.4 | OUT.5 | OUT.6 | OUT.7 | OUT.7 | OUT.7 |

| ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |

| IN.0 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.1 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.2 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.3 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.4 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.5 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.6 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.7 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

Kun kyseessä on yksinkertainen tapahtuma, jossa on yksi tulo ja kaksi lähtöä, tilanne on kuitenkin erilainen:

| % | Lähtö 0 | Lähtö 1 |

| ------- | -------- | -------- |

| Input 0 | 100% | 100% | 100% |

Tässä havaitaan, että todennäköisyys sille, että jokainen lähtö tulee syötteestä #0, on 100 %. Pienempi todennäköisyys johtaa siis suurempaan yksityisyyteen, koska se heikentää suoria yhteyksiä syötteiden ja tuotosten välillä.

### Deterministiset linkit

On myös mahdollista laskea tapahtuman determinististen linkkien määrä. Tämä indikaattori paljastaa, kuinka monta analysoidun liiketoimen panosten ja tuotosten välistä linkkiä on kiistattomia, 100 prosentin todennäköisyydellä. Indikaattoria voidaan täydentää laskemalla determinististen linkkien suhde. Suhde antaa kuvan näiden determinististen linkkien painosta kaikkien tapahtuman linkkien joukossa.

Esimerkiksi Whirlpoolin yhteistoimintatapahtumassa ei ole determinististä yhteyttä panosten ja tuotosten välillä, joten indikaattori osoittaa 0 yhteyttä ja suhdeluku on 0 %. Sen sijaan toisessa tarkastellussa yksinkertaisessa maksutapahtumassa (jossa on yksi panos ja kaksi tuotosta) indikaattori kertoo, että deterministisiä yhteyksiä on kaksi ja suhde on 100 prosenttia. Näin ollen nolla indikaattori merkitsee erinomaista yksityisyyttä, koska panosten ja tuotosten välillä ei ole suoria ja kiistattomia yhteyksiä.

### Miten nämä indikaattorit lasketaan?

Näiden indikaattoreiden laskeminen manuaalisesti esittämieni yhtälöiden avulla on suhteellisen yksinkertaista. Suurin vaikeus on määritellä transaktion mahdollisten tulkintojen määrä. Tämä laskelma voidaan tehdä käsin vakiotapahtumalle. Rinnakkaistapahtuman osalta tehtävä on kuitenkin huomattavasti monimutkaisempi.

Aiemmin oli olemassa OXT:n ja Samourain tiimien kehittämä Python-työkalu nimeltä _Boltzmann Calculator_, jonka avulla kaikki nämä indikaattorit voitiin laskea automaattisesti Bitcoin-tapahtumalle:

![BTC204](assets/fr/163.webp)

Näissä analyyseissä voitiin käyttää myös KYCP.org-sivustoa:

![BTC204](assets/fr/164.webp)

Valitettavasti Samourain perustajien pidätyksen jälkeen nämä välineet eivät tällä hetkellä ole toiminnassa.

Nyt kun olemme käsitelleet coinjoineja yksityiskohtaisesti, tutkimme muita Bitcoinissa käytettävissä olevia yksityisyystekniikoita koulutuksemme viimeisessä osiossa. Tarkastelemme payjoin-transaktioita, erityisiä pseudo-coinjoin-transaktiotyyppejä, staattisia osoiteprotokollia sekä toimenpiteitä, joilla yksityisyyden suojaa ei paranneta transaktiotasolla vaan solmujen verkon tasolla.

https://planb.network/tutorials/privacy/analysis/boltzmann-entropy-738e45af-18a6-4ce6-af1a-1bf58e15f1fe
# Ymmärtää muiden kehittyneiden yksityisyyden suojaa koskevien tekniikoiden panokset

<partId>19989ae6-d608-4acf-b698-2cf1e7e5e6ae</partId>

## Payjoin-transaktiot

<chapterId>c1e90b95-f709-4574-837b-2ec26b11286f</chapterId>

Tällä hetkellä coinjoin on tehokkain menetelmä epävarmuuden lisäämiseksi kolikonseurantaan ketjuanalyysin aikana. Kuten aiemmissa luvuissa on todettu, tehokkaan sekoittamisen aikaansaamiseksi syötteiden ja tuotosten on oltava mahdollisimman homogeenisia. Lisäksi on ratkaisevan tärkeää, että coinjoinit integroidaan mahdollisimman suureksi ryhmäksi, jotta anonsetit voidaan maksimoida. Jotta kolikkoyhdistäminen olisi tehokasta, siihen on siis osallistuttava suuri määrä yhtenäisiä kolikoita. Tämä vaatimusten moninaisuus tarkoittaa sitä, että kolikkoyhdistämistapahtumilla on hyvin jäykkä rakenne: määrät on määritelty ennalta, ja kaikkien osallistujien on noudatettava niitä prosessin yhdenmukaisuuden varmistamiseksi. Lisäksi coinjoinit edellyttävät synkronointia kaikkien osallistujien ja koordinaattorin välillä transaktion rakentamisen aikana.

Näiden vaatimusten vuoksi coinjoin ei sovellu suoriin tukiin. Jos esimerkiksi omistat 1 miljoonan satsin palan coinjoin-poolissa, sen käyttäminen suoraan maksuna olisi monimutkaista. Se edellyttäisi synkronointia muiden osallistujien kanssa ja koordinaattorin rakentamista täsmälleen silloin, kun haluat tehdä maksun yhteistapahtuman, ja ostosumman olisi vastattava täsmälleen palasi arvoa, mikä on käytännössä mahdotonta. Siksi coinjoin-transaktio on luonteeltaan yhteistoiminnallinen siivoustransaktio, mikä tarkoittaa sitä, että yleensä panosten omistajat ovat samoja, jotka ovat myös tuotoksissa.

Olisi kuitenkin mielenkiintoista, että transaktiorakenteet mahdollistaisivat käytännön maksut, kun ketjuanalyysiin sisällytettäisiin epäilyksiä. Juuri tätä tutkimme tässä ja seuraavassa luvussa.

### Mikä on payjoin-transaktio?

Payjoin on erityinen Bitcoin-tapahtumarakenne, joka parantaa käyttäjän yksityisyyttä kulutuksen aikana tekemällä yhteistyötä maksun vastaanottajan kanssa.

Vuonna 2015 LaurentMT mainitsi tämän menetelmän ensimmäisen kerran nimellä "steganografiset transaktiot" (steganographic transactions) artikkelin mukaan [täällä](https://gist.githubusercontent.com/LaurentMT/e758767ca4038ac40aaf/raw/c8125f6a3c3d0e90246dc96d3b603690ab6f1dcc/gistfile1.txt). Tämän tekniikan otti myöhemmin käyttöön Samourai Wallet, joka vuonna 2018 oli ensimmäinen asiakas, joka toteutti sen Stowaway-työkalulla. Payjoin-konsepti löytyy myös [BIP79](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki) ja [BIP78](https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki). Payjoinista käytetäänkin useita termejä:


- Payjoin;
- Salamatkustaja;
- P2EP (_Pay-to-End-Point_);
- Steganografinen tapahtuma.

Payjoinin ainutlaatuisuus piilee sen kyvyssä luoda transaktio, joka näyttää ensi silmäyksellä tavalliselta, mutta on itse asiassa kahden ihmisen välinen mini-Coinjoin. Tätä varten transaktion rakenteeseen kuuluu maksun vastaanottaja syötteissä varsinaisen lähettäjän ohella. Vastaanottaja sisällyttää sitten maksutapahtuman keskelle itselleen maksun, jonka avulla hänelle voidaan maksaa.

Otetaanpa esimerkki, jotta tämä prosessi ymmärretään paremmin. Alice ostaa patongin 4 000 satsilla käyttäen 10 000 satsin UTXO:ta ja valitsee payjoinin. Hänen leipurinsa Bob lisää panokseksi 15 000 satsin UTXO:n, jonka hän saa kokonaisuudessaan takaisin tuotoksena Alicen 4 000 satsin lisäksi.

Esimerkissä leipuri Bob syöttää 15 000 satsia ja saa 19 000 satsia, jolloin erotus on tasan 4 000 satsia, joka on patongin hinta. Alice puolestaan syöttää 10 000 satsia ja saa tuotokseksi 6 000 satsia, mikä vastaa -4 000 satsin saldoa, joka on patongin hinta. Esimerkin yksinkertaistamiseksi jätin tarkoituksella pois kaivostoiminnan maksut tässä liiketoimessa.

### Mikä on payjoinin tarkoitus?

Payjoin-transaktio täyttää kaksi tavoitetta, joiden avulla käyttäjät voivat parantaa maksunsa yksityisyyttä.

Ensinnäkin payjoin pyrkii huijaamaan ulkopuolista tarkkailijaa luomalla harhautuksen ketjuanalyysiin. Tämä on mahdollista CIOH:n (Common Input Ownership Heuristic) avulla. Kuten osassa 3 nähtiin, yleensä kun lohkoketjussa tapahtumassa on useita syötteitä, oletetaan, että kaikki nämä syötteet kuuluvat samalle taholle tai käyttäjälle.

Kun analyytikko tutkii payjoin-transaktiota, hänelle annetaan ymmärtää, että kaikki syötteet ovat peräisin samalta henkilöltä. Tämä käsitys on kuitenkin virheellinen, koska myös maksunsaaja antaa panoksia varsinaisen maksajan lisäksi. Ketjuanalyysi on siten vinoutunut väärän tulkinnan suuntaan, joka osoittautuu vääräksi.

Palataanpa esimerkkiin payjoin-transaktiosta, jolla maksetaan patonki:

Kun ulkopuolinen tarkkailija näkee tämän transaktion lohkoketjussa, hän tulkitsisi sen ketjuanalyysin tavanomaisia heuristiikkoja noudattaen näin: "Alice liittyi 2 UTXO:n transaktioon maksaakseen 19 000 satsia Bobille."

Tämä tulkinta on selvästi väärä, sillä kuten jo tiedät, nämä kaksi UTXO:ta eivät kuulu samalle henkilölle. Toinen on Alicelta, patongin ostajalta, ja toinen on Bobilta, leipurilta.

Näin ulkopuolisen tarkkailijan analyysi kohdistuu virheelliseen johtopäätökseen, mikä takaa sidosryhmien luottamuksellisuuden säilymisen.

### Steganografinen tapahtuma

Payjoinin toinen tavoite on hämätä ulkopuolista tarkkailijaa suoritetun maksun todellisesta määrästä. Tarkastelemalla tapahtuman rakennetta analyytikko saattaa uskoa, että maksu vastaa yhden tuoton määrää.

Jos otamme esimerkin patongin ostamisesta, analyytikko ajattelee, että maksun määrä vastaa joko 6 000 satsin UTXO:ta tai 19 000 satsin UTXO:ta. Tässä tapauksessa analyytikko ajattelee todennäköisemmin, että maksun määrä on 19 000 satsia, koska tuotoksessa on kaksi UTXO:ta, joista ainakin toinen on suurempi kuin 6 000 satsia (ei ole mitään loogista syytä käyttää kahta UTXO:ta 6 000 satsin maksamiseen, kun yksi UTXO olisi riittänyt tähän maksuun).

Todellisuudessa tämä analyysi on kuitenkin virheellinen. Maksun määrä ei vastaa mitään tuotosta. Se on itse asiassa tuotoksen vastaanottajan UTXO:n ja syötteen vastaanottajan UTXO:n välinen erotus.

Tässä payjoin-transaktio kuuluu steganografian piiriin. Sen avulla transaktion todellinen summa voidaan piilottaa väärennetyn transaktion sisään, joka toimii harhautuksena.

Steganografia on tekniikka, jolla tieto kätketään muun datan tai esineiden sisään niin, että piilotetun tiedon läsnäolo ei ole havaittavissa. Esimerkiksi salainen viesti voidaan piilottaa pisteen sisään tekstiin liittymättömässä tekstissä, jolloin sitä ei voi havaita paljain silmin (tämä on [micropoint](https://fr.wikipedia.org/wiki/Micropoint) -tekniikka).

Toisin kuin salaus, joka tekee tiedosta käsittämättömän ilman salausavainta, steganografia ei muuta tietoa. Ne pysyvät näkyvillä. Sen tavoitteena on pikemminkin salata salaisen viestin olemassaolo, kun taas kryptografia paljastaa selvästi kätketyn tiedon olemassaolon, vaikkakin siihen ei pääse käsiksi ilman avainta. Tämän vuoksi payjoinin alkuperäinen nimi oli "steganografiset transaktiot"

Kryptografian ja coinjoinin sekä steganografian ja payjoinin välillä voidaan tehdä analogia. Itse asiassa coinjoinilla on samankaltaisia ominaisuuksia kuin kryptografialla: menetelmä on tunnistettavissa, mutta tieto on salattavissa. Sen sijaan payjoin muistuttaa steganografiaa: tieto on teoriassa saatavilla, mutta koska sen kätkentämenetelmä ei ole tunnistettavissa, siitä tulee saavuttamattomissa.

### Miten payjoinia käytetään?

Tunnettuja ohjelmistoja, jotka tukevat payjoinia, ovat Sparrow Wallet, Wasabi Wallet, Mutiny, BitMask, BlueWallet ja JoinMarket sekä BTCPay-maksuprosessori.

Edistynein toteutus payjoin oli vain Stowaway on Samourai Wallet. Ohjelmiston perustajien sulkemisen jälkeen tämä työkalu toimii kuitenkin vain osittain. Stowawayn etuna on, että se on täydellinen ja erittäin helppokäyttöinen protokolla, joka tukee sekä payjoinin vastaanottamista että lähettämistä. Osittain allekirjoitettuja transaktioita voidaan vaihtaa manuaalisesti skannaamalla useita QR-koodeja tai automaattisesti Torin kautta Sorobanin kautta. Juuri jälkimmäinen viestintävaihtoehto ei ole tällä hetkellä käytössä.

Payjoinin käytön vaikeus on sen riippuvuus kauppiaan osallistumisesta. Asiakkaana payjoinin käyttö on mahdotonta, jos kauppias ei tue sitä. Tämä lisää lisävaikeuksia ostoksen aikana: ei ole pelkästään monimutkaista löytää kauppiaita, jotka hyväksyvät bitcoinin, vaan jos etsit myös niitä, jotka tukevat payjoineja, siitä tulee vielä monimutkaisempaa.

Yksi ratkaisu voisi olla sellaisten transaktiorakenteiden käyttö, jotka tuovat ketjuanalyysiin epäselvyyttä edellyttämättä vastaanottajan yhteistyötä. Näin voisimme parantaa maksujen yksityisyyttä ilman, että olemme riippuvaisia kauppiaiden aktiivisesta osallistumisesta. Juuri tätä tutkimme seuraavassa luvussa.

https://planb.network/tutorials/privacy/on-chain/payjoin-sparrow-wallet-087a0e49-61cd-41f5-8440-ac7b157bdd62
https://planb.network/tutorials/privacy/on-chain/payjoin-samourai-wallet-48a5c711-ee3d-44db-b812-c55913080eab
## Mini-coinjoin-maksu

<chapterId>300777ee-30ae-43d7-ab00-479dac3522c1</chapterId>

Kun haluat tehdä maksutapahtuman ja säilyttää samalla jonkinasteisen yksityisyyden, payjoin on hyvä vaihtoehto. Mutta kuten olemme nähneet, payjoin edellyttää vastaanottajan osallistumista. Mitä siis tehdä, jos tämä kieltäytyy osallistumasta payjoiniin tai jos yksinkertaisesti haluat olla ottamatta häntä mukaan? Yksi vaihtoehto on käyttää Stonewall- tai Stonewall x2-tapahtumaa. Tutustutaanpa tarkemmin näihin kahteen transaktiotyyppiin.

### Stonewall-transaktio

Stonewall on erityinen Bitcoin-tapahtumamuoto, jonka tarkoituksena on lisätä käyttäjän yksityisyyttä ostoskierroksen aikana jäljittelemällä kahden ihmisen välistä pseudo-coin-liittymää, mutta olematta itse asiassa yksi. Itse asiassa tämä transaktio ei ole yhteistoiminnallinen. Käyttäjä voi rakentaa sen itse, ja siinä on mukana vain hänen omistamiaan UTXO:ita syötteenä. Sen jälkeen voit luoda Stonewall-tapahtuman mihin tahansa tilaisuuteen ilman, että sinun tarvitsee synkronoida toisen käyttäjän tai vastaanottajan kanssa.

Stonewall-transaktio toimii seuraavasti: transaktion syötössä lähettäjä käyttää kahta hänelle kuuluvaa UTXO:ta. Transaktio tuottaa lähdössä 4 UTXO:ta, joista 2 on täsmälleen samanarvoisia. Loput 2 UTXOa muodostavat loput. Näistä kahdesta samansuuruisesta tuotoksesta vain toinen menee maksun vastaanottajalle.

Stonewall-tapahtumassa on vain kaksi roolia:


- Lähettäjä, joka suorittaa maksun;
- Vastaanottaja, joka ei välttämättä tiedä tapahtuman erityisluonnetta ja odottaa vain maksua lähettäjältä.

Otetaan esimerkki tämän tapahtumarakenteen ymmärtämiseksi. Alice on leipuri Bobin luona ostamassa patonkia, joka maksaa 4 000 satsia. Hän haluaa maksaa bitcoineilla ja säilyttää samalla jonkinasteisen yksityisyyden maksustaan. Siksi hän päättää rakentaa maksua varten Stonewall-tapahtuman.

Analysoimalla tätä liiketapahtumaa voimme nähdä, että leipuri Bob sai itse asiassa 4 000 satsia maksuna patongista. Alice käytti panoksina kahta UTXO:ta: toinen 10 000 satsin ja toinen 15 000 satsin suuruinen. Tuotoksina hän sai 3 UTXO:ta: yhden 4 000 satsin, yhden 6 000 satsin ja yhden 11 000 satsin. Liisan nettosaldo tästä kaupasta on siis -4 000 satsia, mikä on täsmälleen sama kuin patongin hinta.

Tässä esimerkissä olen tarkoituksella jättänyt kaivostoiminnan maksut huomiotta, jotta ymmärtäminen olisi helpompaa. Todellisuudessa transaktiomaksut jäävät kokonaan lähettäjän maksettaviksi.

### Mitkä ovat Stonewall-tapahtuman tavoitteet?

Stonewall-rakenne lisää paljon entropiaa transaktioon ja sekoittaa ketjuanalyysin jäljet. Ulkopuolelta tällainen transaktio voidaan tulkita kahden henkilön väliseksi minikolikkoliitoksi. Todellisuudessa kyseessä on kuitenkin maksu. Näin ollen tämä menetelmä aiheuttaa epävarmuutta ketjuanalyysissä tai johtaa jopa vääriin jälkiin.

Palataanpa esimerkkiin, jossa Alice on Bob-leipurin luona. Lohkoketjussa tapahtuma näyttäisi seuraavalta:

![BTC204](assets/fr/174.webp)

Ulkopuolinen tarkkailija, joka luottaa ketjuanalyysin yleiseen heuristiikkaan, saattaa virheellisesti päätellä, että "_kaksi ihmistä teki pienen kolikkoliitoksen, jossa kummallakin oli yksi UTXO sisääntulossa ja kaksi UTXO:ta ulostulossa_" Tämän liiketoimen analysointi ulkopuolelta ei johda tulon yhteisen omistajuuden heuristiikan (Common Ownership Heuristics of Input, CIOH) soveltamiseen, koska kahden samansuuruisen tuoton olemassaolo viittaa coinjoin-malliin. Ulkopuolelta katsottuna CIOH ei siis sovellu tähän tapaukseen.

![BTC204](assets/fr/175.webp)

Tämä tulkinta on epätarkka, koska kuten tiedät, yksi UTXO lähetettiin Bob-leipurille, 2 UTXO:ta tulossa oli Alicelta, ja hän haki 3 lopun tulosta.

![BTC204](assets/fr/176.webp)

Erityisen mielenkiintoista Stonewallin liiketoimen rakenteessa on se, että ulkopuolisen tarkkailijan näkökulmasta se näyttää täsmälleen samalta kuin Stonewall x2 -liiketoimi.

### Stonewall-transaktio x2

Stonewall x2 on toinen erityinen Bitcoin-tapahtuman muoto, jolla pyritään myös lisäämään käyttäjän yksityisyyttä rahankäytön aikana, mutta tällä kertaa tekemällä yhteistyötä kolmannen osapuolen kanssa, joka ei ole mukana rahankäytössä. Tämä menetelmä toimii kahden osallistujan välisenä pseudo-coinliitoksena, kun maksua suoritetaan kolmannelle osapuolelle.

Stonewall x2 -tapahtuman toiminta on suhteellisen yksinkertaista: maksun suorittamiseen käytetään hallussa olevaa UTXO:ta ja käytetään apuna kolmatta osapuolta, joka myös antaa oman UTXO:nsa. Transaktio päättyy neljään lähtöön: kaksi niistä on samansuuruisia, joista toinen menee maksun vastaanottajan osoitteeseen ja toinen maksajan osoitteeseen. Kolmas UTXO lähetetään toiseen maksajan osoitteeseen, jolloin hän voi saada takaisin alkuperäisen summan (neutraali toimenpide hänelle, josta on vähennetty kaivosmaksut), ja viimeinen UTXO palaa meille kuuluvaan osoitteeseen, joka muodostaa maksun loppuosan.

Stonewall x2 -tapahtumissa määritellään siis kolme erilaista roolia:


- Lähettäjä, joka suorittaa varsinaisen maksun;
- Vastaanottaja, joka ei välttämättä tiedä tapahtuman erityisluonnetta ja odottaa vain maksua lähettäjältä;
- Yhteistyökumppani, joka antaa bitcoinia epäillä transaktioanalyysia, perii varansa kokonaan takaisin lopussa (neutraali toiminta heille, ilman kaivosmaksuja).

Palataanpa esimerkkiin, jossa Alice on Bob-leipurilla ostamassa patonkia, joka maksaa 4 000 satsia. Hän haluaa maksaa bitcoineilla ja säilyttää samalla jonkinasteisen yksityisyyden maksunsa suhteen. Niinpä hän soittaa ystävälleen Charlesille, joka auttaa häntä tässä prosessissa.

![BTC204](assets/fr/177.webp)

Analysoimalla tätä liiketapahtumaa voimme nähdä, että leipuri Bob sai itse asiassa 4 000 satsia maksuna patongista. Alice käytti 10 000 satsia panoksena ja sai takaisin 6 000 satsia tuotoksena, jolloin nettosaldoksi tuli -4 000 satsia, mikä vastaa patongin hintaa. Charles antoi 15 000 satia panoksena ja sai kaksi tuotosta: 4 000 satia ja 11 000 satia, jolloin saldoksi tuli 0 satia.

Tässä esimerkissä olen tarkoituksella jättänyt huomiotta palkkiot ymmärtämisen helpottamiseksi. Todellisuudessa louhintapalkkiot jaetaan yleensä tasan maksun myöntäjän ja maksajan kesken.

### Mitkä ovat Stonewall x2 -tapahtuman tavoitteet?

Kuten Stonewall-rakenne, myös Stonewall x2 -rakenne lisää transaktioon huomattavan määrän entropiaa ja peittää ketjuanalyysin jäljet. Ulkopuolisesta näkökulmasta tällainen transaktio voitaisiin tulkita pieneksi kolikkoyhteydeksi kahden henkilön välillä. Todellisuudessa kyseessä on kuitenkin maksu. Näin ollen tämä menetelmä aiheuttaa epävarmuutta ketjuanalyysissä, mikä johtaa myös vääriin jälkiin.

Tarkastellaanpa esimerkkiä Alicesta, leipuri Bobista ja Charlesista. Lohkoketjussa tapahtuma näyttäisi seuraavalta:

![BTC204](assets/fr/178.webp)

Ulkopuolinen tarkkailija, joka luottaa ketjuanalyysin yleiseen heuristiikkaan, saattaa virheellisesti päätellä, että "_Alice ja Charles suorittivat pienen coinjoinin, jossa kummallakin oli yksi UTXO tulossa ja kaksi UTXO:ta tulossa_" Myöskään tämän liiketoimen analysointi ulkopuolelta ei johda tulon yhteisen omistuksen heuristiikan (Common Ownership Heuristics of Input, CIOH) soveltamiseen, koska kahden samansuuruisen tuoton läsnäolo viittaa coinjoin-malliin. Ulkopuolelta katsottuna CIOH ei siis sovellu tähän tapaukseen.

![BTC204](assets/fr/179.webp)

Tämä tulkinta on epätarkka, koska kuten tiedätte, yksi UTXO lähetettiin leipuri-Bobille, Alicella on vain yksi lepotulos ja Charlesilla kaksi.

![BTC204](assets/fr/180.webp)

Stonewall x2 -liiketoimen rakenteessa on erityisen mielenkiintoista se, että ulkopuolisen tarkkailijan näkökulmasta se näyttää täsmälleen samalta kuin Stonewallin liiketoimi.

### Mitä eroa on Stonewallin ja Stonewall x2:n välillä?

StonewallX2-tapahtuma toimii täsmälleen samoin kuin Stonewall-tapahtuma, paitsi että ensin mainittu on yhteistoiminnallinen, kun taas jälkimmäinen ei ole. Kuten olemme nähneet, StonewallX2-tapahtumaan osallistuu kolmas osapuoli (Charles), joka on maksun ulkopuolinen ja joka tarjoaa bitcoinejaan tapahtuman luottamuksellisuuden lisäämiseksi. Klassisessa Stonewall-tapahtumassa lähettäjä on rahoittajan roolissa.

![BTC204](assets/fr/181.webp)

Ulkoisesta näkökulmasta katsottuna transaktiomalli on siis täsmälleen sama.

Se, että näillä kahdella transaktiorakenteella on täsmälleen sama kuvio, merkitsee sitä, että vaikka ulkopuolinen tarkkailija pystyisi tunnistamaan "Stonewall(x2)" -kuvion, hänellä ei ole kaikkea tietoa. Hän ei pysty määrittämään, kumpi kahdesta samansuuruisesta UTXO:sta vastaa maksua. Hän ei myöskään pysty määrittämään, ovatko nämä kaksi UTXO-tuloa peräisin kahdelta eri henkilöltä (Stonewall x2) vai kuuluivatko ne yhdelle henkilölle, joka yhdisti ne (Stonewall).

Viimeksi mainittu seikka johtuu siitä, että Stonewall x2 -tapahtumat noudattavat täsmälleen samaa kaavaa kuin Stonewall-tapahtumat. Ulkopuolelta käsin ja ilman lisätietoja on mahdotonta erottaa Stonewall-tapahtumaa Stonewall x2 -tapahtumasta. Ensin mainitut eivät kuitenkaan ole yhteistoiminnallisia liiketoimia, kun taas jälkimmäiset ovat. Tämä lisää entisestään epäilyksiä yhden tällaisen liiketoimen analysoinnissa.

### Milloin käyttää Stonewall ja Stonewall x2 -tapahtumia?

Kun haluat käyttää yksityisyydensuojatyökalua tapahtumassa, logiikan pitäisi olla seuraava:


- Ensisijaisesti voit valita payjoinin;
- Jos kauppias ei tue payjoineja, yhteistapahtuma voidaan tehdä toisen henkilön kanssa maksun ulkopuolella käyttämällä Stonewall x2 -rakennetta;
- Jos et löydä ketään, jonka kanssa tehdä Stonewall x2 -tapahtuma, voit tehdä Stonewall-tapahtuman yksin, mikä jäljittelee Stonewall x2 -tapahtuman käyttäytymistä.

### Kuinka käyttää Stonewall- ja Stonewall x2 -tapahtumia?

Stonewall- ja Stonewall x2 -tapahtumat ovat käytettävissä sekä Samourai Wallet -sovelluksessa että Sparrow Wallet -ohjelmistossa.

Samourain perustajien pidättämisen jälkeen Stonewall x2 -tapahtumat toimivat kuitenkin, kuten payjoinitkin, vain vaihtamalla PSBT-tunnukset manuaalisesti osapuolten välillä. Automaattinen vaihto Sorobanin kautta ei valitettavasti ole tällä hetkellä käytettävissä.

Voit suorittaa tämäntyyppisen tapahtuman myös manuaalisesti mistä tahansa Bitcoin-lompakko-ohjelmistosta.

Seuraavassa luvussa tarkastelemme toista suhteellisen tuntematonta mutta erittäin hyödyllistä yksityisyyden suojaa koskevaa tekniikkaa jo tutkimiemme tekniikoiden lisäksi.

https://planb.network/tutorials/privacy/on-chain/stonewall-033daa45-d42c-40e1-9511-cea89751c3d4
https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b
## Levypallot

<chapterId>db9a20ac-a149-443d-884b-ea6c03f28499</chapterId>

Bitcoin-tapahtumarakenteiden, kuten coinjoinin, käyttö lisää epäselvyyttä ketjuanalyysissä ja on erityisen hyödyllistä yksityisyyden suojan kannalta. Kuten käsittelimme payjoineja koskevassa luvussa, coinjoin-transaktiot ovat kuitenkin luonnollisesti tunnistettavissa ketjussa. Muistakaa kryptografian ja coinjoinin välinen analogia: kun tiedosto salataan, kolmas osapuoli, joka löytää salatun tiedoston, ei pääse käsiksi sen sisältöön, mutta voi selvästi tunnistaa, että tiedostoa on muutettu sen sisällön salaamiseksi. Sama pätee coinjoineihin: kun analyytikko tutkii coinjoin-transaktiota, hän voi silti tunnistaa, että havaittu transaktio on coinjoin, vaikka hän ei pystyisikään osoittamaan suoria yhteyksiä syötteiden ja tulosteiden välillä (ja päinvastoin).

Riippuen kolikon käyttötarkoituksesta kolikon kolikkoliitosprosessin jälkeen, voi olla ongelmallista, että kolikko on käynyt läpi tämän prosessin. Jos esimerkiksi aiot myydä kolikkosi säännellyllä pörssialustalla, mutta se on hiljattain käynyt läpi coinjoinin, alustan ketjuanalyysityökalu havaitsee tämän. Alusta voi tällöin kieltäytyä hyväksymästä UTXO:tasi, joka on kokenut coinjoinin, tai jopa vaatia sinulta selityksiä, jolloin vaarana on, että tilisi keskeytetään tai varasi jäädytetään. Joissakin tapauksissa alusta voi myös ilmoittaa käyttäytymisestäsi valtion viranomaisille (esimerkiksi TRACFIN vaatii tätä digitaalisten varojen palveluntarjoajilta (PSAN) Ranskassa).

Tämän välttämiseksi tarvitsisimme työkalun, joka pystyy häivyttämään Bitcoin-kolikon menneisyyden jäljet ja palauttamaan jonkinlaisen vaihdettavuuden. Juuri tämä on ricochetin tavoite.

### Mikä on kimpoaminen?

Ricochet on tekniikka, jossa suoritetaan useita tekaistuja transaktioita itselle (pyyhkäisy), jotta voidaan simuloida bitcoinin omistusoikeuden siirtoa. Tämä työkalu eroaa muista käsittelemistämme transaktiorakenteista, koska se ei mahdollista prospektiivista anonymiteettiä vaan pikemminkin eräänlaisen takautuvan anonymiteetin. Itse asiassa ricochet mahdollistaa sellaisten erityispiirteiden hämärtämisen, jotka saattavat vaarantaa bitcoin-kolikon vaihdettavuuden sen menneisyyden vuoksi.

Jotta kolikkoon jäänyt jälki, esimerkiksi kolikkojen yhdistämissyklien kaltainen jälki, voidaan häivyttää, ricochet suorittaa neljä peräkkäistä tapahtumaa, joissa käyttäjä siirtää varoja itselleen eri osoitteisiin.

Tämän transaktiosarjan jälkeen ricochet-työkalu ohjaa bitcoinit lopulta lopulliseen määränpäähänsä, joka on vaihtofoorumi.

Tavoitteena on luoda etäisyys, joka vaikuttaa kolikon vaihdettavuuteen, kuten kolikkoliittymistapahtumassa, ja lopulliseen rahankäyttöön, joka saattaa hylätä kolikon sen menneisyyden vuoksi. Ketjuanalyysityökalut saattavat siis päätellä, että tapahtuman jälkeen on todennäköisesti tapahtunut omistajanvaihdos, ja katsoa, että tämä kolikko on vaihdettavissa. Coinjoinin tapauksessa ketjuanalyysityökalut voisivat tällöin olettaa, että kyseessä ei ole sama henkilö, joka lähetti bitcoinit ja suoritti coinjoinin, ja näin ollen on hyödytöntä käynnistää toimia lähettäjää vastaan.

### Miksi se toimii?

Tämän rysäysmenetelmän kohdalla voisi kuvitella, että ketjuanalyysiohjelmistot syventäisivät tarkasteluaan neljän hyppyreissun jälkeen. Nämä alustat joutuvat kuitenkin pulaan havaintokynnyksen optimoinnissa. Niiden on asetettava raja sille hyppyjen määrälle, jonka jälkeen ne myöntävät, että omistajanvaihdos on todennäköisesti tapahtunut ja että linkki aiempaan tapahtumaan (kuten coinjoin) olisi jätettävä huomiotta.

Tämän kynnysarvon määrittäminen on kuitenkin riskialtista: jokainen havaitun ohitusten määrän lisäys lisää eksponentiaalisesti väärien positiivisten tulosten määrää, toisin sanoen henkilöitä, jotka on virheellisesti merkitty tapahtuman osallistujiksi, vaikka tapahtuman on suorittanut joku muu. Tämä skenaario aiheuttaa suuremman riskin näille yrityksille, sillä väärät positiiviset tulokset johtavat tyytymättömyyteen, joka voi ajaa asianomaiset asiakkaat kilpailijoihin. Pitkällä aikavälillä liian suuri havaitsemiskynnys johtaa siihen, että alusta menettää enemmän asiakkaita kuin sen kilpailijat, mikä voi uhata sen selviytymistä. Siksi näille alustoille on monimutkaista lisätä havaittujen hyppyjen määrää, ja 4 on usein riittävä määrä niiden analyysin torjumiseksi.

Tässä havaittu ilmiö vastaa jossain määrin kuuden erotusasteen teoriaa.

Kuuden eriytymisasteen teoria viittaa siihen, että kuka tahansa ihminen maapallolla on yhteydessä keneen tahansa muuhun ihmiseen tiedon ketjun kautta, johon kuuluu enintään kuusi välittäjää. Riittäisi, että kulkisi kuuden ihmisen sarjan läpi, joista jokainen tuntee seuraavan henkilökohtaisesti, jotta saavuttaisi minkä tahansa yksilön maailmassa.

Bitcoin-tapahtumissa on havaittavissa samanlainen ilmiö. Kun jäljittää riittävän määrän Bitcoin-tapahtumia, törmää väistämättä coinjoiniin. Ricochet-menetelmä hyödyntää tätä periaatetta käyttämällä enemmän hyppyjä kuin mitä vaihtoalustat voivat kohtuudella seurata. Jos alustat päättävät seurata useampia transaktioita, on mahdollista yksinkertaisesti lisätä ylimääräinen hyppy tämän toimenpiteen kiertämiseksi.

### Milloin ja miten käyttää ricochetia?

Yleisin käyttötapaus ricochetille on, kun on tarpeen piilottaa aiempi osallistuminen omistamasi UTXO:n kolikkoliitokseen. Ihannetapauksessa on parasta välttää coinjoinin läpikäyneiden bitcoinien siirtämistä säännellyille yhteisöille. Kuitenkin siinä tapauksessa, että ihminen huomaa olevansa vailla muita vaihtoehtoja, erityisesti silloin, kun on kiire realisoida bitcoinit fiat-valuutaksi, ricochet tarjoaa tehokkaan ratkaisun.

Tämä menetelmä on tehokas paitsi kolikkoliitoksiin myös muihin merkkeihin, jotka saattavat vaarantaa kolikon vaihdettavuuden.

Idea tästä ricochet-menetelmästä tuli alun perin Samourai Wallet -tiimiltä, jotka integroivat sen sovellukseensa prosessin automatisoimiseksi. Samourain palvelu on maksullinen, sillä ricochetista peritään 100 000 satsin palvelumaksu kaivosmaksujen lisäksi. Siksi sen käyttöä suositellaan pikemminkin merkittävien summien siirtoihin.

Samourai-sovellus tarjoaa kaksi variaatiota rysäyksestä:


- Kehittynyt ricochet eli "porrastettu toimitus", jonka etuna on Samourain palvelumaksujen jakautuminen viidelle peräkkäiselle tapahtumalle. Tällä vaihtoehdolla varmistetaan myös, että kukin transaktio lähetetään erillisenä ajankohtana ja kirjataan eri lohkoon, minkä ansiosta se jäljittelee mahdollisimman tarkasti omistajanvaihdoksen käyttäytymistä. Vaikka tämä menetelmä on hitaampi, se on suositeltavampi niille, joilla ei ole kiire, sillä se maksimoi ricochetin tehokkuuden vahvistamalla sen vastustuskykyä ketjuanalyysille;
- Klassinen ricochet, joka on suunniteltu suorittamaan operaatio nopeasti lähettämällä kaikki tapahtumat lyhyessä ajassa. Tämä menetelmä tarjoaa siis vähemmän yksityisyyttä ja vähemmän vastustuskykyä analyysille kuin kehittynyt menetelmä. Sitä tulisi käyttää vain kiireellisiin lähetyksiin.

Recochet koostuu yksinkertaisesti bitcoinien lähettämisestä itselleen. On täysin mahdollista suorittaa ricochet manuaalisesti millä tahansa lompakko-ohjelmistolla ilman erikoistunutta työkalua. Siirrä yksinkertaisesti sama kolikko itsellesi myöhemmin käyttämällä joka kerta uutta tyhjää osoitetta.

Seuraavassa luvussa tarkastelemme useita tekniikoita salaisia omaisuudensiirtoja varten. Nämä menetelmät eroavat radikaalisti tähän mennessä tarkastelemistamme menetelmistä sekä toimintatapansa että tulostensa osalta.

https://planb.network/tutorials/privacy/on-chain/ricochet-e0bb1afe-becd-44a6-a940-88a463756589
## Salaiset omaisuuden siirrot

<chapterId>a2067036-849c-4d6b-87d2-44235cfae7a1</chapterId>

Bitcoinin yksityisyystekniikoihin kuuluu muun muassa salainen omistusoikeuden siirto. Tällä menetelmällä pyritään siirtämään bitcoinien omistusoikeus yhdeltä henkilöltä toiselle ja päinvastoin ilman, että tämä transaktio näkyy nimenomaisesti lohkoketjussa. Tutkitaan yhdessä eri käytettävissä olevia tekniikoita sekä niiden etuja ja haittoja.

### CoinSwap

CoinSwap perustuu suhteellisen yksinkertaiseen konseptiin: se käyttää älykkäitä sopimuksia helpottaakseen bitcoinien omistuksen siirtoa kahden käyttäjän välillä ilman, että tarvitaan luottamusta ja ilman, että tämä siirto näkyy selvästi lohkoketjussa.

Kuvitellaanpa yksinkertaistettu esimerkki, jossa ovat Alice ja Bob. Alicella on 1 BTC, joka on suojattu yksityisellä avaimella $A$, ja Bobilla on myös 1 BTC, joka on suojattu yksityisellä avaimella $B$. Teoriassa he voisivat vaihtaa yksityiset avaimensa ulkoisen viestintäkanavan kautta salaisen siirron suorittamiseksi.

Tämä naiivi menetelmä on kuitenkin suuri riski luottamuksen kannalta. Mikään ei estä Alicea pitämästä kopiota $A$:n yksityisestä avaimesta vaihdon jälkeen ja käyttämästä sitä myöhemmin bitcoinien varastamiseen, kun avain on Bobin hallussa.

Mikään ei myöskään estä Alicea saamasta Bobin yksityistä avainta $B$ eikä lähettämästä vastineeksi Bobin yksityistä avainta $A$. Tämä vaihto perustuu siis osapuolten väliseen liialliseen luottamukseen ja osoittautuu tehottomaksi varmistamaan salaisen omistusoikeuden siirron turvallisella tavalla.

Näiden ongelmien ratkaisemiseksi ja sellaisten osapuolten välisen vaihdon mahdollistamiseksi, jotka eivät luota toisiinsa, voimme sen sijaan käyttää älykkäitä sopimusjärjestelmiä. Älykäs sopimus on ohjelma, joka toimii automaattisesti, kun ennalta määritellyt ehdot täyttyvät, mikä meidän tapauksessamme varmistaa, että omaisuuden vaihto tapahtuu automaattisesti ilman, että keskinäinen luottamus on tarpeen.

Tähän voidaan käyttää HTLC:tä (_Hash Time-Locked Contracts_) tai PTLC:tä (_Point Time-Locked Contracts_). Nämä kaksi protokollaa toimivat samalla tavalla käyttämällä aikalukkojärjestelmää, joka varmistaa, että vaihto on onnistuneesti suoritettu tai kokonaan peruutettu, ja suojaa näin molempien osapuolten varojen eheyttä. Suurin ero HTLC:n ja PTLC:n välillä on se, että HTLC:t käyttävät hasheja ja esikuvia transaktion suojaamiseen, kun taas PTLC:t käyttävät mukautuvia allekirjoituksia.

CoinSwap-skenaariossa, jossa käytetään HTLC:tä tai PTLC:tä Alicen ja Bobin välillä, vaihto tapahtuu turvallisella tavalla: joko se onnistuu ja kumpikin saa toisen BTC:n, tai se epäonnistuu ja kumpikin pitää oman BTC:nsä. Näin ollen kummankaan osapuolen on mahdotonta huijata tai varastaa toisen BTC:tä.

> _HTLC:t ovat myös mekanismi, jota käytetään maksujen turvalliseen reitittämiseen Lightning-verkon kaksisuuntaisten kanavien kautta._
> Mukautuvien allekirjoitusten käyttö on erityisen mielenkiintoista tässä yhteydessä, koska sen avulla voidaan ohittaa perinteiset skriptit (tätä mekanismia kutsutaan joskus "skriptittömiksi skripteiksi"). Tämä ominaisuus auttaa vähentämään vaihtoon liittyviä maksuja. Toinen Adaptive Signatures -tekniikan merkittävä etu on se, että se ei edellytä yhteisen hash-tiedonsiirron käyttöä transaktion molemmille osapuolille, jolloin vältetään suoran yhteyden paljastuminen tietyntyyppisissä vaihtotapahtumissa.
### Mukautuvat allekirjoitukset

Adaptiiviset allekirjoitukset ovat salausmenetelmä, jossa voimassa oleva allekirjoitus yhdistetään ylimääräiseen allekirjoitukseen, jota kutsutaan "adaptiiviseksi allekirjoitukseksi", salaisen tiedon paljastamiseksi. Tämä mekanismi on suunniteltu siten, että kun tunnetaan kaksi seuraavista kolmesta elementistä: voimassa oleva allekirjoitus, mukautuva allekirjoitus ja salainen tieto, voidaan päätellä kolmas puuttuva elementti. Menetelmän mielenkiintoinen ominaisuus on se, että jos tiedämme vastapuolemme mukautuvan allekirjoituksen ja sen salaisuuteen liittyvän elliptisen käyrän tietyn pisteen, jota käytettiin mukautuvan allekirjoituksen laskemiseen, voimme johtaa oman mukautuvan allekirjoituksemme, joka on yhteensopiva saman salaisuuden kanssa, ilman että meillä on koskaan suoraa pääsyä itse salaisuuteen.

Kolikkopörsseissä mukautuvien allekirjoitusten käyttö mahdollistaa kahden arkaluonteisen tiedon samanaikaisen paljastamisen osallistujien välillä, jolloin keskinäistä luottamusta ei tarvita. Havainnollistetaan tätä prosessia esimerkillä, jossa Alice ja Bob haluavat vaihtaa kumpikin 1 BTC:n omistusoikeuden, mutta eivät luota toisiinsa. He käyttävät mukautuvia allekirjoituksia, jotta luottamus ei olisi tarpeen tässä vaihdossa. He etenevät seuraavasti:


- Alice aloittaa vaihdon luomalla transaktion $m_A$, joka lähettää 1 BTC Bobille. Hän luo allekirjoituksen $s_A$, joka vahvistaa tämän tapahtuman, käyttäen yksityistä avainta $p_A$ ($P_A = p_A \cdot G$), nonce $n_A$ ($N_A = n_A \cdot G$) ja salaisuutta $t$ ($T = t \cdot G$):

$$s_A = n_A + t + H(N_A + T \paralleli P_A \paralleli m_A) \cdot p_A$$$


- Alice laskee mukautuvan allekirjoituksen $s_A'$ vähentämällä salaisuuden $t$ todellisesta allekirjoituksestaan $s_A$:

$$s_A' = s_A - t$$$


- Alice lähettää Bobille mukautuvan allekirjoituksensa $s'_A$, allekirjoittamattoman tapahtuman $m_A$, salaisuutta vastaavan pisteen ($T$) ja noncea vastaavan pisteen ($N_A$). Nämä elementit muodostavat niin sanotun "_adapterin_" On tärkeää huomata, että pelkästään näillä tiedoilla Bob ei voi hakea Alicen BTC:tä.
- Bob pystyy kuitenkin varmistamaan, ettei Alice yritä varastaa häneltä. Tätä varten hän tarkistaa, vastaako Alicen mukautuva allekirjoitus $s_A'$ todella ehdotettua transaktiota $m_A$. Jos seuraava yhtälö on oikein, hän voi olla varma, että Alicen mukautuva allekirjoitus on pätevä:

$$s_A' \cdot G = N_A + H(N_A + T \paralleeli P_A \paralleeli m_A) \cdot P_A$$$


- Tämä todentaminen antaa Bobille riittävän varmuuden, jotta hän voi jatkaa vaihtoa luottavaisin mielin. Sen jälkeen hän luo oman tapahtuman $m_B$, jonka tarkoituksena on lähettää 1 BTC Alicelle, ja luo mukautuvan allekirjoituksensa $s_B'$, joka myös liittyy samaan salaisuuteen $t$. Tässä vaiheessa vain Alice tietää $t$:n arvon; Bob tietää vain vastaavan pisteen $T$, jonka Alice välitti hänelle:

$$s_B' = n_B + H(N_B + T \paralleeli P_B \paralleeli m_B) \cdot p_B$$$


- Bob lähettää Alicelle mukautuvan allekirjoituksensa $s_B'$, allekirjoittamattoman transaktionsa $m_B$ sekä salaisuutta vastaavan pisteen ($T$) ja noncea vastaavan pisteen ($N_B$). Liisa, joka tietää salaisuuden $t$, voi nyt yhdistää Bobin mukautuvan allekirjoituksen $s_B'$ tähän salaisuuteen luodakseen pätevän allekirjoituksen $s_B$ transaktiota $m_B$ varten, jolla Bobin BTC siirretään Liisalle:

$$s_B = s_B' + t$$$

$$$(s_B' + t) \cdot G = N_B + T + H(N_B + T \paralleeli P_B \paralleeli m_B) \cdot P_B$$$


- Alice lähettää tämän allekirjoitetun tapahtuman $m_B$ Bitcoin-lohkoketjuun saadakseen Bobin lupaamat BTC:t. Kun Bob näkee tämän transaktion lohkoketjussa, hän voi poimia siitä allekirjoituksen $s_B = s_B' + t$. Tämän tiedon avulla Bob pystyy sitten eristämään tarvitsemansa kuuluisan $t$-salaisuuden:

$$t = (s_B' + t) - s_B' = s_B - s_B'$$$


- Itse asiassa tämä salaisuus $t$ oli ainoa puuttuva elementti, jonka avulla Bob pystyi luomaan kelvollisen allekirjoituksen $s_A$ Alicen sovitinallekirjoituksesta $s_A'$. Tämän allekirjoituksen avulla voidaan validoida transaktio $m_A$, joka lähettää BTC:n Alicelta Bobille. Tämän jälkeen Bob laskee $s_A$:n ja lähettää puolestaan $m_A$-tapahtuman lohkoketjuun:

$$s_A = s_A' + t$$$

$$$(s_A' + t) \cdot G = N_A + T + H(N_A + T \paralleeli P_A \paralleeli m_A) \cdot P_A$$

Kerrotaan lyhyesti, miten Signature Adapter toimii kolikkopörssissä. Aluksi Alice lähettää Bobille allekirjoittamattoman transaktion yhdessä sovittimen kanssa, jonka avulla Bob voi tarkistaa, että myöhemmin paljastettu salaisuus antaa hänelle pääsyn bitcoineihin. Vastineeksi Bob lähettää Alicelle allekirjoittamattoman tapahtuman ja sovittimen. Tämän jälkeen Alice voi viimeistellä Bobin transaktion ja saada bitcoinit takaisin lähettämällä pätevän transaktion, jossa käytetään salaisuutta. Kun tämä transaktio julkaistaan lohkoketjussa, Bobilla on mahdollisuus purkaa salaisuus ja siten avata Alicen transaktio. Näin ollen jos Alice aloittaa Bobin bitcoinien siirron, Bob voi puolestaan päästä käsiksi Alicen bitcoineihin ilman keskinäistä luottamusta.

On tärkeää huomata, että kolikkopörssejä ehdotti ensimmäisenä [Gregory Maxwell lokakuussa 2013 BitcoinTalkissa](https://bitcointalk.org/index.php?topic=321228.0).

### Atomipörssi

Kolikkovaihdon tapaan ja samantyyppisiä älykkäitä sopimuksia käyttäen on myös mahdollista tehdä atomivaihtoja. Atomivaihto mahdollistaa eri kryptovaluuttojen, kuten BTC:n ja XMR:n, suoran vaihdon kahden käyttäjän välillä ilman, että tarvitaan luottamusta tai välittäjän väliintuloa. Näitä vaihtoja kutsutaan "atomisiksi" vaihdoiksi, koska niillä on vain kaksi mahdollista lopputulosta: joko vaihto onnistuu ja molemmat osapuolet ovat tyytyväisiä tai se epäonnistuu ja kumpikin säilyttää alkuperäiset kryptovaluuttansa, jolloin luottamusta toiseen osapuoleen ei tarvita.

![BTC204](assets/fr/197.webp)

Atomipörssillä ja kolikkopörssillä on samanlainen toimintatapa, ja ne tarjoavat samat edut ja haitat yksityisyyden suojan kannalta. Itse asiassa Bitcoinin näkökulmasta atomivaihto on verrattavissa kolikkovaihtoon, joka suoritetaan kahdessa vaiheessa. Ensin vaihdamme BTC:n toiseen kryptovaluuttaan, ja sitten tämä kryptovaluutta voidaan vaihtaa toiseen BTC:hen. Lopuksi haemme toisen käyttäjän BTC:n. Tämän vuoksi ryhmittelen nämä kaksi protokollaa yksityisyyskysymyksiä analysoidessani omaisuuden salaisen vaihdon luokkaan.

![BTC204](assets/fr/198.webp)

Toisin kuin kolikkopörssissä, atomipörssissä voi kuitenkin olla epätasapainoa käytettävissä olevan likviditeetin suhteen, erityisesti BTC/XMR-pörsseissä. Yleensä bitcoinin vaihtaminen altcoiniksi on helpompaa, koska bitcoinin kysyntä on suurta, mikä pitää tämän muuntosuunnan preemiot alhaisina. Altcoinin vaihtaminen BTC:n saamiseksi voi kuitenkin olla monimutkaisempaa pienemmän kysynnän vuoksi, mikä johtaa usein hyvin korkeisiin preemioihin.

Kun atomisessa vaihdossa on mukana ketjussa olevia bitcoineja ja Lightning-verkossa olevia bitcoineja, puhumme "_sukellusvaihdosta_"

### Onko se todella hyödyllinen?

Salaiset omistusoikeuden siirrot, kuten kolikoiden ja atomien vaihdot, voivat huijata ketjuanalyysin heuristiikkaa. Näillä menetelmillä voidaan antaa vaikutelma, että transaktioissa on mukana sama käyttäjä, vaikka todellinen omistus olisi vaihtanut omistajaa. Näiden menetelmien suurin haittapuoli on kuitenkin se, että ne ovat hyvin riskialttiita ilman lisätekniikkaa kolikkohistorian häiritsemiseksi.

Kun Alice tekee kolikonvaihdon tai atomivaihdon Bobin kanssa, hän vaihtaa bitcoiniensa omistusoikeuden Bobin bitcoineihin. Atomivaihdon tapauksessa vaihtoon sisältyy altcoin, mutta periaate pysyy samana. Näin Alice saa kolikon $B$ ja Bob kolikon $A$. Tämä lisää epäilyksiä ketjuanalyysiin, mutta kolikoiden historia pysyy jäljitettävissä. Jos analyytikko tutkii kolikkoa $A$, hän voi jäljittää Alicen aiemmat toimet ja päinvastoin kolikon $B$ osalta.

Alicen näkökulmasta riski on, että tietyt tahot voivat pitää $B$-kolikon historiaa epäilyttävänä. Jos esimerkiksi Bob olisi hankkinut $B$-kolikon rikollisella teolla, kuten hakkeroinnilla, tämä kolikko jäisi kytköksissä hänen laittomaan toimintaansa. Alice saattaisi tällöin joutua omistamaan kolikon, jota hän ei voisi siirtää säännellyille kaupankäyntialustoille ilman, että hänen varansa jäädytettäisiin, tai häntä voitaisiin jopa syyttää Bobin rikoksista, vaikka hänellä ei olisi mitään tekemistä niiden kanssa.

Ja tietysti rikolliset, joiden varoja viranomaiset valvovat, suosivat yksityisyyden suojaa koskevia menetelmiä, kuten kolikonvaihtoa tai atomien vaihtoa. Nämä protokollat antavat heille mahdollisuuden luopua valvotuista bitcoineistaan ja vaihtaa ne täysin vaihdettavissa oleviin bitcoineihin. Näin he voivat myös luoda harhautusta ohjaamalla viranomaiset muiden käyttäjien luo. Näillä ihmisillä on siis kaksinkertainen hyöty.

Coinjoinin avulla kolikkosi historia katkeaa, vaikka kolikkosi sekoittuisi valvottuihin bitcoineihin, mikä tarjoaa eräänlaisen uskottavan kiistettävyyden, jota ei ole olemassa salaisissa omaisuudensiirtoprotokollissa, kuten kolikonvaihdossa tai atomivaihdossa.

Jos Alice haluaa välttää riskin, hänen on välttämättä käytettävä menetelmää, jolla hän voi häiritä $B$-kolikon historiaa, kuten esimerkiksi ajamalla sen kolikkoliitosten läpi. Tämä herättää kysymyksen salaisen omistusoikeuden siirron ja coinjoinin yhdistämisen hyödyllisyydestä. Coinjoin, joka keskeyttää kolikon historian, tarjoaa jo riittävän yksityisyyden tason Alicelle. Näin ollen katson, että jos Alice haluaa suojella yksityisyyttään, olisi järkevämpää edetä suoraan coinjoiniin kuin ryhtyä kolikonvaihtoon ja sen jälkeen coinjoiniin.

Jotta salaiset omistusoikeuden siirtomenetelmät olisivat todella tehokkaita ja välttäisivät riskin, että $A$-käyttäjän ja $B$-käyttäjän historia yhdistetään, olisi paradoksaalisesti välttämätöntä, että niiden käyttö olisi laajalti tiedossa. Jos kolikonvaihtoa käytetään laajalti ja viranomaiset ovat tietoisia tästä yleisestä käytännöstä, voitaisiin luoda uskottava kieltämisen muoto. Niin kauan kuin näiden siirtojen käyttö pysyy kuitenkin marginaalisena, uskon, että nämä menetelmät ovat edelleen liian riskialttiita käyttäjille.

Tähän mennessä olemme tutkineet yksityisyyden suojaa koskevia menetelmiä lähinnä itse tapahtumatasolla. Seuraavassa luvussa tarkastelemme verkkotason kysymyksiä ja transaktioiden leviämistä.

## Yksityisyys P2P-verkossa

<chapterId>04a2467b-db84-4076-a9ff-919be5135106</chapterId>

Osassa 4 käsittelimme täyden solmupisteen käytön tärkeyttä liiketoimien yksityisyyden suojaamiseksi. On kuitenkin tärkeää ymmärtää, että itse solmusi voi joutua hyökkäysten kohteeksi, joilla pyritään saamaan tietoja toiminnoistasi. Siksi tässä luvussa tarkastelemme erilaisia yksityisyydensuojatoimenpiteitä, ei itse transaktioiden tai bitcoin-virtojen tasolla vaan verkon tasolla.

### Voikukka

Yksi tapa välttää erilaisia deanonymisointihyökkäyksiä on käyttää ehdotettua Dandelion-järjestelmää. Tämä siirtoprotokolla virallistettiin BIP156:ssa, mutta sitä ei ole koskaan toteutettu Bitcoinissa. Dandelionin ideana on parantaa transaktioiden reitityksen yksityisyyttä Bitcoin-verkossa erilaisten hyökkäysten torjumiseksi. Sen päätavoitteena on piilottaa lähdesolmu, joka alun perin lähettää transaktion verkossa. Tämän solmun paljastuminen voisi yhdistää Bitcoin-tapahtuman tiettyyn IP-osoitteeseen (jos solmu toimii salaamattomassa verkossa), jolloin ketjuanalyysi olisi mahdollista.

Tämä Bitcoinissa tapahtuvan toiminnan ja IP-osoitteen välinen yhteys aiheuttaa merkittävän riskin käyttäjien yksityisyydelle. Lukuisat tahot voivat nimittäin helposti yhdistää IP-osoitteen henkilöllisyyteen. Näihin kuuluvat hallitukset ja Internet-palveluntarjoajat. Lisäksi nämä tiedot voivat tulla julkisesti saataville, esimerkiksi jos IP-osoite ja henkilötiedot paljastuvat tietovuodon vuoksi verkkosivuston tietokantahakkereiden yhteydessä.

Bitcoinin tavanomaisessa toiminnassa käyttäjän ohjelmistolompakkoonsa rakentamat transaktiot siirretään hänen henkilökohtaiseen solmuunsa. 

 Kun transaktio on vahvistettu, kukin vertaisryhmä puolestaan välittää sen eteenpäin vertaisryhmilleen ja niin edelleen.

Lohkossa integrointia odottavien transaktioiden jakautuminen tapahtuu melko tasapainoisesti ja tilastollisesti ennustettavalla tavalla. Tätä haavoittuvuutta voivat käyttää hyväkseen salaliittoutuneet vakoilusolmut, jotka tekevät yhteistyötä verkon valvomiseksi ja analysoimiseksi, jotta ne voivat tunnistaa ensimmäisenä transaktion lähettävän solmun. Jos tarkkailija pystyy paikallistamaan lähdesolmun, se voi olettaa, että transaktio on peräisin kyseisen solmun operaattorilta. Tämäntyyppinen havainnointi voi yhdistää tavallisesti anonyymit transaktiot tiettyihin IP-osoitteisiin.

BIP156:n tavoitteena on puuttua tähän ongelmaan. Tätä varten siinä otetaan käyttöön uuden transaktion lähetyksen lisävaihe, jotta anonymiteetti säilyy ennen laajamittaista julkista levittämistä. Dandelionissa käytetään ensin "varsi"-vaihetta, jossa transaktio lähetetään satunnaisen solmupolun kautta.

Tämän jälkeen tapahtuma lähetetään koko verkkoon "fluff"-vaiheessa (blowhole).

Varsi ja voikukka viittaavat siihen, miten transaktio etenee verkossa, joka muistuttaa voikukan muotoa.

Näin ollen vakoilusolmut voivat mahdollisesti jäljittää tapahtuman takaisin solmuun, joka aloitti puhallusvaiheen (massiivinen lähetys), mutta tämä solmu ei ole se, joka lähetti tapahtuman ensimmäisenä, koska se sai sen varren viimeiseltä solmulta. Jos vakoilusolmut eivät pysty jäljittämään varren kulkua, ne eivät myöskään pysty tunnistamaan lähdesolmua.

Vaikka vakoilusolmuja olisi läsnä varsijakson aikana, epäilyksiä jää aina, koska heti kun vakoilijat kohtaavat rehellisen solmun diffuusiograafissa, he eivät voi määrittää, onko tämä solmu alkuperäinen lähde vai pelkkä välikäsi.

Tämä reititysmenetelmä vaikeuttaa lähdesolmun jäljittämistä, mikä vaikeuttaa tapahtuman jäljittämistä verkon kautta sen alkuperään. Dandelion parantaa näin ollen yksityisyyttä rajoittamalla vastustajien mahdollisuuksia purkaa verkon nimettömyys. Menetelmä on vieläkin tehokkaampi, kun transaktio kulkee "varsi"-vaiheessa solmun kautta, joka salaa verkkoviestintänsä, kuten Tor tai P2P Transport V2.

BIP156:ta ei ole integroitu Bitcoin Coreen, ja se on tällä hetkellä luokiteltu "hylätyksi" Suurin huolenaihe tässä protokollassa on se, että varsi-vaiheessa tapahtumat on välitettävä eteenpäin välisolmuissa ennen niiden todentamista. Kuten olemme nähneet, normaalissa Bitcoin-mallissa jokainen solmu tarkistaa ensin transaktion ennen kuin se välittää sen eteenpäin vertaisilleen. Jos transaktio ei täytä solmun konsensus- tai paikallisia standardisointisääntöjä, se jätetään huomiotta eikä sitä välitetä eteenpäin. Tämä prosessi on tärkeä DoS-hyökkäysten torjumiseksi, koska vain kelvolliset transaktiot välitetään koko verkkoon. Virheelliset transaktiot, jotka mahdollisesti syntyvät joukoittain verkon ylikuormittamiseksi, pysäytetään ensimmäisessä kohdattavassa solmussa, eivätkä ne leviä eteenpäin. Dandelionin suurin riski on se, että tämä uusi protokolla voi luoda uusia vektoreita DoS-hyökkäyksille sallimalla virheellisten tapahtumien välittämisen osassa verkkoa.

### P2P-liikenne V2

P2P Transport V2 on toinen BIP324:ssä esitelty verkkoprotokolla. Se on uusi versio Bitcoinin P2P-kuljetusprotokollasta, joka sisältää opportunistista salausta solmujen välisen viestinnän luottamuksellisuuden ja turvallisuuden parantamiseksi.

Tällä parannuksella pyritään ratkaisemaan useita P2P-protokollan perusversioon liittyviä ongelmia. Ensinnäkin se tekee vaihdetuista tiedoista passiivisen tarkkailijan kannalta erottamattomia muunlaisista Internetissä liikkuvista tiedoista. Päätavoitteena on estää hallituksia, Internet-palveluntarjoajia tai VPN-palveluntarjoajia tarkkailemasta laajamittaisesti Bitcoin-käyttäjiä. Tämä vaikeuttaa myös näiden tahojen tehtävää määrittää, onko Internetin käyttäjä myös Bitcoinin käyttäjä eli käyttääkö hän täyttä solmua.

P2P V2 auttaa myös vähentämään sensuurin ja hyökkäysten riskejä havaitsemalla tietopakettien tietyt mallit. Se vaikeuttaa ja tekee erityyppisten Sybil-hyökkäysten toteuttamisen verkkotasolla kalliimmaksi. Sybil-hyökkäys tapahtuu, kun toimija luo useita vääriä henkilöllisyyksiä saadakseen perusteetonta etua. Bitcoin-verkossa tämä ilmenee usein siten, että toimija hallitsee suurta määrää kokonaisia solmuja ja käyttää niitä aggressiivisesti yhteyksien moninkertaistamiseen. Sybil-hyökkäykset voivat olla passiivisia, jolloin tavoitteena on kerätä tietoja ja vaarantaa käyttäjien luottamuksellisuus, tai aktiivisia, kuten Eclipse-hyökkäykset. Jälkimmäiset eristävät tietyn solmun muusta verkosta, jolloin se voi sensuroida käyttäjää tai muuttaa vastaanottamaansa tietoa. Lopuksi P2P V2 tekee _Man-In-The-Middle_ (MITM) -hyökkäyksistä kalliimpia ja helpommin havaittavia.

P2P V2:n toteuttamaan salaukseen ei sisälly todentamista, jotta se ei lisäisi tarpeetonta monimutkaisuutta eikä vaarantaisi verkkoyhteyden luvatonta luonnetta. Tämä uusi P2P-siirtoprotokolla tarjoaa kuitenkin paremman suojan passiivisia hyökkäyksiä vastaan ja tekee aktiivisista hyökkäyksistä huomattavasti kalliimpia ja helpommin havaittavia. Pseudosatunnaisen tietovirran sisällyttäminen verkkoviesteihin vaikeuttaa niiden hyökkääjien tehtävää, jotka haluavat sensuroida tai manipuloida viestintää.

P2P V2 -kuljetus sisällytettiin vaihtoehtona (oletusarvoisesti pois käytöstä) Bitcoin Coren versioon 26.0, joka otettiin käyttöön joulukuussa 2023. Sen jälkeen se otettiin oletusarvoisesti käyttöön versiossa 27.0 huhtikuussa 2024. Sen voi muuttaa konfiguraatiotiedoston `v2transport=`-vaihtoehdolla.

### Tor

Verrattain yksinkertainen ratkaisu välttää luottamuksellisuuden menettämisen riskit verkkotason solmun osalta on käyttää sitä kokonaan Torin alla. Tor on välityspalvelinten (solmujen) verkko, joka anonymisoi TCP-yhteyksien alkuperän Internetissä. Se toimii kapseloimalla tiedot monikerroksiseen salaukseen. Jokainen välityssolmu poistaa yhden kerroksen paljastaakseen seuraavan solmun osoitteen, kunnes lopullinen määränpää on saavutettu. Tor-verkko varmistaa anonymiteetin estämällä välityssolmuja tietämästä sekä tiedon alkuperää että määränpäätä, jolloin tarkkailijan on hyvin vaikea seurata käyttäjän toimintaa.

Tor ei siis ainoastaan salaa välitettävää dataa, vaan mahdollistaa myös viestinnän alkuperän ja määränpään salaamisen. Käyttämällä Toria henkilökohtaisten solmujen viestintään parannamme liiketoimiemme yksityisyyttä: Internet-palveluntarjoaja (ISP) ei voi purkaa viestintää, eivätkä Bitcoin-verkon muut solmut voi tunnistaa lähdesolmun IP-osoitetta. Lisäksi Tor piilottaa Bitcoinin käytön myös omalta Internet-palveluntarjoajalta.

Suurin tähän menetelmään liittyvä riski on se, että Tor on Bitcoinista riippumaton protokolla. Jos sinulla on Bitcoin-solmu Torin alla ja Tor lakkaa toimimasta, Bitcoin-solmusi ei pysty enää kommunikoimaan.

On myös tärkeää huomata, että viestintä Torissa on hitaampaa. Tämä viive on erityisen hankalaa solmun ensimmäisen käynnistyksen aikana, koska Initial Block Download (IBD) vaatii paljon viestintää. Tämän seurauksena ensimmäinen synkronointi Bitcoin-verkon kanssa voi olla huomattavasti pidempi Torin avulla. On myös mahdollista suorittaa IBD avoimessa verkossa ja aktivoida Tor myöhemmin. Vaikka tämä menetelmä paljastaa Bitcoin-solmusi olemassaolon Internet-palveluntarjoajallesi, se suojaa henkilökohtaisia transaktiotietojasi, kun siirryt Toriin.

Tutustuttuani erilaisiin verkkotason yksityisyysmenetelmiin haluan myös esitellä seuraavissa luvuissa kaksi tyylikästä ratkaisua osoitteiden uudelleenkäytön välttämiseksi: BIP47 ja Silent Payments.

## BIP47 ja uudelleenkäytettävät maksukoodit

<chapterId>ad88e076-a04b-4aec-b3b2-7b4760175504</chapterId>

Kuten näimme osassa 3, osoitteiden uudelleenkäyttö on vakava este käyttäjien yksityisyyden suojalle Bitcoin-protokollassa. Näiden riskien vähentämiseksi on erittäin suositeltavaa luoda uusi vastaanottava osoite jokaista uutta lompakkoon vastaanotettua maksua varten. Vaikka uuden osoitteen luominen on nykyään yksinkertaisempaa nykyaikaisten ohjelmistojen ja hierarkkisten determinististen lompakoiden ansiosta, tämä käytäntö voi vaikuttaa intuition vastaiselta.

Esimerkiksi perinteisessä pankkijärjestelmässä olemme tottuneet jakamaan IBAN-tilinumeromme, joka pysyy aina samana. Kun kerromme sen jollekin, hän voi lähettää meille useita maksuja ilman, että hänen tarvitsee olla kanssamme uudelleen tekemisissä. Neopankit tarjoavat myös nykyaikaisempia mahdollisuuksia, kuten yksilöllisten sähköpostiosoitteiden käyttö PayPalissa tai RevTags Revolutissa. Myös rahoitusalan ulkopuolella päivittäiset tunnisteemme, kuten postiosoite, puhelinnumero ja sähköpostiosoite, ovat ainutlaatuisia ja pysyviä. Meidän ei tarvitse uusia niitä jokaisen uuden vuorovaikutuksen yhteydessä.

Bitcoinin toiminta on kuitenkin erilaista: jokaiselle saapuvalle transaktiolle on luotava uusi vastaanottava osoite. Tämä kompromissi helppokäyttöisyyden ja yksityisyyden välillä juontaa juurensa Bitcoinin valkoisen kirjan alkulähteille. Satoshi Nakamoto varoitti tästä riskistä jo julkaisemalla ensimmäisen version paperistaan vuoden 2008 lopulla:

**"_"Lisäpalomuurina voitaisiin käyttää uutta avainparia jokaiselle tapahtumalle, jotta ne eivät olisi sidoksissa yhteiseen omistajaan._"**"

On olemassa lukuisia menetelmiä, joilla voidaan vastaanottaa useita maksuja yhdellä tunnisteella ilman, että osoitetta käytetään uudelleen. Jokaisella näistä menetelmistä on omat kompromissinsa ja haittansa. Yksi näistä menetelmistä on Justus Ranvierin kehittämä ja vuonna 2015 julkaistu ehdotus BIP47 . Ehdotuksen tavoitteena on luoda uudelleenkäytettäviä maksutunnuksia, jotka mahdollistavat useat maksutapahtumat samalle henkilölle välttäen samalla osoitteen uudelleenkäyttöä. Pohjimmiltaan BIP47 pyrkii tarjoamaan intuitiivisen maksujärjestelmän yksilöllisenä tunnisteena ja säilyttämään samalla transaktioiden yksityisyyden.

![BTC204](assets/fr/212.webp)

BIP47 ei suoraan paranna käyttäjien yksityisyyttä, sillä BIP47-maksu tarjoaa saman yksityisyyden tason kuin perinteinen Bitcoin-tapahtuma, jossa käytetään uusia osoitteita. Se tekee kuitenkin Bitcoinin käytöstä helpompaa ja intuitiivisempaa, mikä normaalisti vaarantaisi yksityisyyden. BIP47:n ansiosta tämän helppokäyttöisyyden ansiosta saavutetaan sama yksityisyyden taso kuin perinteisessä transaktiossa. Tämän vuoksi BIP47 on arvokas väline yksityisyyden säilyttämisessä.

Alun perin BIP47 oli ehdotus, joka oli tarkoitus sisällyttää Bitcoin Coreen, mutta sitä ei koskaan hyväksytty. Jotkin ohjelmistot päättivät kuitenkin toteuttaa sen itsenäisesti sovellustasolla. Niinpä Samourai Wallet -tiimit kehittivät oman BIP47-toteutuksensa nimeltä "PayNym"

### BIP47:n ja PayNymin yleinen periaate

BIP47:n tavoitteena on mahdollistaa lukuisten maksujen vastaanottaminen ilman, että osoitetta käytetään uudelleen. Se perustuu uudelleenkäytettävän maksukoodin käyttöön, jonka avulla eri lähettäjät voivat lähettää useita maksuja yhdelle toiselle käyttäjälle kuuluvalle koodille. Vastaanottajan ei siis tarvitse antaa uutta osoitetta jokaista maksutapahtumaa varten, mikä helpottaa huomattavasti maksujen vaihtoa ja säilyttää samalla vastaanottajan yksityisyyden.

![BTC204](assets/it/66/4.webp)

Käyttäjä voi sitten vapaasti jakaa maksukoodinsa joko sosiaalisissa verkostoissa tai omalla verkkosivustollaan vaarantamatta yksityisyyttään, toisin kuin perinteisen vastaanotto-osoitteen tai julkisen avaimen tapauksessa.

Jotta transaktio voidaan suorittaa, molemmilla osapuolilla on oltava Bitcoin-lompakko, jossa on BIP47-toteutus, kuten PayNym on Samourai Wallet tai Sparrow Wallet. Heidän maksukoodiensa yhteinen käyttö luo salaisen kanavan heidän välilleen. Jotta tämä kanava voidaan luoda tehokkaasti, lähettäjän on suoritettava Bitcoin-lohkoketjussa erityinen transaktio, jota kutsutaan "ilmoitustransaktioksi" (kerron tästä myöhemmin lisää).

Molempien käyttäjien maksukoodien yhdistelmä tuottaa yhteisiä salaisuuksia, jotka puolestaan mahdollistavat suuren määrän (tasan 2^32 eli noin 4 miljardia) ainutlaatuisia Bitcoin-vastaanottoosoitteita. Näin ollen BIP47:n kautta suoritettuja maksuja ei itse asiassa osoiteta itse maksukoodille, vaan pikemminkin klassisille vastaanotto-osoitteille, jotka on johdettu osallistuvien käyttäjien maksukoodeista.

Maksukoodi toimii virtuaalisena tunnisteena, joka on johdettu lompakon siemenestä. Salkun hierarkkisessa johdannaisrakenteessa maksukoodi sijoitetaan tasolle 3 eli tilitasolle.

![BTC204](assets/it/66/5.webp)

BIP47:n johdannaiskohde tunnistetaan indeksillä "47" ("0x8000002F"), joka viittaa BIP47:ään. Esimerkki uudelleenkäytettävän maksukoodin johdannaispolusta olisi seuraava:

```plaintext
m/47'/0'/0'/
```

Jotta saisit käsityksen siitä, miltä maksukoodi näyttää, tässä on omani:

```plaintext
M8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Tämä koodi voidaan myös koodata QR-koodiksi, joka helpottaa viestintää, aivan kuten klassinen vastaanottoosoite.

PayNym-robotit, joita näkee toisinaan Twitterissä, ovat Samourai Walletin luomia maksukoodin visuaalisia esityksiä. Ne luodaan hashing-toiminnon avulla, mikä antaa niille lähes ainutlaatuisuuden. Ne näkyvät pienenä merkkijonona, joka alkaa kirjaimella `+`:

```plaintext
+throbbingpond8B1
+twilightresonance487
+billowingfire340
```

Nämä avatarit voidaan esittää myös kuvina:

![BTC204](assets/fr/215.webp)

Vaikka näillä roboteilla ei ole erityistä teknistä toimintoa BIP47-kehyksessä, ne helpottavat käyttäjien välistä vuorovaikutusta tarjoamalla helposti tunnistettavan visuaalisen identiteetin.

---
*Tämän luvun seuraavissa BIP47:ää käsittelevissä osissa tarkastellaan yksityiskohtaisesti sen toimintaa ja keskitytään erityisesti käytettyihin salausmenetelmiin. Näiden melko teknisten selitysten ymmärtämiseksi on ensin ymmärrettävä HD-lompakoiden rakenne, avainten johdatusprosessit ja elliptisiin käyriin perustuvan kryptografian perusperiaatteet. Jos haluat oppia lisää näistä käsitteistä, toinen ilmainen kurssi on saatavilla Plan ₿ Networkista:*

https://planb.network/courses/46b0ced2-9028-4a61-8fbc-3b005ee8d70f
*Suosittelen lämpimästi sen seuraamista, sillä BIP47:n teknisen toiminnan ymmärtäminen auttaa sinua ymmärtämään paljon helpommin muita vastaavia ehdotuksia, joita käsittelemme tulevissa luvuissa.*

---
### Uudelleenkäytettävä maksukoodi

Kuten aiemmin mainittiin, uudelleenkäytettävä maksukoodi sijaitsee HD-lompakon tasolla 3, joten se on verrattavissa `xpubiin` sekä sijainniltaan lompakon rakenteessa että roolinsa puolesta.

80 tavun maksukoodi jakautuu seuraavasti:


- Tavu `0`: Versio**. BIP47:n ensimmäisen version osalta tämä tavu on `0x01`;
- Tavu `1`: Bittikenttä**. Tämä tila on varattu lisämerkintöjen sisällyttämiseksi erityiskäyttöön. PayNymin vakiokäytössä tämä tavu on määritelty muodossa "0x00";
- Tavu "2": Pariteetti `y`**. Tämä tavu on `0x02` tai `0x03`, mikä osoittaa, onko julkisen avaimen ordinaatti parillinen vai pariton, koska käytetään pakattua julkista avainta;
- Tavusta "3" tavuun "34": Arvo `x`**. Nämä tavut edustavat julkisen avaimen abessiivia. `x`:n ja `y`:n pariteetin ketjutus muodostaa täydellisen pakatun julkisen avaimen;
- Tavusta "35" tavuun "66": Ketjukoodi**. Tämä tila sisältää julkiseen avaimeen liittyvän ketjukoodin;
- Tavusta "67" tavuun "79": Täyttö**. Tämä tila on tarkoitettu mahdollista tulevaa kehitystä varten. Nykyisessä versiossa nollat on yksinkertaisesti sijoitettu tänne, jotta saavutetaan 80 tavun koko, joka vaaditaan `OP_RETURN`-ulostuloa varten.

Tässä on edellisessä jaksossa jo esitellyn uudelleenkäytettävän maksukoodini heksadesimaalinen esitys:

```plaintext
0x010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

![BTC204](assets/it/66/7.webp)

Aluksi on lisättävä etuliitteen alkuun tavu "P", jotta voidaan selvästi osoittaa, että kyseessä on maksukoodi. Tämä tavu esitetään muodossa "0x47":

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

Lopuksi maksukoodin eheyden varmistamiseksi suoritetaan tarkistussumman laskenta käyttämällä `HASH256`-toimintoa, joka koostuu kaksinkertaisesta hash-toiminnosta `SHA256`-funktiolla. Tämän jälkeen hashin tuloksena saadut neljä ensimmäistä tavua liitetään maksukoodin loppuun:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000567080c4
```

Kun nämä vaiheet on suoritettu, maksukoodi on valmis. Ainoa jäljellä oleva vaihe on muuntaa se 58-alkuiseksi, jotta saat sen lopullisen version:

```plaintext
PM8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Tässä maksukoodin luomisprosessissa käytämme pakattua julkista avainta ja ketjukoodia. Molemmat johdetaan deterministisesti ja hierarkkisesti lompakon siemenestä. Tähän käytetty derivointipolku on seuraava:

```plaintext
m/47'/0'/0'/
```

Uudelleenkäytettävän maksukoodin pakatun julkisen avaimen ja siihen liittyvän ketjukoodin luominen aloitetaan laskemalla yksityinen pääavain lompakon siemenestä. Sen jälkeen johdetaan tytäravainpari käyttäen indeksiä `47 + 2^31` (vahvistettu johdanto). Tätä vaihetta seuraa vielä kaksi peräkkäistä tytäravainparin johdatusta, joissa kussakin käytetään indeksiä `2^31` (vahvistettu johdatus).

### Elliptisen käyrän Diffie-Hellman-avainten vaihto (ECDH)

BIP47:n ytimessä olevaan salausprotokollaan viitataan lyhenteellä ECDH, joka tarkoittaa _Elliptic-Curve Diffie-Hellman_. Menetelmä on muunnelma alkuperäisestä Diffie-Hellman-avaintenvaihdosta.

Diffie-Hellman on vuonna 1976 käyttöön otettu avainsopimusprotokolla, jonka avulla kaksi osapuolta, joilla kummallakin on oma avainparinsa (julkinen ja yksityinen), voivat sopia yhteisestä salaisuudesta, vaikka he kommunikoivat yksinomaan julkisen, turvattoman kanavan kautta.

![BTC204](assets/it/66/10.webp)

Tätä jaettua salaisuutta (tässä tapauksessa sinistä avainta) voidaan sitten käyttää muihin operaatioihin. Tyypillisesti tätä jaettua salaisuutta voidaan käyttää viestinnän salaamiseen ja purkamiseen turvattomassa verkossa:

![BTC204](assets/fr/220.webp)

Diffie-Hellman käyttää modulaarista aritmetiikkaa jaetun salaisuuden laskemiseen. Tässä on yksinkertaistettu selitys siitä, miten se toimii:


- Alice ja Bob sopivat yhteisestä väristä, tässä tapauksessa keltaisesta, joka on julkista tietoa (hyökkääjät tietävät tämän värin);
- Alice valitsee salaisen värin, tässä tapauksessa punaisen, ja sekoittaa nämä kaksi keskenään saadakseen oranssin värin;
- Bob valitsee myös salaisen värin, tässä tapauksessa sinisen, ja sekoittaa sen keltaisen kanssa saadakseen vihreän;
- Sitten he vaihtavat saadut värit, oranssin ja vihreän. Tämä vaihto voi tapahtua epävarmassa, tarkkaillussa verkossa;
- Sekoittamalla Bobin vihreää ja hänen salaista väriään Alice saa aikaan ruskean värin;
- Bob, joka tekee saman Alicen oranssilla ja salaisella sinisellä, saa myös ruskean.

![BTC204](assets/it/66/12.webp)

Tässä yksinkertaistuksessa ruskea väri edustaa Alicen ja Bobin jakamaa salaisuutta. On tärkeää ymmärtää, että todellisuudessa hyökkääjän on mahdotonta erottaa oranssi ja vihreä väri toisistaan ja saada selville Alicen tai Bobin salaiset värit.

Tutkitaan nyt, miten tämä protokolla oikeasti toimii, ei värien analogioiden avulla, vaan käyttämällä reaalilukuja ja modulaarista aritmetiikkaa!

Ennen kuin käsittelemme Diffie-Hellman-mekanismeja, haluan muistuttaa lyhyesti kahdesta keskeisestä matemaattisesta käsitteestä, joita tarvitsemme:


- **Primiluku** on luonnollinen luku, jolla on vain kaksi jakajaa: $1$ ja itsensä. Esimerkiksi $7$ on alkuluku, koska se voidaan jakaa vain $1$:lla ja $7$:lla. Toisaalta $8$ ei ole alkuluku, koska se on jaollinen luvuilla $1$, $2$, $4$ ja $8$. Sillä on siis neljän positiivisen kokonaisluvun jakaja kahden sijasta;
- **mod** (merkitään $mod$ tai $\%$) on matemaattinen operaatio, joka palauttaa kahden kokonaisluvun välille jäännöksen, joka on saatu jakamalla ensimmäinen kokonaisluku jälkimmäisellä kokonaisluvulla euklidisesti. Esimerkiksi $16 \bmod 5 = 1$.

**Diffie-Hellman-avainten vaihto Alicen ja Bobin välillä tapahtuu seuraavasti:**


- Alice ja Bob sopivat kahdesta yhteisestä luvusta: $p$ ja $g$. $p$ on alkuluku, ja mitä suurempi tämä luku on, sitä varmempi Diffie-Hellman on. $g$ on $p$:n alkujuuri. Nämä kaksi lukua voidaan välittää avoimesti suojaamattomassa verkossa. Ne vastaavat **keltaista väriä** edellä esitetyssä yksinkertaistuksessa. Siksi on tärkeää, että Alice ja Bob käyttävät täsmälleen samoja arvoja $p$:lle ja $g$:lle.

Kun nämä parametrit on määritelty, Alice ja Bob valitsevat kumpikin satunnaisen salaisen numeron. Alice kutsuu satunnaista salaista lukua $a$ (vastaa **punaista väriä**) ja Bob kutsuu $b$ (vastaa **sinistä väriä**). Nämä luvut on pidettävä ehdottoman luottamuksellisina.

Sen sijaan, että vaihdettaisiin suoraan luvut $a$ ja $b$, kumpikin osapuoli laskee $A$ ja $B$ seuraavasti:

$A$ on yhtä suuri kuin $g$ korotettuna $a$:n potenssiin modulo $p$:

$$
A = g^a \bmod p
$$

$B$ on yhtä suuri kuin $g$ korotettuna $b$:n potenssiin modulo $p$:

$$
B = g^b \bmod p
$$

Osapuolet vaihtavat arvot $A$ (vastaa **oranssia väriä**) ja $B$ (vastaa **vihreää väriä**). Tämä vaihto voi tapahtua avoimesti suojaamattoman verkon kautta;

Kun Alice on saanut $B$, hän laskee $z$:n arvon seuraavasti:

$z$ on yhtä suuri kuin $B$ korotettuna $a$:n potenssiin modulo $p$:

$$
z = B^a \bmod p
$$

Muistuta:

$$
B = g^b \bmod p
$$

Näin ollen saadaan:

$$
z = B^a \bmod p
$$

$$
z = (g^b)^a \bmod p
$$

Eksponenttisääntöjen soveltaminen:

$$
(x^n)^m = x^{nm}
$$

Näin saadaan:

$$
z = g^{ba} \bmod p
$$


- Bob, joka on saanut $A$, laskee myös $z$:n arvon seuraavalla tavalla:

$z$ on yhtä suuri kuin $A$ korotettuna $b$:n potenssiin modulo $p$:

$$
z = A^b \bmod p
$$

Näin ollen saadaan:

$$
z = (g^a)^b \bmod p
$$

$$
z = g^{ab} \bmod p
$$

$$
z = g^{ba} \bmod p
$$

Modulo-operaattorin distributiivisuuden vuoksi Alice ja Bob saavat täsmälleen saman $z$-arvon. Tämä luku edustaa heidän yhteistä salaisuuttaan, joka vastaa **ruskeaa väriä** edellisessä yksinkertaistuksessa, jossa käytettiin maalipurkkeja. He voivat nyt käyttää tätä yhteistä salaisuutta symmetrisesti salatakseen viestinsä suojaamattomassa verkossa.

Hyökkääjä, vaikka hänellä olisi hallussaan $p$, $g$, $A$ ja $B$ (julkiset arvot), ei pysty laskemaan $a$, $b$ tai $z$ (yksityiset arvot). Se edellyttäisi eksponentiaalin kääntämistä, mikä on mahdoton tehtävä kokeilematta kaikkia mahdollisuuksia yksi kerrallaan, koska se vastaa diskreetin logaritmin eli eksponentiaalin käänteisluvun laskemista äärellisessä syklisessä ryhmässä.

Niin kauan kuin $a$, $b$ ja $p$ ovat riittävän suuria, Diffie-Hellman-protokolla on turvallinen. Kun parametrit ovat 2048-bittiset (600-numeroinen luku desimaalilukuna), kaikkien $a$- ja $b$-vaihtoehtojen testaaminen ei yleensä ole käytännöllistä. Toistaiseksi tätä algoritmia pidetään tällaisilla luvuilla turvallisena.

Juuri tässä on Diffie-Hellman-protokollan suurin haittapuoli. Jotta algoritmi olisi turvallinen, sen on käytettävä suuria lukuja. Siksi nykyään suositaan ECDH-algoritmia (_Elliptic Curve Diffie-Hellman_), joka on Diffie-Hellmanin muunnos, joka perustuu algebralliseen käyrään, tarkemmin sanottuna elliptiseen käyrään. Tämän lähestymistavan ansiosta voidaan työskennellä paljon pienemmillä luvuilla säilyttäen sama tietoturva, mikä vähentää laskentaan ja tallennukseen tarvittavia resursseja.

Algoritmin yleinen periaate pysyy samana. Sen sijaan, että käytämme satunnaislukua $a$ ja lukua $A$, joka lasketaan $a$:sta modulaarisella eksponentioinnilla, käytämme elliptiselle käyrälle muodostettua avainparia. Sen sijaan, että luottaisimme modulo-operaattorin distributiivisuuteen, käytämme elliptisten käyrien ryhmälakia ja tarkemmin sanottuna tämän lain assosiatiivisuutta.

Lyhyesti selitän elliptisen käyrän salauksen periaatteen: yksityistä avainta edustaa satunnaisluku, joka on välillä $1$ ja $n-1$, jossa $n$ edustaa käyrän järjestystä. Julkinen avain puolestaan on tämän käyrän tietty piste, joka saadaan yksityisestä avaimesta laskemalla yhteen ja kaksinkertaistamalla pisteitä, jotka alkavat generoivasta pisteestä, yhtälön mukaisesti:

$$
K = k \cdot G
$$

Tässä kaavassa $K$ tarkoittaa julkista avainta, $k$ yksityistä avainta ja $G$ generointipistettä.

Yksi näiden avainten keskeisistä ominaisuuksista on se, että $K$ on helppo laskea $k$:sta ja $G$:sta, kun taas $k$:n löytäminen $K$:sta ja $G$:sta on käytännössä mahdotonta. Tämä epäsymmetria luo yksisuuntaisen funktion. Toisin sanoen julkinen avain on helppo laskea, jos tietää yksityisen avaimen, mutta yksityisen avaimen löytäminen julkisesta avaimesta on mahdotonta. Tämä turvallisuus perustuu edelleen diskreetin logaritmin laskennalliseen vaikeuteen.

Käytämme tätä ominaisuutta Diffie-Hellmanin algoritmin mukauttamiseen. **ECDH:n toimintaperiaate on seuraava:**


- Alice ja Bob sopivat yhdessä kryptografisesti turvallisesta elliptisestä käyrästä ja sen parametreista. Nämä tiedot ovat julkisia;
- Alice luo satunnaisluvun $ka$, joka on hänen yksityinen avaimensa. Tämän yksityisen avaimen on pysyttävä salassa. Hän määrittää julkisen avaimensa $Ka$ lisäämällä ja kaksinkertaistamalla valitun elliptisen käyrän pisteitä:

$$
K_a = k_a \cdot G
$$


- Bob luo myös satunnaisluvun $kb$, joka on hänen yksityinen avaimensa. Hän laskee siihen liittyvän julkisen avaimen $kb$:

$$
K_b = k_b \cdot G
$$


- Alice ja Bob vaihtavat julkiset avaimensa $Ka$ ja $Kb$ suojaamattomassa julkisessa verkossa.
- Alice laskee käyrän pisteen $(x,y)$ soveltamalla yksityistä avainta $ka$ Bobin julkiseen avaimeen $Kb$:

$$
(x,y) = k_a \cdot K_b
$$


- Bob laskee käyrän pisteen $(x,y)$ soveltamalla yksityistä avainta $kb$ Alicen julkiseen avaimeen $Ka$:

$$
(x,y) = k_b \cdot K_a
$$


- Alice ja Bob saavat saman pisteen elliptisellä käyrällä. Jaettu salaisuus on tämän pisteen $x$-koordinaatti.

Itse asiassa ne saavat saman jaetun salaisuuden, koska:

(x,y) = k_a \cdot K_b = k_a \cdot (k_b \cdot G) = (k_a \cdot k_b) \cdot G = (k_b \cdot k_a) \cdot G = k_b \cdot (k_a \cdot G) = k_b \cdot K_a

$$
Un attaccante che osserva la rete pubblica non protetta può ottenere solo le chiavi pubbliche di ciascuna parte e i parametri della curva ellittica scelta. Come precedentemente spiegato, queste informazioni da sole non sono sufficienti per determinare le chiavi private. Pertanto, l'attaccante non può trovare il segreto condiviso tra Alice e Bob.
ECDH è quindi un algoritmo che consente lo scambio di chiavi. È spesso utilizzato in combinazione con altri metodi crittografici per stabilire un protocollo completo. Ad esempio, ECDH è integrato nel nucleo di TLS (_Transport Layer Security_), un protocollo di crittografia e autenticazione utilizzato per il livello di trasporto di Internet. TLS utilizza ECDHE per lo scambio di chiavi, una variante di ECDH dove le chiavi sono effimere, per garantire la confidenzialità persistente. Inoltre, TLS utilizza algoritmi di autenticazione come ECDSA, algoritmi di crittografia come AES e funzioni hash come SHA256.
TLS è notevolmente responsabile della `s` in `https` così come del lucchetto visibile nella barra degli indirizzi del tuo browser, simboli delle comunicazioni criptate. Seguendo questo corso, stai quindi utilizzando ECDH, ed è molto probabile che lo usi quotidianamente senza nemmeno saperlo.
### La Transazione di Notifica
Come abbiamo visto nella sezione precedente, ECDH è una variante dello scambio Diffie-Hellman che utilizza coppie di chiavi stabilite su una curva ellittica. Convenientemente, possediamo già molte coppie di chiavi aderenti a questo standard nei nostri portafogli Bitcoin! L'idea di BIP47 è di utilizzare le coppie di chiavi dei portafogli Bitcoin gerarchici deterministici di entrambe le parti per stabilire segreti condivisi ed effimeri tra di loro. Nel contesto di BIP47, viene utilizzato ECDHE (_Elliptic Curve Diffie-Hellman Ephemeral_).
ECDHE viene utilizzato per la prima volta in BIP47 per trasmettere il codice di pagamento dal mittente al destinatario. Questo è il famoso **notification transaction**. Questo passaggio è essenziale perché affinché BIP47 funzioni efficacemente, entrambe le parti coinvolte (il mittente e il destinatario) devono conoscere il codice di pagamento dell'altro. Questa conoscenza consente la derivazione di chiavi pubbliche effimere e, di conseguenza, indirizzi di ricezione vuoti associati.
Prima di questo scambio, il mittente è logicamente già a conoscenza del codice di pagamento del destinatario poiché lo ha recuperato off-chain, ad esempio, dal loro sito web, una fattura o i loro social media. Tuttavia, il destinatario potrebbe non conoscere necessariamente il codice di pagamento del mittente. Eppure, questo codice deve essere trasmesso a loro; altrimenti, non saranno in grado di derivare le chiavi effimere necessarie per identificare gli indirizzi dove sono conservati i loro bitcoin, né accedere ai loro fondi. Sebbene questa trasmissione del codice del mittente possa tecnicamente essere effettuata off-chain attraverso altri mezzi di comunicazione, ciò pone un problema se il portafoglio deve essere recuperato solo dal seme.
Infatti, a differenza degli indirizzi convenzionali, gli indirizzi BIP47 non sono derivati direttamente dal seed del destinatario—utilizzare un `xpub` sarebbe più semplice in questo caso—ma risultano da un calcolo che combina i codici di pagamento di entrambi: quello del mittente e quello del destinatario. Pertanto, se il destinatario perde il proprio portafoglio e tenta di ripristinarlo dal proprio seed, recupererà il proprio codice di pagamento, che è derivato direttamente dal loro seed. Tuttavia, per trovare gli indirizzi effimeri, sarà essenziale per loro avere anche i codici di pagamento di tutti coloro che hanno inviato loro bitcoin tramite BIP47. Da qui l'importanza della transazione di notifica, che consente di salvare queste informazioni sulla blockchain di Bitcoin, pur essendo in grado di trovarle molto facilmente senza dover cercare tra il miliardo di transazioni eseguite dal suo lancio nel 2009.
![BTC204](assets/it/66/15.webp)
Pertanto, sarebbe possibile implementare BIP47 senza ricorrere alla transazione di notifica, a condizione che ogni utente conservi un backup dei codici di pagamento dei propri pari. Tuttavia, questo metodo si rivela complesso da gestire finché non viene sviluppata una soluzione semplice, robusta ed efficiente per creare, conservare e aggiornare questi backup. Nello stato attuale delle cose, la transazione di notifica diventa quasi indispensabile.
Nei capitoli seguenti, studieremo altri protocolli con obiettivi simili a quelli di BIP47, ma che non richiedono una transazione di notifica. Queste alternative, tuttavia, introducono i propri compromessi.
Oltre al suo ruolo nel backup dei codici di pagamento, la transazione di notifica serve anche una funzione di notifica per il destinatario, come suggerisce il suo nome. Segnala al client del destinatario che è stato stabilito un nuovo canale di pagamento e suggerisce quindi di monitorare gli indirizzi effimeri risultanti.
### Il Modello di Privacy di BIP47
Prima di dettagliare il funzionamento tecnico della transazione di notifica, è importante discutere il modello di privacy associato a BIP47, che giustifica alcune misure prese durante la creazione di questa transazione iniziale.
Il codice di pagamento, di per sé, non rappresenta un rischio diretto per la privacy. A differenza del modello Bitcoin tradizionale, che mira a rompere il collegamento tra l'identità di un utente e le sue transazioni (che sono pubbliche) preservando l'anonimato di chiavi e indirizzi, il codice di pagamento può essere apertamente associato a un'identità senza rappresentare una minaccia.
Infatti, il codice di pagamento non è utilizzato per derivare direttamente gli indirizzi che ricevono pagamenti BIP47. Questi indirizzi sono invece generati attraverso l'applicazione di ECDH tra le chiavi derivate dai codici di pagamento delle due parti coinvolte.
Così, un codice di pagamento di per sé non porta direttamente a una perdita di privacy, poiché solo l'indirizzo di notifica è derivato da esso. Sebbene questo indirizzo possa rivelare alcune informazioni, normalmente non consente di scoprire le parti con cui si stanno conducendo transazioni, a meno che non si effettui un'analisi approfondita della catena. Infatti, se il mittente utilizza UTXO che possono essere collegati alla loro identità per eseguire la transazione di notifica, allora diventa possibile dedurre che la loro identità è probabilmente collegata ai pagamenti BIP47 al tuo codice di pagamento. Questo non rivelerà le transazioni sottostanti, ma indicherà la loro probabile esistenza.
Pertanto, è essenziale mantenere questa stretta separazione tra i codici di pagamento degli utenti. Verso questo obiettivo, il passo iniziale di comunicazione del codice è un momento critico per la privacy del pagamento, ma obbligatorio per il corretto funzionamento del protocollo. Se uno dei codici di pagamento può essere ottenuto pubblicamente (come su un sito web), il secondo codice, quello del mittente, non deve essere collegato al primo in nessun caso.
Prendiamo un esempio concreto: voglio fare una donazione a un movimento politico tramite BIP47:
- L'organizzazione ha reso pubblico il suo codice di pagamento sul suo sito web o tramite i suoi social network;
- Questo codice è quindi collegato al movimento politico;
- Recupero questo codice di pagamento;
- Prima di procedere con un invio, devo assicurarmi che conoscano il mio codice di pagamento, che è anche collegato alla mia identità poiché lo uso per ricevere transazioni sui miei social network.
Come trasmettere il mio codice senza rischi? L'uso di mezzi di comunicazione convenzionali potrebbe portare a una fuga di informazioni e, di conseguenza, associarmi a questo movimento politico. La transazione di notifica offre una soluzione grazie a uno strato di crittografia che impedisce precisamente questa associazione tra due codici. Sebbene questo non sia l'unico metodo per trasmettere segretamente il codice di pagamento del mittente, si dimostra molto efficace.
Nel diagramma sottostante, le linee arancioni indicano i punti in cui il flusso di informazioni deve essere interrotto, e le frecce nere mostrano le connessioni che potrebbero potenzialmente essere osservate da terze parti:
![BTC204](assets/it/66/16.webp)
In realtà, all'interno del modello tradizionale di privacy di Bitcoin, è spesso complesso dissociare completamente il flusso di informazioni tra la coppia di chiavi e l'utente, specialmente durante le transazioni a distanza. Ad esempio, nel contesto di una campagna di donazione, il destinatario deve inevitabilmente divulgare un indirizzo o una chiave pubblica tramite il loro sito web o social network. L'uso corretto di BIP47, in particolare con la transazione di notifica, permette di aggirare questo problema grazie a ECDHE e allo strato di crittografia che studieremo ulteriormente.
Ovviamente, il modello classico di privacy di Bitcoin si applica ancora alle chiavi pubbliche effimere, che sono derivate dalla combinazione dei due codici di pagamento. I due modelli sono in realtà complementari. Quello che voglio evidenziare qui è che, contrariamente all'uso abituale di una chiave pubblica per ricevere bitcoin, il codice di pagamento può essere collegato a una specifica identità, perché l'informazione "_Alice effettua una transazione con Bob_" viene interrotta in un'altra fase. Il codice di pagamento viene utilizzato per generare indirizzi di pagamento, ma basandosi unicamente sull'osservazione della blockchain, è impossibile collegare una transazione di pagamento BIP47 ai codici di pagamento utilizzati per eseguirla, a meno che gli UTXO coinvolti non fossero già collegati a un'identità precedentemente e gli utenti non abbiano associato i loro codici di pagamento alle rispettive identità.
Per riassumere, il modello di privacy offerto dai pagamenti BIP47 potrebbe essere considerato superiore a quello della base di Bitcoin, anche se non è magico in alcun modo.
### Costruzione della Transazione di Notifica
Ora, vediamo come funziona questa transazione di notifica. Immaginiamo che Alice voglia inviare fondi a Bob con BIP47. Nel mio esempio, Alice agisce come mittente e Bob come destinatario. Quest'ultimo ha pubblicato il suo codice di pagamento sul suo sito web. Pertanto, Alice è già a conoscenza del codice di pagamento di Bob.
**1- Alice calcola un segreto condiviso con ECDH:**
- Seleziona una coppia di chiavi dal suo portafoglio HD situato su un ramo diverso dal suo codice di pagamento. Nota, questa coppia non dovrebbe essere facilmente associata all'indirizzo di notifica di Alice, né all'identità di Alice (vedi sezione precedente);
- Alice seleziona la chiave privata da questa coppia. La chiamiamo $a$ (minuscolo);
$$

a

$$
```text
- Alice recupera la chiave pubblica associata all'indirizzo di notifica di Bob. Questa chiave è la prima figlia derivata dal codice di pagamento di Bob (indice $/0$). Chiamiamo questa chiave pubblica $B$ (maiuscolo). La chiave privata associata a questa chiave pubblica è chiamata $b$ (minuscolo). $B$ è determinata dall'addizione e dal raddoppio dei punti sulla curva ellittica da $G$ (il punto generatore) con $b$ (la chiave privata):
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ (maiuscolo) sulla curva ellittica tramite l'addizione e il raddoppio dei punti applicando la sua chiave privata $a$ dalla chiave pubblica di Bob $B$.
$$ S = a \cdot B $$
- Alice calcola il fattore di oscuramento $f$ che le permetterà di criptare il suo codice di pagamento. Per fare ciò, determinerà un numero pseudo-casuale con la funzione HMAC-SHA512. Nel secondo input di questa funzione, utilizza un valore che solo Bob potrà recuperare: $x$ che è l'ascissa del punto segreto precedentemente calcolato. Il primo input è $o$ che è l'UTXO consumato in input di questa transazione (outpoint).
$$ f = \text{HMAC-SHA512}(o, x) $$
**2- Alice converte il suo codice di pagamento personale in base 2 (binario).**
**3- Utilizza questo fattore di oscuramento come chiave per eseguire la crittografia simmetrica sul payload del suo codice di pagamento.** L'algoritmo di crittografia utilizzato è semplicemente un `XOR`. L'operazione eseguita è paragonabile alla cifratura di Vernam, anche denominata "One-Time Pad".
- Alice prima divide il suo fattore di oscuramento in due: i primi 32 byte sono denominati $f1$ e gli ultimi 32 byte sono denominati $f2$. Quindi, abbiamo:
$$ f = f1 || f2 $$
- Alice calcola l'$x'$ criptato dell'ascissa della chiave pubblica $x$ del suo codice di pagamento, e il $c'$ criptato del suo codice catena $c$ separatamente. $f1$ e $f2$ agiscono rispettivamente come chiavi di crittografia. L'operazione utilizzata è il `XOR` (o esclusivo).
$$ x' = x \oplus f1 $$
$$ c' = c \oplus f2 $$
- Alice sostituisce i valori reali dell'ascissa della chiave pubblica $x$ e del codice catena $c$ nel suo codice di pagamento con i valori criptati $x'$ e $c'$.
**4-** Alice ora ha il suo codice di pagamento con un payload criptato. Costruirà e trasmetterà una transazione che coinvolge la sua chiave pubblica $A$ come input, un output all'indirizzo di notifica di Bob, e un output `OP_RETURN` contenente il suo codice di pagamento con il payload criptato. **Questa transazione è la transazione di notifica**.
Un `OP_RETURN` è un opcode che segna un output di una transazione Bitcoin come non valido. Oggi, è utilizzato per trasmettere o ancorare informazioni sulla blockchain di Bitcoin. Fino a 80 byte di dati possono essere memorizzati, che sono scritti sulla catena e quindi visibili a tutti gli altri utenti.
Come abbiamo visto nelle sezioni precedenti, ECDH è utilizzato per generare un segreto condiviso tra due utenti che comunicano su una rete non sicura, potenzialmente osservata da attaccanti. In BIP47, ECDH è utilizzato per la comunicazione sulla rete Bitcoin, che per sua natura è una rete di comunicazione trasparente osservata da molti attaccanti. Il segreto condiviso calcolato tramite lo scambio di chiavi ECDH è poi utilizzato per criptare le informazioni segrete da trasmettere: il codice di pagamento del mittente (di Alice).
Ricapitoliamo i passaggi che abbiamo appena esaminato insieme per eseguire una transazione di notifica:
- Alice recupera il codice di pagamento e l'indirizzo di notifica di Bob;
- Alice seleziona un UTXO che possiede nel suo portafoglio HD con la corrispondente coppia di chiavi;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH;
- Utilizza questo punto segreto per calcolare un HMAC, che è il fattore di oscuramento;
- Utilizza questo fattore di oscuramento per criptare il payload del suo codice di pagamento personale.
- Lei utilizza un output di transazione `OP_RETURN` per comunicare il codice di pagamento mascherato a Bob.
![BTC204](assets/it/66/17.webp)
### Transazione di Notifica: Studio Concreto
Per comprendere meglio il suo funzionamento, in particolare l'uso di `OP_RETURN`, esaminiamo insieme una vera transazione di notifica. Ho eseguito tale transazione sulla testnet, che potete trovare [cliccando qui](https://mempool.space/fr/testnet/tx/0e2e4695a3c49272ef631426a9fd2dae6ec3a469e3a39a3db51aa476cd09de2e).
![BTC204](assets/fr/227.webp)
Osservando questa transazione, possiamo vedere che ha un singolo input e 4 output:
- Il primo output è l'`OP_RETURN` che contiene il mio codice di pagamento mascherato;
- Il secondo output di 546 sats punta all'indirizzo di notifica del mio destinatario;
- Il terzo output di 15.000 sats rappresenta le commissioni di servizio, poiché ho utilizzato Samourai Wallet per costruire questa transazione;
- Il quarto output di 2 milioni di sats rappresenta il resto, ovvero la differenza rimanente dal mio input che ritorna a un altro indirizzo che mi appartiene.
Il più interessante da studiare è ovviamente l'output 0 che utilizza l'`OP_RETURN`. Vediamo più da vicino cosa contiene. Ecco lo `scriptPubKey` in esadecimale:
6a4c50010002b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d800000000000000000000000000
```

```text
In questo script, possiamo sezionare diverse parti. Prima di tutto, gli opcode:
6a4c
```

```text
Tra gli opcode, possiamo riconoscere `0x6a` che designa l'`OP_RETURN` e `0x4c` che designa l'`OP_PUSHDATA1`.
Il byte seguente questo ultimo opcode indica la dimensione del payload che segue. Indica `0x50`, ovvero 80 byte:
6a4c50
```

```text
Poi, abbiamo i metadati del mio codice di pagamento in chiaro:
010002
```

```text
La coordinata x criptata della chiave pubblica del mio codice di pagamento:
b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164
```

```text
Il codice catena criptato del mio codice di pagamento:
927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d8
```

```text
E infine, il padding per raggiungere 80 byte, la dimensione standard di un `OP_RETURN`:
00000000000000000000000000
```

```
Per capire meglio, ecco il mio codice di pagamento in chiaro in base 58:
````text
PM8TJQCyt6ovbozreUCBrfKqmSVmTzJ5vjqse58LnBzKFFZTwny3KfCDdwTqAEYVasn11tTMPc2FJsFygFd3YzsHvwNXLEQNADgxeGnMK8Ugmin62TZU
Quando si confronta il mio codice di pagamento in chiaro con l'`OP_RETURN`, è evidente che l'HRP (`0x47`) e il checksum (`0x8604e4db`) non vengono trasmessi. Questo è previsto, poiché queste informazioni sono destinate agli esseri umani.
Successivamente, possiamo identificare la versione (`0x01`), il campo di bit (`0x00`) e la parità della chiave pubblica (`0x02`). E, alla fine del codice di pagamento, i byte vuoti (`0x00000000000000000000000000`) sono utilizzati per riempire il codice fino a un totale di 80 byte. Tutti questi metadati vengono trasmessi in chiaro (non criptati).
Infine, si può osservare che la coordinata x della chiave pubblica (`0x77507c9c17a89cfca2d3af554745d6c2db0e7f6b2721a3941a504933103cc42a`) e il codice catena (`0xdd94881210d6e752a9abc8a9fa0070e85184993c4f643f1121dd807dd556d1dc`) sono stati criptati. Questo costituisce il payload del codice di pagamento.
### Cos'è XOR?
Nelle sezioni precedenti, abbiamo visto che il codice di pagamento è stato trasmesso criptato utilizzando l'operazione XOR. Prendiamoci un momento per capire come funziona questo operatore, poiché è ampiamente utilizzato nella crittografia.
XOR è un operatore logico bit a bit basato sull'algebra booleana. Con due operandi bit, restituisce `1` se i bit dello stesso rango sono diversi, e restituisce `0` se i bit dello stesso rango sono uguali. Ecco la tabella di verità di XOR basata sui valori degli operandi `D` e `E`:
| D   | E   | D XOR E |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |
Per esempio:
$$

$$
0110 \oplus 1110 = 1000
Oppure:
$$

$$
010011 \oplus 110110 = 100101
Con ECDH, l'uso di XOR come strato di crittografia è particolarmente adatto. Innanzitutto, a causa di questo operatore, la crittografia è simmetrica. Questo consente al destinatario di decifrare il codice di pagamento con la stessa chiave utilizzata per la crittografia. La chiave di crittografia e decrittografia viene calcolata dal segreto condiviso grazie a ECDH. Questa simmetria è resa possibile dalle proprietà commutativa e associativa dell'operatore XOR:
- Altre proprietà:
$$

$$
D \oplus D = 0
D ⊕ 0 = D
- Commutatività:
$$

$$
D \oplus E = E \oplus D
- Associatività:
$$

$$
D \oplus (E \oplus Z) = (D \oplus E) \oplus Z = D \oplus E \oplus Z
Se:
$$

$$
D \oplus E = L
Allora:
$$

$$
D \oplus L = D \oplus (D \oplus E) = D \oplus D \oplus E = 0 \oplus E = E \\
\therefore D \oplus L = E
Successivamente, questo metodo di cifratura assomiglia molto al cifrario di Vernam (One-Time Pad), l'unico algoritmo di cifratura conosciuto fino ad oggi che possiede sicurezza incondizionata (o assoluta). Affinché il cifrario di Vernam abbia questa caratteristica, la chiave di cifratura deve essere perfettamente casuale, deve essere della stessa dimensione del messaggio e deve essere utilizzata una sola volta. Nel metodo di cifratura utilizzato qui per BIP47, la chiave è effettivamente della stessa dimensione del messaggio, il fattore di offuscamento è esattamente della stessa dimensione della concatenazione della coordinata x della chiave pubblica con il codice catena del codice di pagamento. Questa chiave di cifratura è effettivamente utilizzata una sola volta. Tuttavia, questa chiave non è il risultato di una casualità perfetta poiché è un HMAC. È piuttosto pseudo-casuale. Pertanto, non si tratta di un cifrario di Vernam, ma il metodo è simile.
### Ricezione della Transazione di Notifica
Ora che Alice ha inviato la transazione di notifica a Bob, vediamo come lui la interpreta. Come promemoria, Bob deve essere in grado di accedere al codice di pagamento di Alice. Senza queste informazioni, come vedremo nella sezione seguente, non sarà in grado di derivare le coppie di chiavi create da Alice e, quindi, non sarà in grado di accedere ai suoi bitcoin ricevuti tramite BIP47. Per ora, il payload del codice di pagamento di Alice è criptato. Vediamo come Bob lo decifra.
**1-** Bob monitora le transazioni che creano output con il suo indirizzo di notifica.
**2-** Quando una transazione ha un output sul suo indirizzo di notifica, Bob la analizza per vedere se contiene un output OP_RETURN che segue lo standard BIP47.
**3-** Se il primo byte del payload OP_RETURN è `0x01`, Bob inizia la sua ricerca di un possibile segreto condiviso con ECDH:
- Bob seleziona la chiave pubblica nell'input della transazione. Ovvero, la chiave pubblica di Alice denominata $A$ con:
$$ A = a \cdot G $$
- Bob seleziona la chiave privata $b$ associata al suo indirizzo di notifica personale:
$$ b $$
- Bob calcola il punto segreto $S$ (segreto condiviso ECDH) sulla curva ellittica sommando e raddoppiando i punti, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$:
$$ S = b \cdot A $$
- Bob determina il fattore di offuscamento $f$ che gli permetterà di decifrare il payload del codice di pagamento di Alice. Nello stesso modo in cui Alice aveva precedentemente calcolato, Bob troverà $f$ applicando HMAC-SHA512 su $x$ la coordinata x del punto segreto $S$, e su $o$ l'UTXO consumato come input in questa transazione di notifica:
$$ f = \text{HMAC-SHA512}(o, x) $$
**4-** Bob interpreta i dati nell'OP_RETURN della transazione di notifica come un codice di pagamento. Egli semplicemente decifra il payload di questo potenziale codice di pagamento usando il fattore di offuscamento $f$:
- Bob divide il fattore di offuscamento $f$ in 2 parti: i primi 32 byte di $f$ saranno $f1$ e gli ultimi 32 byte saranno $f2$;
- Bob decifra la coordinata x cifrata $x'$ della chiave pubblica dal codice di pagamento di Alice:
$$ x = x' \oplus f1 $$
- Bob decifra il valore del codice catena cifrato $c'$ dal codice di pagamento di Alice:
$$ c = c' \oplus f2 $$
**5-** Bob verifica se il valore della chiave pubblica dal codice di pagamento di Alice è effettivamente parte del gruppo secp256k1. Se è così, lo interpreta come un codice di pagamento valido. Altrimenti, ignora questa transazione.
Ora che Bob è a conoscenza del codice di pagamento di Alice, lei può inviargli fino a `2^32` pagamenti, senza mai dover effettuare un'altra transazione di notifica di questo tipo.
Perché funziona? Come fa Bob a determinare lo stesso fattore di offuscamento di Alice, e quindi a decifrare il suo codice di pagamento? Esaminiamo più da vicino il ruolo di ECDH in quello che abbiamo appena descritto.
Prima di tutto, stiamo trattando con la crittografia simmetrica. Questo significa che la chiave di cifratura e la chiave di decifratura sono lo stesso valore. Questa chiave nella transazione di notifica è il fattore di offuscamento:
$$ f = f1 || f2 $$
Pertanto, Alice e Bob devono ottenere lo stesso valore per $f$, senza trasmetterlo direttamente poiché un attaccante potrebbe rubarlo e decifrare le informazioni segrete. Questo fattore di offuscamento si ottiene applicando HMAC-SHA512 su 2 valori:
- la coordinata x di un punto segreto;
- e l'UTXO consumato come input nella transazione.
Bob, quindi, ha bisogno di queste due informazioni per decifrare il payload del codice di pagamento di Alice. Per l'UTXO come input, Bob può semplicemente recuperarlo osservando la transazione di notifica. Per il punto segreto, Bob dovrà usare ECDH. Come visto nella sezione precedente su Diffie-Hellman, semplicemente scambiando le rispettive chiavi pubbliche e applicando segretamente le proprie chiavi private alla chiave pubblica dell'altro, Alice e Bob possono trovare un punto specifico e segreto sulla curva ellittica. La transazione di notifica si basa su questo meccanismo:
- Coppia di chiavi di Bob:
$$ B = b \cdot G $$
- Coppia di chiavi di Alice:
$$ A = a \cdot G $$
- Per un segreto $S (x, y)$:
$$ S = a \cdot B = a \cdot (b \cdot G) = (b \cdot a) \cdot G = b \cdot A $$
Ora che Bob conosce il codice di pagamento di Alice, sarà in grado di rilevare i suoi pagamenti BIP47, e può derivare le chiavi private che bloccano i bitcoin ricevuti.
Ricapitoliamo i passaggi che abbiamo appena esaminato per ricevere e interpretare una transazione di notifica:
- Bob monitora gli output delle transazioni al suo indirizzo di notifica;
- Quando ne rileva uno, recupera le informazioni contenute nell'OP_RETURN;
- Bob seleziona la chiave pubblica in input e calcola un punto segreto usando ECDH;
- Usa questo punto segreto per calcolare un HMAC che è il fattore di offuscamento;
- Usa questo fattore di offuscamento per decifrare il payload del codice di pagamento di Alice contenuto nell'OP_RETURN.
### La Transazione di Pagamento BIP47
Studiamo ora insieme il processo di pagamento con BIP47. Per ricordarvi lo stato attuale delle cose:
- Alice conosce il codice di pagamento di Bob, che ha semplicemente recuperato dal suo sito web;
- Bob conosce il codice di pagamento di Alice grazie alla transazione di notifica;
- Alice effettuerà un primo pagamento a Bob. Potrà effettuarne molti altri allo stesso modo.
Prima di spiegare questo processo, penso sia importante ricordare gli indici su cui stiamo attualmente lavorando. Il percorso di derivazione di un codice di pagamento è descritto come segue: `m/47'/0'/0'`. La profondità successiva distribuisce gli indici in questo modo:
- La prima coppia di chiavi figlio normali (non rinforzate) è quella utilizzata per generare l'indirizzo di notifica di cui abbiamo parlato nella parte precedente: `m/47'/0'/0'/0`;
- Le coppie di chiavi figlio normali sono utilizzate all'interno di ECDH per generare indirizzi di ricezione dei pagamenti BIP47 come vedremo in questa sezione: da `m/47'/0'/0'/0` a `m/47'/0'/0'/2 147 483 647`;
- Le coppie di chiavi figlio rinforzate sono codici di pagamento effimeri: da `m/47'/0'/0'/0'` a `m/47'/0'/0'/2 147 483 647'`.
Ogni volta che Alice desidera inviare un pagamento a Bob, deriva un nuovo indirizzo vergine unico, grazie ancora al protocollo ECDH:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale riutilizzabile:
$$ a $$
- Alice seleziona la prima chiave pubblica inutilizzata derivata dal codice di pagamento di Bob. Questa chiave pubblica, la chiameremo $B$. È associata alla chiave privata $b$ che solo Bob conosce:
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ sulla curva ellittica tramite addizione e raddoppio di punti applicando la sua chiave privata $a$ alla chiave pubblica $B$ di Bob:
$$ S = a \cdot B $$
- Da questo punto segreto, Alice calcolerà il segreto condiviso $s$ (minuscolo). Per fare ciò, seleziona la coordinata x del punto segreto $S$ denominata $Sx$, e passa questo valore attraverso la funzione hash SHA256:
$$ S = (Sx, Sy) $$
$$ s = \text{SHA256}(Sx) $$
- Alice utilizza questo segreto condiviso $s$ per calcolare un indirizzo Bitcoin di ricezione dei pagamenti. Inizialmente, verifica che $s$ sia contenuto nell'ordine della curva secp256k1. In caso contrario, incrementa l'indice della chiave pubblica di Bob per derivare un altro segreto condiviso;
- In secondo luogo, calcola una chiave pubblica $K0$ aggiungendo sulla curva ellittica i punti $B$ e $s·G$. In altre parole, Alice aggiunge la chiave pubblica derivata dal codice di pagamento di Bob $B$ con un altro punto calcolato sulla curva ellittica tramite addizione e raddoppio con il segreto condiviso $s$ dal punto generatore della curva secp256k1 $G$. Questo nuovo punto rappresenta una chiave pubblica, e lo chiamiamo $K0$:
$$ K0 = B + s \cdot G $$
- Con questa chiave pubblica $K0$, Alice può derivare un indirizzo vergine standard di ricezione (per esempio, SegWit V0 in bech32).
Una volta che Alice ha ottenuto l'indirizzo di ricezione di Bob $K0$, può eseguire una transazione Bitcoin in modo standard. Per fare ciò, seleziona un UTXO di sua proprietà, assicurato da una coppia di chiavi di un ramo diverso del suo portafoglio HD, e lo spende per soddisfare un output all'indirizzo di Bob $K0$. È importante notare che questo pagamento, una volta derivato l'indirizzo, segue un processo convenzionale e non dipende più dalle chiavi associate a BIP47.
Ricapitoliamo i passaggi che abbiamo appena eseguito insieme per inviare un pagamento BIP47:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH dalla prima chiave pubblica derivata non utilizzata dal codice di pagamento di Bob;
- Utilizza questo punto segreto per calcolare un segreto condiviso con SHA256;
- Utilizza questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla chiave pubblica di Bob;
- Ottiene una nuova chiave pubblica effimera per la quale solo Bob ha la chiave privata associata;
- Alice può effettuare una transazione standard a Bob con l'indirizzo di ricezione effimero derivato.
![BTC204](assets/it/66/21.webp)
Se Alice desidera effettuare un secondo pagamento, seguirà gli stessi passaggi di prima, eccetto che questa volta selezionerà la seconda chiave pubblica derivata dal codice di pagamento di Bob. Specificamente, utilizzerà la prossima chiave non utilizzata. Otterrà così un nuovo indirizzo di ricezione appartenente a Bob, designato $K1$:
![BTC204](assets/it/66/22.webp)
Può continuare in questo modo e derivare fino a `2^32` indirizzi non utilizzati appartenenti a Bob.
Da un punto di vista esterno, osservando la blockchain, è teoricamente impossibile differenziare un pagamento BIP47 da un pagamento standard. Ecco un esempio di transazione di pagamento BIP47 sul Testnet:
```

94b2e59510f2e1fa78411634c98a77bbb638e28fb2da00c9f359cd5fc8f87254
````
Questo sembra una transazione standard con un input consumato, un output di pagamento e un resto:
![BTC204](assets/fr/232.webp)
### Ricevere il Pagamento BIP47 e Derivare la Chiave Privata
Alice ha appena effettuato il suo primo pagamento a un nuovo indirizzo BIP47 appartenente a Bob. Ora vediamo come Bob riceve questo pagamento. Vedremo anche perché Alice non ha accesso alla chiave privata dell'indirizzo che ha appena generato da sola, e come Bob recupera questa chiave per spendere i bitcoin che ha appena ricevuto.
Non appena Bob riceve la transazione di notifica da Alice, deriva la chiave pubblica BIP47 $K0$ anche prima che lei abbia inviato qualsiasi pagamento. Poi monitora qualsiasi pagamento all'indirizzo associato. Infatti, deriva immediatamente diversi indirizzi che monitorerà ($K0$, $K1$, $K2$, $K3$...). Ecco come deriva questa chiave pubblica $K0$:
- Bob seleziona la prima chiave privata derivata dal suo codice di pagamento. Questa chiave privata è denominata $b$. È associata alla chiave pubblica $B$ con cui Alice aveva fatto i suoi calcoli nel passaggio precedente:
$$ b $$
- Bob seleziona la prima chiave pubblica di Alice derivata dal suo codice di pagamento. Questa chiave è denominata $A$. È associata alla chiave privata $a$ con cui Alice aveva fatto i suoi calcoli, e di cui solo Alice è a conoscenza. Bob può eseguire questo processo poiché è a conoscenza del codice di pagamento di Alice che le è stato trasmesso con la transazione di notifica:
$$ A = a \cdot G $$
- Bob calcola il punto segreto $S$, mediante addizione e raddoppio di punti sulla curva ellittica, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$. Qui troviamo l'uso di ECDH che garantisce che questo punto $S$ sarà lo stesso sia per Bob che per Alice:
$$ S = b \cdot A $$
- Proprio come ha fatto Alice, Bob isola la coordinata x di questo punto $S$. Abbiamo chiamato questo valore $Sx$. Egli passa questo valore attraverso la funzione SHA256 per trovare il segreto condiviso $s$ (minuscolo):
$$ s = \text{SHA256}(Sx) $$
- Proprio come Alice, Bob calcola il punto $s·G$ sulla curva ellittica. Poi, aggiunge questo punto segreto alla sua chiave pubblica $B$. Ottiene così un nuovo punto sulla curva ellittica che interpreta come una chiave pubblica $K0$:
$$ K0 = B + s \cdot G $$
Una volta che Bob ha questa chiave pubblica $K0$, può derivare la chiave privata associata per essere in grado di spendere i suoi bitcoin. È l'unico che può generare questa chiave privata:
- Bob aggiunge la sua chiave privata figlio $b$ derivata dal suo codice di pagamento personale. È l'unico che può ottenere il valore di $b$. Poi, aggiunge $b$ con il segreto condiviso $s$ per ottenere $k0$, la chiave privata di $K0$:
$$ k0 = b + s $$
Grazie alla legge di gruppo della curva ellittica, Bob ottiene esattamente la chiave privata corrispondente alla chiave pubblica usata da Alice. Abbiamo quindi:
$$ K0 = k0 \cdot G $$
Riassumerò i passaggi che abbiamo appena esaminato insieme per ricevere un pagamento BIP47 e calcolare la chiave privata corrispondente:
- Bob seleziona la prima chiave privata figlio derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica usando ECDH dalla prima chiave pubblica figlio derivata dal codice catena di Alice;
- Usa questo punto segreto per calcolare un segreto condiviso con SHA256;
- Usa questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla sua chiave pubblica personale;
- Ottiene una nuova chiave pubblica effimera, alla quale Alice invierà il suo primo pagamento;
- Bob calcola la chiave privata associata a questa chiave pubblica effimera aggiungendo la sua chiave privata figlio derivata dal suo codice di pagamento e il segreto condiviso.
![BTC204](assets/it/66/24.webp)
Poiché Alice non può ottenere $b$ (la chiave privata di Bob), lei non è in grado di determinare $k0$ (la chiave privata associata all'indirizzo di ricezione BIP47 di Bob). Schematicamente, possiamo rappresentare il calcolo del segreto condiviso $S$ così:
![BTC204](assets/it/66/19.webp)
Una volta trovato il segreto condiviso con ECDH, Alice e Bob calcolano la chiave pubblica di pagamento BIP47 $K0$, e Bob calcola anche la chiave privata associata $k0$:
![BTC204](assets/it/66/25.webp)
### Rimborsare il Pagamento BIP47
Poiché Bob è a conoscenza del codice di pagamento riutilizzabile di Alice, ha già tutte le informazioni necessarie per inviarle un rimborso. Non avrà bisogno di contattare nuovamente Alice per chiedere informazioni. Dovrà semplicemente notificarla con una transazione di notifica, specialmente affinché lei possa recuperare i suoi indirizzi BIP47 con il suo seed, e poi potrà anche inviarle fino a `2^32` pagamenti.
La funzionalità di rimborso è specifica per BIP47 ed è uno dei suoi vantaggi rispetto ad altri metodi che studieremo nei prossimi capitoli, come i Pagamenti Silenziosi.
Bob può quindi rimborsare Alice nello stesso modo in cui lei gli ha inviato i pagamenti. I ruoli si invertono:
![BTC204](assets/it/66/26.webp)
_Un grande ringraziamento a [Fanis Michalakis](https://x.com/FanisMichalakis) per la sua revisione e preziosi consigli esperti sull'articolo che ha ispirato la scrittura di questo capitolo!_
https://planb.network/tutorials/privacy/on-chain/paynym-bip47-a492a70b-50eb-4f95-a766-bae2c5535093
## Pagamenti Silenziosi
<chapterId>2871d594-414e-4598-a830-91c9eb84dfb8</chapterId>
Il BIP47 è stato criticato per la sua inefficienza sulla blockchain. Come spiegato nel capitolo precedente, richiede una transazione di notifica per ogni nuovo destinatario. Questo vincolo diventa trascurabile se si prevede di stabilire un canale di pagamento duraturo con questo destinatario. Infatti, una singola transazione di notifica apre la strada a un numero quasi infinito di pagamenti BIP47 successivi.
Tuttavia, in determinate situazioni, la transazione di notifica può rappresentare un ostacolo per l'utente. Prendiamo l'esempio di una donazione una tantum a un destinatario: con un indirizzo Bitcoin classico, una singola transazione è sufficiente per effettuare la donazione. Ma con il BIP47, sono necessarie due transazioni: una per la notifica e un'altra per il pagamento effettivo. Quando la domanda di spazio nel blocco è bassa e le commissioni di transazione sono minime, questo passaggio aggiuntivo generalmente non rappresenta un problema. Tuttavia, durante i periodi di congestione, le commissioni di transazione possono diventare esorbitanti per un singolo pagamento, potenzialmente raddoppiando il costo per l'utente rispetto a una transazione Bitcoin standard, il che può essere inaccettabile per l'utente.
Per situazioni in cui l'utente prevede di effettuare solo pochi pagamenti a un identificatore statico, sono state sviluppate altre soluzioni. Tra queste ci sono i Pagamenti Silenziosi, descritti nel [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki). Questo protocollo consente l'uso di un identificatore statico per ricevere pagamenti senza generare riutilizzo dell'indirizzo e senza richiedere l'uso di transazioni di notifica. Esaminiamo come funziona questo protocollo.
---
_Per comprendere appieno questo capitolo, è essenziale essere familiari con il funzionamento di ECDH (Elliptic Curve Diffie-Hellman) e la derivazione delle chiavi crittografiche in un portafoglio HD. Questi concetti sono stati dettagliati nel capitolo precedente sul BIP47. Non li ripeterò qui. Se non sei ancora familiare con queste nozioni, ti consiglio di consultare il capitolo precedente prima di continuare con questo. Non riprenderò nemmeno i rischi associati al riutilizzo degli indirizzi di ricezione, né l'importanza di avere un identificatore unico per ricevere pagamenti._
---
### Perché non spostare la notifica?
Come discusso nel capitolo sul BIP47, la transazione di notifica svolge principalmente due funzioni:
- Notifica il destinatario;
- Trasmette il codice di pagamento del mittente.
Si potrebbe ingenuamente pensare che questo processo di notifica potrebbe essere effettuato off-chain. In teoria, ciò è completamente fattibile: sarebbe sufficiente per il destinatario indicare un mezzo di comunicazione per ricevere i codici di pagamento BIP47 dai mittenti. Tuttavia, questo approccio presenta due problemi principali:
- Primo, ciò sposterebbe il processo di trasmissione del codice su un altro protocollo di comunicazione. Le questioni relative ai costi e alla privacy dello scambio rimarrebbero, ma sarebbero semplicemente trasferite a questo nuovo protocollo. In termini di privacy, ciò potrebbe anche creare un collegamento tra l'identità di un utente e l'attività sulla blockchain, cosa che cerchiamo di evitare eseguendo la notifica direttamente sulla blockchain. Inoltre, effettuare la notifica fuori dalla blockchain introdurrebbe rischi di censura (come il blocco dei fondi) che non esistono su Bitcoin;
Successivamente, ciò porrebbe un problema di recupero. Con BIP47, il destinatario deve assolutamente conoscere i codici di pagamento dei mittenti per accedere ai fondi. Questo è vero al momento della ricezione, ma anche in caso di recupero dei fondi tramite il seed in caso di perdita del portafoglio. Con le notifiche onchain, questo rischio viene evitato, poiché l'utente può trovare e decifrare le transazioni di notifica semplicemente conoscendo il proprio seed. Tuttavia, se la notifica viene eseguita fuori dalla blockchain, l'utente dovrebbe mantenere un backup dinamico di tutti i codici di pagamento ricevuti, il che è impraticabile per l'utente medio.
Tutti questi vincoli rendono l'uso della notifica onchain indispensabile nel contesto di BIP47. Eppure, i Pagamenti Silenziosi cercano specificamente di evitare questo passaggio di notifica onchain a causa del suo costo. Pertanto, la soluzione adottata non è spostare la notifica, ma eliminarla completamente. Per raggiungere questo obiettivo, deve essere accettato un compromesso: quello della scansione. A differenza di BIP47, dove l'utente sa esattamente dove trovare i propri fondi grazie alle transazioni di notifica, nel contesto dei Pagamenti Silenziosi, l'utente deve esaminare tutte le transazioni Bitcoin esistenti per rilevare eventuali pagamenti che potrebbero essere destinati a loro. Per ridurre questo onere operativo, la ricerca di Pagamenti Silenziosi è limitata solo alle transazioni che probabilmente contengono tali pagamenti, ovvero quelle che includono almeno un output Taproot P2TR. La scansione si concentra esclusivamente anche sulle transazioni dalla data di creazione del portafoglio (non c'è bisogno di scandire transazioni risalenti al 2009 se il portafoglio è stato creato nel 2024).
Pertanto, potete vedere perché BIP47 e Pagamenti Silenziosi, sebbene mirino a un obiettivo simile, comportano compromessi diversi e **quindi si rivolgono effettivamente a casi d'uso distinti**. Per i pagamenti una tantum, come le donazioni occasionali, i Pagamenti Silenziosi sono più appropriati a causa del loro costo inferiore. Al contrario, per le transazioni regolari allo stesso destinatario, come nel caso delle piattaforme di scambio o dei pool di mining, BIP47 potrebbe essere preferito.
Esploriamo insieme il funzionamento tecnico dei Pagamenti Silenziosi per capirne meglio le implicazioni. Per fare ciò, suggerisco di adottare lo stesso approccio del documento esplicativo di BIP352. Scomporremo gradualmente i calcoli da eseguire, elemento per elemento, giustificando ogni nuova aggiunta.
### Alcuni concetti da comprendere
Prima di iniziare, è importante chiarire che i Pagamenti Silenziosi si basano esclusivamente sull'uso di tipi di script P2TR (_Pay to Taproot_). A differenza di BIP47, non è necessario derivare gli indirizzi di ricezione dalle chiavi pubbliche figlie tramite hashing. Infatti, nello standard P2TR, la chiave pubblica modificata viene utilizzata direttamente e apertamente nell'indirizzo. Così, un indirizzo di ricezione Taproot è essenzialmente una chiave pubblica accompagnata da alcuni metadati. Questa chiave pubblica modificata è l'aggregazione di altre due chiavi pubbliche: una che consente la spesa diretta e tradizionale tramite una semplice firma, e l'altra che rappresenta la radice di Merkle del MAST, che autorizza la spesa soggetta alla soddisfazione di una delle condizioni potenzialmente iscritte nell'albero di Merkle.
![BTC204](assets/it/67/01.webp)
La decisione di limitare i Pagamenti Silenziosi esclusivamente a Taproot è motivata da due ragioni principali:
- Primo, facilita significativamente l'implementazione e gli aggiornamenti futuri nel software del portafoglio, poiché è necessario aderire a un solo standard;
- In secondo luogo, questo approccio aiuta a migliorare l'insieme di anonimato degli utenti incoraggiandoli a non disperdersi tra diversi tipi di script, che generano impronte di portafoglio distinte nell'analisi della catena (per maggiori informazioni su questo concetto, vi invito a consultare il capitolo 4 della parte 2).
### Derivazione naive di una chiave pubblica di Pagamenti Silenziosi
Iniziamo con un semplice esempio che ti aiuterà a comprendere il funzionamento di base dei Pagamenti Silenziosi (SP, Silent Payments). Prendiamo Alice e Bob, due utenti Bitcoin. Alice vuole inviare bitcoin a Bob su un nuovo indirizzo di ricezione. Tre obiettivi devono essere raggiunti in questo processo:
- Alice deve essere in grado di generare un nuovo indirizzo;
- Bob deve essere in grado di identificare un pagamento inviato a questo specifico indirizzo;
- Bob deve essere in grado di ottenere la chiave privata associata a questo indirizzo per poter spendere i suoi fondi.
Alice ha un UTXO nel suo portafoglio Bitcoin protetto con la seguente coppia di chiavi:
- $a$: la chiave privata;
- $A$: la chiave pubblica ($A = a \cdot G$)
Bob ha un indirizzo SP che ha pubblicato su internet con:
- $b$: la chiave privata;
- $B$: la chiave pubblica ($B = b \cdot G$)
Recuperando l'indirizzo di Bob, Alice è in grado di calcolare un nuovo indirizzo vuoto che appartiene a Bob usando ECDH. Chiamiamo questo indirizzo $P$:
$$ P = B + \text{hash}(a \cdot B) \cdot G $$
In questa equazione, Alice ha semplicemente calcolato il prodotto scalare della sua chiave privata $a$ e della chiave pubblica di Bob $B$. Ha passato questo risultato attraverso una funzione hash conosciuta da tutti. Il valore di output è poi moltiplicato scalarmente per il punto generatore $G$ della curva ellittica `secp256k1`. Infine, Alice aggiunge il punto ottenuto alla chiave pubblica di Bob $B$. Una volta che Alice ha questo indirizzo $P$, lo usa come output in una transazione, il che significa che invia bitcoin ad esso.
> _Nel contesto dei Pagamenti Silenziosi, la funzione "hash" corrisponde a una funzione hash SHA256 etichettata specificamente con `BIP0352/SharedSecret`, assicurando che gli hash generati siano unici per questo protocollo e non possano essere riutilizzati in altri contesti, fornendo anche una protezione aggiuntiva contro il riutilizzo di nonce nelle firme. Questo standard corrisponde a quello [specificato nel BIP340 per le firme Schnorr](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) su `secp256k1`._
Grazie alle proprietà della curva ellittica su cui si basa ECDH, sappiamo che:
$$ a \cdot B = b \cdot A $$
Bob sarà quindi in grado di calcolare l'indirizzo di ricezione su cui Alice ha inviato i bitcoin. Per fare ciò, monitora tutte le transazioni Bitcoin che soddisfano i criteri dei Pagamenti Silenziosi e applica il seguente calcolo a ciascuna di esse per vedere se il pagamento è indirizzato a lui (_scanning_):
$$ P' = B + \text{hash}(b \cdot A) \cdot G $$
Quando esamina la transazione di Alice, si rende conto che $P'$ è uguale a $P$. Sa quindi che questo pagamento è indirizzato a lui:
$$ P' = B + \text{hash}(b \cdot A) \cdot G = B + \text{hash}(a \cdot B) \cdot G = P $$
Da qui, Bob sarà in grado di calcolare la chiave privata $p$ che consente di spendere l'indirizzo $P$:
$$ p = (b + \text{hash}(b \cdot A)) \bmod n $$
Come puoi vedere, per calcolare questa chiave privata $p$, è necessario avere la chiave privata $b$. Solo Bob ha questa chiave privata $b$. Sarà quindi effettivamente l'unico in grado di spendere i bitcoin inviati al suo indirizzo di Pagamenti Silenziosi.
![BTC204](assets/fr/236.webp)
_Didascalia:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s$: Il segreto comune ECDH
- $P$: La chiave pubblica / indirizzo unico per il pagamento a Bob
Ecco un approccio inizialmente piuttosto ingenuo nell'uso dell'indirizzo statico di Bob, denotato $B$, per derivare un indirizzo unico $P$ per inviare bitcoin. Tuttavia, questo metodo è troppo semplicistico e presenta diversi difetti che necessitano di correzione. Il primo problema è che, in questo schema, Alice non può creare molteplici output per Bob all'interno della stessa transazione.
### Come creare molteplici output?
Nell'esempio della sezione precedente, Alice crea un singolo output che andrà a Bob al suo indirizzo unico $P$. Con lo stesso input selezionato, è impossibile per Alice creare due indirizzi vergini distinti per Bob, poiché il metodo utilizzato porterebbe sempre allo stesso risultato per $P$, quindi allo stesso indirizzo. Tuttavia, ci possono essere molte situazioni in cui Alice desidera dividere il suo pagamento a Bob in diverse piccole somme, creando così molteplici UTXO. È quindi necessario trovare un metodo che permetta di farlo.
Per raggiungere questo obiettivo, modificheremo leggermente il calcolo che Alice esegue per derivare $P$, in modo che possa generare due indirizzi distinti per Bob, ovvero $P_0$ e $P_1$.
Per modificare il calcolo e ottenere 2 indirizzi diversi, è sufficiente aggiungere un intero che modifica il risultato. Così, Alice aggiungerà $0$ nel suo calcolo per ottenere l'indirizzo $P_0$ e $1$ per ottenere l'indirizzo $P_1$. Chiamiamo questo intero $i$:
$$ P_i = B + \text{hash}(a \cdot B \text{ ‖ } i) \cdot G $$
Il processo di calcolo rimane invariato rispetto al metodo precedente, eccetto che questa volta Alice concatenerà $a \cdot B$ con $i$ prima di procedere al hash. È quindi sufficiente cambiare $i$ per avere un nuovo indirizzo appartenente a Bob. Ad esempio:
$$ P_0 = B + \text{hash}(a \cdot B \text{ ‖ } 0) \cdot G $$
$$ P_1 = B + \text{hash}(a \cdot B \text{ ‖ } 1) \cdot G $$
Quando Bob esamina la blockchain per i Pagamenti Silenziosi destinati a lui, inizia utilizzando $i = 0$ per l'indirizzo $P_0$. Se non trova nessun pagamento su $P_0$, conclude che questa transazione non contiene nessun Pagamento Silenzioso per lui e smette di analizzarla. Tuttavia, se $P_0$ è valido e contiene un pagamento per lui, procede con $P_1$ nella stessa transazione per verificare se Alice ha effettuato un secondo pagamento. Se $P_1$ risulta essere invalido, interrompe la sua ricerca per questa transazione; altrimenti, continua a testare valori successivi di $i$.
$$ P_1 = B + \text{hash}(b \cdot A \text{ ‖ } 1) \cdot G $$
Poiché Bob si ferma immediatamente a $i = 0$ se $P_0$ non produce risultati, l'uso di questo intero aggiunge quasi nessun onere operativo aggiuntivo a Bob per la fase di scansione delle transazioni.
Bob può quindi calcolare le chiavi private nello stesso modo:
$$

p_0 = (b + \text{hash}(b \cdot A \text{ ‖ } 0)) \bmod n

$$
p_1 = (b + \text{hash}(b \cdot A \text{ ‖ } 1)) \bmod n
$$

didascalia:_


- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: SHA256-hajautuksen funktio on määritetty `BIP0352/SharedSecret`:llä
- $s_0$: Il primo segreto condiviso ECDH
- $s_1$: Il secondo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $P_1$: La seconda chiave pubblica / indirizzo unico per il pagamento a Bob

Tämän menetelmän avulla voimme luoda erinomaisen protokollan, mutta meillä on vielä joitakin ongelmia, joita on vaikea hallita, erityisesti indirizzi-käyttöjen käytön estäminen.

### Come evitare il riutilizzo degli indirizzi?

Kuten olemme nähneet aiemmissa jaksoissa, Alice käyttää UTXO:ta suojaavaa chiavi-kopiota, jota hän käyttää laskeakseen ECDH:n salaisen koodin Bobin kanssa. Questo segreto le permette di derivare l'indirizzo unico $P_0$. Alicen käyttämä chiavi-kombinaatio ($a$, $A$) voi kuitenkin suojata enemmän UTXO:ta, jos se on käyttänyt tätä indirizzoa useaan kertaan. Jos Alice suorittaa kaksi maksua Bobin tilastolliselle tunnukselle $B$ käyttäen kahta UTXO:ta, jotka on suojattu samasta tunnuksesta $A$, tämä vastaa Bobin tunnuksen käyttämistä.

> _Il riutilizzo degli indirizzi è una pratica molto negativa per la privacy degli utenti. Jotta ymmärtäisit, miksi, sinun kannattaa lukea tämän ohjeen ensimmäiset osat._
Infatti, poiché l'indirizzo unico $P_0$ è derivato da $A$ e $B$, se Alice deriva un secondo indirizzo per un secondo pagamento a $B$, con la stessa chiave $A$, finirà per ottenere lo stesso indirizzo $P_0$. Tämän riskin välttämiseksi ja sen estämiseksi, että indirizzi-indiriskejä käytetään Pagamenti Silenziosi -maksujen sisällä, meidän on muutettava hieman enemmän laskelmiemme tuloksia.

Haluamme vain, että jokainen UTXO, jonka Alice kuluttaa maksun syöttönä, saa Bobin lattialta yhden yksilöllisen tunnuksen, vaikka useampia UTXO:ita suojellaan samoilla koodeilla. È quindi sufficiente aggiungere un riferimento all'UTXO nel calcolo dell'indirizzo unico $P_0$. Questo riferimento sarà semplicemente l'hash dell'UTXO consumato come input:

$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$ $$

Tämän syöttötiedon perusteella Alice liittää sen yksikäsitteisen $P_0$-indeksin laskentaan:

Durante la sua scansione, Bob può anche aggiungere $\text{inputHash}$, poiché tutto ciò che deve fare è osservare la transazione per dedurre $\text{outpoint}$:

$$ P_0 = B + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0) \cdot G$ $$

Quando trova un valido $P_0$, può calcolare la corrispondente chiave privata $p_0$:

$$
p_0 = (b + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0)) \bmod n
$$

```text
_Legenda:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $H$: L'hash dell'UTXO usato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hash SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
Al momento, i nostri calcoli presuppongono che Alice utilizzi un singolo input per la sua transazione. Tuttavia, dovrebbe essere in grado di utilizzare più input. Di conseguenza, da parte di Bob, per ogni transazione contenente più input, teoricamente avrebbe bisogno di calcolare l'ECDH per ogni input per determinare se un pagamento è destinato a lui. Questo metodo non è soddisfacente, quindi abbiamo bisogno di trovare una soluzione per ridurre il carico di lavoro!
### Modificare le chiavi pubbliche negli input
Per risolvere questo problema, invece di utilizzare la coppia di chiavi che protegge un input specifico da parte di Alice, useremo la somma di tutte le coppie di chiavi utilizzate negli input della transazione. Questa somma sarà quindi considerata come una nuova coppia di chiavi. Questa tecnica è nota come "tweak".
Per esempio, immagina che la transazione di Alice abbia 3 input, ognuno protetto con una coppia di chiavi diversa:
- $a_0$ protegge l'input #0;
- $a_1$ protegge l'input #1;
- $a_2$ protegge l'input #2.
Seguendo il metodo descritto sopra, Alice dovrebbe scegliere una singola coppia di chiavi tra $a_0$, $a_1$ e $a_2$ per calcolare il segreto ECDH e generare l'indirizzo di pagamento unico $P$ dall'indirizzo statico $B$ di Bob. Tuttavia, questo approccio richiede a Bob di testare ogni possibilità sequenzialmente, partendo da $a_0$, poi $a_1$, e così via, fino all'identificazione di una coppia che genera un indirizzo valido $P$. Questo processo richiede che Bob esegua il calcolo ECDH su tutti gli input di tutte le transazioni, aumentando significativamente il carico di lavoro operativo di scansione.
Per evitare ciò, chiederemo ad Alice di eseguire il suo calcolo di $P$ utilizzando la somma di tutte le chiavi in input. Prendendo il nostro esempio, la chiave privata modificata $a$ sarebbe calcolata come segue:
$$ a = a_0 + a_1 + a_2 $$
Allo stesso modo, Alice e Bob saranno in grado di calcolare la chiave pubblica modificata:
$$ A = A_0 + A_1 + A_2 $$
Grazie a questo metodo, a Bob basta calcolare la somma delle chiavi pubbliche della transazione, poi calcolare il segreto ECDH da $A$ soltanto, il che riduce notevolmente il numero di calcoli da fare per la fase di scansione. Tuttavia, ricorda dalla sezione precedente. Avevamo incluso nel nostro calcolo l'hash $\text{inputHash}$ che viene usato come nonce per prevenire il riutilizzo degli indirizzi:
$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$
Ma se ci sono più input in una transazione, è necessario determinare quale $\text{outpoint}$ viene scelto in questo calcolo. Secondo il BIP352, il criterio di selezione per $\text{outpoint}$ da usare è scegliere il più piccolo lessicograficamente, il che significa selezionare l'UTXO che appare per primo in ordine alfabetico. Questo metodo standardizza l'UTXO da scegliere in ogni transazione. Ad esempio, se questo $\text{outpoint}$ più piccolo lessicograficamente è $\text{outpoint}_L$, il calcolo di $\text{inputHash}$ sarà:
$$ \text{inputHash} = \text{hash}(\text{outpoint}\_L \text{ ‖ } A) $$
I calcoli rimangono quindi identici a quelli presentati nella sezione precedente, eccetto che la chiave privata $a$ e la sua corrispondente chiave pubblica $A$ non rappresentano più una coppia che protegge un singolo input, ma ora rappresentano la modifica di tutte le coppie di chiavi negli input.
### Separare le Chiavi di Spesa e di Scansione
Finora, abbiamo discusso dell'indirizzo statico di Pagamento Silenzioso $B$ come di una chiave pubblica unica. Ricorda, è questa chiave pubblica $B$ che viene usata da Alice per creare il segreto condiviso ECDH, che a sua volta viene usato per calcolare l'indirizzo di pagamento unico $P$. Bob usa questa chiave pubblica $B$ e la corrispondente chiave privata $b$ per la fase di scansione. Ma userà anche la chiave privata $b$ per calcolare la chiave privata $p$ che consente di spendere dall'indirizzo $P$.
Lo svantaggio di questo metodo è che la chiave privata $b$, che viene usata per calcolare tutte le chiavi private per gli indirizzi che ricevono Pagamenti Silenziosi, viene anche usata da Bob per scansionare le transazioni. Questo passaggio richiede che la chiave $b$ sia disponibile su un software di portafoglio connesso a Internet, il che la espone a un rischio maggiore di furto rispetto al mantenerla su un portafoglio freddo. Idealmente, sarebbe vantaggioso poter approfittare dei Pagamenti Silenziosi mantenendo la chiave privata $b$, che controlla l'accesso a tutte le altre chiavi private, al sicuro su un portafoglio hardware. Fortunatamente, il protocollo è stato adattato per permettere esattamente questo.
Per raggiungere questo obiettivo, il BIP352 specifica che il ricevente usa 2 diverse coppie di chiavi:
- $B_{\text{spend}}$: per calcolare le chiavi private degli indirizzi di pagamento unici;
- $B_{\text{scan}}$: per trovare indirizzi di pagamento unici.
In questo modo, Bob può mantenere la chiave privata $b_{\text{spend}}$ su un portafoglio hardware e usare la chiave privata $b_{\text{scan}}$ su software online per trovare i suoi Pagamenti Silenziosi, senza rivelare $b_{\text{spend}}$. Tuttavia, le chiavi pubbliche $B_{\text{scan}}$ e $B_{\text{spend}}$ sono entrambe pubblicamente rivelate, poiché si trovano nell'indirizzo statico di Bob $B$:
Per calcolare un indirizzo di pagamento unico $P_0$ appartenente a Bob, Alice eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot a \cdot B\_{\text{scan}} \text{ ‖ } 0) \cdot G $$
Per trovare i pagamenti indirizzati a lui, Bob eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Come puoi vedere, fino a questo momento, Bob non ha avuto bisogno di usare $b_{\text{spend}}$ che si trova sul suo portafoglio hardware. Quando desidera spendere $P_0$, può quindi eseguire il seguente calcolo per trovare la chiave privata $p_0$:
$$ p*0 = (b*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0)) \bmod n $$
_Didascalia:_
- $B_{\text{scan}}$: Chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: Chiave privata di scansione di Bob
- $B_{\text{spend}}$: Chiave pubblica di spesa di Bob (indirizzo statico)
- $b_{\text{spend}}$: Chiave privata di spesa di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash dell'UTXO più piccolo (lessicograficamente) usato in input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo di pagamento unico per Bob
### Utilizzando indirizzi SP con un'etichetta
Bob ha quindi un indirizzo statico $B$ per i Pagamenti Silenziosi come segue:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Il problema con questo metodo è che non permette di segregare i diversi pagamenti inviati a questo indirizzo. Ad esempio, se Bob ha 2 clienti diversi per la sua attività e vuole differenziare chiaramente i pagamenti da ciascuno, avrebbe bisogno di 2 indirizzi statici diversi. Una soluzione ingenua, con l'approccio attuale, sarebbe che Bob crei due portafogli separati, ognuno con il proprio indirizzo statico, o addirittura stabilisca due indirizzi statici diversi all'interno dello stesso portafoglio. Tuttavia, questa soluzione richiede la scansione dell'intera blockchain due volte (una per ciascun indirizzo) per rilevare rispettivamente i pagamenti destinati a ciascun indirizzo. Questa doppia scansione aumenta in modo irragionevole l'onere operativo per Bob.
Per risolvere questo problema, BIP352 utilizza un sistema di etichettatura che consente di avere diversi indirizzi statici senza aumentare in modo irragionevole il carico di lavoro per trovare Pagamenti Silenziosi sulla blockchain. Per fare ciò, viene aggiunto un intero $m$ alla chiave pubblica di spesa $B_{\text{spend}}$. Questo intero può assumere il valore di $1$ per il primo indirizzo statico, poi $2$ per il secondo, e così via. Le chiavi di spesa $B_{\text{spend}}$ saranno d'ora in poi chiamate $B_m$ e saranno costruite in questo modo:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Per esempio, per la prima chiave di spesa con l'etichetta $1$:
$$ B*1 = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } 1) \cdot G $$
L'indirizzo statico pubblicato da Bob consisterà ora di $B_{\text{scan}}$ e $B_m$. Per esempio, il primo indirizzo statico con l'etichetta $1$ sarà:
$$ B = B\_{\text{scan}} \text{ ‖ } B_1 $$
> _Iniziamo solo dall'etichetta 1 perché l'etichetta 0 è riservata per il resto._
Alice, da parte sua, deriverà l'indirizzo di pagamento unico $P$ nello stesso modo di prima, ma utilizzando il nuovo $B_1$ invece di $B_{\text{spend}}$.
$$ P*0 = B_1 + \text{hash}(\text{inputHash} \cdot a \cdot B*{\text{scan}} \text{ ‖ } 0) \cdot G $$
In realtà, Alice potrebbe non sapere nemmeno che Bob ha un indirizzo etichettato, poiché lei semplicemente utilizza la seconda parte dell'indirizzo statico che lui le ha fornito, che in questo caso, è il valore $B_1$ piuttosto che $B_{\text{spend}}$.
Per scansionare i pagamenti, Bob utilizzerà sempre il valore del suo indirizzo statico iniziale con $B_{\text{spend}}$ in questo modo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Poi, semplicemente sottrae il valore che trova per $P_0$ da ogni output uno per uno. Poi controlla se uno dei risultati di queste sottrazioni corrisponde al valore di una delle etichette che usa nel suo portafoglio. Se corrisponde, per esempio, per l'output #4 con l'etichetta $1$, ciò significa che questo output è un Pagamento Silenzioso associato al suo indirizzo statico etichettato $B_1$:
$$ Out*4 - P_0 = \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Questo funziona perché:
$$ B*1 = B*{\text{spend}} + \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Grazie a questo metodo, Bob può utilizzare una moltitudine di indirizzi statici ($B_1$, $B_2$, $B_3$...), tutti derivati dal suo indirizzo statico base ($B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}}$), al fine di separare correttamente gli usi.
Tuttavia, questa separazione degli indirizzi statici è valida solo da una prospettiva di gestione personale del portafoglio e non consente la separazione delle identità. Poiché tutti hanno lo stesso $B*{\text{scan}}$, è molto facile associare tutti gli indirizzi statici insieme e dedurre che appartengono a una singola entità.
_Didascalia:_
- $B_{\text{scan}}$: chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: chiave privata di scansione di Bob
- $B_{\text{spend}}$: chiave pubblica di spesa di Bob (indirizzo iniziale)
- $B_m$: chiave pubblica di spesa etichettata di Bob (indirizzo statico)
- $b_m$: chiave privata di spesa etichettata di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash del più piccolo UTXO (lessicograficamente) utilizzato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $p_0$: La chiave privata del primo indirizzo di pagamento unico a Bob
- $X$: L'hash della chiave privata di scansione con l'etichetta
### Come Costruire un Indirizzo per Pagamenti Silenziosi?
Per costruire un indirizzo dedicato ai Pagamenti Silenziosi, è necessario prima derivare 2 coppie di chiavi nel proprio portafoglio Bitcoin HD:
- La coppia $b_{\text{scan}}$, $B_{\text{scan}}$ per cercare i pagamenti indirizzati a noi;
- La coppia $b_{\text{spend}}$, $B_{\text{spend}}$ per spendere i bitcoin che abbiamo ricevuto.
Queste coppie sono derivate seguendo questi percorsi (_Bitcoin Mainnet_):
scan: m / 352' / 0' / 0' / 1' / 0
spend: m / 352' / 0' / 0' / 0' / 0
```

```text
Una volta disponibili queste 2 coppie di chiavi, si concatenano semplicemente (una di seguito all'altra) per creare il payload dell'indirizzo statico:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Se si desidera utilizzare etichette, $B_{\text{spend}}$ viene sostituito con $B_m$:
$$ B = B\_{\text{scan}} \text{ ‖ } B_m $$
Con l'etichetta $m$:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Una volta disponibile questo payload, si aggiunge la HRP (_Human-Readable Part_) `sp` e la versione `q` (= versione 0). Viene anche aggiunto un checksum, e l'indirizzo è formattato in bech32m.
Ad esempio, ecco il mio indirizzo statico per i Pagamenti Silenziosi:
sp1qqvhjvsq2vz8zwrw372vuzle7472zup2ql3pz64yn5cpkw5ngv2n6jq4nl8cgm6zmu48yk3eq33ryc7aam6jrvrg0d0uuyzecfhx2wgsumcurv77e
```