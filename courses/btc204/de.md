---
name: Datenschutz bei Bitcoin
goal: Verstehen und Beherrschen der Grundsätze des Datenschutzes bei der Verwendung von Bitcoin
objectives: 

  - Definition der theoretischen Konzepte, die erforderlich sind, um die Bedeutung des Schutzes der Privatsphäre zu verstehen
  - Wissen, wie man Risiken im Zusammenhang mit dem Verlust der Privatsphäre von Bitcoin-Nutzern erkennt und eindämmt
  - Methoden und Tools zum Schutz Ihrer Privatsphäre auf Bitcoin
  - Verstehen der Methoden der Kettenanalyse und Entwicklung von Verteidigungsstrategien

---
# Schützen Sie Ihre Privatsphäre bei bitcoin

In einer Welt, in der der Schutz der Privatsphäre bei Finanztransaktionen allmählich zum Luxus wird, ist das Verständnis und die Beherrschung der Grundsätze des Datenschutzes bei der Nutzung von Bitcoin unerlässlich. Dieses Training liefert Ihnen alle Schlüssel, sowohl theoretisch als auch praktisch, um dieses Ziel selbst zu erreichen.

Heute gibt es auf Bitcoin Unternehmen, die sich auf Kettenanalysen spezialisiert haben. Ihr Hauptgeschäft ist es, in Ihre Privatsphäre einzudringen, um die Vertraulichkeit Ihrer Transaktionen zu gefährden. In der Tat existiert das "Recht auf Privatsphäre" auf Bitcoin nicht. Es liegt daher an Ihnen, dem Nutzer, Ihre natürlichen Rechte geltend zu machen und die Vertraulichkeit Ihrer Transaktionen zu schützen, denn niemand sonst wird das für Sie tun.

Diese Schulung ist als umfassender, generalistischer Kurs konzipiert. Jeder technische Begriff wird detailliert erläutert und durch erklärende Diagramme unterstützt. Das Ziel ist es, das Wissen für jeden zugänglich zu machen. BTC204 ist daher für Anfänger und Fortgeschrittene zugänglich. Diese Schulung bietet auch erfahreneren Bitcoinern einen Mehrwert, da wir uns mit einigen oft unbekannten technischen Konzepten befassen.

Schließen Sie sich uns an, um Ihre Nutzung von Bitcoin zu verändern und ein informierter Nutzer zu werden, der in der Lage ist, die Probleme im Zusammenhang mit der Vertraulichkeit zu verstehen und Ihre Privatsphäre zu schützen.

+++
# Einführung

<partId>e17474a8-8899-4bdb-a7f8-bc52ddb01440</partId>

## Einführung in die Ausbildung

<chapterId>08ba1933-f393-4fb5-8279-777d874caedb</chapterId>

In einer Welt, in der der Schutz der Privatsphäre bei Finanztransaktionen allmählich zum Luxus wird, ist das Verständnis und die Beherrschung der Grundsätze des Datenschutzes bei der Nutzung von Bitcoin unerlässlich. Dieses Training liefert Ihnen alle Schlüssel, sowohl theoretisch als auch praktisch, um dieses Ziel selbst zu erreichen.

Heute gibt es im Bitcoin-Ökosystem Unternehmen, die sich auf die Blockchain-Analyse spezialisiert haben. Ihr Hauptgeschäft ist es, in Ihre Privatsphäre einzudringen und die Vertraulichkeit Ihrer Transaktionen zu gefährden. In der Tat gibt es bei Bitcoin kein "Recht auf Privatsphäre". Es liegt also an Ihnen, dem Nutzer, Ihre natürlichen Rechte geltend zu machen und die Vertraulichkeit Ihrer Transaktionen zu schützen, denn niemand sonst wird das für Sie tun.

Bitcoin ist nicht nur für "Number Go Up" und die Erhaltung des Wertes von Ersparnissen da. Aufgrund seiner einzigartigen Eigenschaften und seiner Geschichte ist er in erster Linie ein Werkzeug der alternativen Wirtschaft. Dank dieser bemerkenswerten Erfindung können Sie Ihr Geld frei verwalten, es ausgeben und anhäufen, ohne dass Sie jemand daran hindern kann.

Bitcoin bietet einen friedlichen Ausweg aus dem Joch des Staates und ermöglicht es Ihnen, Ihre natürlichen Rechte in vollem Umfang zu genießen, die nicht durch bestehende Gesetze in Frage gestellt werden können. Dank der Erfindung von Satoshi Nakamoto haben Sie die Macht, Ihr Recht auf Privateigentum durchzusetzen und Ihre Vertragsfreiheit wiederzuerlangen.

Allerdings ist Bitcoin nicht standardmäßig anonym, was ein Risiko für Personen darstellen kann, die in der alternativen Wirtschaft tätig sind, insbesondere in Regionen mit despotischen Regimen. Aber das ist nicht die einzige Gefahr. Da Bitcoin ein wertvolles und unzensiertes Gut ist, könnte es die Aufmerksamkeit von Dieben auf sich ziehen. Daher wird der Schutz Ihrer Privatsphäre auch zu einer Sicherheitsfrage: Er kann Ihnen helfen, Cyberangriffe und physische Übergriffe zu verhindern.

Wie wir sehen werden, bietet das Protokoll zwar einen gewissen inhärenten Schutz der Privatsphäre, aber es ist wichtig, zusätzliche Werkzeuge zu verwenden, um diese Privatsphäre zu optimieren und zu schützen. Dieser Kurs ist als umfassender, allgemeiner Weg zum Verständnis von Datenschutzfragen bei Bitcoin konzipiert. Jeder technische Begriff wird im Detail diskutiert und durch erklärende Diagramme unterstützt. Das Ziel ist es, das Wissen für jeden zugänglich zu machen, einschließlich Anfängern und Fortgeschrittenen. Für erfahrenere Bitcoin-Nutzer werden in diesem Kurs auch sehr technische und manchmal weniger bekannte Konzepte behandelt, um das Verständnis der einzelnen Themen zu vertiefen.

Das Ziel dieses Kurses ist es nicht, Sie bei der Nutzung von Bitcoin völlig anonym zu machen, sondern Ihnen die wesentlichen Werkzeuge an die Hand zu geben, um zu wissen, wie Sie Ihre Privatsphäre entsprechend Ihrer persönlichen Ziele schützen können. Sie werden die Freiheit haben, aus den vorgestellten Konzepten und Werkzeugen zu wählen, um Ihre eigenen Strategien zu entwickeln, die auf Ihre spezifischen Ziele und Bedürfnisse zugeschnitten sind.

### Abschnitt 1: Definitionen und Schlüsselbegriffe

Zu Beginn werden wir uns gemeinsam die Grundlagen ansehen, die die Funktionsweise von Bitcoin bestimmen, und uns dann in aller Ruhe den Begriffen der Privatsphäre nähern. Es ist wichtig, einige grundlegende Konzepte wie UTXOs, Empfangsadressen oder Skripte zu beherrschen, bevor wir die Konzepte, die wir in den folgenden Abschnitten behandeln werden, vollständig verstehen können. Wir werden auch das allgemeine Datenschutzmodell von Bitcoin vorstellen, wie es von Satoshi Nakamoto erdacht wurde, was es uns ermöglicht, die Probleme und damit verbundenen Risiken zu verstehen.

![BTC204](assets/it/11/1.webp)

### Abschnitt 2: Verständnis der Kettenanalyse und wie Sie sich schützen können

Im zweiten Abschnitt untersuchen wir die Techniken, die von Blockchain-Analyseunternehmen verwendet werden, um Ihre Aktivitäten auf Bitcoin zu verfolgen. Diese Methoden zu verstehen, ist entscheidend für die Verbesserung des Schutzes Ihrer Privatsphäre. Dieser Teil zielt darauf ab, die Strategien der Angreifer zu untersuchen, um die Risiken besser zu verstehen und die Grundlage für die Techniken zu schaffen, die wir in den folgenden Abschnitten untersuchen werden. Wir werden Transaktionsmuster, interne und externe Heuristiken sowie plausible Interpretationen dieser Muster analysieren. Neben einer theoretischen Komponente werden wir anhand von praktischen Beispielen und Übungen lernen, wie man einen Block-Explorer zur Durchführung von Kettenanalysen verwendet.

![BTC204](assets/fr/002.webp)

### Abschnitt 3: Beherrschung bewährter Praktiken zum Schutz Ihrer Privatsphäre

Im dritten Abschnitt unseres Kurses kommen wir zum Kern der Sache: Praxis! Das Ziel ist es, alle wesentlichen Best Practices zu beherrschen, die für jeden Bitcoin-Nutzer zu natürlichen Reflexen werden sollten. Wir werden die Verwendung neuer Adressen, die Kennzeichnung, die Konsolidierung, die Verwendung kompletter Nodes sowie KYC und Erwerbsmethoden behandeln. Ziel ist es, Ihnen einen umfassenden Überblick über die zu vermeidenden Fallstricke zu geben, um eine solide Grundlage für den Schutz der Privatsphäre zu schaffen. Für einige dieser Praktiken werden Sie zu einer speziellen Anleitung geführt, um sie umzusetzen.

![BTC204](assets/it/11/3.webp)

### Abschnitt 4: Verständnis von Coinjoin-Transaktionen

Wie können wir über Bitcoin-Privatsphäre sprechen, ohne Coinjoin zu erwähnen? In Abschnitt 4 erfahren Sie alles, was Sie über diese Methode der Vermischung wissen müssen. Sie werden erfahren, was ein Coinjoin ist, seine Geschichte und Ziele sowie die verschiedenen Arten von Coinjoin, die es gibt. Schließlich erfahren erfahrene Nutzer, was Anonsets und Entropie sind und wie man diese Indikatoren berechnet.

![BTC204](assets/it/11/4.webp)

### Abschnitt 5: Verständnis der Problematik anderer fortgeschrittener Datenschutztechniken

Im fünften Abschnitt geben wir einen Überblick über alle anderen existierenden Techniken zum Schutz Ihrer Privatsphäre auf Bitcoin neben coinjoin. Im Laufe der Jahre haben die Entwickler bei der Entwicklung von Tools zum Schutz der Privatsphäre viel Kreativität bewiesen. Wir werden all diese Methoden wie Payjoin, kollaborative Transaktionen, Coin Swap und Atomic Swap untersuchen und detailliert beschreiben, wie sie funktionieren, welche Ziele sie verfolgen und welche potenziellen Schwächen sie haben.

Wir werden auch die Privatsphäre auf der Ebene des Knotennetzwerks und die Verbreitung von Transaktionen behandeln. Wir werden auch die verschiedenen Protokolle diskutieren, die im Laufe der Jahre vorgeschlagen wurden, um die Privatsphäre der Nutzer von Bitcoin zu verbessern, einschließlich statischer Adressprotokolle.

![BTC204](assets/fr/005.webp)

# Definitionen und Schlüsselbegriffe

<partId>b9bbbde3-34c0-4851-83e8-e2ffb029cf31</partId>

## Das UTXO-Modell von Bitcoin

<chapterId>8d6b50c5-bf74-44f4-922b-25204991cb75</chapterId>

Bitcoin ist in erster Linie eine Währung, aber wissen Sie konkret, wie BTC in dem Protokoll dargestellt wird?

### UTXOs von Bitcoin: Was sind sie?

Im Bitcoin-Protokoll basiert die Verwaltung der Geldeinheiten auf dem UTXO-Modell, das für "_Unspent Transaction Output_" steht

Dieses Modell unterscheidet sich grundlegend von traditionellen Bankensystemen, die sich auf einen Konto- und Saldomechanismus stützen, um Finanzströme zu verfolgen. Im Bankensystem werden die einzelnen Guthaben auf Konten geführt, die mit einer Identität verbunden sind. Wenn Sie beispielsweise ein Baguette beim Bäcker kaufen, bucht Ihre Bank den Betrag einfach von Ihrem Konto ab, wodurch sich Ihr Saldo verringert, während dem Konto des Bäckers der gleiche Betrag gutgeschrieben wird, wodurch sich sein Saldo erhöht. In diesem System gibt es keine Verbindung zwischen dem Geld, das auf Ihrem Konto eingeht, und dem Geld, das von Ihrem Konto abgeht, außer den Transaktionsaufzeichnungen.

Bei Bitcoin funktionieren die Dinge anders. Das Konzept eines Kontos gibt es nicht, und die Geldeinheiten werden nicht über Guthaben, sondern über UTXOs verwaltet. Ein UTXO steht für einen bestimmten Bitcoin-Betrag, der noch nicht ausgegeben wurde und somit ein "Bitcoin-Stück" darstellt, das groß oder klein sein kann. Ein UTXO kann zum Beispiel 500 BTC oder nur 700 SATS wert sein.

**> Zur Erinnerung:** Der Satoshi, oft abgekürzt als Sat, ist die kleinste Einheit von Bitcoin, vergleichbar mit einem Penny in Fiat-Währungen.

```plaintext
1 BTC = 100,000,000 SATS
```

Theoretisch kann ein UTXO jeden Wert in Bitcoin repräsentieren, von einem Sat bis zum theoretischen Maximum von etwa 21 Millionen BTC. Es ist jedoch logisch unmöglich, alle 21 Millionen Bitcoins zu besitzen, und es gibt eine untere wirtschaftliche Schwelle, die als "Staub" bezeichnet wird und unterhalb derer ein UTXO als unwirtschaftlich angesehen wird.

**>Der größte UTXO, der jemals auf Bitcoin erstellt wurde, hatte einen Wert von 500.000 BTC. Er wurde von der MtGox-Plattform während einer Konsolidierungsoperation im November 2011 erstellt: [29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf](https://mempool.space/fr/tx/29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf)

### UTXO und Ausgabenbedingungen

UTXOs sind die Tauschmittel von Bitcoin. Jede Transaktion beinhaltet den Verbrauch von UTXOs als Inputs und die Schaffung neuer UTXOs als Outputs. Wenn eine Transaktion durchgeführt wird, werden die als Inputs verwendeten UTXOs als "verbraucht" betrachtet, und neue UTXOs werden erzeugt und den in den Outputs der Transaktion angegebenen Empfängern zugewiesen. Somit stellt ein UTXO einfach eine nicht ausgegebene Transaktionsausgabe dar und somit einen Bitcoin-Betrag, der einem Nutzer zu einem bestimmten Zeitpunkt gehört.

![BTC204](assets/it/21/2.webp)

Alle UTXOs sind durch Skripte geschützt, die die Bedingungen festlegen, unter denen sie ausgegeben werden können. Um einen UTXO zu verbrauchen, muss ein Benutzer dem Netz nachweisen, dass er die Bedingungen erfüllt, die in dem Skript zum Schutz dieses UTXO festgelegt sind. Im Allgemeinen werden UTXOs durch einen öffentlichen Schlüssel (oder eine Empfangsadresse, die diesen öffentlichen Schlüssel repräsentiert) geschützt. Um ein mit diesem öffentlichen Schlüssel verknüpftes UTXO auszugeben, muss der Benutzer nachweisen, dass er im Besitz des entsprechenden privaten Schlüssels ist, indem er eine mit diesem Schlüssel erstellte digitale Signatur vorlegt. Aus diesem Grund sagt man, dass Ihre Bitcoin-Brieftasche eigentlich keine Bitcoins enthält, sondern Ihre privaten Schlüssel, die Ihnen wiederum Zugang zu Ihren UTXOs und damit zu den Bitcoins geben, die sie repräsentieren.

![BTC204](assets/it/21/3.webp)

Da es in Bitcoin kein Konzept eines Kontos gibt, ist der Kontostand einer Wallet einfach die Summe der Werte aller UTXOs, die sie ausgeben kann. Wenn Ihr Bitcoin-Wallet zum Beispiel die folgenden 4 UTXOs ausgeben kann:

```plaintext
- 2 BTC
- 8 BTC
- 5 BTC
- 2 BTC
```

Das Gesamtguthaben Ihrer Brieftasche würde dann 17 BTC betragen.

![BTC204](assets/it/21/4.webp)

## Die Struktur von Bitcoin-Transaktionen

<chapterId>29d3aaab-de2e-4746-ab40-c9748898850c</chapterId>

### Die Ein- und Ausgänge einer Transaktion

Eine Bitcoin-Transaktion ist eine in der Blockchain aufgezeichnete Transaktion, die die Übertragung des Eigentums an Bitcoins von einer Person auf eine andere ermöglicht. Genauer gesagt, da wir uns in einem UTXO-Modell befinden und es keine Konten gibt, erfüllt die Transaktion die Ausgabebedingungen, die einen oder mehrere UTXOs geschützt haben, verbraucht sie und schafft entsprechend neue UTXOs, die mit neuen Ausgabebedingungen ausgestattet sind. Kurz gesagt, eine Transaktion verschiebt Bitcoins von einem Skript, das erfüllt ist, zu einem neuen Skript, das sie schützen soll.

![BTC204](assets/it/22/1.webp)

Jede Bitcoin-Transaktion besteht also aus einem oder mehreren Inputs und einem oder mehreren Outputs. Die Inputs sind UTXOs, die von der Transaktion verbraucht werden, um die Outputs zu erzeugen. Die Outputs sind neue UTXOs, die als Inputs für zukünftige Transaktionen verwendet werden können.

![BTC204](assets/it/22/2.webp)

**> Theoretisch kann eine Bitcoin-Transaktion eine unendliche Anzahl von Ein- und Ausgängen haben. Nur die maximale Blockgröße begrenzt diese Anzahl. Jeder Input in einer Bitcoin-Transaktion bezieht sich auf einen vorherigen, nicht ausgegebenen UTXO (Unspent Transaction Output). Um einen UTXO als Input zu verwenden, muss sein Inhaber nachweisen, dass er der rechtmäßige Eigentümer ist, indem er das damit verbundene Skript validiert, d. h. die auferlegte Ausgabebedingung erfüllt. In der Regel bedeutet dies, dass eine digitale Signatur vorgelegt werden muss, die mit dem privaten Schlüssel erstellt wurde, der dem öffentlichen Schlüssel entspricht, mit dem der UTXO ursprünglich gesichert wurde. Das Skript überprüft dann, ob die Signatur mit dem öffentlichen Schlüssel übereinstimmt, der beim Empfang der Mittel verwendet wurde.

Bei jeder Ausgabe werden hingegen der zu übertragende Bitcoin-Betrag und der Empfänger angegeben. Letzterer wird durch ein neues Skript definiert, das im Allgemeinen den neu erstellten UTXO mit einer Empfängeradresse oder einem neuen öffentlichen Schlüssel sperrt.

Damit eine Transaktion nach den Konsensregeln als gültig angesehen wird, muss die Summe der Outputs kleiner oder gleich der Summe der Inputs sein. Mit anderen Worten: Die Summe der durch die Transaktion erzeugten neuen UTXOs darf die Summe der als Inputs verbrauchten UTXOs nicht übersteigen. Dieses Prinzip ist logisch: Wenn Sie nur über einen Betrag von 500.000 SATS verfügen, können Sie nicht einen Kauf von 700.000 SATS tätigen.

### Umtausch und Konsolidierung bei einer Bitcoin-Transaktion

Die Wirkung einer Bitcoin-Transaktion auf UTXOs kann daher mit dem Schmelzen einer Goldmünze verglichen werden. In der Tat ist ein UTXO nicht teilbar, sondern nur vereinheitlicht. Das bedeutet, dass ein Nutzer einen UTXO, der einen bestimmten Bitcoin-Betrag repräsentiert, nicht einfach in mehrere kleinere UTXOs aufteilen kann. Er muss ihn in einer Transaktion vollständig verbrauchen, um einen oder mehrere neue UTXO mit beliebigen Werten in den Ausgängen zu erzeugen, die kleiner oder gleich dem ursprünglichen Wert sein müssen.

Dieser Mechanismus ist ähnlich wie bei einer Goldmünze. Stellen Sie sich vor, Sie besitzen eine 2-Unzen-Münze und möchten eine Zahlung von 1 Unze leisten, vorausgesetzt, der Verkäufer kann Ihnen kein Wechselgeld geben. Sie müssten Ihre Münze einschmelzen und 2 neue Münzen zu je 1 Unze prägen.

Bei Bitcoin ist der Vorgang ähnlich. Angenommen, Alice hat einen UTXO von 10.000 SATS und möchte ein Baguette kaufen, das 4.000 SATS kostet. Alice wird eine Transaktion mit einem UTXO von 10.000 SATS durchführen, den sie vollständig verbraucht, und zwei UTXOs im Wert von 4.000 SATS und 6.000 SATS erzeugen. Der UTXO von `4.000 SATS` wird an den Bäcker als Bezahlung für das Baguette geschickt, während der UTXO von `6.000 SATS` als Wechselgeld zu Alice zurückkehrt. Diese UTXO, die an den ursprünglichen Absender der Transaktion zurückgeht, wird im Bitcoin-Jargon als "Wechselgeld" bezeichnet.

Stellen Sie sich nun vor, dass Alice nicht über einen einzigen UTXO mit `10.000 SATS` verfügt, sondern über zwei UTXOs mit je `3.000 SATS`. In diesem Fall reicht keiner der einzelnen UTXOs aus, um die `4.000 SATS` für das Baguette zu decken. Daher muss Alice beide UTXOs von `3.000 SATS` gleichzeitig als Input für ihre Transaktion verwenden. Auf diese Weise erreicht die Gesamtmenge der Vorleistungen `6.000 SATS`, was es ihr ermöglicht, die Zahlung von `4.000 SATS` an den Bäcker zu decken. Diese Methode, bei der mehrere UTXOs zu den Vorleistungen eines Geschäfts zusammengefasst werden, wird oft als "Konsolidierung" bezeichnet.

### Transaktionsgebühren

Intuitiv könnte man meinen, dass Transaktionsgebühren auch eine Leistung einer Transaktion darstellen. In Wirklichkeit ist dies jedoch nicht der Fall. Transaktionsgebühren stellen die Differenz zwischen den gesamten Inputs und den gesamten Outputs dar. Das bedeutet, dass nach der Verwendung eines Teils des Wertes der Inputs zur Deckung der gewünschten Outputs in einer Transaktion eine bestimmte Summe der Inputs ungenutzt bleibt. Dieser Restbetrag stellt die Transaktionsgebühren dar.

```plaintext
Commissioni = input totali - output totali
```

Kehren wir zu dem Beispiel von Alice zurück, die einen UTXO von 10.000 SATS hat und ein Baguette für 4.000 SATS kaufen möchte. Alice erstellt eine Transaktion mit ihrem UTXO von "10.000 SATS" als Eingabe. Sie erzeugt dann eine Ausgabe von 4.000 SATS, die der Bäcker für das Baguette bezahlen soll. Um die Miner zu ermutigen, ihre Transaktion in einen Block aufzunehmen, gibt Alice 200 SATS als Provision aus. Dabei erzeugt sie eine zweite Ausgabe, den Rest, der ihr zurückgegeben wird, in Höhe von `5.800 SATS`.

Wenn man die Provisionsformel anwendet, sieht man, dass 200 SATS für die Bergleute übrig sind:

```plaintext
Commissioni = input totali - output totali
Spese = 10.000 - (4.000 + 5.800)
Spese = 10.000 - 9.800
Spese = 200
```

Wenn ein Miner einen Block erfolgreich validiert, ist er berechtigt, diese Gebühren für alle in seinem Block enthaltenen Transaktionen durch eine so genannte "Coinbase"-Transaktion zu kassieren.

### Die Schaffung von UTXO auf Bitcoin

Wenn Sie die vorangegangenen Abschnitte aufmerksam verfolgt haben, wissen Sie nun, dass UTXOs nur durch den Verbrauch anderer bestehender UTXOs erzeugt werden können. Somit bilden die Münzen auf Bitcoin eine kontinuierliche Kette. Sie werden sich jedoch fragen, wie die ersten UTXOs in dieser Kette entstanden sind. Dies wirft ein Problem auf, das dem des Huhns und des Eies ähnelt: Woher kamen diese ursprünglichen UTXOs?

Die Antwort liegt in der **Coinbase-Transaktion**.

Coinbase ist eine spezielle Art von Bitcoin-Transaktion, die für jeden Block einzigartig ist und immer die erste in einem Block ist. Sie ermöglicht es dem Miner, der einen gültigen Proof of Work gefunden hat, seine Blockbelohnung zu erhalten. Diese Belohnung besteht aus zwei Elementen: **dem Block Grant** und **Transaktionsgebühren**, die im vorherigen Teil beschrieben wurden.

Das Einzigartige an der Coinbase-Transaktion ist, dass sie die einzige ist, die Bitcoins aus dem Nichts erschaffen kann, ohne dass sie Inputs verbrauchen muss, um ihren Output zu erzeugen. Diese neu geschaffenen Bitcoins sind das, was man die "ursprünglichen UTXOs" nennen könnte

Bitcoins aus dem Block Grant sind neue BTC, die aus dem Nichts geschaffen werden, indem sie einem in den Konsensregeln festgelegten Ausgabeplan folgen. Der Block Grant wird alle 210.000 Blöcke halbiert, etwa alle vier Jahre, in einem Prozess, der "Halving" genannt wird Ursprünglich wurden pro Subvention 50 Bitcoins geschaffen, aber dieser Betrag ist allmählich gesunken; derzeit sind es 3.125 Bitcoins pro Block.

Die Transaktionsgebühren stellen zwar neu geschaffene BTC dar, dürfen aber die Differenz zwischen den gesamten Inputs und Outputs aller Transaktionen in einem Block nicht überschreiten. Wir haben bereits gesehen, dass diese Gebühren den Teil der Inputs darstellen, der nicht in den Outputs der Transaktionen verwendet wird. Dieser Teil ist technisch gesehen während der Transaktion "verloren", und der Miner hat das Recht, diesen Wert in Form eines oder mehrerer neuer UTXOs wiederherzustellen. Es handelt sich also um eine Wertübertragung vom Absender der Transaktion an den Miner, der sie zur Blockchain hinzufügt.

**> Wussten Sie schon?** Bitcoins, die aus einer Coinbase-Transaktion generiert werden, unterliegen einer 100-Block-Reifezeit, während der sie vom Miner nicht ausgegeben werden können. Diese Regel soll Komplikationen vermeiden, die mit der Verwendung von neu erzeugten Bitcoins auf einer Kette verbunden sind, die später veraltet sein könnte.

### Die Auswirkungen des UTXO-Modells

Erstens wirkt sich das UTXO-Modell direkt auf die Transaktionsgebühren in Bitcoin aus. Da die Kapazität jedes Blocks begrenzt ist, bevorzugen die Miner Transaktionen, die die besten Gebühren im Verhältnis zu dem Platz bieten, den sie im Block belegen. Je mehr UTXO eine Transaktion als Input und Output enthält, desto schwerer ist sie und erfordert daher höhere Gebühren. Dies ist einer der Gründe, warum oft versucht wird, die Anzahl der UTXOs in unserem Portfolio zu reduzieren, was sich auch auf die Privatsphäre auswirken kann, ein Thema, das wir im dritten Teil dieser Schulung im Detail untersuchen werden.

Wie in den vorangegangenen Abschnitten erwähnt, sind Bitcoin-Münzen im Wesentlichen eine Kette von UTXOs. Jede Transaktion schafft somit eine Verbindung zwischen einem vergangenen UTXO und einem zukünftigen UTXO. UTXOs ermöglichen somit eine eindeutige Verfolgung des Weges der Bitcoins von ihrer Entstehung bis zu ihrer aktuellen Ausgabe. Diese Transparenz ist positiv zu bewerten, da sie es jedem Nutzer ermöglicht, die Echtheit der erhaltenen Bitcoins zu überprüfen. Auf diesem Prinzip der Rückverfolgbarkeit und Überprüfbarkeit basiert jedoch auch die Kettenanalyse, eine Praxis, die Ihre Privatsphäre gefährdet. Wir werden uns im zweiten Teil der Schulung eingehend mit dieser Praxis befassen.

## Das Datenschutzmodell von Bitcoin

<chapterId>769d8963-3ed5-4094-b21d-9203c7d9e465</chapterId>

### Währung: Authentizität, Integrität und doppelte Ausgaben

Eine der Funktionen der Währung besteht darin, das Problem der doppelten Deckung von Bedürfnissen zu lösen. In einem auf Tauschhandel basierenden System muss man für einen Tausch nicht nur eine Person finden, die ein Gut anbietet, das mein Bedürfnis befriedigt, sondern ihr auch ein gleichwertiges Gut zur Verfügung stellen, das ihr Bedürfnis befriedigt. Dieses Gleichgewicht zu finden, erweist sich als komplex.

Aus diesem Grund wird eine Währung verwendet, die den Transfer von Werten in Raum und Zeit ermöglicht.

Damit eine Währung dieses Problem lösen kann, muss derjenige, der eine Ware oder Dienstleistung anbietet, davon überzeugt sein, dass er diesen Betrag später ausgeben kann. Daher wird jeder vernünftige Mensch, der eine Form von Währung akzeptieren möchte, egal ob digital oder physisch, sicherstellen, dass sie zwei grundlegende Kriterien erfüllt:


- Die Münze muss intakt und echt sein;**- **und darf nicht zweimal ausgegeben werden.**

Bei der Verwendung von physischem Geld ist das erste Merkmal am schwierigsten zu behaupten. In verschiedenen historischen Epochen wurde die Integrität von Metallmünzen oft durch Praktiken wie Schneiden oder Stanzen beeinträchtigt. Im alten Rom war es beispielsweise üblich, dass die Bürger die Ränder von Goldmünzen abkratzten, um einen Teil des Edelmetalls aufzusammeln und sie für zukünftige Transaktionen aufzubewahren. Auf diese Weise wurde der innere Wert der Münze verringert, ihr Nennwert blieb jedoch gleich. Dies ist auch der Grund, warum später Streifen auf den Rand der Münzen geprägt wurden.

Die Echtheit ist auch ein Merkmal, das sich nur schwer mit physischen Geldmitteln überprüfen lässt. Heutzutage werden die Techniken zur Bekämpfung von Fälschungen immer komplexer, so dass Händler gezwungen sind, in teure Prüfsysteme zu investieren.

Andererseits ist die doppelte Zahlung bei physischen Währungen aufgrund ihrer Beschaffenheit kein Problem. Wenn ich Ihnen einen 10-Euro-Schein gebe, verlässt er unwiderruflich meinen Besitz und geht in Ihren über, was natürlich jede Möglichkeit ausschließt, dieselben Geldeinheiten mehrfach auszugeben. Kurz gesagt, ich kann diesen 10-€-Schein nicht noch einmal ausgeben.

Bei digitalen Währungen ist die Schwierigkeit eine andere. Die Sicherstellung der Authentizität und Integrität einer Münze ist oft einfacher. Wie wir im vorigen Abschnitt gesehen haben, ermöglicht es das UTXO-Modell von Bitcoin, eine Münze bis zu ihrem Ursprung zurückzuverfolgen und so zu überprüfen, ob sie tatsächlich in Übereinstimmung mit den Konsensregeln von einem Miner erstellt wurde.

Die Sicherstellung, dass keine doppelte Zahlung erfolgt, ist jedoch komplexer, da jedes digitale Gut im Wesentlichen aus Informationen besteht. Im Gegensatz zu physischen Gütern werden Informationen beim Austausch nicht geteilt, sondern durch Vervielfältigung weitergegeben. Wenn ich Ihnen zum Beispiel ein Dokument per E-Mail schicke, wird es vervielfältigt. Sie Ihrerseits können nicht mit Sicherheit feststellen, ob ich das Originaldokument gelöscht habe.

### Vermeidung von Doppelzahlungen bei Bitcoin

Die einzige Möglichkeit, die Duplizierung eines digitalen Vermögenswerts zu vermeiden, besteht darin, sich über alle Tauschvorgänge innerhalb des Systems zu informieren. Auf diese Weise kann man wissen, wem was gehört, und die Eigentumsverhältnisse aller Beteiligten auf der Grundlage der durchgeführten Transaktionen aktualisieren. So wird es zum Beispiel mit dem Buchgeld im Bankensystem gemacht. Wenn Sie bei einem Händler 10 € mit einer Kreditkarte bezahlen, zeichnet die Bank diesen Austausch auf und aktualisiert das Hauptbuch.

Bei Bitcoin wird die Vermeidung von Doppelzahlungen auf die gleiche Weise erreicht. Das Ziel ist es, die Abwesenheit einer Transaktion zu bestätigen, bei der die fraglichen Münzen bereits ausgegeben wurden. Wenn diese Münzen noch nie verwendet wurden, können wir sicher sein, dass keine doppelte Zahlung erfolgt. Dieses Prinzip wurde von Satoshi Nakamoto im White Paper mit diesem berühmten Satz beschrieben:

**"Die einzige Möglichkeit, das Nichtvorhandensein einer Transaktion zu bestätigen, besteht darin, alle Transaktionen zu kennen."

Im Gegensatz zum Bankenmodell besteht bei Bitcoin jedoch nicht der Wunsch, einer zentralen Stelle vertrauen zu müssen. Alle Nutzer müssen in der Lage sein, das Nichtvorhandensein von Doppelzahlungen zu bestätigen, ohne sich auf eine dritte Partei verlassen zu müssen. Daher muss jeder über alle Bitcoin-Transaktionen informiert sein. Aus diesem Grund werden Bitcoin-Transaktionen auf allen Knoten des Netzwerks öffentlich bekannt gegeben und im Klartext in der Blockchain aufgezeichnet.

Es ist genau diese öffentliche Verbreitung von Informationen, die den Schutz der Privatsphäre bei Bitcoin erschwert. Im traditionellen Bankensystem hat theoretisch nur das Finanzinstitut Kenntnis von den getätigten Transaktionen. Bei Bitcoin hingegen sind alle Nutzer über ihre jeweiligen Knotenpunkte über alle Transaktionen informiert.

### Das Datenschutzmodell: Bankensystem vs. Bitcoin

Im traditionellen System ist Ihr Bankkonto mit Ihrer Identität verknüpft. Der Banker kann wissen, welcher Kunde zu welchem Konto gehört und welche Transaktionen damit verbunden sind. Dieser Informationsfluss ist jedoch zwischen der Bank und dem öffentlichen Bereich unterbrochen. Mit anderen Worten: Es ist unmöglich, den Saldo und die Transaktionen eines Bankkontos zu kennen, das einer anderen Person gehört. Nur die Bank hat Zugang zu diesen Informationen.

Ihr Bankier weiß zum Beispiel, dass Sie Ihr Baguette jeden Morgen beim Bäcker um die Ecke kaufen, aber Ihr Nachbar weiß nichts von dieser Transaktion. Der Informationsfluss ist also für die interessierten Parteien, insbesondere die Bank, zugänglich, bleibt aber für Außenstehende unzugänglich.

Aufgrund der Einschränkung der öffentlichen Verbreitung von Transaktionen, die wir im vorherigen Teil gesehen haben, kann das Bitcoin-Datenschutzmodell nicht dem Modell des Bankensystems folgen. Im Falle von Bitcoin kann der Informationsfluss zwischen den Transaktionen und der Öffentlichkeit nicht unterbrochen werden, weshalb **das Datenschutzmodell auf der Trennung zwischen der Identität des Nutzers und den Transaktionen** selbst beruht.

Wenn Sie zum Beispiel ein Baguette beim Bäcker kaufen und mit BTC bezahlen, kann Ihr Nachbar, der seinen eigenen vollständigen Knoten besitzt, Ihre Transaktion sehen, so wie er auch alle anderen Transaktionen im System sehen kann. Wenn jedoch die Grundsätze des Datenschutzes beachtet werden, sollte er nicht in der Lage sein, diese spezielle Transaktion mit Ihrer Identität zu verknüpfen.

Da Bitcoin-Transaktionen jedoch öffentlich gemacht werden, ist es möglich, Verbindungen zwischen ihnen herzustellen, um Informationen über die beteiligten Parteien zu erhalten. Diese Tätigkeit stellt sogar eine eigene Spezialität dar, die "Kettenanalyse" Im nächsten Teil des Kurses lade ich Sie dazu ein, die Grundlagen der Kettenanalyse zu erforschen, um zu verstehen, wie Ihre Bitcoins verfolgt werden, und um zu wissen, wie Sie sich besser verteidigen können.

# Das Verständnis der Kettenanalyse und wie Sie sich schützen können

<partId>4739371e-9fef-45b0-bcaa-b7a4df6b4470</partId>

## Was ist die Kettenanalyse bei Bitcoin?

<chapterId>7d198ba6-4af2-4f24-86cb-3c79cb25627e</chapterId>

### Definition und Betrieb

Die Kettenanalyse ist ein Verfahren, das alle Methoden zur Verfolgung des Bitcoin-Flusses in der Blockchain umfasst. Im Allgemeinen basiert die Kettenanalyse auf der Beobachtung von Merkmalen in Stichproben früherer Transaktionen. Es geht dann darum, dieselben Merkmale in einer Transaktion zu identifizieren, die man analysieren möchte, und daraus plausible Interpretationen abzuleiten. Diese Methode der Problemlösung aus einem praktischen Ansatz heraus, um eine ausreichend gute Lösung zu finden, wird als "Heuristik" bezeichnet

Zur Vereinfachung wird die Kettenanalyse in drei Hauptschritten durchgeführt:

1. **Beobachtung der Blockchain;**

2. **Bekannte Merkmale identifizieren;**

3. **Voraussetzungen.**

Die Blockchain-Analyse kann von jedermann durchgeführt werden. Es reicht aus, über einen vollständigen Knoten Zugang zu den öffentlichen Informationen der Blockchain zu haben, um Transaktionsbewegungen zu beobachten und Annahmen zu treffen. Es gibt auch kostenlose Tools, die diese Analyse erleichtern, wie z. B. die Website [OXT.me] (https://oxt.me/), die wir in den letzten beiden Kapiteln dieses Teils im Detail untersuchen werden. Das größte Risiko für die Privatsphäre geht jedoch von Unternehmen aus, die sich auf die Kettenanalyse spezialisiert haben. Diese Unternehmen haben die Kettenanalyse zu einem industriellen Maßstab erhoben und verkaufen ihre Dienste an Finanzinstitute oder Regierungen. Unter diesen Unternehmen ist Chainalysis wahrscheinlich das bekannteste.

### Die Ziele der Kettenanalyse

Eines der Ziele der Kettenanalyse ist es, verschiedene Aktivitäten auf Bitcoin zu gruppieren, um die Einzigartigkeit des Nutzers zu bestimmen, der sie durchgeführt hat. Anschließend kann versucht werden, diese Aktivitäten mit einer tatsächlichen Identität zu verknüpfen.

Erinnern Sie sich an das vorherige Kapitel. Ich habe erklärt, warum das Bitcoin-Datenschutzmodell ursprünglich auf der Trennung von Nutzeridentitäten und deren Transaktionen basierte. Daher wäre es verlockend zu denken, dass On-Chain-Analysen nutzlos sind, denn selbst wenn man On-Chain-Aktivitäten gruppieren kann, können sie nicht mit einer tatsächlichen Identität in Verbindung gebracht werden.

Theoretisch ist diese Aussage richtig. Im ersten Teil dieser Schulung haben wir gesehen, dass kryptografische Schlüsselpaare verwendet werden, um Bedingungen für den UTXO festzulegen. Diese Schlüsselpaare geben im Wesentlichen keine Informationen über die Identität ihrer Inhaber preis. Selbst wenn wir also in der Lage sind, Aktivitäten zu gruppieren, die mit verschiedenen Schlüsselpaaren verbunden sind, sagt uns dies nichts über die Entität hinter diesen Aktivitäten.

Die praktische Realität ist jedoch viel komplexer. Es gibt eine Vielzahl von Verhaltensweisen, bei denen die Gefahr besteht, dass eine echte Identität mit einer Onchain-Aktivität verknüpft wird. In der Analyse wird dies als Einstiegspunkt bezeichnet, und es gibt viele davon.

Die häufigste ist natürlich KYC (_Know Your Customer_). Wenn Sie Ihre Bitcoins von einer regulierten Plattform an eine Ihrer persönlichen Empfangsadressen abheben, können einige Leute Ihre Identität mit dieser Adresse in Verbindung bringen. Allgemeiner ausgedrückt kann ein Einstiegspunkt jede Form der Interaktion zwischen Ihrem realen Leben und einer Bitcoin-Transaktion sein. Wenn Sie zum Beispiel eine Empfängeradresse in Ihren sozialen Netzwerken veröffentlichen, kann dies ein Einstiegspunkt für eine Analyse sein. Wenn Sie eine Bitcoin-Zahlung an Ihren Bäcker leisten, kann dieser Ihr Gesicht (das Teil Ihrer Identität ist) mit einer Bitcoin-Adresse in Verbindung bringen.

Diese Einstiegspunkte sind bei der Verwendung von Bitcoin fast unvermeidlich. Auch wenn Sie versuchen können, ihren Umfang einzuschränken, werden sie präsent bleiben. Deshalb ist es wichtig, Methoden zur Wahrung Ihrer Privatsphäre zu kombinieren. Die Trennung zwischen Ihrer echten Identität und Ihren Transaktionen ist zwar ein attraktiver Ansatz, reicht aber heute nicht mehr aus. Wenn nämlich alle Ihre Onchain-Aktivitäten zusammengefasst werden können, ist der kleinste Angriffspunkt geeignet, den einzigen Schutz Ihrer Privatsphäre zu gefährden, den Sie aufgebaut haben.

### Verteidigung gegen die Kettenanalyse

Daher müssen wir auch in der Lage sein, die Blockchain-Analyse bei der Verwendung von Bitcoin zu berücksichtigen. Wenn wir so vorgehen, können wir die Aggregation unserer Aktivitäten minimieren und die Auswirkungen eines Einstiegspunkts auf unsere Privatsphäre begrenzen.

Um der Blockchain-Analyse besser begegnen zu können, gibt es keinen besseren Ansatz als sich mit den Methoden der Blockchain-Analyse vertraut zu machen Wenn Sie wissen wollen, wie Sie Ihre Privatsphäre auf Bitcoin verbessern können, müssen Sie diese Methoden verstehen. Dadurch können Sie Techniken wie Coinjoin oder Payjoin (Techniken, die wir in den letzten Teilen der Schulung untersuchen werden) besser verstehen und die Fehler, die Sie machen könnten, reduzieren.

In diesem Zusammenhang können wir eine Analogie zur Kryptographie und Kryptoanalyse herstellen. Ein guter Kryptograph ist in erster Linie ein guter Kryptoanalytiker. Um einen neuen kryptografischen Algorithmus zu entwickeln, muss man wissen, welchen Angriffen er ausgesetzt sein wird, und auch untersuchen, warum frühere Algorithmen gehackt wurden. Das gleiche Prinzip gilt für den Datenschutz bei Bitcoin. Die Methoden zur Analyse der Blockchain zu verstehen, ist der Schlüssel zum Schutz vor Angriffen. Deshalb schlage ich in dieser Schulung einen ganzen Abschnitt zur Blockchain-Analyse vor.

https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/fr/tutorials/privacy/on-chain/payjoin-848b6a23-deb2-4c5f-a27e-93e2f842140f
### Die Methoden der Blockchain-Analyse

Es ist wichtig zu verstehen, dass die Blockchain-Analyse keine exakte Wissenschaft ist. Sie stützt sich auf Heuristiken, die aus früheren Beobachtungen oder logischen Interpretationen abgeleitet werden. Diese Regeln ermöglichen recht zuverlässige Ergebnisse, aber nie mit absoluter Präzision. Mit anderen Worten: **Die Blockchain-Analyse beinhaltet immer eine Wahrscheinlichkeitsdimension in den Schlussfolgerungen**. So kann man beispielsweise mit mehr oder weniger großer Sicherheit davon ausgehen, dass zwei Adressen zu ein und demselben Unternehmen gehören, aber eine absolute Gewissheit wird es immer nicht geben.

Das Hauptziel der Blockchain-Analyse besteht gerade in der Zusammenführung verschiedener Heuristiken, um das Fehlerrisiko zu minimieren. Es handelt sich gewissermaßen um eine Anhäufung von Beweisen, die es uns ermöglicht, der Realität näher zu kommen.

Diese berühmten Heuristiken lassen sich in mehrere Kategorien einteilen, die wir im Folgenden näher erläutern werden:


- Transaktionsmodelle (oder Transaktionsmodelle);**
- Interne Heuristik der Transaktion;**
- Heuristiken außerhalb der Transaktion.**

### Satoshi Nakamoto und die Blockchain-Analyse

Es sei darauf hingewiesen, dass die ersten beiden Heuristiken für die Kettenanalyse von Satoshi Nakamoto selbst entdeckt wurden. Er erörtert sie in Teil 10 des Bitcoin White Paper. Diese sind:


- die Gemeinsame Eingabeeigenschaftsheuristik (CIOH);
- und die Wiederverwendung von Adressen.

![BTC204](assets/fr/031.webp)

Quelle: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

In den folgenden Kapiteln werden wir untersuchen, was es damit auf sich hat, aber es ist schon jetzt interessant, dass diese beiden Heuristiken auch heute noch in der Kettenanalyse eine wichtige Rolle spielen.

## Transaktionsvorlagen

<chapterId>d365a101-2d37-46a5-bfb9-3c51e37bf96b</chapterId>

Ein Transaktionsmodell ist einfach ein allgemeines Muster oder eine Struktur einer typischen Transaktion, die in der Blockchain zu finden ist und deren Interpretation vermutlich bekannt ist. Bei der Untersuchung von Mustern konzentrieren wir uns auf eine einzelne Transaktion, die wir auf einer hohen Ebene analysieren.

Mit anderen Worten, wir betrachten nur die Anzahl der UTXOs in den Eingängen und die Anzahl der UTXOs in den Ausgängen, ohne uns mit den genaueren Details oder dem Umfeld der Transaktion zu befassen. Anhand des beobachteten Musters können wir die Art der Transaktion interpretieren. Wir suchen dann nach Merkmalen in ihrer Struktur und leiten daraus eine Interpretation ab.

![BTC204](assets/it/32/01.webp)

In diesem Teil werden wir gemeinsam die wichtigsten Transaktionsmuster entdecken, die bei der Kettenanalyse vorkommen können, und für jedes Muster werde ich Ihnen die wahrscheinliche Interpretation dieser Struktur zusammen mit einem konkreten Beispiel geben.

### Einfaches Versenden (oder einfache Zahlung)

Beginnen wir mit einem sehr beliebten Modell, da es in den meisten Bitcoin-Zahlungen vorkommt. Das einfache Zahlungsmodell zeichnet sich dadurch aus, dass bei den Eingängen ein oder mehrere UTXOs verbraucht und bei den Ausgängen 2 UTXOs produziert werden. Dieses Modell sieht also wie folgt aus:

![BTC204](assets/it/32/02.webp)

Wenn wir diese Transaktionsstruktur in der Blockchain identifizieren, können wir bereits eine Interpretation vornehmen. Wie der Name schon sagt, zeigt dieses Muster an, dass es sich um eine Sende- oder Zahlungstransaktion handelt. Der Nutzer hat seine UTXOs im Input verbraucht, um im Output eine Zahlungs-UTXO und eine Wechsel-UTXO (Geld, das an denselben Nutzer zurückgegeben wird) zu erfüllen.

Wir wissen also, dass der beobachtete Nutzer wahrscheinlich nicht mehr im Besitz einer der beiden Ausgangs-UTXOs (der Zahlungs-UTXO) ist, aber immer noch im Besitz der anderen UTXO (der Änderungs-UTXO).

Gegenwärtig ist es uns nicht möglich, zu spezifizieren, welcher Ausgang welchen UTXO repräsentiert, da dies nicht das Ziel der Untersuchung von Modellen ist. Wir werden dieses Ziel erreichen, indem wir uns auf die Heuristiken stützen, die wir in den folgenden Abschnitten untersuchen werden. In diesem Stadium beschränkt sich unser Ziel darauf, die Art der fraglichen Transaktion zu bestimmen, die in diesem Fall ein einfaches Senden ist.

Hier ein Beispiel für eine Bitcoin-Transaktion, bei der das einfache Sendemodell verwendet wird:

```plaintext
b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769
```

![BTC204](assets/it/32/03.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769)

Nach diesem ersten Beispiel sollten Sie besser verstehen, was es bedeutet, ein "Transaktionsmodell" zu untersuchen Wir untersuchen eine Transaktion, indem wir uns nur auf ihre Struktur konzentrieren, ohne ihr Umfeld oder transaktionsspezifische Details zu berücksichtigen. In diesem ersten Schritt betrachten wir die Transaktion nur global.

Nachdem Sie nun verstanden haben, was ein Modell ist, kommen wir zu den anderen bestehenden Modellen.

### Fegen

Dieses zweite Modell zeichnet sich dadurch aus, dass es einen einzigen UTXO als Eingang verbraucht und einen einzigen UTXO als Ausgang produziert.

![BTC204](assets/it/32/04.webp)

Die Interpretation dieses Modells ist, dass es sich um einen Auto-Transfer handelt. Der Nutzer hat seine Bitcoins an sich selbst übertragen, an eine andere Adresse, die ihm gehört. Da es bei der Transaktion keinen Restbetrag gibt, ist es sehr unwahrscheinlich, dass es sich um eine Zahlung handelt. Tatsächlich ist es bei einer Zahlung fast unmöglich, dass der Zahler über einen UTXO verfügt, der genau dem vom Verkäufer geforderten Betrag entspricht, zuzüglich der Transaktionsgebühren. Im Allgemeinen ist der Zahler daher gezwungen, einen Restbetrag auszugeben.

Daher wissen wir, dass der beobachtete Benutzer wahrscheinlich noch im Besitz dieses UTXO ist. Wenn wir im Rahmen einer Kettenanalyse wissen, dass der in der Transaktion als Eingabe verwendete UTXO Alice gehört, können wir annehmen, dass der UTXO in der Ausgabe ebenfalls ihr gehört. Später wird es interessant sein, transaktionsinterne Heuristiken zu finden, die diese Annahme stärken könnten (wir werden diese Heuristiken in Abschnitt 3.3 untersuchen).

Hier ein Beispiel für eine Bitcoin-Transaktion, die nach dem Sweeping-Modell abläuft:

```plaintext
35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d
```

![BTC204](assets/it/32/05.webp)

Quelle:[Mempool.space](https://mempool.space/fr/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d) Diese Art von Muster kann jedoch auch auf eine Selbstüberweisung auf ein Konto einer Kryptowährungsaustauschplattform hindeuten. Die Untersuchung der bekannten Adressen und des Kontexts der Transaktion wird es uns ermöglichen, zu erkennen, ob es sich um eine Konsolidierung auf eine selbstverwahrte Geldbörse oder eine Abhebung auf eine Plattform handelt. Die Adressen von Tauschplattformen sind in der Tat oft leicht identifizierbar.

Kehren wir zum Beispiel von Alice zurück: Führt die Konsolidierung zu einer bekannten Adresse einer Plattform (wie z. B. Binance), kann dies bedeuten, dass die Bitcoins aus Alices direktem Besitz transferiert wurden, wahrscheinlich in der Absicht, sie zu verkaufen oder auf dieser Plattform zu speichern. Ist die Zieladresse hingegen unbekannt, kann man davon ausgehen, dass es sich einfach um eine andere Geldbörse handelt, die Alice noch gehört. Diese Art der Untersuchung fällt jedoch eher in die Kategorie der Heuristik und nicht in die Untersuchung von Mustern.

### Konsolidierung

Dieses Modell zeichnet sich dadurch aus, dass es mehrere UTXOs als Eingang verbraucht und einen einzigen UTXO als Ausgang produziert.

![BTC204](assets/it/32/06.webp)

Die Interpretation dieses Musters ist, dass wir es mit einer Konsolidierung zu tun haben. Dies ist eine gängige Praxis unter Bitcoin-Nutzern, mehrere UTXOs in Erwartung einer möglichen Erhöhung der Transaktionsgebühren zusammenzulegen. Indem diese Operation in einer Zeit durchgeführt wird, in der die Gebühren niedrig sind, ist es möglich, bei zukünftigen Gebühren zu sparen. Wir werden mehr über diese Praxis in Kapitel 4.3 diskutieren.

Wir können daraus schließen, dass der Benutzer hinter diesem Transaktionsmodell wahrscheinlich im Besitz aller Eingabe-UTXOs war und immer noch im Besitz der Ausgabe-UTXO ist. Dies ist definitiv ein Autotransfer.

Genau wie die Konsolidierung kann diese Art von Muster auch eine Selbstüberweisung auf ein Konto einer Börsenplattform offenbaren. Erst die Untersuchung der bekannten Adressen und des Transaktionskontextes wird uns Aufschluss darüber geben, ob es sich um eine Konsolidierung auf eine selbstverwahrte Geldbörse oder eine Abhebung auf eine Plattform handelt.

Hier ein Beispiel für eine Bitcoin-Transaktion, bei der das Konsolidierungsschema angewandt wird:

```plaintext
77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94
```

![BTC204](assets/it/32/07.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)

Im Rahmen einer Kettenanalyse kann dieses Modell eine Menge Informationen offenbaren. Wenn wir zum Beispiel wissen, dass einer der Inputs zu Alice gehört, können wir davon ausgehen, dass alle anderen Inputs und Outputs dieser Transaktion zu ihr gehören. Diese Annahme würde es uns dann ermöglichen, frühere Transaktionsketten zurückzuverfolgen, um andere Transaktionen zu entdecken und zu analysieren, die wahrscheinlich mit Alice in Verbindung stehen.

![BTC204](assets/it/32/08.webp)

### Gruppierte Ausgaben

Dieses Modell ist gekennzeichnet durch den Verbrauch einiger weniger UTXOs als Input (oft nur eines) und die Produktion zahlreicher UTXOs als Output.

![BTC204](assets/it/32/09.webp)

Die Interpretation dieses Musters ist, dass wir es mit gebündelten Ausgaben zu tun haben. Dies ist eine Praxis, die wahrscheinlich auf eine bedeutende wirtschaftliche Aktivität hindeutet, wie z. B. eine Tauschplattform. Durch gebündelte Ausgaben können diese Einrichtungen Gebühren sparen, indem sie ihre Ausgaben in einer einzigen Transaktion zusammenfassen.

Aus diesem Modell lässt sich ableiten, dass der UTXO-Input von einem Unternehmen mit erheblicher wirtschaftlicher Aktivität stammt und dass die UTXO-Outputs gestreut werden. Viele werden den Kunden des Unternehmens gehören, die Bitcoin von der Plattform abgezogen haben. Andere können an Partnerunternehmen gehen. Und schließlich wird es sicherlich einen oder mehrere Umtauschvorgänge geben, die an das ausgebende Unternehmen zurückgehen.

Hier ist zum Beispiel eine Bitcoin-Transaktion, die das Modell der gruppierten Ausgaben verwendet (wahrscheinlich handelt es sich um eine Transaktion, die von der Bybit-Plattform ausgegeben wurde):

```plaintext
8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43
```

![BTC204](assets/it/32/10.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Protokollspezifische Transaktionen

Unter den Transaktionsmustern lassen sich auch Muster erkennen, die auf die Verwendung eines bestimmten Protokolls hindeuten. Whirlpool-Coinjoins (die wir in Teil 5 besprechen werden) haben beispielsweise eine leicht erkennbare Struktur, die es ermöglicht, sie von anderen, eher traditionellen Transaktionen zu unterscheiden.

![BTC204](assets/it/32/11.webp)

Die Analyse dieses Musters deutet darauf hin, dass wir es wahrscheinlich mit einer kollaborativen Transaktion zu tun haben. Es ist auch möglich, dass es sich um einen Coinjoin handelt. Sollte sich die letztgenannte Hypothese als zutreffend erweisen, könnte die Anzahl der Ausgaben eine grobe Schätzung der Anzahl der Coinjoin-Teilnehmer liefern.

Hier ein Beispiel für eine Bitcoin-Transaktion, die nach dem Modell der kollaborativen Coinjoin-Transaktion durchgeführt wird:

```plaintext
00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea
```

![BTC204](assets/it/32/12.webp)

Fonte: [Mempool.space](https://mempool.space/fr/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)

Es gibt viele andere Protokolle, die ihre eigenen spezifischen Strukturen haben. So könnte man zum Beispiel Transaktionen vom Typ Wabisabi, Briefmarken-Transaktionen oder auch Runen unterscheiden.

Dank dieser Transaktionsmodelle können wir bereits eine gewisse Menge an Informationen über eine bestimmte Transaktion interpretieren. Aber die Struktur der Transaktion ist nicht die einzige Informationsquelle für die Analyse. Wir können auch ihre Details untersuchen. Diese transaktionsinternen Details bezeichne ich als "interne Heuristiken", und wir werden sie im folgenden Kapitel untersuchen.

## Interne Heuristiken

<chapterId>c54b5abe-872f-40f4-a0d0-c59faff228ba</chapterId>

Eine interne Heuristik ist ein spezifisches Merkmal, das innerhalb einer Transaktion selbst identifiziert wird, ohne dass die Umgebung untersucht werden muss, und das uns erlaubt, Schlussfolgerungen zu ziehen. Im Gegensatz zu Modellen, die sich auf die Gesamtstruktur der Transaktion auf einer hohen Ebene konzentrieren, basieren interne Heuristiken auf der Menge der extrahierbaren Daten. Dazu gehören:


- Die Mengen der verschiedenen UTXOs in und out;
- Alles über Skripte: Empfangsadressen, Versionierung, Sperrzeiten usw.

Mit dieser Art von Heuristik können wir im Allgemeinen den Rest einer bestimmten Transaktion identifizieren. Auf diese Weise können wir eine Entität über mehrere Transaktionen hinweg weiterverfolgen. Wenn wir nämlich einen UTXO identifizieren, der einem Nutzer gehört, den wir verfolgen wollen, ist es von entscheidender Bedeutung, bei einer Transaktion festzustellen, welcher Output an einen anderen Nutzer übertragen wurde und welcher Output den Rest darstellt und somit in seinem Besitz bleibt.

![BTC204](assets/it/33/01.webp)

Ich möchte nochmals darauf hinweisen, dass diese Heuristiken keineswegs genau sind. Für sich genommen erlauben sie uns nur, plausible Szenarien zu identifizieren. Es ist die Ansammlung verschiedener Heuristiken, die dazu beiträgt, die Unsicherheit zu verringern, ohne sie jemals vollständig zu beseitigen.

### Interne Ähnlichkeiten

Bei dieser Heuristik werden die Ähnlichkeiten zwischen den Eingängen und den Ausgängen desselben Vorgangs untersucht. Wenn wir dasselbe Merkmal bei den Eingaben und nur bei einer der Ausgaben der Transaktion beobachten, dann ist es wahrscheinlich, dass diese Ausgabe den Rest ausmacht.

Das offensichtlichste Merkmal ist die Wiederverwendung einer Empfangsadresse in ein und derselben Transaktion.

![BTC204](assets/it/33/02.webp)

Diese Heuristik lässt wenig Raum für Zweifel. Sofern der private Schlüssel nicht gehackt wurde, verrät dieselbe Empfangsadresse unweigerlich die Aktivität eines einzigen Nutzers. Daraus ergibt sich die Interpretation, dass der Rest der Transaktion die Ausgabe mit derselben Adresse wie die Eingabe ist. Dies ermöglicht eine kontinuierliche Verfolgung der Person auf der Grundlage dieses Rests.

Hier ein Beispiel für eine Transaktion, auf die diese Heuristik sinnvoll angewendet werden kann:

```plaintext
54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0
```

![BTC204](assets/fr/046.webp)

Fonte: [Mempool.space](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Diese Ähnlichkeiten zwischen Eingabe und Ausgabe beschränken sich nicht auf die Wiederverwendung von Adressen. Jede Ähnlichkeit bei der Verwendung von Skripten kann die Anwendung von Heuristiken ermöglichen. Zum Beispiel kann manchmal die gleiche Versionierung zwischen einer Eingabe und einer der Transaktionsausgaben beobachtet werden.

![BTC204](assets/it/33/04.webp)

In diesem Diagramm ist zu erkennen, dass die Eingabe Nr. 0 ein P2WPKH-Skript (SegWit V0, das mit "bc1q" beginnt) freigibt. Ausgang Nr. 0 verwendet dieselbe Art von Skript. Die Ausgabe Nr. 1 verwendet jedoch ein P2TR-Skript (SegWit V1 beginnend mit "bc1p"). Die Interpretation dieses Merkmals ist, dass es wahrscheinlich ist, dass die Adresse mit der gleichen Versionierung wie die Eingabe die Adresse des Rests ist. Sie würde also immer noch zu demselben Benutzer gehören.

Hier ist eine Transaktion, auf die diese Heuristik sinnvoll angewendet werden kann:

```plaintext
db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578
```

![BTC204](assets/fr/048.webp)

Fonte: [Mempool.space](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)

In diesem Fall können wir sehen, dass Eingabe Nr. 0 und Ausgabe Nr. 1 P2WPKH-Skripte (SegWit V0) verwenden, während Ausgabe Nr. 0 einen anderen Skripttyp, P2PKH (Legacy), verwendet. In den frühen 2010er Jahren war diese auf der Skriptversion basierende Heuristik aufgrund der Beschränkung der verfügbaren Skripttypen relativ wenig hilfreich. Im Laufe der Zeit und mit den nachfolgenden Aktualisierungen von Bitcoin wurde jedoch eine zunehmende Vielfalt an Skripttypen eingeführt. Diese Heuristik wird immer relevanter, denn mit einer größeren Auswahl an Skripttypen werden die Nutzer in kleinere Gruppen unterteilt, was die Chancen erhöht, diese interne Heuristik zur Wiederverwendung von Versionen anzuwenden. Aus diesem Grund ist es allein aus Sicht des Datenschutzes ratsam, sich für den am häufigsten verwendeten Skripttyp zu entscheiden. Während ich diese Zeilen schreibe, werden beispielsweise Taproot-Skripte (`bc1p`) weniger häufig verwendet als SegWit V0-Skripte (`bc1q`). Obwohl erstere in bestimmten Kontexten wirtschaftliche und datenschutzrechtliche Vorteile bieten, kann es für traditionellere Anwendungen mit nur einer Unterschrift klug sein, aus Datenschutzgründen bei einem älteren Standard zu bleiben, bis der neue Standard weiter verbreitet ist.

### Zahlungen mit gerundeten Zahlen

Eine weitere interne Heuristik, die uns helfen kann, den Restbetrag zu ermitteln, ist die der gerundeten Zahl. Im Allgemeinen gilt bei einem einfachen Zahlungsschema (1 Eingabe und 2 Ausgaben), dass, wenn eine der Ausgaben einen gerundeten Betrag ausgibt, sie die Zahlung darstellt.

![BTC204](assets/it/33/06.webp)

Wenn eine Ausgabe eine Zahlung darstellt, steht die andere für Wechselgeld. Daraus lässt sich ableiten, dass der Benutzer, der die Transaktion eingegeben hat, wahrscheinlich noch im Besitz der als Wechselgeld identifizierten Ausgabe ist.

Es ist anzumerken, dass diese Heuristik nicht immer anwendbar ist, da die meisten Zahlungen immer noch in Fiat-Währungseinheiten getätigt werden. Wenn ein Händler in Frankreich Bitcoin annimmt, zeigt er in der Regel keine stabilen Preise in Sats an. Er entscheidet sich vielmehr für eine Umrechnung zwischen dem Preis in Euro und dem zu zahlenden Betrag in Bitcoin. Daher sollte in der Transaktionsausgabe keine gerundete Zahl erscheinen.

Ein Analytiker könnte jedoch versuchen, diese Umrechnung unter Berücksichtigung des Wechselkurses vorzunehmen, der zum Zeitpunkt der Übermittlung der Transaktion über das Netz galt. Nehmen wir das Beispiel einer Transaktion mit einem Input von 97.552 sats und zwei Outputs, einem von 31.085 sats und einem von 64.152 sats. Auf den ersten Blick scheint es sich bei dieser Transaktion nicht um gerundete Beträge zu handeln. Wendet man jedoch den Wechselkurs von 64,339 Euro zum Zeitpunkt der Transaktion an, ergibt sich eine Umrechnung in Euro, die wie folgt aussieht:


- Ein Aufwand von 62,76 €;
- Eine Leistung von 20 €;
- Eine Leistung von 41,27 €.

Nach der Umrechnung in Fiat-Währung ermöglicht diese Transaktion die Anwendung der Heuristik von Zahlungen mit gerundeten Beträgen. Die Ausgabe von 20 € war wahrscheinlich für einen Händler bestimmt oder hat anderweitig den Besitzer gewechselt. Daraus lässt sich schließen, dass die Ausgabe von 41,27 € wahrscheinlich im Besitz des ursprünglichen Nutzers blieb.

![BTC204](assets/it/33/07.webp)

Wenn Bitcoin eines Tages die bevorzugte Rechnungseinheit bei unseren Transaktionen wird, könnte diese Heuristik für die Analyse noch nützlicher werden.

Hier ein Beispiel für eine Transaktion, bei der diese Heuristik wahrscheinlich angewendet werden kann:

```plaintext
2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a
```

![BTC204](assets/fr/051.webp)

Fonte: [Mempool.space](https://mempool.space/tx/2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a)

### Der größte Output

Wenn bei einem einfachen Zahlungsmodell eine signifikant große Differenz zwischen zwei Outputs einer Transaktion besteht, kann man davon ausgehen, dass der größere Output wahrscheinlich der Rest ist.

![BTC204](assets/it/33/09.webp)

Diese Heuristik der größten Leistung ist wahrscheinlich die ungenaueste von allen. Wenn sie allein ermittelt wird, ist sie eher schwach. Dieses Merkmal kann jedoch mit anderen Heuristiken kombiniert werden, um die Unsicherheit unserer Interpretation zu verringern.

Wenn wir zum Beispiel eine Transaktion untersuchen, die eine Ausgabe mit einem runden Betrag und eine andere Ausgabe mit einem größeren Betrag hat, können wir durch die gemeinsame Anwendung der Heuristiken für runde Zahlungen und der Heuristiken für die größere Ausgabe unseren Unsicherheitsgrad verringern.

Hier ein Beispiel für eine Transaktion, bei der diese Heuristik wahrscheinlich angewendet werden kann:

```plaintext
b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf
```

![BTC204](assets/fr/053.webp)

Fonte: [Mempool.space](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Externe Heuristiken

<chapterId>4a170e3b-200d-431a-8285-18a23ff617ba</chapterId>

Bei der Untersuchung externer Heuristiken geht es um die Analyse von Ähnlichkeiten, Mustern und Merkmalen bestimmter Elemente, die der Transaktion selbst nicht innewohnend sind. Mit anderen Worten: Waren wir bisher darauf beschränkt, mit internen Heuristiken transaktionsimmanente Elemente zu nutzen, so erweitern wir nun mit externen Heuristiken unser Analysefeld auf das Umfeld der Transaktion.

### Wiederverwendung von Adressen

Dies ist eine der bekanntesten Heuristiken unter Bitcoin-Enthusiasten. Die Wiederverwendung von Adressen ermöglicht es, eine Verbindung zwischen verschiedenen Transaktionen und verschiedenen UTXOs herzustellen. Sie wird beobachtet, wenn eine Bitcoin-Empfangsadresse mehrfach verwendet wird.

So ist es möglich, die Wiederverwendung von Adressen innerhalb derselben Transaktion als interne Heuristik zu nutzen, um den Rest zu identifizieren (wie wir im vorherigen Kapitel gesehen haben). Die Adresswiederverwendung kann aber auch als externe Heuristik dienen, um die Einzigartigkeit einer Entität hinter mehreren Transaktionen zu erkennen.

Die Wiederverwendung von Adressen wird so interpretiert, dass alle an dieser Adresse gesperrten UTXOs zur selben Einheit gehören (oder gehört haben). Diese Heuristik lässt wenig Raum für Unsicherheit. Wenn sie identifiziert werden kann, entspricht die folgende Interpretation höchstwahrscheinlich der Realität. Auf diese Weise lassen sich verschiedene Onchain-Aktivitäten in Gruppen zusammenfassen.

![BTC204](assets/it/34/01.webp)

Wie in der Einleitung zu diesem Teil 3 erläutert, wurde diese Heuristik von Satoshi Nakamoto selbst entdeckt. Im Weißbuch erwähnt er ausdrücklich eine Lösung für Benutzer, um dies zu vermeiden, nämlich einfach eine neue Adresse für jede neue Transaktion zu verwenden:

"Als zusätzlicher Schutz könnte für jede Transaktion ein neues Schlüsselpaar verwendet werden, um zu verhindern, dass sie mit einem gemeinsamen Eigentümer verknüpft werden."

![BTC204](assets/fr/055.webp)

Quelle: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Hier ist zum Beispiel eine Adresse, die in mehreren Transaktionen wiederverwendet wird:

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

Quelle:[Mempool.space](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Ähnlichkeit von Skripten und Fingerabdrücken von Geldbörsen

Neben der Wiederverwendung von Adressen gibt es eine Reihe weiterer Heuristiken, um Aktien mit demselben Portfolio oder einer Gruppe von Adressen zu verknüpfen.

Zunächst einmal kann ein Analyst Ähnlichkeiten in der Skriptverwendung ausnutzen. So können beispielsweise bestimmte Minderheitsskripte wie Multisig leichter identifiziert werden als SegWit-V0-Skripte. Je größer die Gruppe ist, in der wir uns verstecken, desto schwieriger ist es, uns zu identifizieren. Aus diesem Grund verwenden in guten Coinjoin-Protokollen alle Teilnehmer genau dieselbe Art von Skripten.

Ganz allgemein kann sich ein Analyst auch auf die Fingerabdruckmerkmale eines Portfolios konzentrieren. Dabei handelt es sich um spezifische Prozesse im Zusammenhang mit der Nutzung, die man versuchen kann, zu identifizieren, um sie als Tracking-Heuristik zu nutzen. Mit anderen Worten: Wenn man eine Häufung derselben internen Merkmale bei Transaktionen beobachtet, die dem verfolgten Unternehmen zugeordnet werden, kann man versuchen, dieselben Merkmale bei anderen Transaktionen zu identifizieren.

So lässt sich beispielsweise feststellen, dass der verfolgte Nutzer seine restlichen Daten systematisch an P2TR-Adressen (`bc1p...`) sendet. Wenn sich dieser Vorgang wiederholt, kann er als Heuristik für die Fortsetzung unserer Analyse verwendet werden. Es können auch andere Fingerabdrücke verwendet werden, z. B. die Reihenfolge der UTXOs, die Platzierung der Reste in den Ausgängen, die RBF-Signalisierung (Replace-by-Fee) oder sogar die Versionsnummer, das Feld "nSequence" und das Feld "nLockTime".

Wie [@LaurentMT](https://twitter.com/LaurentMT) in [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (einem frankophonen Podcast) ausführt, nimmt der Nutzen von Wallet-Fingerprints bei der Kettenanalyse mit der Zeit erheblich zu. Die zunehmende Anzahl von Skripttypen und die immer allmählichere Einführung dieser neuen Fähigkeiten durch die Wallet-Software verstärken die Unterschiede noch weiter. Es kann sogar der Fall sein, dass man die Software, die von der zu verfolgenden Einheit verwendet wird, genau identifizieren kann. Es ist daher wichtig zu verstehen, dass die Untersuchung des digitalen Fußabdrucks einer Brieftasche sich als besonders relevant für die jüngsten Transaktionen erweist, mehr noch als für diejenigen, die in den frühen 2010er Jahren initiiert wurden.

Zusammenfassend lässt sich sagen, dass ein Fingerabdruck jede spezifische Praxis sein kann, die automatisch von der Brieftasche oder manuell vom Benutzer durchgeführt wird und die bei anderen Transaktionen gefunden werden kann, um unsere Analyse zu unterstützen.

### Die Heuristik des gemeinsamen Besitzes von Inputs (CIOH)

CIOH, die englische Abkürzung für "Common Input Ownership Heuristic", ist eine Heuristik, die besagt, dass, wenn eine Transaktion mehrere Inputs umfasst, diese wahrscheinlich von einem einzigen Unternehmen stammen. Infolgedessen ist ihr Eigentum gemeinsam.

Um die Heuristik des gemeinsamen Besitzes von Eingaben (CIOH) anzuwenden, beobachten wir zunächst eine Transaktion, die mehrere Eingaben hat. Dies können mindestens 2 und maximal 30 Eingaben sein. Sobald dieses Merkmal identifiziert ist, prüfen wir, ob die Transaktion nicht zu einem bekannten Transaktionsmodell passt. Wenn sie beispielsweise 5 Eingänge mit ungefähr gleichen Beträgen und 5 Ausgänge mit genau dem gleichen Betrag hat, wissen wir, dass es sich um die Struktur eines Coinjoin handelt. Daher können wir IOCH nicht anwenden.

Wenn die Transaktion jedoch keinem bekannten Modell einer kollaborativen Transaktion entspricht, können wir daraus schließen, dass alle Eingaben wahrscheinlich von der gleichen Entität stammen. Dies kann sehr nützlich sein, um einen bekannten Cluster zu erweitern oder die Verfolgung fortzusetzen.

CIOH wurde von Satoshi Nakamoto entdeckt. Er erörtert dies in Teil 10 des Weißbuchs:

"_[...] Verknüpfungen sind unvermeidlich bei Transaktionen mit mehreren Eingängen, die zwangsläufig offenbaren, dass ihre Eingänge demselben Eigentümer gehörten. Das Risiko besteht darin, dass, wenn der Eigentümer eines Schlüssels aufgedeckt wird, die Verknüpfungen andere Transaktionen aufdecken können, die demselben Eigentümer gehörten._"

Besonders faszinierend ist, dass Satoshi Nakamoto bereits vor dem offiziellen Start von Bitcoin die beiden wichtigsten Schwachstellen für die Privatsphäre der Nutzer identifiziert hatte, nämlich IOCH und die Wiederverwendung von Adressen. Eine solche Vorhersage ist recht bemerkenswert, da diese beiden Heuristiken bis heute die nützlichsten bei der Blockchain-Analyse sind.

Um Ihnen ein Beispiel zu geben, hier ist eine Transaktion, auf die wir wahrscheinlich IOCH anwenden können:

```plaintext
20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712
```

Fonte: [Mempool.space](https://mempool.space/tx/20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712)

### Offchain-Daten

Natürlich ist die On-Chain-Analyse nicht ausschließlich auf On-Chain-Daten beschränkt. Daten aus früheren Analysen oder aus dem Internet können ebenfalls zur Verfeinerung einer Analyse verwendet werden.

Wenn beispielsweise beobachtet wird, dass verfolgte Transaktionen systematisch von ein und demselben Bitcoin-Knoten übermittelt werden, und dessen IP-Adresse identifiziert werden kann, könnte es möglich sein, andere Transaktionen von ein und derselben Einheit zu identifizieren und einen Teil der Identität des Absenders zu ermitteln. Obwohl dies nicht einfach zu bewerkstelligen ist, da es viele Knotenpunkte erfordert, ist es möglich, dass einige Unternehmen, die sich auf die Analyse von Ketten spezialisiert haben, dieses Verfahren anwenden.

Der Analytiker hat auch die Möglichkeit, sich auf Analysen zu stützen, die zuvor als Open Source veröffentlicht wurden, oder auf seine eigenen früheren Analysen. Vielleicht lässt sich eine Ausgabe finden, die auf ein bereits identifiziertes Adresscluster hinweist. Manchmal ist es auch möglich, sich auf eine Ausgabe zu stützen, die auf eine Austauschplattform verweist, deren Adressen allgemein bekannt sind.

In ähnlicher Weise kann man eine Analyse durch Eliminierung durchführen. Wenn z. B. bei der Analyse einer Transaktion mit zwei Ausgängen einer davon mit einem bereits bekannten Adresscluster verbunden ist, der sich von der verfolgten Entität unterscheidet, dann kann man daraus schließen, dass der andere Ausgang wahrscheinlich den Rest darstellt.

Die Kettenanalyse umfasst auch einen Teil der OSINT (_Open Source Intelligence_), die bei Internetrecherchen etwas allgemeiner ist. Aus diesem Grund ist es nicht empfehlenswert, Empfangsadressen direkt in sozialen Medien oder auf einer Website zu veröffentlichen, egal ob unter einem Pseudonym oder nicht.

![BTC204](assets/fr/063.webp)

### Zeitliche Verlaufsmuster

Es wird zwar seltener in Betracht gezogen, aber bestimmte menschliche Verhaltensweisen sind auf der Kette erkennbar. Am nützlichsten für die Analyse könnte Ihr Schlafverhalten sein! Ja, wenn Sie schlafen, übermitteln Sie vermutlich keine Bitcoin-Transaktionen. Da Sie in der Regel zu denselben Zeiten schlafen, ist es üblich, bei der On-Chain-Analyse eine zeitliche Analyse durchzuführen. Dabei werden einfach die Zeiten katalogisiert, zu denen die Transaktionen einer bestimmten Einheit an das Bitcoin-Netzwerk übertragen werden. Durch die Analyse dieser zeitlichen Muster können wir eine Menge Informationen ableiten.

Zunächst einmal lässt sich durch eine zeitliche Analyse manchmal die Art des zu verfolgenden Unternehmens feststellen. Wenn beobachtet wird, dass Transaktionen durchgängig über einen Zeitraum von 24 Stunden übermittelt werden, lässt dies auf eine starke wirtschaftliche Aktivität schließen. Die hinter diesen Transaktionen stehende Einheit ist wahrscheinlich ein Unternehmen, möglicherweise international und vielleicht mit intern automatisierten Verfahren.

Zum Beispiel [hatte ich dieses Muster vor einigen Monaten erkannt](https://twitter.com/Loic_Pandul/status/1701127409712452072), als ich [die Transaktion, bei der fälschlicherweise 19 Bitcoins an Gebühren zugewiesen wurden](https://mempool.space/tx/d5392d474b4c436e1c9d1f4ff4be5f5f9bb0eb2e26b61d2781751474b7e870fd) analysierte. Eine einfache zeitliche Analyse ließ mich vermuten, dass wir es mit einem automatisierten Dienst zu tun hatten, also wahrscheinlich mit einer großen Einrichtung wie einer Börsenplattform.

Einige Tage später stellte sich heraus, dass die Gelder über die Paxos-Austauschplattform zu PayPal gehörten.

Stellt man hingegen fest, dass sich das Zeitmuster über 16 ganz bestimmte Stunden erstreckt, kann man davon ausgehen, dass es sich um einen einzelnen Nutzer oder vielleicht um ein lokales Unternehmen handelt, je nachdem, wie viel gehandelt wird.

Neben der Art der beobachteten Entität kann uns das zeitliche Modell auch einen ungefähren Standort des Nutzers durch Zeitzonen angeben. Wir können dann andere Transaktionen miteinander verknüpfen und die Zeitstempel dieser Transaktionen als zusätzliche Heuristiken verwenden, die zu unserer Analyse hinzugefügt werden können.

Bei der bereits erwähnten wiederverwendeten Adresse können wir zum Beispiel beobachten, dass sich die eingehenden und ausgehenden Transaktionen auf ein 13-Stunden-Intervall konzentrieren.

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

![BTC204](assets/fr/064.webp)

Quelle: OXT.me

Dieser Bereich entspricht wahrscheinlich Europa, Afrika oder dem Nahen Osten. Wir können daher davon ausgehen, dass der Nutzer hinter diesen Transaktionen dort lebt.

In einem anderen Register ist es auch eine solche Zeitanalyse, die die Hypothese zuließ, dass Satoshi Nakamoto nicht von Japan aus operierte, sondern tatsächlich von den Vereinigten Staaten aus: [_The Time Zones of Satoshi Nakamoto_](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

## Praktische Anwendung mit einem Block Explorer

<chapterId>6493cf2f-225c-405f-9375-c4304f1087ed</chapterId>

In diesem letzten Kapitel werden wir die Konzepte, die wir bisher studiert haben, konkret anwenden. Ich werde Beispiele für echte Bitcoin-Transaktionen präsentieren, und Sie müssen die von mir verlangten Informationen extrahieren.

Idealerweise sollte für diese Übungen ein professionelles Kettenanalyse-Tool verwendet werden. Nach der Schließung der Samourai Wallet ist das einzige kostenlose Analysetool OXT.me jedoch nicht mehr verfügbar. Daher werden wir uns für einen klassischen Block-Explorer für diese Übungen entscheiden. Ich empfehle die Verwendung von [Mempool.space](https://mempool.space/) wegen seiner vielen Funktionen und der Bandbreite an Kettenanalyse-Tools, aber Sie können auch einen anderen Explorer wie [Bitcoin Explorer](https://bitcoinexplorer.org/) wählen. Zu Beginn werde ich die Übungen vorstellen. Verwenden Sie Ihren Block-Explorer, um sie auszufüllen, und schreiben Sie Ihre Antworten auf ein Blatt Papier. Am Ende dieses Kapitels werde ich Ihnen die Antworten geben, damit Sie Ihre Ergebnisse überprüfen und korrigieren können.

die Transaktionen, die für diese Übungen ausgewählt wurden, wurden ausschließlich aufgrund ihrer Merkmale eher zufällig ausgewählt. Dieses Kapitel ist nur für Bildungs- und Informationszwecke gedacht. Ich möchte klarstellen, dass ich die Verwendung dieser Tools für böswillige Zwecke weder befürworte noch ermutige. Das Ziel ist es, Ihnen beizubringen, wie Sie sich vor Kettenanalysen schützen können, und nicht, Analysen durchzuführen, um private Informationen anderer zu enthüllen._

### Übung 1

ID der zu analysierenden Transaktion:

```plaintext
3769d3b124e47ef4ffb5b52d11df64b0a3f0b82bb10fd6b98c0fd5111789bef7
```

Wie lautet der Modellname dieser Transaktion, und welche plausiblen Interpretationen lassen sich ziehen, wenn man nur ihr Modell, d. h. die Struktur der Transaktion, betrachtet?

### Übung 2

ID der zu analysierenden Transaktion:

```plaintext
baa228f6859ca63e6b8eea24ffad7e871713749d693ebd85343859173b8d5c20
```

Wie lautet der Modellname dieser Transaktion, und welche plausiblen Interpretationen lassen sich ziehen, wenn man nur ihr Modell, d. h. die Struktur der Transaktion, betrachtet?

### Übung 3

ID der zu analysierenden Transaktion:

```plaintext
3a9eb9ccc3517cc25d1860924c66109262a4b68f4ed2d847f079b084da0cd32b
```

Was ist das Muster dieser Transaktion?

Nach der Identifizierung des Modells unter Verwendung der internen Heuristik der Transaktion, welche Ausgabe ist wahrscheinlich, um den Rest zu repräsentieren?

### Übung 4

ID der zu analysierenden Transaktion:

```plaintext
35f0b31c05503ebfdf7311df47f68a048e992e5cf4c97ec34aa2833cc0122a12
```

Was ist das Muster dieser Transaktion?

Nach der Identifizierung des Modells unter Verwendung der internen Heuristik der Transaktion, welche Ausgabe ist wahrscheinlich, um den Rest zu repräsentieren?

### Übung 5

Stellen Sie sich vor, dass Loïc eine seiner Bitcoin-Adressen im sozialen Netzwerk Twitter veröffentlicht hat, um Zahlungen zu erhalten:

![BTC204](assets/fr/065.webp)

```plaintext
bc1qja0hycrv7g9ww00jcqanhfpqmzx7luqalum3vu
```

Welche Bitcoin-Transaktionen können wir mit der Identität von Loïc verknüpfen, wenn wir **nur die Heuristik der Adresswiederverwendung** verwenden?

natürlich bin ich nicht der wirkliche Besitzer dieser Empfangsadresse und ich habe sie nicht in den sozialen Medien veröffentlicht. Es ist eine Adresse, die ich zufällig aus der Blockchain ausgewählt habe

### Übung 6

Nach Übung 5 konnten Sie mithilfe der Adresswiederverwendungsheuristik mehrere Bitcoin-Transaktionen identifizieren, an denen Loïc beteiligt zu sein scheint. Normalerweise hätten Sie unter den identifizierten Transaktionen diese eine identifizieren müssen:

Diese Transaktion ist die allererste, bei der Geld an die Adresse von Loïc gesendet wird. Was glauben Sie, woher die Bitcoins stammen, die Loïc durch diese Transaktion erhalten hat?

### Übung 7

Nach Übung 5 konnten Sie mithilfe der Adresswiederverwendungsheuristik mehrere Bitcoin-Transaktionen identifizieren, an denen Loïc beteiligt zu sein scheint. Sie möchten nun herausfinden, woher Loïc kommt. Führen Sie auf der Grundlage der gefundenen Transaktionen eine Zeitanalyse durch, um die wahrscheinliche Zeitzone von Loïc zu ermitteln. Bestimmen Sie anhand dieser Zeitzone den Ort, an dem Loïc zu leben scheint (Land, Staat/Region, Stadt...).

### Übung 8

Hier ist die Bitcoin-Transaktion zu sehen:

```plaintext
bb346dae645d09d32ed6eca1391d2ee97c57e11b4c31ae4325bcffdec40afd4f
```

Welche Informationen können wir interpretieren, wenn wir nur diese Transaktion betrachten?

### Lösungen zu den Übungen

**_Übung 1:_**

Das Modell dieser Transaktion ist das einer einfachen Zahlung. Wenn wir nur seine Struktur untersuchen, können wir interpretieren, dass ein Ausgang eine Veränderung und der andere Ausgang eine tatsächliche Zahlung darstellt. Wir wissen dann, dass der beobachtete Nutzer wahrscheinlich nicht mehr im Besitz einer der beiden UTXOs in den Ausgängen ist (die für die Zahlung), aber immer noch im Besitz der anderen UTXO (die für das Wechselgeld).

**_Übung 2:_**

Bei dieser Transaktion handelt es sich um eine Sammelausgabe. Dieses Muster deutet wahrscheinlich auf eine bedeutende wirtschaftliche Aktivität hin, wie z. B. eine Austauschplattform. Wir können daraus schließen, dass der Eingangs-UTXO von einem Unternehmen mit einer bedeutenden wirtschaftlichen Aktivität stammt und dass die Ausgangs-UTXOs sich verteilen werden. Einige werden den Kunden des Unternehmens gehören, die ihre Bitcoins in selbstverwahrende Wallets abgehoben haben. Andere können an Partnerunternehmen gehen. Schließlich wird sicherlich ein Rest an das ausgebende Unternehmen zurückfließen.

**_Übung 3:_**

Das Modell dieser Transaktion ist das einer einfachen Zahlung. Daher können wir interne Heuristiken auf die Transaktion anwenden, um zu versuchen, den Rest zu identifizieren.

Ich persönlich habe mindestens zwei interne Heuristiken identifiziert, die die gleiche Hypothese unterstützen:


- Die Wiederverwendung desselben Skripttyps;
- Größter Output.

Die offensichtlichste Heuristik ist die Wiederverwendung desselben Skripttyps. In der Tat ist die Ausgabe "0" ein "P2SH", erkennbar an der Empfangsadresse, die mit "3" beginnt:

```plaintext
3Lcdauq6eqCWwQ3UzgNb4cu9bs88sz3mKD
```

Der Ausgang `1` ist ein `P2WPKH`, erkennbar an seiner mit `bc1q` beginnenden Adresse:

```plaintext
bc1qya6sw6sta0mfr698n9jpd3j3nrkltdtwvelywa
```

Das UTXO, das als Eingabe für diese Transaktion verwendet wird, verwendet auch ein "P2WPKH"-Skript:

```plaintext
bc1qyfuytw8pcvg5vx37kkgwjspg73rpt56l5mx89k
```

Wir können also davon ausgehen, dass Ausgang "0" einer Zahlung entspricht und Ausgang "1" der Rest der Transaktion ist, was bedeuten würde, dass der Eingangsnutzer immer noch Eigentümer des Ausgangs "1" ist.

Um diese Hypothese zu stützen oder zu widerlegen, können wir nach anderen Heuristiken suchen, die unser Denken bestätigen oder die Wahrscheinlichkeit verringern, dass unsere Hypothese richtig ist.

Ich habe mindestens eine weitere Heuristik identifiziert. Es ist die größte Ausgabe. Die Ausgabe "0" misst "123.689 Sats", während die Ausgabe "1" "505.839 Sats" misst. Es besteht also ein erheblicher Unterschied zwischen diesen beiden Ausgaben. Die Heuristik der größeren Ausgabe legt nahe, dass die umfangreichere Ausgabe wahrscheinlich der Rest ist. Diese Heuristik bestärkt also unsere ursprüngliche Hypothese weiter.

Es scheint wahrscheinlich, dass der Benutzer, der die Eingabe UTXO zur Verfügung gestellt hat, immer noch die Ausgabe `1` besitzt, die den Rest der Transaktion zu repräsentieren scheint.

**_Übung 4:_**

Das Modell dieser Transaktion ist das einer einfachen Zahlung. Daher können wir interne Heuristiken auf die Transaktion anwenden, um zu versuchen, den Rest zu identifizieren.

Ich persönlich habe mindestens zwei interne Heuristiken identifiziert, die die gleiche Hypothese unterstützen:


- Die Wiederverwendung desselben Skripttyps;
- Die Ausgabe eines runden Betrags.

Die offensichtlichste Heuristik ist die Wiederverwendung desselben Skripttyps. In der Tat ist die Ausgabe "0" ein "P2SH", erkennbar an der Empfangsadresse, die mit "3" beginnt:

```plaintext
3FSH5Mnq6S5FyQoKR9Yjakk3X4KCGxeaD4
```

Der Ausgang `1` ist ein `P2WPKH`, erkennbar an seiner mit `bc1q` beginnenden Adresse:

```plaintext
bc1qvdywdcfsyavt4v8uxmmrdt6meu4vgeg439n7sg
```

Das UTXO, das als Eingabe für diese Transaktion verwendet wird, verwendet auch ein "P2WPKH"-Skript:

```plaintext
bc1qku3f2y294h3ks5eusv63dslcua2xnlzxx0k6kp
```

Wir können also davon ausgehen, dass der Ausgang "0" einer Zahlung entspricht und der Ausgang "1" der Rest der Transaktion ist, was bedeuten würde, dass der Eingangsnutzer immer noch den Ausgang "1" besitzt.

Um diese Hypothese zu stützen oder zu widerlegen, können wir nach anderen Heuristiken suchen, die unser Denken bestätigen oder die Wahrscheinlichkeit verringern, dass unsere Hypothese richtig ist.

Ich habe mindestens eine weitere Heuristik identifiziert. Es ist die Ausgabe eines runden Betrags. Die Ausgabe "0" misst "70.000 sats", während die Ausgabe "1" "22.962 sats" misst. Wir haben es also mit einer vollkommen runden Ausgabe in BTC-Rechnungseinheiten zu tun. Die Heuristik der runden Ausgabe legt nahe, dass die UTXO mit einem runden Betrag wahrscheinlich die Zahlung ist, und durch Eliminierung stellt die andere den Rest dar. Diese Heuristik untermauert also unsere Ausgangshypothese.

In diesem Beispiel könnte jedoch eine andere Heuristik unsere ursprüngliche Annahme in Frage stellen. In der Tat ist die Ausgabe "0" größer als die Ausgabe "1". Wenn wir uns auf die Heuristik stützen, dass die größte Ausgabe im Allgemeinen der Rest ist, könnten wir daraus schließen, dass die Ausgabe "0" der Rest ist. Diese Gegenhypothese erscheint jedoch unplausibel, da die beiden anderen Heuristiken wesentlich überzeugender erscheinen als die Heuristik der größten Ausgabe. Folglich scheint es vernünftig, unsere ursprüngliche Hypothese trotz dieses scheinbaren Widerspruchs beizubehalten.

Daher ist es wahrscheinlich, dass der Benutzer, der den UTXO als Eingabe zur Verfügung gestellt hat, immer noch die Ausgabe "1" besitzt, die den Rest der Transaktion zu repräsentieren scheint.

**_Übung 5:_**

Wir sehen, dass 8 Transaktionen mit der Identität von Loïc in Verbindung gebracht werden können. Davon beinhalten 4 den Erhalt von Bitcoin:

```plaintext
2d9575553c99578268ffba49a1b2adc3b85a29926728bd0280703a04d051eace
8b70bd322e6118b8a002dbdb731d16b59c4a729c2379af376ae230cf8cdde0dd
d5864ea93e7a8db9d3fb113651d2131567e284e868021e114a67c3f5fb616ac4
bc4dcf2200c88ac1f976b8c9018ce70f9007e949435841fc5681fd33308dd762
```

Bei den anderen 4 geht es um das Versenden von Bitcoin:

```plaintext
8b52fe3c2cf8bef60828399d1c776c0e9e99e7aaeeff721fff70f4b68145d540
c12499e9a865b9e920012e39b4b9867ea821e44c047d022ebb5c9113f2910ed6
a6dbebebca119af3d05c0196b76f80fdbf78f20368ebef1b7fd3476d0814517d
3aeb7ce02c35eaecccc0a97a771d92c3e65e86bedff42a8185edd12ce89d89cc
```

**_Übung 6:_**

Wenn wir das Muster dieser Transaktion untersuchen, ist es offensichtlich, dass es sich um eine gebündelte Ausgabe handelt. In der Tat hat die Transaktion einen einzigen Input und 51 Outputs, was auf eine bedeutende wirtschaftliche Aktivität hindeutet. Wir können daher davon ausgehen, dass Loïc eine Bitcoin-Abhebung von einer Tauschplattform vorgenommen hat.

Mehrere Elemente untermauern diese Hypothese. Erstens handelt es sich bei dem Skript, das zum Schutz der UTXO-Eingabe verwendet wird, um ein P2SH-Multisig-2/3-Skript, was auf ein für Börsenplattformen typisches hohes Sicherheitsniveau hinweist:

```plaintext
OP_PUSHNUM_2
OP_PUSHBYTES_33 03eae02975918af86577e1d8a257773118fd6ceaf43f1a543a4a04a410e9af4a59
OP_PUSHBYTES_33 03ba37b6c04aaf7099edc389e22eeb5eae643ce0ab89ac5afa4fb934f575f24b4e
OP_PUSHBYTES_33 03d95ef2dc0749859929f3ed4aa5668c7a95baa47133d3abec25896411321d2d2d
OP_PUSHNUM_3
OP_CHECKMULTISIG
```

Darüber hinaus wurde die analysierte Adresse "3PUv9tQMSDCEPSMsYSopA5wDW86pwRFbNF" in mehr als 220.000 verschiedenen Transaktionen wiederverwendet, was häufig für Tauschplattformen charakteristisch ist, die sich im Allgemeinen keine Sorgen um ihre Privatsphäre machen. Zeitliche Heuristiken, die auf diese Adresse angewandt wurden, zeigen auch eine regelmäßige Verteilung von Transaktionen fast täglich über einen Zeitraum von drei Monaten, mit ausgedehnten Stunden über 24 Stunden, was auf die kontinuierliche Aktivität einer Tauschplattform hindeutet.

Schließlich sind die von diesem Unternehmen verarbeiteten Volumina enorm. Tatsächlich hat die Adresse zwischen Dezember 2022 und März 2023 bei 222.262 Transaktionen 44 BTC empfangen und versendet. Diese beträchtlichen Volumina bestätigen die wahrscheinliche Natur der Aktivität einer Austauschplattform.

**_Übung 7:_**

Die Analyse der Transaktionsbestätigungszeiten ergibt die folgenden UTC-Zeiten:

```plaintext
05:43
20:51
18:12
17:16
04:28
23:38
07:45
21:55
```

Die Analyse dieser Zeiten zeigt, dass die Zeitzonen UTC-7 und UTC-8 in den meisten Fällen mit den üblichen menschlichen Aktivitäten (zwischen 8.00 und 23.00 Uhr) übereinstimmen:

```plaintext
05:43 UTC > 22:43 UTC-7
20:51 UTC > 13:51 UTC-7
18:12 UTC > 11:12 UTC-7
17:16 UTC > 10:16 UTC-7
04:28 UTC > 21:28 UTC-7
23:38 UTC > 16:38 UTC-7
07:45 UTC > 00:45 UTC-7
21:55 UTC > 14:55 UTC-7
05:43 UTC > 21:43 UTC-8
20:51 UTC > 12:51 UTC-8
18:12 UTC > 10:12 UTC-8
17:16 UTC > 09:16 UTC-8
04:28 UTC > 20:28 UTC-8
23:38 UTC > 15:38 UTC-8
07:45 UTC > 23:45 UTC-8
21:55 UTC > 13:55 UTC-8
```

Die Zeitzone UTC-7 ist besonders im Sommer von Bedeutung, da sie Staaten und Regionen wie z. B. die Niederlande umfasst:


- Kalifornien (mit Städten wie Los Angeles, San Francisco und San Diego);
- Nevada (mit Las Vegas);
- Oregon (mit Portland);
- Washington (mit Seattle);
- Die kanadische Region British Columbia (mit Städten wie Vancouver und Victoria).

Diese Informationen legen nahe, dass Loïc möglicherweise an der Westküste der Vereinigten Staaten oder in Kanada wohnt.

**_Übung 8:_**

Die Analyse dieser Transaktion zeigt 5 Eingänge und einen einzigen Ausgang, was auf eine Konsolidierung hinzudeuten scheint. Die Anwendung der CIOH-Heuristik deutet darauf hin, dass alle UTXOs in den Eingängen von einer einzigen Einheit gehalten werden und dass der UTXO im Ausgang ebenfalls zu dieser Einheit gehört. Es scheint, dass der Benutzer mehrere UTXOs, die ihm gehören, in einem einzigen UTXO in der Ausgabe konsolidieren wollte, um seine eigenen Münzen zu konsolidieren. Dieses Vorgehen war wahrscheinlich durch den Wunsch motiviert, die derzeit niedrigen Transaktionsgebühren auszunutzen, um künftige Gebühren zu senken.

---
bei der Abfassung dieses Teils 3 über die Kettenanalyse habe ich mich auf folgende Quellen gestützt:_


- die vierteilige Serie mit dem Titel: [Understanding Bitcoin Privacy with OXT] (https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923), produziert von Samourai Wallet im Jahr 2021
- die verschiedenen Berichte von [OXT Research] (https://medium.com/oxt-research) sowie deren kostenloses Kettenanalyse-Tool (das nach der Verhaftung der Gründer von Samourai Wallet derzeit nicht mehr verfügbar ist)
- im Allgemeinen stammt mein Wissen aus den verschiedenen Tweets und Inhalten von [@LaurentMT] (https://twitter.com/LaurentMT) und [@ErgoBTC] (https://twitter.com/ErgoBTC)
- \_Das [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji), an dem ich zusammen mit [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene\_\_](https://twitter.com/Sosthene___) und [@LaurentMT](https://twitter.com/LaurentMT) teilnahm.\_

ich möchte ihren Autoren, Entwicklern und Produzenten danken. Mein Dank gilt auch den Gutachtern, die den Artikel, der als Grundlage für diesen Teil 3 diente, akribisch korrigiert und mich mit ihrem fachkundigen Rat beehrt haben:_


- [Gilles Cadignan] (https://twitter.com/gillesCadignan);_
- _[Ludovic Lars](https://viresinnumeris.fr/)._

# Bewährte Praktiken zum Schutz Ihrer Privatsphäre beherrschen

<partId>9bd04b63-f1af-4e50-9061-6bc90009df68</partId>

## Wiederverwendung von Adressen

<chapterId>f3e97645-3df3-41bc-a4ed-d2c740113d96</chapterId>

Nachdem wir die Techniken untersucht haben, die Ihre Privatsphäre bei Bitcoin gefährden können, werden wir in diesem dritten Teil nun die besten Praktiken untersuchen, die Sie anwenden können, um sich zu schützen. Dieser Teil zielt nicht darauf ab, Methoden zur Verbesserung der Privatsphäre zu erforschen, ein Thema, das später behandelt wird, sondern vielmehr zu verstehen, wie man richtig mit Bitcoin interagiert, um die Privatsphäre zu erhalten, die es von Natur aus bietet, ohne auf zusätzliche Techniken zurückzugreifen.

Zu Beginn dieses dritten Teils werden wir natürlich über die Wiederverwendung von Adressen sprechen. Dieses Phänomen ist die größte Bedrohung für die Privatsphäre der Nutzer. Daher ist dieses Kapitel wahrscheinlich das wichtigste des gesamten Kurses.

### Was ist eine Empfangsadresse?

Eine Bitcoin-Empfangsadresse ist eine Zeichenfolge oder eine Kennung, die verwendet wird, um Bitcoin in eine Geldbörse zu empfangen.

Technisch gesehen "empfängt" eine Bitcoin-Empfangsadresse keine Bitcoins im wörtlichen Sinne, sondern definiert vielmehr die Bedingungen, unter denen Bitcoins ausgegeben werden können. Wenn eine Zahlung an Sie gesendet wird, erstellt die Transaktion des Absenders aus den UTXOs, die er in den Eingängen verbraucht hat, einen neuen UTXO, der für Sie bestimmt ist, in der Ausgabe. Auf diesen Output wird ein Skript angewendet, das festlegt, wie dieser UTXO später ausgegeben werden kann. Dieses Skript wird als "_ScriptPubKey_" oder "_Locking Script_" bezeichnet Ihre Empfangsadresse, genauer gesagt ihre Nutzlast, ist in dieses Skript eingebettet. Vereinfacht ausgedrückt, besagt dieses Skript im Wesentlichen:

> "Um diese neue UTXO auszugeben, muss eine digitale Signatur mit dem privaten Schlüssel, der mit dieser Empfangsadresse verbunden ist, bereitgestellt werden."
![BTC204](assets/fr/067.webp)

Bitcoin-Adressen gibt es je nach verwendetem Skript-Modell in verschiedenen Ausführungen. Die ersten Modelle, bekannt als "_Legacy_", beinhalten `P2PKH` (_Pay-to-PubKey-Hash_) und `P2SH` (_Pay-to-Script-Hash_) Adressen. P2PKH-Adressen beginnen immer mit "1" und P2SH mit "3". Obwohl diese Formate immer noch sicher sind, sind sie inzwischen veraltet, da sie höhere Transaktionsgebühren verursachen und weniger Datenschutz bieten als die neuen Standards.

SegWit V0 (`P2WPKH` und `P2WSH`) und Taproot / SegWit V1 (`P2TR`) Adressen sind moderne Formate. SegWit-Adressen beginnen mit "bc1q" und Taproot-Adressen, die 2021 eingeführt wurden, beginnen mit "bc1p".

Hier ist zum Beispiel eine Taproot-Empfangsadresse:

```text
bc1ps5gd2ys8kllz9alpmcwxqegn7kl3elrpnnlegwkm3xpq2h8da07spxwtf5
```

Wie der ScriptPubKey aufgebaut ist, hängt von dem von Ihnen verwendeten Standard ab:

| Skriptvorlage | ScriptPubKey || ---------------- | ----------------------------------------------------------- | ----------------------------------------------------------- |

| P2PKH | OP_DUP OP_HASH160 `<pubKeyHash>` OP_EQUALVERIFY OP_CHECKSIG |

| P2SH | OP_HASH160 `<scriptHash>` OP_EQUAL |

| P2WPKH | 0 `<pubKeyHash>` |

| P2WSH | 0 `<witnessScriptHash>` |

| P2SH - P2WPKH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2SH - P2WSH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |

| P2TR | 1 `<pubKey>` |

Der Aufbau der Empfangsadressen hängt ebenfalls von der gewählten Skriptvorlage ab:


- Bei "P2PKH"- und "P2WPKH"-Adressen stellt die Nutzlast, also der Kern der Adresse, den Hash des öffentlichen Schlüssels dar;
- Bei den Adressen `P2SH` und `P2WSH` stellt die Nutzlast den Hash eines Skripts dar;
- Wie bei "P2TR"-Adressen ist die Nutzlast ein modifizierter öffentlicher Schlüssel. Die `P2TR'-Ausgaben kombinieren Aspekte von _Pay-to-PubKey_ und _Pay-to-Script_. Der modifizierte öffentliche Schlüssel ist das Ergebnis des Hinzufügens eines klassischen öffentlichen Schlüssels zum Ausgeben mit einer "Modifikation", die von der Merkle-Wurzel einer Reihe von Skripten abgeleitet ist, die auch zum Ausgeben von Bitcoin verwendet werden können.

![BTC204](assets/it/67/01.webp)

Die in Ihrer Wallet-Software angezeigten Adressen enthalten auch einen HRP (_Human-Readable Part_), typischerweise `bc` für Post-SegWit-Adressen, ein Trennzeichen `1` und eine Versionsnummer `q` für SegWit V0 und `p` für Taproot/SegWit V1. Außerdem wird eine Prüfsumme hinzugefügt, um die Integrität und Gültigkeit der Adresse während der Übertragung sicherzustellen.

Schließlich werden die Adressen in ein Standardformat gebracht:


- Base58check für alte Legacy-Adressen;
- Bech32 für SegWit-Adressen;
- Bech32m für Taproot-Adressen.

Hier ist die Additionsmatrix für die Formate bech32 und bech32m (SegWit und Taproot) zur Basis 10:

| + | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |

| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| 0 | q | p | z | r | y | 9 | x | 8 | 8

| 8 | g | f | 2 | t | v | d | w | 0 |

| 16 | s | 3 | j | n | 5 | 4 | k | h | | 24 | c | e | 6 | m | u | a | 7 | l | l

### Was ist Adresswiederverwendung?

Die Wiederverwendung von Adressen bezieht sich auf die Praxis, dieselbe Empfangsadresse zum Blockieren verschiedener UTXOs zu verwenden.

Wie wir im vorigen Abschnitt gesehen haben, hat jedes UTXO seinen eigenen ScriptPubKey, der es sperrt und erfüllt sein muss, damit das UTXO als Eingabe in einer neuen Transaktion verwendet werden kann. In diesen ScriptPubKey sind die Empfangsadressen (Payloads) eingebettet.

Wenn mehrere ScriptPubKeys dieselbe Empfangsadresse enthalten, wird dies als Adresswiederverwendung bezeichnet. In der Praxis bedeutet dies, dass ein Nutzer dieselbe Adresse mehrfach an Absender weitergegeben hat, um durch mehrere Zahlungen Bitcoin zu erhalten. Und in der Tat ist diese Praxis katastrophal für Ihre Privatsphäre.

### Warum ist die Wiederverwendung von Adressen ein Problem?

Da die Blockchain öffentlich ist, ist leicht zu erkennen, welche Adressen welche UTXOs blockieren und wie viele Bitcoins. Wenn dieselbe Adresse für mehrere Transaktionen verwendet wird, kann man daraus schließen, dass alle Bitcoins, die mit dieser Adresse verbunden sind, ein und derselben Person gehören. Diese Praxis gefährdet die Privatsphäre der Nutzer, da sie es ermöglicht, deterministische Verbindungen zwischen verschiedenen Transaktionen herzustellen und Bitcoins in der Blockchain zu verfolgen. Satoshi Nakamoto selbst hat dieses Problem im Bitcoin-Weißbuch hervorgehoben:

> als zusätzliche Firewall könnte für jede Transaktion ein neues Schlüsselpaar verwendet werden, um zu verhindern, dass sie mit einem gemeinsamen Eigentümer verknüpft werden
![BTC204](assets/fr/055.webp)

Quelle: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Das Ziel, das Satoshi mit dieser Aussage verfolgte, war es, eine zusätzliche Firewall für den Fall zu schaffen, dass die Identität des Nutzers mit einem Schlüsselpaar auf Bitcoin in Verbindung gebracht wird, um zu vermeiden, dass alle seine Aktivitäten öffentlich mit seiner Identität verknüpft werden. Heute, mit der Verbreitung von Blockchain-Analyseunternehmen und KYC-Vorschriften, ist die Verwendung von eindeutigen Adressen keine "zusätzliche Firewall" mehr, sondern eine notwendige Praxis für jeden, der seine Privatsphäre auf ein Minimum beschränken möchte.

Wenn Sie eine Adresse wiederverwenden, stellen Sie eine fast unbestreitbare Verbindung zwischen allen mit dieser Adresse verbundenen Transaktionen her. Dies gefährdet zwar nicht direkt Ihr Geld, da die Verschlüsselung mit elliptischen Kurven die Sicherheit Ihrer privaten Schlüssel gewährleistet, aber es erleichtert die Überwachung Ihrer Aktivitäten. Tatsächlich kann jeder, der über einen Node verfügt, Ihre Transaktionen und Ihr Adressguthaben beobachten, wodurch Ihre Anonymität vollständig gefährdet wird.

![BTC204](assets/it/34/01.webp)

Zur Veranschaulichung dieses Punktes nehmen wir das Beispiel von Bob, einem Nutzer, der regelmäßig Bitcoins in kleinen Beträgen über Dollar Cost Averaging (DCA) kauft und sie immer an dieselbe Adresse schickt. Nach zwei Jahren enthält diese Adresse eine beträchtliche Menge an Bitcoin. Wenn Bob diese Adresse verwendet, um eine Zahlung an einen lokalen Händler vorzunehmen, könnte der Händler alle damit verbundenen Gelder sehen und Bobs Vermögen abziehen. Dies könnte zu persönlichen Sicherheitsrisiken führen, einschließlich Diebstahls- oder Erpressungsversuchen. Hätte Bob für jeden regelmäßigen Kauf eine neue Adresse verwendet, hätte er seinem Händler unendlich viel weniger Informationen preisgegeben.

Bei der Kettenanalyse unterscheiden wir zwischen 2 Arten der Adresswiederverwendung:


- Externe Wiederverwendung;
- Interne Wiederverwendung innerhalb einer Transaktion.

Die erste wird beobachtet, wenn eine Adresse in mehreren verschiedenen Bitcoin-Transaktionen wiederverwendet wird. Das haben wir bereits besprochen: Diese Heuristik erlaubt es uns zu folgern, dass alle UTXOs, die über diese Adresse geleitet werden, zu einer einzigen Entität gehören.

Die Wiederverwendung interner Adressen wird nicht beobachtet, wenn die Wiederverwendung über mehrere Transaktionen hinweg erfolgt, sondern wenn sie innerhalb ein und derselben Transaktion stattfindet. Wenn nämlich dieselbe Adresse, die zum Sperren einer Eingabe verwendet wurde, als Ausgabe in einer Transaktion verwendet wird, können wir daraus schließen, dass diese Ausgabe immer noch demselben Benutzer (Rest) gehört und dass die zweite Ausgabe die eigentliche Zahlung darstellt. Mit dieser anderen Heuristik können Gelder über mehrere Transaktionen hinweg nachverfolgt werden.

![BTC204](assets/it/33/02.webp)

Die Wiederverwendung von Adressen ist eine echte Geißel für Bitcoin. Laut der (derzeit nicht zugänglichen) Website OXT.me lag die Gesamtrate der Adresswiederverwendung bei Bitcoin im Jahr 2022 bei etwa 52 Prozent:

![BTC204](assets/fr/069.webp)

Dieser Anteil ist enorm, aber er stammt überwiegend von Tauschbörsen und nicht von einzelnen Nutzern.

### Wie lässt sich die Wiederverwendung von Adressen vermeiden?

Die Vermeidung der Wiederverwendung von Adressen ist ganz einfach: **Verwenden Sie einfach eine neue Adresse für jeden neuen Zahlungseingang in Ihrer Brieftasche**.

Dank BIP32 sind moderne Portfolios jetzt deterministisch und hierarchisch. Das bedeutet, dass ein Nutzer eine große Anzahl von Adressen aus einer einzigen Ausgangsinformation generieren kann: dem Seed. Durch die Speicherung dieser einzigen Information können alle privaten Schlüssel in der Brieftasche wiederhergestellt werden, wodurch der Zugriff auf die durch die entsprechenden Adressen gesicherten Mittel möglich wird.

![BTC204](assets/fr/070.webp)

Deshalb wird Ihnen jedes Mal, wenn Sie in Ihrer Wallet-Software die Schaltfläche "_empfangen_" drücken, eine unbenutzte Empfangsadresse angeboten. Nach dem Empfang von Bitcoin an dieser Adresse schlägt die Software automatisch eine neue Adresse vor.

> pS: Kürzlich haben einige Geldbörsen-Software ihre Absicht bekannt gegeben, keine leeren Adressen mehr zu generieren, da sie befürchten, dass dies von den Behörden als eine Form der Geldwäsche angesehen werden könnte. Wenn Ihre Software dazugehört, rate ich Ihnen dringend, sie sofort zu ersetzen, da dies für den Benutzer nicht akzeptabel ist
Wenn Sie eine statische Kennung für den Empfang von Zahlungen benötigen, z. B. um Spenden zu erhalten, ist die Verwendung einer klassischen Bitcoin-Adresse wegen des Risikos der Wiederverwendung nicht zu empfehlen. Sie ziehen es vor, eine Lightning-Adresse zu verwenden, oder für einen statischen Onchain-Zahlungsidentifikator können Sie sich für BIP47 oder Silent Payments entscheiden. Wie diese Protokolle funktionieren, wird in Teil 6 dieser Schulung beschrieben.

## Etikettierung und Kontrolle von Münzen

<chapterId>fbdb07cd-c025-48f2-97b0-bd1bc21c68a8</chapterId>

Wie wir im Abschnitt über die Kettenanalyse festgestellt haben, gibt es eine Vielzahl von Heuristiken und Mustern, die verwendet werden können, um Informationen über eine Transaktion abzuleiten. Als Nutzer ist es wichtig, sich dieser Techniken bewusst zu sein, um sich besser schützen zu können.

Dazu gehört eine strikte Verwaltung der eigenen Wallet in persönlicher Obhut, was die Kenntnis der Herkunft der eigenen UTXOs sowie eine sorgfältige Auswahl der UTXOs, die bei Zahlungen verbraucht werden, einschließt. Dieses effektive Wallet-Management beruht auf zwei wichtigen Merkmalen guter Bitcoin-Wallets: Kennzeichnung und Münzkontrolle.

In diesem Kapitel werden wir diese Funktionen untersuchen und sehen, wie Sie sie intelligent nutzen können, ohne zu viel Arbeitsaufwand zu verursachen, um Ihre Privatsphäre auf Bitcoin zu optimieren.

### Was ist Etikettierung?

Tagging ist eine Praxis, bei der einem bestimmten UTXO in einer Bitcoin-Wallet ein Vermerk oder Label zugewiesen wird. Diese Anmerkungen werden lokal von der Wallet-Software gespeichert und werden niemals über das Bitcoin-Netzwerk übertragen. Tagging ist somit ein Werkzeug zur persönlichen Verwaltung.

Wenn ich zum Beispiel einen UTXO aus einem P2P-Kauf auf Bisq mit Charles besitze, könnte ich ihm die Bezeichnung "Non-KYC Bisq Charles" zuweisen.

Tagging ist eine gute Praxis, die dabei hilft, sich an den Ursprung oder das vorgesehene Ziel eines UTXO zu erinnern, wodurch die Verwaltung von Geldern erleichtert und die Privatsphäre optimiert wird. Ihre Bitcoin-Brieftasche wird wahrscheinlich mehrere UTXOs enthalten. Wenn die Quellen dieser UTXOs unterschiedlich sind, möchten Sie diese UTXOs in Zukunft vielleicht nicht zusammenführen, da Sie sonst ihren gemeinsamen Besitz preisgeben könnten. Indem Sie alle Ihre Münzen ordnungsgemäß kennzeichnen, stellen Sie sicher, dass Sie sich an ihre Herkunft erinnern, wenn Sie sie brauchen, auch wenn das erst in einigen Jahren der Fall sein wird.

### Was ist Münzkontrolle?

Die aktive Nutzung des Tagging wird noch attraktiver, wenn sie mit der Münzkontrolloption in Ihrer Brieftaschensoftware kombiniert wird.

Die Münzkontrolle ist eine Funktion, die in guter Bitcoin-Wallet-Software zu finden ist und Ihnen die Möglichkeit gibt, bestimmte UTXOs manuell auszuwählen, die Sie als Input für eine Transaktion verwenden können. Um eine ausgehende Zahlung zu erfüllen, müssen Sie im Gegenzug einen eingehenden UTXO verbrauchen. Aus verschiedenen Gründen, die wir später noch erläutern werden, möchten Sie vielleicht genau auswählen, welche Münzen Sie als Input für eine bestimmte Zahlung verwenden möchten. Genau das ist mit der Münzkontrolle möglich. Um Ihnen eine Analogie zu geben, ist diese Funktion vergleichbar mit der Auswahl einer bestimmten Münze in Ihrer Brieftasche, wenn Sie Ihr Baguette bezahlen.

Die Verwendung einer münzgesteuerten Wallet-Software in Verbindung mit der Kennzeichnung von UTXOs ermöglicht es den Benutzern, UTXOs für ihre Transaktionen genau zu unterscheiden und auszuwählen.

### Wie kennzeichne ich meine UTXOs richtig?

Es gibt keine universelle Methode zur Kennzeichnung von UTXOs, die für alle geeignet ist. Es liegt an Ihnen, ein Kennzeichnungssystem festzulegen, mit dem Sie sich in Ihrem Portfolio leicht zurechtfinden können. In jedem Fall sollten Sie bedenken, dass eine gute Kennzeichnung das ist, was Sie verstehen können, wenn Sie es brauchen. Wenn Ihre Bitcoin-Brieftasche in erster Linie zum Sparen gedacht ist, kann es sein, dass die Beschriftung erst in einigen Jahrzehnten für Sie nützlich sein wird. Stellen Sie daher sicher, dass sie klar, genau und umfassend sind.

Es ist wichtig, dass Ihre Angehörigen die Quelle der Gelder leicht identifizieren können, wenn sie eines Tages Zugang zu Ihrem Portfolio benötigen. Dies könnte ihnen aus Gründen der Privatsphäre und aus rechtlichen Gründen helfen, wenn sie die Herkunft der Gelder vor einer Behörde rechtfertigen müssen.

Der wichtigste Aspekt bei der Kennzeichnung ist die Angabe der Herkunft des UTXO. Sie sollten einfach angeben, wie diese Münze in Ihr Portemonnaie gelangt ist. Stammt er von einem Kauf auf einer Börsenplattform? Eine Zahlung von einem Kunden? Ein Peer-to-Peer-Austausch? Oder handelt es sich um den Restbetrag eines Kaufs? Sie könnten also angeben:


- abholbörse.com";
- zahlungskunde David";
- p2P-Charles kaufen";
- vom Sofakauf zurücktreten"

Um Ihre Verwaltung von UTXOs zu verfeinern und Ihre Strategien zur Trennung von Fonds innerhalb Ihres Portfolios einzuhalten, könnten Sie Ihre Etiketten mit einer zusätzlichen Markierung anreichern, um diese Trennungen wiederzugeben. Wenn Ihr Portfolio zwei Kategorien von UTXOs enthält, die Sie nicht mischen möchten, können Sie eine Markierung in Ihre Etiketten integrieren, um diese Gruppen klar zu unterscheiden. Diese Trennungsmarkierungen hängen von Ihren Kriterien ab, wie z. B. die Unterscheidung zwischen UTXOs aus einem Akquisitionsprozess, der KYC beinhaltet, oder zwischen professionellen und privaten Fonds. In Anlehnung an die zuvor erwähnten Beispiele für Etiketten könnte dies folgendermaßen aussehen:


- kYC - Exchange.com Withdrawal";
- kYC - Kundenzahlung David";
- nO KYC - Kauf von P2P-Charles";
- nO KYC - Restbetrag vom Sofakauf"

Es ist auch ratsam, die Kennzeichnung einer Münze während der Transaktionen beizubehalten. Wenn Sie beispielsweise UTXOs ohne KYC konsolidieren, sollten Sie den resultierenden UTXO nicht nur als "Konsolidierung", sondern ausdrücklich als "No-KYC-Konsolidierung" kennzeichnen, um die Herkunft der Münze eindeutig zu belegen.

Schließlich ist es nicht zwingend erforderlich, ein Datum auf einem Etikett anzugeben. Die meisten Geldbörsenprogramme zeigen das Datum der Transaktion bereits an, und es ist immer möglich, diese Information über einen Block-Explorer anhand der TXID abzurufen.

### Wie wählt man seine Münzen richtig aus?

Wenn Sie eine Transaktion durchführen, können Sie mit der Münzkontrolle gezielt auswählen, welche UTXOs Sie als Input verbrauchen möchten, um die Zahlungsausgabe zu erfüllen. Bei dieser Auswahl sollten zwei Aspekte berücksichtigt werden:


- Die Möglichkeit für den Zahlungsempfänger, einen Teil Ihrer Identität mit den als Eingabe verwendeten UTXOs zu verknüpfen;
- Die Fähigkeit eines außenstehenden Beobachters, Verbindungen zwischen allen als Input verbrauchten UTXOs herzustellen.

Um den ersten Punkt zu veranschaulichen, nehmen wir ein konkretes Beispiel. Angenommen, Sie kaufen ein Baguette mit Bitcoins bei Ihrem örtlichen Bäcker. Sie verwenden einen oder mehrere eigene UTXOs als Input, um mindestens den Preis des Baguettes im Output zu decken, plus Transaktionsgebühren. Ihr Bäcker könnte dann möglicherweise Ihr Gesicht oder einen anderen Teil Ihrer Identität, den er kennt, mit den als Input verwendeten Münzen in Verbindung bringen. Wenn Sie um diese Verbindung wissen, ziehen Sie vielleicht einen bestimmten UTXO einem anderen vor, wenn Sie bezahlen wollen.

Wenn zum Beispiel einer Ihrer UTXOs von einer Börsenplattform stammt und Sie es vorziehen, dass der Bäcker nichts von Ihrem Konto auf dieser Plattform weiß, würden Sie diesen UTXO nicht zur Zahlung verwenden. Wenn Sie einen UTXO von hohem Wert haben, der eine beträchtliche Menge an Bitcoin offenbart, könnten Sie sich auch dafür entscheiden, ihn nicht zu verwenden, um zu verhindern, dass der Bäcker von Ihrem BTC-Vermögen erfährt.

Die Wahl der UTXOs, die Sie für diesen ersten Punkt verwenden, basiert daher auf einer persönlichen Entscheidung, die davon beeinflusst wird, was Sie bereit sind, offenzulegen oder nicht. Die Kennzeichnungen, die Sie Ihren UTXOs beim Empfang zugewiesen haben, werden Ihnen helfen, diejenigen auszuwählen, die, wenn sie ausgegeben werden, nur die Informationen anzeigen, die Sie bereit sind, dem Empfänger preiszugeben.

Zusätzlich zu den Informationen, die dem Empfänger möglicherweise offengelegt werden, wirkt sich die Wahl der Eingaben auch darauf aus, was Sie allen Blockchain-Beobachtern offenlegen. Wenn Sie nämlich mehrere UTXOs als Inputs für Ihre Transaktion verwenden, geben Sie gemäß der Common Ownership Heuristics of Inputs (CIOH) preis, dass sie demselben Unternehmen gehören.

Wenn Sie Ihre Münzen auswählen, sollten Sie sich daher bewusst sein, dass die Transaktion, die Sie übertragen wollen, eine Verbindung zwischen allen verwendeten UTXOs herstellt. Diese Verbindung kann für Ihre Privatsphäre problematisch sein, insbesondere wenn die UTXOs aus verschiedenen Quellen stammen.

Um auf das Beispiel meines UTXO ohne KYC von Bisq zurückzukommen: Ich möchte vermeiden, ihn mit einem UTXO von einer regulierten Börsenplattform zu kombinieren, die meine Identität kennt. Wenn ich diese beiden UTXOs als Inputs in derselben Transaktion verwenden würde, wäre die regulierte Plattform in der Lage, meine Identität mit dem UTXO zu verknüpfen, den ich auf Bisq gekauft habe, während er vorher nicht mit meiner Identität verknüpft war.

Das Wichtigste bei der Auswahl der UTXOs, die als Input für eine Transaktion verwendet werden sollen, ist die Vermeidung der Verwendung mehrerer UTXOs. Wann immer möglich, wählen Sie eine einzige Münze, die groß genug ist, um Ihre Zahlung zu decken. Auf diese Weise vermeiden Sie die mit COINJOIN verbundenen Risiken vollständig. Wenn jedoch kein einzelner UTXO für Ihre Zahlung ausreicht und Sie mehrere verbrauchen müssen, achten Sie darauf, dass sie aus ähnlichen Quellen stammen, um das Risiko unerwünschter Verbindungen zu minimieren. Bedenken Sie auch, dass der Empfänger die Informationen, die er über Sie hat, mit der Historie der als Input verwendeten Münzen in Verbindung bringen kann.

### Die automatische Münzauswahl verstehen

In den vorherigen Abschnitten haben wir die manuelle Auswahl von UTXOs für eine Transaktion besprochen. Aber was passiert, wenn die Wallet-Software diese Auswahl automatisch vornimmt? Es gibt mehrere Methoden, um zu bestimmen, welche Münzen verbraucht werden sollen, und die Auswahl von UTXOs ist ein echtes Forschungsgebiet in Bitcoin. Das Hauptziel dieses automatischen Prozesses ist oft, die Transaktionsgebühren für den Nutzer zu minimieren.

UTXO-Auswahlmethoden wie FIFO (_First In First Out_) und LIFO (_Last In First Out_) gehören zu den einfachsten, aber auch zu den am wenigsten effizienten Methoden. Bei FIFO werden die ältesten Münzen im Portfolio zuerst verwendet. Dieser Ansatz ist im Allgemeinen ineffizient, sowohl was die Minimierung der Transaktionsgebühren als auch die Wahrung der Privatsphäre angeht, es sei denn, es werden relative Zeitsperren verwendet, die regelmäßig erneuert werden müssen. Im Gegensatz dazu werden bei LIFO vorrangig die neuesten UTXOs verwendet. Obwohl diese beiden Methoden einfach sind, erweisen sie sich oft als ineffizient.

Eine fortgeschrittenere Methode ist der _Knapsack Solver_. Dies war die Methode, die in der Bitcoin Core Wallet bis Version 0.17 verwendet wurde. Sie beinhaltet die iterative und zufällige Auswahl von UTXOs aus der Wallet, die Summierung in Untergruppen und die Beibehaltung der Lösung, die das Transaktionsgewicht so weit wie möglich reduziert, um die Nutzergebühren zu senken.

Der _Branch-and-Bound_ (BNB), der in Anlehnung an seinen Erfinder oft "Murchs Algorithmus" genannt wird, hat den _Knapsack Solver_ in Bitcoin Core ab Version 0.17 ersetzt. Diese fortschrittlichere Methode zielt darauf ab, einen Satz von UTXOs zu finden, der genau dem Betrag entspricht, der benötigt wird, um die Ausgaben einer Transaktion zu befriedigen. Das Ziel von BNB ist es, die Menge des Rests sowie die Gebühren zu minimieren, indem das so genannte Abfallkriterium reduziert wird, das sowohl die unmittelbaren Kosten als auch die erwarteten zukünftigen Kosten für den Rest berücksichtigt. Diese Methode ist von dem ursprünglichen _Branch-and-Bound_-Konzept abgeleitet, das 1960 von Ailsa Land und Alison Harcourt entwickelt wurde, und bietet eine präzisere Provisionsoptimierung als der _Knapsack Solver_.

All diese automatischen UTXO-Auswahlverfahren können die Transaktionsgebühren wirksam senken, sind aber oft ineffizient, wenn es um die Wahrung der Privatsphäre der Nutzer geht. Diese Algorithmen können nämlich mehrere UTXOs zu einer Eingabe zusammenfassen, wodurch ein gemeinsamer Besitz dieser UTXOs aufgrund von COH aufgedeckt wird. Natürlich können diese Methoden nicht die mit den UTXOs verbundenen Labels berücksichtigen, die für die bewusste Auswahl der Münzen, die dem Transaktionsempfänger offengelegt werden sollen, entscheidend sind. Derzeit besteht die einzige Lösung zur Optimierung der Privatsphäre bei der Münzauswahl darin, diese manuell vorzunehmen.

### UTXO Beschriftung Tutorial

Wenn Sie herausfinden möchten, wie Sie Ihre UTXOs taggen können, haben wir eine umfassende Anleitung für die wichtigsten Bitcoin-Wallet-Programme zusammengestellt:

https://planb.network/tutorials/privacy/on-chain/utxo-labelling-d997f80f-8a96-45b5-8a4e-a3e1b7788c52
## KYC und Schlüsselidentifikation

<chapterId>cec6b9d9-0eed-4f85-bc4e-1e9aa59ca605</chapterId>

KYC steht für "Know Your Customer" (Kenne deinen Kunden) und ist ein regulatorisches Verfahren, das von einigen in der Bitcoin-Branche tätigen Unternehmen eingeführt wurde. Dieses Verfahren zielt darauf ab, die Identität ihrer Kunden zu überprüfen und aufzuzeichnen, mit dem erklärten Ziel, Geldwäsche und Terrorismusfinanzierung zu bekämpfen.

Konkret bedeutet KYC die Erfassung verschiedener persönlicher Daten des Kunden, die je nach Land variieren können, aber im Allgemeinen einen Ausweis, ein Foto und einen Nachweis des Wohnsitzes umfassen. Diese Informationen werden dann überprüft und zur späteren Verwendung gespeichert.

Dieses Verfahren ist in den meisten westlichen Ländern für alle regulierten Tauschplattformen obligatorisch geworden. Das bedeutet, dass jeder, der über diese Plattformen Fiat-Währungen gegen Bitcoin tauschen möchte, die KYC-Anforderungen erfüllen muss.

Dieses Verfahren ist nicht ohne Risiken für die Privatsphäre und Sicherheit der Nutzer. In diesem Kapitel werden wir diese Risiken im Detail untersuchen und die spezifischen Auswirkungen der KYC- und Identifikationsprozesse auf die Privatsphäre der Bitcoin-Nutzer analysieren.

### Erleichterung der Onchain-Nachverfolgung

Das erste mit der KYC verbundene Risiko besteht darin, dass sie einen bevorzugten Einstiegspunkt für die Blockchain-Analyse bietet. Wie wir im vorherigen Abschnitt gesehen haben, können Analysten die Aktivitäten auf der Blockchain mithilfe von Transaktionsmustern und Heuristiken gruppieren und verfolgen. Sobald es ihnen gelungen ist, die Onchain-Aktivitäten eines Nutzers zu gruppieren, reicht es aus, nur einen einzigen Einstiegspunkt unter all seinen Transaktionen und Schlüsseln zu finden, um seine Privatsphäre vollständig zu gefährden.

![BTC204](assets/fr/078.webp)

Wenn Sie sich der KYC unterwerfen, bieten Sie einen sehr hochwertigen Einstiegspunkt für die Kettenanalyse, da Sie die Empfängeradressen, die Sie beim Abheben Ihrer Bitcoins von einer Börsenplattform verwenden, mit Ihrer vollständigen, verifizierten Identität verknüpfen. Theoretisch sind diese Informationen nur dem Unternehmen bekannt, dem Sie sie zur Verfügung gestellt haben, aber wie wir später sehen werden, ist das Risiko eines Datenverlusts real. Außerdem kann allein die Tatsache, dass ein Unternehmen über diese Informationen verfügt, problematisch sein, selbst wenn es sie nicht weitergibt.

Wenn also keine anderen Maßnahmen ergriffen werden, um die Zusammenführung der eigenen Aktivitäten auf der Blockchain zu begrenzen, kann jeder, der den Einstiegspunkt KYC kennt, potenziell alle seine Aktivitäten auf Bitcoin mit seiner Identität verknüpfen. Aus der Sicht dieses Unternehmens verliert die Verwendung von Bitcoin daher jegliche Vertraulichkeit.

![BTC204](assets/fr/079.webp)

Um dies mit einem Vergleich zu verdeutlichen, wäre es so, als ob der Bankangestellte der _Bank X_ nicht nur Zugang zu allen Transaktionen mit der _Bank X_ hätte, sondern auch die Transaktionen mit der _Bank Y_ und alle eigenen Bargeldtransaktionen beobachten könnte.

Erinnern Sie sich an den ersten Teil dieser Schulung: Das von Satoshi Nakamoto entwickelte Datenschutzmodell von Bitcoin basiert auf der Trennung zwischen der Identität des Nutzers und seinen Schlüsselpaaren. Obwohl diese Ebene der Privatsphäre heute nicht mehr ausreicht, ist es immer noch ratsam, ihre Verschlechterung so weit wie möglich zu begrenzen.

### Exposition gegenüber der staatlichen Überwachung

Das zweite große Problem bei der KYC ist, dass sie dem Staat offenbart, dass man irgendwann einmal Bitcoin besessen hat. Wenn man Bitcoins über einen regulierten Akteur kauft, ist es dem Staat möglich, von diesem Besitz zu erfahren. Im Moment mag dies trivial erscheinen, aber es ist wichtig, daran zu denken, dass die politische und wirtschaftliche Zukunft des eigenen Landes nicht in den eigenen Händen liegt.

Zunächst einmal kann der Staat schnell eine autoritäre Haltung einnehmen. Die Geschichte ist voll von Beispielen, in denen sich die Politik abrupt geändert hat. Heute können Bitcoin-Enthusiasten in Europa Artikel über Bitcoin schreiben, an Konferenzen teilnehmen und ihre eigenen Wallets zur Selbstlagerung verwalten. Aber wer kann schon sagen, was morgen sein wird? Wenn Bitcoin plötzlich zum Staatsfeind Nummer eins wird, könnte es sich als problematisch erweisen, in staatlichen Registern damit in Verbindung gebracht zu werden.

Später, angesichts schwerer Wirtschaftskrisen, könnte der Staat erwägen, Bitcoins im Besitz der Bürger zu beschlagnahmen. Vielleicht werden die Bitcoin-Besitzer morgen als Ausnutzer der Krise angesehen und wegen ihrer Kapitalgewinne angesichts der Abwertung der Fiat-Währung übermäßig besteuert.

Man könnte meinen, dass dies kein Problem darstellt, da Ihre Bitcoins gemischt werden und daher nicht zurückverfolgt werden können. Die Rückverfolgbarkeit ist hier jedoch nicht das Problem. Das eigentliche Problem ist, dass der Staat weiß, dass Sie Bitcoins besessen haben. Diese einfache Information könnte ausreichen, um Sie zu belasten oder ein Konto zu verlangen. Sie könnten versuchen zu behaupten, dass Sie Ihre Bitcoins ausgegeben haben, aber das müsste sich in Ihrer Steuererklärung widerspiegeln, und Sie würden enttarnt werden. Sie könnten auch sagen, dass Sie Ihre Schlüssel bei einem Bootsunfall verloren haben, aber glauben Sie wirklich, dass dies - abgesehen von einem Twitter-Witz - ausreichen würde, um Sie zu entlasten?

Daher ist es wichtig, das Risiko in Betracht zu ziehen, das mit der einfachen Tatsache verbunden ist, dass der Staat wissen könnte, dass Sie BTC besitzen, auch wenn dieses Risiko heute weit weg zu sein scheint.

Ein weiteres Problem, das KYC im Hinblick auf die staatliche Aufsicht aufwirft, ist die obligatorische Berichterstattung durch regulierte Plattformen. Ich kenne zwar die Vorschriften in anderen Ländern nicht, aber in Frankreich müssen _Digital Asset Service Provider_ (PSANs) den Finanzaufsichtsbehörden jede Geldbewegung melden, die sie für verdächtig halten.

So wurden in Frankreich im Jahr 2023 1.449 verdächtige Handlungen von PSANs gemeldet. Im Moment sind die meisten dieser Handlungen mit Verbrechen verbunden. Die Behörden fordern jedoch auch regulierte Plattformen auf, verdächtige Bitcoin-Transaktionen allein aufgrund ihrer Struktur zu melden. Wenn Sie eine kollaborative Transaktion durchführen oder auch nur eine Transaktion, die ein etwas untypisches Muster aufweist, und diese Transaktion in der Nähe der Abhebung Ihrer Bitcoins von diesen Plattformen stattfindet, kann es sein, dass Sie den Behörden gemeldet werden. Selbst wenn Sie kein Fehlverhalten begangen haben und Ihre Rechte rechtmäßig ausüben, könnte diese Meldung zu einer verstärkten Kontrolle und Überwachung führen - Unannehmlichkeiten, die Ihnen ohne KYC erspart geblieben wären.

### Das Risiko des Verlusts personenbezogener Daten

Ein weiteres Problem der KYC ist die Tatsache, dass sie die Speicherung aller persönlichen Daten auf den Servern eines privaten Unternehmens erfordert. Die jüngsten Ereignisse haben uns daran erinnert, dass niemand vor Fehlern gefeit ist, weder im finanziellen noch im IT-Bereich. Im Jahr 2022 hatten die Kunden von Celsius die Folgen zu tragen. Infolge des Konkurses des Unternehmens wurden die Namen der Gläubiger und die Höhe ihrer Vermögenswerte von der US-Justiz im Rahmen eines Verwaltungsverfahrens bekannt gegeben.

Vor etwas mehr als zwei Jahren wurde ein führendes Unternehmen für Cybersicherheit im Bereich der Kryptowährungen Opfer des Diebstahls der persönlichen Daten seiner Kunden. Obwohl dieser Vorfall nicht direkt mit dem Kauf von Bitcoin zusammenhing, besteht dieses Risiko auch für Börsenplattformen. Es besteht also ein eindeutiges Risiko im Zusammenhang mit diesen persönlichen Daten.

Es stimmt, dass wir bereits einen Großteil unserer persönlichen Daten privaten Unternehmen anvertrauen. Allerdings besteht hier ein doppeltes Risiko, da diese Daten nicht nur eine Identifizierung ermöglichen, sondern auch mit Aktivitäten auf Bitcoin verknüpft sind. Wenn nämlich ein Hacker in der Lage ist, auf die Daten von Kunden einer Börsenplattform zuzugreifen, kann er vernünftigerweise davon ausgehen, dass diese Kunden Bitcoin besitzen. Dieses Risiko wird also durch die Tatsache verschärft, dass Bitcoin wie jedes andere wertvolle Gut das Interesse von Dieben auf sich zieht.

Im Falle einer Datenschutzverletzung könnten Sie im besten Fall das Ziel von gezielten Phishing-Versuchen sein. Im schlimmsten Fall könnten Sie sich im Zentrum physischer Bedrohungen für Ihr Zuhause wiederfinden.

Zusätzlich zu den spezifischen Risiken, die mit Bitcoin verbunden sind, müssen auch die Gefahren berücksichtigt werden, die mit der Übermittlung von Identitätsdokumenten verbunden sind. Im Falle eines Datenlecks ist es nämlich möglich, Opfer eines Identitätsdiebstahls zu werden. Es geht also nicht nur um den Schutz der Vertraulichkeit von Transaktionen, sondern auch um die persönliche Sicherheit jedes Einzelnen.

### Häufige Missverständnisse in Bezug auf KYC

Es ist wichtig, einige gängige Missverständnisse über KYC auszuräumen, die häufig auf Twitter oder in unseren Diskussionen unter Bitcoinern zu finden sind.

Zunächst einmal ist es falsch zu denken, dass der Schutz der Privatsphäre für Bitcoins, die durch KYC (Know Your Customer) erworben wurden, nutzlos ist. Die Werkzeuge und Methoden zum Schutz der Privatsphäre bei bitcoin sind vielfältig und dienen unterschiedlichen Zwecken. Die Verwendung von Coinjoin-Transaktionen auf bitcoin von KYC ist zum Beispiel keine schlechte Idee. Natürlich müssen Sie bei regulierten Austauschplattformen vorsichtig sein, um zu vermeiden, dass Ihr Konto eingefroren oder gesperrt wird, aber von einem rein technischen Standpunkt aus sind diese Praktiken nicht unvereinbar. Coinjoin hat den Effekt, dass die Historie eines Coins unterbrochen wird, was dazu beiträgt, einige der mit der KYC verbundenen Risiken der Kettenanalyse auszugleichen. Auch wenn dadurch nicht alle Risiken beseitigt werden, ist dies bereits ein erheblicher Vorteil.

Die Privatsphäre bei Bitcoin sollte nicht binär betrachtet werden, als Unterscheidung zwischen "anonymen" Bitcoins und anderen, die nicht anonym sind. Der Besitz von Bitcoins, die durch KYC erworben wurden, bedeutet nicht, dass alles verloren ist; im Gegenteil, die Verwendung von Tools zum Schutz der Privatsphäre kann sich sogar als vorteilhaft erweisen.

Umgekehrt garantiert der Erwerb von Bitcoin über eine Nicht-KYC-Methode keine perfekte Privatsphäre und entbindet Sie nicht von der Notwendigkeit, andere Schutzmaßnahmen zu ergreifen. Wenn Sie nicht-KYC-Bitcoin besitzen, aber die Empfangsadressen mehrfach wiederverwenden, können Ihre Transaktionen nachverfolgt und gruppiert werden. Die kleinste Verbindung zur Welt außerhalb von bitcoin könnte die einzige Ebene der Privatsphäre, die Sie hatten, gefährden. Daher ist es wichtig, alle Werkzeuge und Methoden, die die Privatsphäre bei Bitcoin verbessern, als komplementär zu betrachten. Jede Technik befasst sich mit einem bestimmten Risiko und kann eine zusätzliche Schutzschicht hinzufügen. Der Besitz von Nicht-KYC-Bitcoin entbindet Sie also keineswegs davon, andere Vorsichtsmaßnahmen zu treffen.

### Kann der KYC annulliert werden?

Ich werde manchmal gefragt, ob es möglich ist, nach Abschluss der KYC "zurückzugehen", und wie Sie sich anhand der vorangegangenen Absätze vorstellen können, ist die Antwort nuanciert. Um die mit der KYC verbundenen Risiken zu vermeiden, ist die einfachste Methode, sie beim Erwerb von Bitcoins nicht zu verwenden. Wir werden im nächsten Kapitel näher auf dieses Thema eingehen. Wenn die KYC jedoch bereits durchgeführt wurde und Bitcoins erworben wurden, gibt es dann Möglichkeiten, die damit verbundenen Risiken zu mindern?

Was das Risiko der Rückverfolgung Ihrer Transaktionen betrifft, so ist die Verwendung von Coinjoin eine Lösung. Wir werden diese Methode später in der Schulung im Detail besprechen, aber Sie sollten wissen, dass Coinjoin die Historie eines Coins unterbrechen und seine Rückverfolgbarkeit von der Vergangenheit zur Gegenwart und von der Gegenwart zur Vergangenheit verhindern kann. Selbst bei BTC, die über eine regulierte Plattform erworben wurden, kann diese Technik die Rückverfolgbarkeit verhindern.

Coinjoin beseitigt jedoch nicht das zweite mit KYC verbundene Risiko: die Tatsache, dass der Staat über Ihren Bitcoin-Besitz informiert ist. Selbst wenn Ihre Münzen nicht mehr rückverfolgbar sind, kann der Staat je nach Gerichtsbarkeit Zugang zu Ihren kryptoaktiven Veräußerungserklärungen haben. Da es sich hierbei nicht um ein technisches, sondern um ein administratives Risiko handelt, gibt es keine bitcoin-spezifischen Lösungen, um dieses Risiko auszuschalten, abgesehen von der anfänglichen Vermeidung der KYC-Bestimmungen. Der einzige legale Ansatz zur Minderung dieses Risikos besteht darin, Ihre über regulierte Plattformen erworbenen Bitcoins auf regulierten Plattformen zu verkaufen und sie dann ohne KYC zurückzukaufen. Durch den Verkauf und die Deklaration der Veräußerung sollte die Verwaltung feststellen, dass Sie sie nicht mehr besitzen.

Was das Risiko der Offenlegung Ihrer persönlichen Daten und Identitätsdokumente betrifft, so ist dies eine Gefahr außerhalb von Bitcoin, und es gibt keine technische Lösung, um dies zu vermeiden. Wenn Ihre Daten einmal offengelegt wurden, ist es schwierig, dies rückgängig zu machen. Sie können versuchen, Ihr Konto auf der Plattform zu schließen, aber das garantiert nicht die Beseitigung Ihrer KYC-Daten, insbesondere wenn die Identitätsprüfung ausgelagert ist. Es ist unmöglich, die vollständige Beseitigung Ihrer Daten zu überprüfen. Daher gibt es keine Lösung, um dieses Risiko vollständig zu verhindern und sicherzustellen, dass es nicht mehr besteht.

### Der Unterschied zwischen KYC und Schlüsselidentifikation

Manchmal neigen einige Bitcoiner dazu, den Begriff "KYC" auf jeden BTC-Austausch auszudehnen, der eine Überweisung oder eine Kreditkartenzahlung beinhaltet, da diese Mittel ebenso wie KYC die Herkunft der Zahlung offenlegen können. Es ist jedoch wichtig, KYC nicht mit der Schlüsselidentifikation zu verwechseln. Ich persönlich muss zugeben, dass sich meine Sichtweise zu diesem Thema im Laufe der Zeit verändert hat.

KYC bezieht sich speziell auf ein regulatorisches Verfahren, das von einigen Unternehmen eingeführt wurde, um die Identität ihrer Kunden zu überprüfen und aufzuzeichnen. Es ist eine binäre Angelegenheit: Wenn Sie Ihre Bitcoins erwerben, müssen Sie sich entweder der KYC unterwerfen oder nicht. Die Schlüsselidentifikation, bei der es darum geht, einen Aspekt der Identität eines Nutzers mit Onchain-Aktivitäten zu verknüpfen, ist jedoch nicht so binär, sondern stellt eher ein Kontinuum dar. Im Zusammenhang mit dem Kauf oder Verkauf von Bitcoin ist diese Identifizierung immer in unterschiedlichem Maße möglich.

Wenn Sie zum Beispiel Bitcoin auf einer regulierten Plattform in der Schweiz kaufen, ist KYC (Know Your Customer) nicht erforderlich. Es kann jedoch eine Identifizierung Ihrer Schlüssel erfolgen, da der Kauf über Ihr Bankkonto getätigt wurde. Hier entstehen die ersten beiden mit KYC verbundenen Risiken - die Erleichterung des Onchain-Trackings und die Anfälligkeit für staatliche Überwachung -, die auch bei einem Austausch ohne KYC auftreten können. Wenn das Schweizer Unternehmen den Behörden in Ihrem Land verdächtige Transaktionen meldet, können diese einfach das für den Kauf verwendete Bankkonto überprüfen, um Ihre Identität festzustellen. Daher ist der Kauf ohne KYC auf regulierten Plattformen auf der Risikoskala für die Schlüsselidentifikation ziemlich weit oben angesiedelt.

Wenn man jedoch regulierte Plattformen meidet und sich für P2P (Peer-to-Peer)-Erwerbsmethoden entscheidet, lässt sich das Risiko der Schlüsselidentifizierung nicht völlig ausschalten, sondern nur verringern. Nehmen wir das Beispiel eines Kaufs auf Bisq oder einer anderen P2P-Plattform. Um mit Ihrem Gegenüber abzurechnen, werden Sie wahrscheinlich Ihr Bankkonto verwenden. Wenn die Behörden die Person, mit der Sie gehandelt haben, befragen und nach Ihrem Namen fragen, entstehen die oben genannten Risiken 1 und 2. Diese Risiken sind sicherlich viel geringer als bei einem Kauf ohne KYC auf einer Plattform und sogar geringer als bei einem Kauf mit KYC, aber sie sind immer noch in geringem Umfang vorhanden.

Und schließlich sind Sie nicht völlig anonym, selbst wenn Sie Ihre Bitcoins über eine physische Geldbörse kaufen. Die Person, mit der Sie Geschäfte gemacht haben, hat Ihr Gesicht gesehen, das Teil Ihrer Identität ist. Obwohl in diesem Beispiel minimal, besteht immer noch die Möglichkeit eines Identifikationsschlüssels.

Zusammenfassend lässt sich sagen, dass beim Tausch von Bitcoin gegen andere Vermögenswerte, sei es beim Kauf einer Fiat-Währung oder beim Verkauf gegen einen realen Vermögenswert, immer eine Form der Schlüsselidentifizierung stattfindet. Je nach der gewählten Umtauschmethode kann diese Identifizierung unterschiedlich intensiv sein. Es ist wichtig, diese Identifizierung nicht mit der KYC zu verwechseln, bei der es sich um ein genau definiertes regulatorisches Verfahren handelt. Es besteht jedoch eine Verbindung zwischen KYC und dem Identifizierungsspektrum, da KYC am oberen Ende dieses Spektrums liegt, da es die Identifizierung von Benutzerschlüsseln durch Behörden systematisch erleichtert.

## Verkaufs- und Akquisitionsmethoden

<chapterId>756598af-95aa-4c77-ac48-243c7ad89530</chapterId>

Nachdem Sie das vorherige Kapitel gelesen haben, fragen Sie sich vielleicht, wie Sie Bitcoin kaufen oder verkaufen können, ohne sich einer Identitätsüberprüfung unterziehen zu müssen, um die mit KYC verbundenen Risiken zu vermeiden. Es gibt mehrere Methoden für den Tausch.

### P2P-Bargeldumtausch

Wie wir gesehen haben, ist die beste Methode in Bezug auf den Datenschutz nach wie vor der P2P-Austausch (Peer-to-Peer) mit Barausgleich. Mit dieser Methode können Sie die Spuren, die Sie hinterlassen, minimieren und die Möglichkeit der Identifizierung von Käufern und Verkäufern erheblich reduzieren.

Diese Praxis birgt jedoch persönliche Sicherheitsrisiken. Die größte Gefahr besteht darin, dass die Gegenpartei während des Umtauschs erfährt, dass Sie einen erheblichen Betrag entweder in bar oder in Bitcoin besitzen. Diese Information kann die Aufmerksamkeit von böswilligen Personen auf sich ziehen. In der Tat wird allgemein empfohlen, den Besitz von Bitcoin diskret zu behandeln. Dieser Ratschlag könnte auch auf Bargeld angewendet werden. Bei einem persönlichen Austausch ist es jedoch unvermeidlich, den Besitz von Bitcoin preiszugeben, was die Gier wecken kann.

Um dieses Risiko zu begrenzen, empfehle ich, dass Sie Bargeldtransaktionen mit vertrauenswürdigen Personen, wie Familienmitgliedern oder engen Freunden, bevorzugen. Alternativ können Sie auch in Erwägung ziehen, den Tausch bei [lokalen Bitcoin-Treffen] (https://btcmap.org/communities/map) vorzunehmen, nachdem Sie mehrmals daran teilgenommen haben. So können Sie die anderen Teilnehmer besser kennenlernen und sind während des physischen Austauschs nicht allein. Sie sollten sich jedoch darüber im Klaren sein, dass der P2P-Bargeldtausch Risiken für Ihre persönliche Sicherheit birgt, die beim Kauf über eine regulierte Plattform und Ihr Bankkonto nicht bestehen.

Je nachdem, wo Sie leben, kann der Transport und die Aufbewahrung großer Geldbeträge, ob Bitcoin oder Bargeld, Risiken bergen.

Der Austausch von Bargeld kann auch rechtliche Risiken bei Polizei- oder anderen Kontrollen mit sich bringen. Obwohl es in den meisten Ländern keine Beschränkung für die Menge an Bargeld gibt, die Sie mit sich führen dürfen, können zu hohe Beträge Verdacht erregen. Seien Sie daher vorsichtig, vor allem wenn Sie weite Strecken zurücklegen müssen, und vermeiden Sie zu große Transaktionen auf einmal, damit Sie sich nicht für den Besitz erheblicher Summen rechtfertigen müssen.

Ein weiterer Nachteil von P2P-Käufen besteht darin, dass der Preis oft höher ist als auf regulierten Plattformen. Die Verkäufer erheben oft einen Aufschlag von 1 % bis manchmal mehr als 10 %. Für diesen Preisunterschied gibt es mehrere Gründe. Erstens ist es eine gängige Praxis unter P2P-Verkäufern, die sich im Laufe der Zeit etabliert hat. Darüber hinaus fallen bei den Verkäufern Transaktionsgebühren für die Überweisung von Geldbeträgen an den Käufer an. Außerdem besteht bei P2P-Verkäufen ein höheres Diebstahlsrisiko als bei Plattformtransaktionen, was eine Gebühr für das eingegangene Risiko rechtfertigt. Schließlich kann die Prämie auch von der Nachfrage und der Qualität des Austauschs in Bezug auf den Datenschutz abhängen. Als Käufer ist der Gewinn an Privatsphäre in den vom Verkäufer erhobenen Aufpreis eingepreist. Einige Bitcoiner sind auch der Meinung, dass der höhere Preis der im P2P gekauften BTC ihren wahren Wert widerspiegelt, und argumentieren, dass die niedrigeren Preise auf regulierten Plattformen das Ergebnis eines Kompromisses in Bezug auf die Privatsphäre Ihrer persönlichen Daten sind.

### P2P-Tauschbörsen über eine Matching-Plattform

Eine weniger risikoreiche Alternative in Bezug auf die persönliche Sicherheit ist es, P2P-Tauschgeschäfte ausschließlich online über elektronische Zahlungsmittel wie PayPal, Banküberweisungen oder Revolut abzuwickeln.

Auf diese Weise lassen sich viele Risiken vermeiden, die mit Bargeldtransaktionen verbunden sind. Allerdings ist das Risiko, dass die Gegenpartei ihre Verpflichtungen bei einem Online-Tausch nicht einhält, größer. Wenn Sie bei einem physischen Tausch dem Verkäufer Geld übergeben und dieser Ihnen im Gegenzug keine Bitcoins schickt, können Sie ihn sofort zur Rede stellen, da er direkt vor Ihnen steht. Online hingegen ist es oft unmöglich, eine Person zu finden, die Sie bestohlen hat.

Um dieses Risiko zu mindern, können für P2P-Tauschbörsen spezialisierte Matching-Plattformen verwendet werden. Diese Plattformen nutzen Konfliktlösungsmechanismen, um geschädigte Nutzer zu schützen. In der Regel bieten sie ein Treuhandsystem an, bei dem Bitcoins so lange aufbewahrt werden, bis die Zahlung in Fiat-Währung vom Verkäufer bestätigt wird.

In Bezug auf die persönliche Sicherheit ist diese Kaufmethode wesentlich sicherer als der physische Bargeldumtausch. Wie bereits erwähnt, hinterlassen Online-P2P-Tauschbörsen jedoch mehr Spuren als ein physischer Tausch, was der Privatsphäre bei Bitcoin abträglich sein kann. Wenn Sie eine Online-Zahlungsmethode wie eine Bank verwenden, geben Sie mehr Informationen preis, die eine Schlüsselidentifizierung erleichtern könnten.

Auch hier empfehle ich, auf diesen Plattformen keine großen Geschäfte in einer einzigen Transaktion zu tätigen. Indem Sie Ihre Transaktionen aufteilen, streuen Sie die Risiken, die mit einem möglichen Diebstahl durch die Gegenpartei verbunden sind.

Ein weiterer Nachteil von P2P-Käufen ist, dass der Preis oft höher ist als auf regulierten Plattformen. Die Verkäufer erheben oft einen Aufschlag von 1 % bis manchmal mehr als 10 %. Für diesen Preisunterschied gibt es mehrere Gründe. Erstens ist es eine gängige Praxis unter P2P-Verkäufern, die sich im Laufe der Zeit etabliert hat. Außerdem fallen bei den Verkäufern Transaktionsgebühren für die Überweisung des Geldes an den Käufer an. Außerdem besteht bei P2P-Verkäufen ein höheres Diebstahlsrisiko als bei Plattformtransaktionen, was eine Gebühr für das eingegangene Risiko rechtfertigt. Schließlich kann die Prämie auch von der Nachfrage und der Qualität des Austauschs in Bezug auf den Datenschutz abhängen. Als Käufer ist der Gewinn an Privatsphäre in den vom Verkäufer erhobenen Aufpreis eingepreist. Einige Bitcoiner sind auch der Meinung, dass der höhere Preis von über P2P gekauftem BTC dessen wahren Wert widerspiegelt, und argumentieren, dass die niedrigeren Preise auf regulierten Plattformen das Ergebnis eines Kompromisses in Bezug auf die Privatsphäre Ihrer persönlichen Daten sind.

Was Lösungen angeht, so habe ich persönlich immer [Bisq] (https://bisq.network/) verwendet und bin sehr zufrieden damit. Ihr System ist gut eingeführt und scheint zuverlässig zu sein. Allerdings ist Bisq nur auf dem PC verfügbar und die Benutzeroberfläche könnte für Anfänger zu komplex sein. Ein weiterer Nachteil ist, dass Bisq ausschließlich mit Onchain-Transaktionen arbeitet, was in Zeiten hoher Transaktionsgebühren für Bitcoin teuer werden kann.

-> Erfahren Sie mehr über unser Tutorial zu Bisq.

https://planb.network/tutorials/exchange/peer-to-peer/bisq-fe244bfa-dcc4-4522-8ec7-92223373ed04
Eine einfachere Option ist [Peach] (https://peachbitcoin.com/), eine mobile Anwendung, die die Verbindung zwischen Käufern und Verkäufern mit einem integrierten Streitbeilegungssystem erleichtert. Das Verfahren ist intuitiver als das von Bisq.

-> Erfahren Sie mehr über unser Tutorial zu Peach.

Eine weitere Online-Option ist [HodlHodl](https://hodlhodl.com/), eine gut etablierte Plattform, die eine gute Liquidität bietet, obwohl ich sie persönlich nicht getestet habe.

-> Erfahren Sie mehr über unser Tutorial zu HodlHodl.

https://planb.network/tutorials/exchange/peer-to-peer/peach-wallet-db64fe42-17ca-4b24-abb8-e7d4c03b2028
https://planb.network/tutorials/exchange/peer-to-peer/hodlhodl-d7344cd5-6b18-40f5-8e78-2574a93a3879
Für Lightning Network-basierte Lösungen können Sie [RoboSats] (https://learn.robosats.com/) und [LNP2PBot] (https://lnp2pbot.com/) ausprobieren. RoboSats ist über eine Website zugänglich und relativ einfach zu bedienen. LNP2PBot ist eher untypisch, da es über ein Austauschsystem in der Messaging-App Telegram funktioniert.

-> Sehen Sie sich unser Tutorial über RoboSats an.

-> Sehen Sie sich unser Tutorial zu LNP2PBot an.

https://planb.network/tutorials/exchange/peer-to-peer/robosats-b60e4f7c-533a-4295-9f6d-5368152e8c06
https://planb.network/tutorials/exchange/peer-to-peer/lnp2pbot-v2-e6bcb210-610b-487d-970c-7cce85273e3c
### Regulierte Plattformen ohne KYC

Je nachdem, in welchem Land Sie leben, haben Sie möglicherweise Zugang zu regulierten Plattformen, die kein KYC-Verfahren für den Kauf oder Verkauf von Bitcoin erfordern. In der Schweiz können Sie zum Beispiel Plattformen wie [Relai](https://relai.app/) und [MtPelerin](https://www.mtpelerin.com/) nutzen.

-> Erfahren Sie mehr über unser Tutorial zu Relai.

Wie wir im vorherigen Kapitel gesehen haben, erspart Ihnen diese Art von Plattform die mit KYC-Verfahren verbundenen Risiken, aber sie stellen ein höheres Risiko für die Schlüsselidentifikation dar. In Bezug auf die Privatsphäre bei Bitcoin bieten diese Plattformen daher einen besseren Schutz als KYC-Kaufmethoden, sind aber weniger attraktiv als P2P-Börsen.

In Bezug auf die persönliche Sicherheit ist die Nutzung dieser Plattformen jedoch deutlich weniger riskant als P2P-Börsen. Außerdem sind sie oft einfacher zu bedienen als Plattformen, die P2P-Börsen ermöglichen.

https://planb.network/tutorials/exchange/centralized/relai-v2-30a9671d-e407-459d-9203-4c3eae15b30e
### ATM

Eine weitere Möglichkeit, Bitcoin ohne KYC zu kaufen oder zu verkaufen, sind Kryptowährungs-Geldautomaten (ATMs). Ich persönlich hatte noch nie die Gelegenheit, diese Lösung zu testen, da es in meinem Land keine gibt. Aber je nachdem, wo Sie leben, kann diese Methode sehr interessant sein.

Das Problem mit Geldautomaten ist, dass sie in einigen Ländern verboten sind oder in anderen Ländern stark reguliert werden. Wenn ein Geldautomat eine Identitätsüberprüfung erfordert, bestehen die gleichen Risiken wie bei regulierten KYC-Plattformen. Erlaubt der Geldautomat jedoch Transaktionen ohne Identitätsüberprüfung für kleine Beträge, dann kann seine Nutzung ein Maß an Privatsphäre bieten, das mit dem einer bargeldbasierten P2P-Börse vergleichbar ist, wodurch die meisten der mit dieser Art von Börse verbundenen Risiken vermieden werden.

Der Hauptnachteil der Geldautomaten liegt in den oft hohen Umtauschgebühren, die von einigen Prozent bis hin zu 15 Prozent des umgetauschten Betrags reichen.

### Geschenkkarten

Schließlich wollte ich auch eine Lösung vorstellen, die gut für diejenigen funktioniert, die ihre Bitcoins täglich für Einkäufe verwenden möchten, anstatt sie gegen Fiat-Währungen zu verkaufen.

Die beste Möglichkeit, BTC auszugeben, ist natürlich, Bitcoin direkt oder über das Lightning Network zu verwenden, um Waren oder Dienstleistungen zu kaufen. In vielen Ländern ist die Zahl der Händler, die Bitcoin akzeptieren, jedoch nach wie vor begrenzt. Eine praktische Alternative ist daher die Verwendung von Geschenkkarten.

Mehrere Plattformen, die kein KYC-Verfahren erfordern, bieten die Möglichkeit, Bitcoin gegen Geschenkkarten einzutauschen, die in größeren Geschäften verwendet werden können. Zu diesen Plattformen gehören [CoinsBee](https://www.coinsbee.com/), [The Bitcoin Company](https://thebitcoincompany.com/) und [Bitrefill](https://www.bitrefill.com/). Diese Plattformen erleichtern die tägliche Verwendung Ihrer Bitcoins erheblich, da sie Ihnen den Zugang zu einer breiten Palette von Produkten und Dienstleistungen ermöglichen, ohne dass Sie eine Umrechnung in Fiat-Währung vornehmen müssen.

https://planb.network/tutorials/exchange/centralized/bitrefill-8c588412-1bfc-465b-9bca-e647a647fbc1
### Andere Methoden der Beschaffung

Zu den anderen Methoden, Bitcoin zu erwerben und gleichzeitig Ihre Privatsphäre zu schützen, gehört natürlich das Mining. Um mit dem Mining von Sats zu beginnen, müssen Sie Ihre Identität nicht preisgeben; suchen Sie einfach einen gültigen Beschäftigungsnachweis und reichen Sie ihn beim Netzwerk ein. Wenn Sie sich für das Mining in einem Pool entscheiden, verlangen einige Pools eine Form der Identifizierung, z. B. KYC, während andere dies nicht tun.

Eine andere Methode ist die Arbeit im Tausch gegen Bitcoin. Diese Methode des Erwerbs kann attraktiv sein, aber der Grad der Identifizierung, der erforderlich ist, variiert stark je nach den Umständen.

\Um dieses Kapitel zu schreiben, habe ich den von [@pivi\_\_](https://x.com/pivi___) erstellten BTC205-Kurs auf dem Plan ₿ Network verwendet (vorerst nur auf Französisch verfügbar).\_

## Konsolidierung, UTXO und CIOH Management

<chapterId>d0486c8f-332d-402b-ae2e-949416752b9c</chapterId>

Einer der kompliziertesten Aspekte, die es zu bewältigen gilt, wenn man ein eigenes Selfstorage-Portfolio besitzt, ist zweifelsohne die Konsolidierung. Sollten Sie konsolidieren? Was ist der Zweck? Welche Größe des UTXO sollten Sie anstreben? Was sind die Kompromisse in Bezug auf den Datenschutz? Das wollen wir in diesem Abschnitt untersuchen.

### Was ist Konsolidierung?

Die Funktionsweise von Bitcoin ähnelt einem Auktionsmarkt, bei dem Transaktionen mit den besten Gebühren von den Minern bevorzugt werden. Allerdings hat jeder Block ein maximales Gewicht, was die Anzahl der Transaktionen, die aufgenommen werden können, begrenzt. Da ein Block im Durchschnitt alle 10 Minuten erstellt wird, ist der in jedem Block verfügbare Platz eine seltene Ressource.

Minenbetreiber, deren Geschäft mit erheblichen Strom-, Kapital- und Wartungskosten verbunden ist, versuchen natürlich, ihre Rentabilität zu maximieren. Sie neigen dazu, Transaktionen zu bevorzugen, die ihnen die höchsten Gebühren im Verhältnis zu ihrem Gewicht bieten.

In der Tat wiegen nicht alle Bitcoin-Transaktionen gleich viel. Diejenigen mit mehr Input und Output werden mehr wiegen. Betrachten Sie zum Beispiel 2 Transaktionen:


- Transaktion A umfasst 1 Eingabe und 1 Ausgabe. Es weist 1.994 Gebührensätze zu und sein Gewicht beträgt 141 vB;
- Bei der komplexeren Transaktion B mit 2 Eingängen und 2 Ausgängen werden 2.640 Sats an Provisionen für ein Gewicht von 220 vB zugewiesen.

Obwohl Transaktion B in diesem Beispiel eine höhere Provision bietet, werden die Miner Transaktion A bevorzugen, da sie ein besseres Verhältnis zwischen Provision und Gewicht bietet. Hier ist die Berechnung für jede Transaktion, ausgedrückt in Sats pro virtuellem Byte (sat/vB):

```text
TXA: 1994 / 141 = 14 sat/vB
TXB: 2640 / 220 = 12 sat / vB
```

Das bedeutet, dass für jede Gewichtseinheit bei Transaktion A mehr Gebühren anfallen als bei Transaktion B, auch wenn letztere in absoluten Zahlen mehr Gebühren bietet.

Daher wird es für die Nutzer immer attraktiver, bei ihren Transaktionen so wenig wie möglich an Input zu verbrauchen. Es ist jedoch notwendig, ausreichende Mengen zu verbrauchen, um die Output-Zahlung zu erfüllen. Bei der Verwaltung des eigenen Portfolios ist es daher notwendig, über ausreichend große UTXOs zu verfügen.

Das Prinzip der Konsolidierung besteht genau darin, Zeiten mit niedrigen Bitcoin-Gebühren auszunutzen, um seine kleinen UTXOs zu einem größeren UTXO zusammenzulegen. Wenn die Bitcoin-Gebühren steigen, kann man also mit minimalem Aufwand Transaktionen durchführen und somit weniger absolute Gebühren ausgeben. Das Ziel ist es, in Zeiten hoher Provisionen obligatorische Transaktionen zu planen.

Neben der Einsparung von Transaktionsgebühren trägt die Konsolidierung von UTXOs dazu bei, die Entstehung von "Staub" zu vermeiden Unter "Staub" versteht man UTXOs, deren Wert in Sats so gering ist, dass er nicht ausreicht, um die für ihre Ausgabe erforderlichen Transaktionsgebühren zu decken. Daher ist es wirtschaftlich unvernünftig, diese UTXOs zu verwenden, solange die Transaktionsgebühren hoch bleiben. Indem Sie Ihre UTXOs proaktiv gruppieren, verhindern Sie, dass sie zu Staub werden, und stellen sicher, dass alle Ihre Gelder nutzbar bleiben.

### Was ist die Mindestgröße für Ihre UTXOs?

Manchmal werde ich gefragt, was der empfohlene Mindestwert für einen UTXO ist. Leider gibt es keine allgemeingültige Antwort, da dies von Ihren Präferenzen und den Marktbedingungen für Provisionen abhängt. Hier ist jedoch eine Formel, die Ihnen helfen kann, einen Schwellenwert zu bestimmen, der Ihren Bedürfnissen entspricht:

$$
\frac {P \times F}T = M
$$

Wo:


- $P$ ist das Gewicht der Transaktion;
- $F$ steht für die maximale Rate in Satoshi pro Vbyte (sats/vB), die Sie bereit sind zu zahlen;
- $T$ ist der Prozentsatz der Transaktionsgebühr, den Sie im Verhältnis zum Gesamtwert des UTXO zu zahlen bereit sind;
- $M$ ist der Mindestbetrag in Satoshi für jeden UTXO.

Angenommen, Sie wollen die Provisionen für eine Standard-SegWit-Transaktion mit 1 Eingang und 2 Ausgängen abdecken, was 141 vB wiegt. Wenn Sie bis zu 800 Sats/vB abdecken und bereit sind, maximal 12 Prozent des UTXO-Wertes an Provisionen auszugeben, dann würde die Berechnung lauten:

$$
\frac{141 \times 800}{0.12} = 940\ 000
$$

In diesem Beispiel wäre es ratsam, einen Mindestwert von 940.000 sat für UTXOs in Ihrem Portfolio zu halten.

### Konsolidierung und der COIH

Eine der am weitesten verbreiteten Heuristiken in der Blockchain-Analyse ist die COIH (_Common Input Ownership Heuristic_), die es uns ermöglicht, davon auszugehen, dass alle Inputs einer Bitcoin-Transaktion der gleichen Entität gehören. Das Prinzip der Konsolidierung besteht darin, mehrere UTXOs als Input zu verbrauchen und einen einzigen UTXO als Output zu erzeugen. Daher ermöglicht die Konsolidierung die Anwendung von COIH.

![BTC204](assets/fr/097.webp)

In der Praxis bedeutet dies, dass ein außenstehender Beobachter daraus schließen kann, dass alle konsolidierten UTXOs wahrscheinlich zu ein und derselben Person gehören und dass auch die einzige erzeugte Ausgabe zu dieser Person gehört. Diese Situation kann Ihre Privatsphäre durch die Verknüpfung verschiedener Transaktionsverläufe gefährden. Nehmen wir an, ich konsolidiere 3 UTXOs, die ich über P2P erworben habe, mit einem UTXO, den ich über eine Plattform erworben habe, die KYC verlangt:

![BTC204](assets/fr/098.webp)

Auf diese Weise kann jede Einrichtung mit Zugang zu den Daten der Börsenplattform, möglicherweise auch staatliche Stellen, feststellen, dass ich andere Beträge in BTC besitze. Zuvor waren diese UTXOs nicht direkt mit meiner Identität verknüpft; jetzt sind sie es. Außerdem wird dadurch für alle Quellen ersichtlich, dass ich im Besitz einer bestimmten Menge Bitcoin bin.

Bei der Verwaltung von UTXOs stehen wirtschaftliche Erwägungen, die auf eine Konsolidierung zur Senkung der Gebühren drängen, im Widerspruch zu guten Datenschutzpraktiken, die empfehlen würden, UTXOs niemals zusammenzulegen. Die Entscheidung zwischen Wirtschaftlichkeit und Datenschutz hängt also von den Prioritäten des jeweiligen Nutzers ab.

Ideal ist es, wenn Sie eine Konsolidierung vermeiden und gleichzeitig eine beträchtliche Anzahl von UTXOs beibehalten können. Optimieren Sie zu diesem Zweck Ihre Erwerbsmethoden. Wenn Sie Ihre Bitcoins in DCA kaufen, versuchen Sie, Ihre einmaligen Käufe so weit wie möglich zu verteilen, um den Wert in weniger UTXOs zu gruppieren. Es wird einfacher sein, einen einmaligen Kauf von 1.000 € alle 2 Monate zu verwalten als einen Kauf von 120 € jede Woche. Dadurch wird die Anzahl der generierten UTXOs minimiert und die Verwaltung Ihres Portfolios vereinfacht, während Ihre Privatsphäre gewahrt bleibt.

Wenn Sie Ihre Bitcoins konsolidieren müssen, sollten Sie die Konsolidierung von UTXOs aus derselben Quelle bevorzugen. Beispielsweise hat die Zusammenführung von 10 UTXOs von einer einzigen Plattform weniger Auswirkungen auf Ihre Privatsphäre als die Zusammenführung von 5 UTXOs von Plattform A mit 5 UTXOs von Plattform B. Wenn eine Konsolidierung aus verschiedenen Quellen unvermeidlich ist, versuchen Sie, sie nach ihren Eigenschaften zu trennen. Fassen Sie zum Beispiel UTXOs, die Sie über KYC erworben haben, in einer Transaktion zusammen, und solche, die Sie über P2P erhalten haben, in einer anderen.

In jedem Fall sollten Sie bedenken, dass jede Konsolidierung unweigerlich zu einem Verlust der Privatsphäre führt. Prüfen Sie daher sorgfältig die Notwendigkeit und die potenziellen Auswirkungen auf Ihre Privatsphäre und berücksichtigen Sie dabei das Risiko.

## Andere bewährte Praktiken

<chapterId>b5216965-7d13-4ea1-9b7c-e292966a487b</chapterId>

Lassen Sie uns gemeinsam einige andere bewährte Praktiken erkunden, die Ihnen helfen können, Ihre Privatsphäre auf Bitcoin zu optimieren.

### Der vollständige Knoten

Ihre Bitcoins in persönlicher Verwahrung zu haben ist gut, aber Ihren eigenen Knotenpunkt zu benutzen ist besser! Aus diesem Grund ist ein eigener Knotenpunkt entscheidend für die vollständig souveräne Nutzung von Bitcoin:


- Widerstandsfähigkeit gegen Zensur**: Ihre Transaktionen können von niemandem blockiert werden;
- Unabhängigkeit von Drittparteien**: Sie sind bei der Überprüfung von Blockchain-Daten nicht mehr von einem externen Dienst abhängig;
- Aktive Teilnahme**: Sie haben die Möglichkeit, Ihre eigenen Validierungsregeln festzulegen und sich direkt am Konsensverfahren zu beteiligen;
- Beitrag zum Netzwerk**: Indem Sie einen Knoten betreiben, helfen Sie, das Bitcoin-Netzwerk zu stärken und zu verbreiten;
- Technische Ausbildung**: Das Betreiben eines vollständigen Knotens ist eine großartige Möglichkeit, Ihr technisches Wissen über Bitcoin zu vertiefen.

Zusätzlich zu diesen Vorteilen verbessert die Verwendung eines Full Nodes auch Ihre Privatsphäre bei der Übermittlung Ihrer Transaktionen. Wenn Sie eine Transaktion ausstellen, wird diese zunächst über Ihre Wallet erstellt und signiert. Um sie im Bitcoin-Netzwerk zu übertragen, muss sie mindestens einem Knoten bekannt sein. Durch die Verwendung eines eigenen Knotens haben Sie direkte Kontrolle über diese Übertragung, was Ihre Privatsphäre verbessert und das Risiko eines Datenverlusts verringert.

![BTC204](assets/fr/099.webp)

Wenn Sie keinen eigenen Bitcoin-Knotenpunkt haben, sind Sie gezwungen, den eines Dritten zu nutzen, der z. B. von Ihrem Wallet-Softwareanbieter angeboten wird. Neben der Übertragung von Transaktionen benötigt Ihre Wallet Zugang zu verschiedenen Informationen wie ausstehende Transaktionen, mit Ihren Adressen verbundene Guthaben oder die Anzahl der Bestätigungen für Ihre Transaktionen. Um auf all diese Daten zuzugreifen, müssen Sie einen Knoten abfragen.

![BTC204](assets/fr/100.webp)

Das Hauptrisiko, wenn Sie Ihren Bitcoin-Knoten nicht verwenden, besteht darin, dass der Betreiber des Drittknotens Ihre Aktivitäten auf der Blockchain beobachten oder diese Informationen sogar an andere Stellen weitergeben kann. Um dieses Risiko zu begrenzen, besteht eine Zwischenlösung darin, eine Wallet-Software zu verwenden, mit der Sie Ihre Verbindungen über Tor maskieren können. Dadurch können Sie die Offenlegung Ihrer Daten verringern. Die optimale Lösung ist jedoch nach wie vor ein eigener Bitcoin-Knoten, über den Sie Ihre Transaktionen übermitteln. Natürlich müssen Sie auch dafür sorgen, dass keine Informationen aus Ihrem Knoten nach außen dringen, aber das ist ein anderes Thema, das wir in den folgenden Abschnitten untersuchen werden.

Neben dem offensichtlichen Vorteil für Ihre Privatsphäre stellt ein eigener vollständiger Knotenpunkt auch die Richtigkeit der Daten auf der Blockchain sicher, schützt vor Zensur und ermöglicht es Ihnen, aktiv an der Bitcoin-Governance teilzunehmen. Durch die Verwendung eines eigenen Knotens tragen Sie Ihr wirtschaftliches Gewicht zu der Blockchain Ihrer Wahl bei, was bei Konflikten innerhalb der Gemeinschaft wichtig ist, wie zum Beispiel während des Block Size War von 2015 bis 2017. Im Falle einer Abspaltung könnte die Verwendung des Knotens eines Dritten dazu führen, dass Sie eine Kette unterstützen, die Sie nicht bevorzugen möchten, da der Knotenbetreiber die Entscheidung für Sie trifft. Wie Sie verstehen können, ist es aus Sicht des Datenschutzes und der individuellen Souveränität unerlässlich, einen eigenen vollständigen Knoten zu betreiben und zu verwenden!

### Täuschende Analyse-Heuristiken

Generell ist es wichtig, die Heuristiken, die wir im vorigen Abschnitt besprochen haben, zu verstehen, um sie besser vermeiden oder täuschen zu können. Die Übernahme einer Reihe von bewährten Praktiken kann sich als vorteilhaft erweisen, auch wenn sie nicht unbedingt notwendig sind. Sie bieten eine zusätzliche Schutzebene, die für die Wahrung der Privatsphäre bei der Verwendung von Bitcoin wichtig sein kann.

Der erste Ratschlag, den ich geben kann, ist, sich in die dichteste Menge einzufügen. Bei Bitcoin bedeutet dies, die am weitesten verbreiteten Skriptvorlagen zu verwenden. Zum Beispiel sind P2WSH-Skripte, die oft für Multisig-SegWit-V0-Konfigurationen verwendet werden, sehr selten. Sie erlauben es nicht, sich in einer großen Menge von Anonymität zu verstecken. Das Gleiche gilt für ältere Modelle wie P2PKH oder P2SH. Obwohl sie im UTXO-Set weit verbreitet sind, werden sie immer seltener für neue Transaktionen verwendet.

Im Allgemeinen ist es sicherer, sich dem neuesten Skript-Standard zuzuwenden, solange er ausreichend verbreitet ist. Während ich also im Jahr 2022 von der Verwendung von P2TR (Taproot) wegen seiner geringen Verbreitung abgeraten hätte, würde ich im Jahr 2024 empfehlen, sich für diese Art von Skript oder andernfalls für das SegWit V0-Skript zu entscheiden, da die Zahl der Transaktionen, die P2TR verwenden, allmählich einen sehr großen Anteil ausmacht.

Quelle:[txstats.com](https://txstats.com/d/000000054/utxo-set-repartition-by-output-type)

Ein weiterer Tipp zur Wahrung Ihrer Privatsphäre besteht darin, zu versuchen, interne Transaktionsheuristiken zu umgehen. Wenn Sie z.B. eine Zahlung vornehmen, können Sie versuchen, eine Ausgabe mit einem runden Betrag zu vermeiden, da dies signalisieren könnte, dass die andere Ausgabe eine Änderung darstellt. Wenn Sie 100k Satoshi an einen Freund schicken müssen, sollten Sie einen etwas höheren Betrag überweisen, um diese Heuristik zu umgehen. Versuchen Sie auch, keine Restbeträge zu erzeugen, die im Vergleich zur geleisteten Zahlung unverhältnismäßig hoch sind, da dies ebenfalls verraten könnte, welcher der Beträge einen Restbetrag darstellt.

Wenn Sie regelmäßig Bitcoin-Transaktionen durchführen, sollten Sie darauf achten, dass Sie diese nicht immer zu denselben Zeiten übermitteln. Indem Sie die Übermittlung Ihrer Transaktionen über den Tag und die Woche verteilen, vermeiden Sie, dass außenstehende Beobachter ein zeitliches Muster auf der Grundlage von Zeitzonen erkennen können, das ihre Analyse verbessern könnte.

Zusätzlich zu all diesen bewährten Praktiken, die Sie täglich anwenden sollten, gibt es noch effektivere Methoden, um die Rückverfolgbarkeit Ihrer Bitcoins vollständig zu unterbrechen. Dazu gehören natürlich Coinjoin-Transaktionen, die wir im folgenden Abschnitt genauer untersuchen werden.

# Verstehen von Coinjoin-Transaktionen

<partId>6d0bbf16-3714-4db1-9897-2d45019f6bdc</partId>

## Was ist eine Coinjoin-Transaktion?

<chapterId>0862bc6b-1c48-4aa4-b76d-4f547b469008</chapterId>

Nachdem wir uns mit den Grundlagen des Schutzes der Privatsphäre beschäftigt haben, werden wir nun anspruchsvollere Techniken besprechen, die darauf abzielen, Ihre Privatsphäre aktiv zu schützen, insbesondere durch die Trennung Ihrer Bitcoin-Historie. Im nächsten Teil werden wir viele kleine Techniken erkunden, aber zuerst möchte ich Ihnen etwas über coinjoin erzählen.

Coinjoin wird oft als der effektivste Weg angesehen, die Privatsphäre von Bitcoin-Nutzern zu schützen. Aber was genau ist eine Coinjoin-Transaktion? Lassen Sie es uns gemeinsam herausfinden.

### Die Grundprinzipien von Coinjoin

Coinjoin ist eine Technik, die die Verfolgung von Bitcoins auf der Blockchain unterbricht. Sie basiert auf einer kollaborativen Transaktion mit einer spezifischen Struktur gleichen Namens: der Coinjoin-Transaktion.

Wie wir in den ersten Teilen dieses Kurses gesehen haben, sind die Transaktionen auf Bitcoin allen Nutzern über ihren Knotenpunkt bekannt. Es ist daher einfach, die elektronische Signaturkette jeder Münze zu überprüfen und ihre Geschichte zu beobachten. Dies bedeutet, dass alle Nutzer versuchen können, die Transaktionen anderer Nutzer zu analysieren. Anonymität auf der Transaktionsebene ist daher unmöglich. Auf der Ebene der individuellen Identifizierung bleibt die Anonymität jedoch gewahrt. Im Gegensatz zu herkömmlichen Bankgeschäften, bei denen jedes Konto mit einer persönlichen Identität verknüpft ist, sind bei Bitcoin die Gelder mit kryptografischen Schlüsselpaaren (oder Skripten) verknüpft, was den Nutzern eine Form der Pseudonymität hinter kryptografischen Identifikatoren bietet.

![BTC204](assets/it/51/01.webp)

Die Vertraulichkeit von bitcoin ist also gefährdet, wenn außenstehende Beobachter in der Lage sind, bestimmte UTXOs mit identifizierten Nutzern in Verbindung zu bringen. Sobald diese Verbindung hergestellt ist, ist es möglich, ihre Transaktionen zu verfolgen und ihren Bitcoin-Verlauf zu analysieren. Coinjoin ist eine Technik, die entwickelt wurde, um die Verfolgung von UTXOs zu unterbrechen und Bitcoin-Nutzern ein gewisses Maß an Vertraulichkeit auf Transaktionsebene zu bieten.

Coinjoins verbessern die Vertraulichkeit von Bitcoin-Nutzern, indem sie die Kettenanalyse für außenstehende Beobachter erschweren. Ihre Struktur ermöglicht es, mehrere Coins von verschiedenen Nutzern zu einer einzigen Transaktion zu verschmelzen, wodurch Spuren verwischt werden und es schwierig wird, Verbindungen zwischen Eingabe- und Ausgabeadressen zu bestimmen.

Es ist wichtig zu verstehen, dass das Ziel einer Coinjoin-Transaktion darin besteht, die Geschichte eines Coins zu unterbrechen. Diese Technik verleiht keine dauerhafte Anonymität und unterbricht auch nicht dauerhaft die Rückverfolgbarkeit von Bitcoins, anders als man vielleicht denken könnte. Coinjoin zielt nur darauf ab, die Historie an dem Punkt zu unterbrechen, an dem die Coinjoin-Transaktion durchgeführt wird. Vor und nach dieser Transaktion unterliegt der Coin jedoch weiterhin denselben Risiken für die Privatsphäre.

![BTC204](assets/fr/104.webp)

### Wie funktionieren Coinjoins?

Das Prinzip von coinjoin basiert auf einem kollaborativen Ansatz: Mehrere Nutzer, die ihre Bitcoins mischen möchten, zahlen identische Beträge in die Inputs derselben Transaktion ein. Diese Beträge werden dann in Ausgängen mit gleichem Wert an jeden Nutzer umverteilt.

![BTC204](assets/fr/105.webp)

Am Ende der Transaktion ist es nicht mehr möglich, eine bestimmte Ausgabe mit einer bekannten Benutzereingabe zu verknüpfen. Es gibt keine direkte Verbindung zwischen Inputs und Outputs, wodurch die Verbindung zwischen Nutzern und ihren UTXOs sowie die Historie der einzelnen Münzen unterbrochen wird.

![BTC204](assets/fr/106.webp)

Nehmen wir das Beispiel von Alice. Sie möchte ihrer Schwester Eve zum Geburtstag etwa 100.000 Satoshi (sats) schicken. Alice möchte jedoch nicht, dass Eve ihren Transaktionsverlauf nachverfolgen kann, da sie nicht preisgeben möchte, wie viele Bitcoins sie besitzt oder wie sie diese erhalten hat. Um dies zu erreichen, beschließt Alice, ihre UTXO-Historie mit einer Coinjoin-Transaktion zu unterbrechen. Sie verabredet sich mit Bob, Charles, David und Frank, um eine gemeinschaftliche Transaktion durchzuführen: Alice, Bob, Charles, David und Frank verpfänden jeweils einen UTXO von 105.000 Sats (mit 5.000 Sats für Mining-Gebühren) als Input für die Transaktion:

![BTC204](assets/fr/107.webp)


- Als Gegenleistung für die Nutzung dieser Eingaben generiert jeder eine neue Adresse, um fünf identische Ausgaben von jeweils 100.000 Sats zu erzeugen. Jeder Teilnehmer ruft eine Ausgabe ab:

![BTC204](assets/fr/108.webp)


- Am Ende hat Alice einen UTXO von 100.000 Sats, dessen Geschichte gemischt ist. Sie verwendet diesen UTXO in einer neuen Transaktion, um den Betrag an Eva zu ihrem Geburtstag zu schicken:

![BTC204](assets/fr/109.webp)


- Wenn Eve versucht, diese Transaktion zu analysieren, um Informationen zu extrahieren, stößt sie auf die Coinjoin-Transaktion von Alice, Bob, Charles, David und Frank. Da Eve aufgrund der Einheitlichkeit der Beträge nicht unterscheiden kann, zu wem die einzelnen Eingaben gehören, kann sie weder die Geschichte von Alices UTXO zurückverfolgen noch feststellen, wie viele Bitcoins ihre Schwester besitzt oder wie sie sie erworben hat:

![BTC204](assets/fr/110.webp)

In diesem Szenario nutzte Alice die Coinjoin-Technik, um ihre Privatsphäre gegen Rückwärtsanalysen zu schützen. Alice schützt sich nämlich vor einer möglichen Analyse durch Eve, die von einer bestimmten Transaktion ausgehen würde, um die Geschichte des UTXO rückwärts zu verfolgen. Diesen Schutz vor einer Analyse von der Gegenwart in die Vergangenheit nennen wir retrospektives Anonset. Wir werden dieses Konzept in den letzten Kapiteln dieses Teils noch genauer untersuchen.

Coinjoin bietet jedoch auch die Möglichkeit, den Schutz der Privatsphäre vor einer Analyse von Vergangenheit zu Gegenwart zu verbessern, was als prospektive Anonymisierung bezeichnet wird. Kehren wir zu unserem Beispiel zurück, in dem Alice an ihrem Geburtstag 98.000 Sats an Eve geschickt hat, aber vertauschen wir die Rollen. Stellen wir uns nun vor, dass es Eva ist, die um ihre Privatsphäre besorgt ist. Tatsächlich könnte Alice versucht sein, die Münze, die sie an Eve geschickt hat, zu verfolgen, um Informationen zu sammeln. Eve könnte diesen neu erhaltenen UTXO mit all ihren anderen UTXOs konsolidieren, was Alice die Menge an Bitcoin verraten könnte, die sie in ihrer Brieftasche hat. Um dies zu vermeiden, kann Eve auch die Historie der neu erhaltenen Münze unterbrechen.


- Eve, Grace, Mallory, Oscar und Victor haben jeweils eine UTXO von 98.000 sats als Input in eine Bitcoin-Transaktion eingegeben:

![BTC204](assets/fr/111.webp)


- Als Gegenleistung für die Nutzung dieser Eingänge stellt jeder eine neue Adresse zur Verfügung, um 5 Ausgänge mit jeweils 97.500 Sats zu erzeugen, die vollkommen gleich sind. Jeder Nutzer ruft eine Ausgabe ab:

![BTC204](assets/fr/112.webp)


- Eve besitzt nun einen UTXO mit 97.500 Sats und einer fehlerhaften Historie. Sie kann ihn ohne Bedenken für zukünftige Transaktionen verwenden. Wenn Alice versucht, die Bitcoins zu verfolgen, die sie an Eve geschickt hat, wird sie auf eine Coinjoin-Transaktion stoßen. Sie wird nicht in der Lage sein, festzustellen, zu welchem UTXO-Ausgang Eve gehört. Eine Analyse wird dann unmöglich:

![BTC204](assets/fr/113.webp)

Im ersten Beispiel haben wir gesehen, wie Coinjoin die Privatsphäre einer Münze in Bezug auf ihre Vergangenheit schützen kann, und im zweiten Beispiel, wie es auch die Geschichte einer Münze in Bezug auf ihre Zukunft sichern kann. Deshalb habe ich erwähnt, dass Coinjoin als ein einmaliges Ereignis betrachtet werden sollte, das die Geschichte einer Münze in beide Richtungen aufteilt:

![BTC204](assets/fr/104.webp)

### Mischen, Co-joins, Mixer... Was ist der Unterschied?

Der Begriff "Mischen" wird manchmal verwendet, um Coinjoin zu beschreiben, ein Begriff, den einige Bitcoiner ablehnen, weil sie eine Verwechslung mit Custodial Mixers befürchten. Ich denke jedoch, dass diese Befürchtung unbegründet ist, denn in einem mathematischen Kontext verkörpert Coinjoin genau das Konzept des Mischens.

Im allgemeinen Bereich der Mathematik bezeichnet Mischen die Eigenschaft eines dynamischen Systems, bei dem nach einer bestimmten Zeit theoretisch alle Teile des Ausgangsraums mit jedem anderen Teil gemischt werden können. Vermischung bedeutet, dass sich die Position eines Teilchens oder der Zustand eines Systems so entwickelt, dass seine zukünftige Verteilung unabhängig von seiner anfänglichen Verteilung ist, so dass ein Zustand erreicht wird, in dem die Merkmale des Anfangszustands gleichmäßig im Raum des Systems verteilt sind. Genau das geschieht bei einem Coinjoin mit Bitcoins. Meiner Meinung nach ist Coinjoin also wirklich eine Methode zum Mischen von Münzen.

![BTC204](assets/fr/114.webp)

Es ist jedoch wichtig, Coinjoins von Mixern zu unterscheiden. Ein Mixer ist ein Dienst, bei dem Nutzer ihre Bitcoins zum Mischen einsenden. Diese Dienste waren in den 2010er Jahren sehr beliebt, aber ihre Nutzung ist aufgrund von zwei großen Nachteilen im Vergleich zu Coinjoin zurückgegangen:


- Sie verlangen von den Nutzern, dass sie während des Mischvorgangs auf die Verwahrung ihrer Gelder verzichten, was sie dem Risiko des Diebstahls aussetzt;
- Es gibt keine Garantie dafür, dass der Mixer keine Transaktionsdetails aufzeichnet oder diese Informationen sogar an Blockchain-Analyseunternehmen verkauft.

![BTC204](assets/fr/115.webp)

Heutzutage bevorzugen die Nutzer daher Coinjoin, da sie so während des gesamten Prozesses die volle Kontrolle über ihr Geld behalten. Die Teilnehmer an einem Coinjoin laufen nicht Gefahr, dass ihre Bitcoins von anderen Beteiligten gestohlen werden. Wie das möglich ist, wollen wir im nächsten Kapitel gemeinsam erkunden.

## Zerolink und Chaumian Coinjoins

<chapterId>326c9654-b359-4906-b23d-d6518dd5dc3e</chapterId>

Die Privatsphäre, die ein Coinjoin bietet, hängt von der Größe der Gruppe ab, in der unsere Figur versteckt ist. Daher ist es notwendig, so viele Teilnehmer wie möglich zu finden. Es ist durchaus möglich, einen Coinjoin manuell mit unabhängig voneinander gefundenen Nutzern durchzuführen, aber diese Methode ist komplex und lässt keine großen Anonsets zu.

Aus diesem Grund haben sich auf Bitcoin Coinjoin-Koordinatoren entwickelt. Ihre Aufgabe ist es, verschiedene Nutzer zu verbinden und die Informationen zu übermitteln, die für den erfolgreichen Abschluss der gemeinsamen Transaktion notwendig sind.

![BTC204](assets/fr/116.webp)

Aber wie können wir sicherstellen, dass der Koordinator niemals die Kontrolle über die Bitcoins der Nutzer hat, und obwohl er oder sie die Person ist, die die Coinjoin-Transaktion konstruiert, wie können wir sicherstellen, dass er oder sie nicht die Inputs und Outputs der Nutzer verknüpfen kann, was einen Verlust der Privatsphäre darstellen könnte?

### Chaums Blindsignaturen

Moderne Coinjoin-Implementierungen verwenden die Blindsignaturen von David Chaum, um Informationslecks zu verhindern. Schauen wir uns kurz an, wie diese Blindsignaturen funktionieren.

Chaum-Blindsignaturen sind eine Form der digitalen Signatur, bei der der Aussteller einer Signatur den Inhalt der Nachricht, die er signiert, nicht kennt. Die Unterschrift kann jedoch später anhand der Originalnachricht überprüft werden. Diese Technik wurde 1983 von dem Kryptographen David Chaum entwickelt.

Nehmen wir das Beispiel eines Unternehmens, das ein vertrauliches Dokument, z. B. einen Vertrag, authentifizieren möchte, ohne dessen Inhalt preiszugeben. Das Unternehmen wendet ein Maskierungsverfahren an, das das Originaldokument kryptografisch umwandelt und umkehrbar macht. Dieses geänderte Dokument wird an eine Zertifizierungsstelle gesandt, die eine Blindsignatur anbringt, ohne den zugrunde liegenden Inhalt zu kennen. Nachdem das Unternehmen das signierte Dokument erhalten hat, entfernt es die Maskierung der Signatur. Das Ergebnis ist ein Originaldokument, das durch die Unterschrift der Behörde beglaubigt wird, ohne dass die Behörde jemals den ursprünglichen Inhalt gesehen hat.

Die Blindsignaturen von Chaum ermöglichen es also, die Authentizität eines Dokuments zu zertifizieren, ohne dessen Inhalt zu kennen, wodurch sowohl die Vertraulichkeit der Daten des Benutzers als auch die Integrität des signierten Dokuments gewährleistet wird.

### Chaumianische Münzprägung

In "Chaumian CoinJoins" werden Tor und David Chaums blinde Signaturen kombiniert, um sicherzustellen, dass der Koordinator nicht wissen kann, zu welchem Nutzer jede Ausgabe gehört. Der Prozess der Erstellung von CoinJoin-Transaktionen besteht aus 3 Hauptschritten: Registrierung der Eingaben, Registrierung der Ausgaben und Signierung der Transaktionen. Wir wollen diesen Prozess am Beispiel von Alice, einer der Coinjoin-Teilnehmerinnen, untersuchen. Alle anderen Teilnehmer befolgen die gleichen Schritte wie Alice, jeder für sich.

**Schritt 1: Registrierung der Eingaben.**


- Alice sendet dem Koordinator die UTXO-Adresse, die sie als Eingabe für die Transaktion verwenden möchte, sowie die maskierte Empfangsadresse, die sie als Ausgabe verwenden möchte, um ihre Bitcoins zu erhalten. Daher kann der Koordinator die Adresse von Alice nicht kennen. Er sieht nur ihre maskierte Version.
- Der Koordinator prüft die Gültigkeit der Eingaben und signiert dann die maskierte Adresse von Alice mit ihrem privaten Schlüssel. Anschließend sendet er Alice die Blindsignatur.

**Schritt 2: Aufzeichnung der Ausgänge


- Alice kann nun die Maskerade von ihrer Adresse entfernen, die mit dem privaten Schlüssel des Koordinators signiert ist. Sie baut eine neue Verbindung unter einer anderen Tor-Identität auf. Der Koordinator kann nicht erkennen, dass es Alice ist, die sich unter dieser neuen Identität verbindet.
- Alice sendet die unverschlüsselte Adresse und Signatur an den Koordinator (der immer noch nicht weiß, dass es sich um Alice handelt).

**Schritt 3: Unterschreiben Sie die Transaktion


- Der Koordinator ruft in ähnlicher Weise unmaskierte Ausgaben von allen Teilnehmern ab. Anhand der zugehörigen Signaturen kann er überprüfen, ob jede anonym gesendete Ausgabe tatsächlich zuvor mit seinem privaten Schlüssel signiert wurde, wodurch ihre Legitimität gewährleistet ist. Er ist dann bereit, die Coinjoin-Transaktion zu erstellen und sendet sie an die Teilnehmer, damit diese sie unterzeichnen.
- Alice überprüft wie die anderen Teilnehmer, ob ihre Eingaben und Ausgaben korrekt in der vom Koordinator erstellten Transaktion enthalten sind. Wenn alles in Ordnung ist, sendet sie die Signatur, die das Skript ihrer Eingabe freischaltet, an den Koordinator.
- Nachdem er die Unterschriften aller Coinjoin-Teilnehmer gesammelt hat, kann der Koordinator die Transaktion über das Bitcoin-Netzwerk übertragen, damit sie zu einem Block hinzugefügt werden kann.

In diesem System ist der Koordinator nicht in der Lage, eine Eingabe mit einer bestimmten Ausgabe zu verknüpfen. Außerdem kann er nicht über die Gelder der Teilnehmer verfügen, da er nie Zugang zu den privaten Schlüsseln hat, die zum Entsperren ihrer UTXOs benötigt werden. Während des gesamten Prozesses und bis zum Ende von Schritt 3 hat er nicht einmal Zugriff auf die Unterschriften. Wenn Alice und die anderen Teilnehmer die globale Transaktion unterschreiben, nachdem sie sich vergewissert haben, dass alles korrekt ist, kann der Koordinator diese Transaktion, einschließlich der Ausgaben, nicht mehr ändern, ohne sie für ungültig zu erklären. Auf diese Weise wird ein Bitcoin-Diebstahl durch den Koordinator verhindert.

Letztendlich möchte der Coinjoin-Nutzer, wenn er seinen Output in der Transaktion registriert, ähnliche Garantien wie ein Bürger, der an einer Wahl teilnimmt. Es gibt eine Dualität zwischen den öffentlichen und privaten Aspekten dieser Handlungen. Der Wähler möchte nicht, dass sein Stimmzettel mit seiner Identität in Verbindung gebracht wird; der Coinjoin-Nutzer möchte nicht, dass sein Output mit seinem Input in Verbindung gebracht wird. Wenn es dem Koordinator oder einer anderen Partei gelingt, eine Verbindung zwischen einer Eingabe und einer Ausgabe herzustellen, verliert Coinjoin seinen gesamten Zweck. Wie bereits erläutert, muss der Coinjoin als Unterbrechung in der Geschichte einer Münze funktionieren. Diese Unterbrechung entsteht gerade dadurch, dass es nicht möglich ist, eine bestimmte Eingabe mit einer bestimmten Ausgabe in der Coinjoin-Transaktion zu verknüpfen (prospektive Anonset) und umgekehrt (retrospektive Anonset).

Andererseits gibt es den öffentlichen Aspekt: Der Wähler möchte sicherstellen, dass sein Stimmzettel in der Wahlurne enthalten ist; ebenso möchte der Coinjoin-Nutzer sicherstellen, dass sein Output in der Coinjoin-Transaktion enthalten ist. Tatsächlich ist es für Coinjoin-Teilnehmer absolut notwendig, das Vorhandensein ihres Outputs vor der Unterzeichnung der Transaktion überprüfen zu können, da der Koordinator sonst das Geld stehlen könnte.

Es sind genau diese beiden öffentlichen und privaten Aspekte, die durch die Verwendung von David Chaums Blindsignaturen ermöglicht werden, die den Chaumians coinjoin-Teilnehmern die Sicherheit geben, dass ihre Bitcoins nicht gestohlen werden und dass ihr Geld nicht zurückverfolgt werden kann.

### Wer hat das Konzept des Coinjoin erfunden?

Es ist schwierig, mit Sicherheit zu bestimmen, wer zuerst die Idee des Coinjoin auf Bitcoin eingeführt hat und wer auf die Idee kam, David Chaums blinde Signaturen in diesem Zusammenhang zu verwenden. Es wird oft angenommen, dass es Gregory Maxwell war, der es zum ersten Mal in [einem Beitrag auf BitcoinTalk im Jahr 2013] erwähnte (https://bitcointalk.org/index.php?topic=279249.0):

Verwendung von Chaums Blindsignaturen: Die Nutzer stellen eine Verbindung her und geben Eingaben (und Adressen für den Rest) sowie eine kryptografisch verdeckte Version der Adresse an, an die sie ihre privaten Münzen senden möchten; der Server signiert die Token und sendet sie an die Nutzer zurück. Der Server signiert die Token und schickt sie den Nutzern zurück. Die Nutzer stellen eine anonyme Verbindung her, geben ihre Ausgabeadressen preis und schicken sie an den Server zurück. Der Server kann sehen, dass alle Ausgaben von ihm signiert wurden und dass folglich alle Ausgaben von gültigen Teilnehmern stammen. Später verbinden sich die Teilnehmer erneut und signieren.

Maxwell, G. (2013, August 22). _CoinJoin: Bitcoin's privacy for the real world_. BitcoinTalk Forum. https://bitcointalk.org/index.php?topic=279249.0

Es gab jedoch frühere Erwähnungen von Chaum-Signaturen im Zusammenhang mit Mischen und Coinjoins. [Im Juni 2011 präsentierte Duncan Townsend auf BitcoinTalk](https://bitcointalk.org/index.php?topic=12751.0) einen Mixer, der Chaum-Signaturen in einer Weise verwendet, die modernen Chaumians Coinjoins sehr ähnlich ist.

Im gleichen Thread gibt es [eine Hashcoin-Nachricht als Antwort auf Duncan Townsend](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793), um seinen Mixer zu verbessern. Der in dieser Nachricht beschriebene Prozess ist genau das, was Coinjoins am nächsten kommt. Ein ähnliches System wird auch in [einer Nachricht von Alex Mizrahi aus dem Jahr 2012](https://gist.github.com/killerstorm/6f843e1d3ffc38191aebca67d483bd88#file-laundry) erwähnt, als er die Schöpfer von Tenebrix beriet, einem der ersten Altcoins, der später als Grundlage für die Schaffung von Litecoin diente. Auch der Begriff "Coinjoin" selbst wurde nicht von Greg Maxwell erfunden, sondern geht auf eine Idee von Peter Todd zurück.

![BTC204](assets/fr/125.webp)

### Zerolink

Zerolink ist ein umfassendes Mischprotokoll, das Chaumiani-Coinjoins und verschiedene Strategien zum Schutz der Anonymität der Nutzer vor verschiedenen Formen der Kettenanalyse integriert, wodurch Fehler im Zusammenhang mit der Verwaltung von Geldbörsen erheblich reduziert werden. Dieses Protokoll [wurde von nopara73 und TDevD im Jahr 2017 eingeführt] (https://github.com/nopara73/ZeroLink/blob/master/README.md).

![BTC204](assets/fr/126.webp)

Wie der Name schon sagt, besteht das Prinzip von Zerolink darin, Coinjoin-Transaktionen durchzuführen, die sicherstellen, dass die Verbindungen zwischen Inputs und Outputs nicht zurückverfolgt werden können. Diese Eigenschaft wird dadurch erreicht, dass alle Outputs vollkommen identische Beträge aufweisen.

![BTC204](assets/fr/127.webp)

Eine wichtige Präventivmaßnahme von Zerolink besteht in der vollständigen Trennung von unvermischten UTXOs und gemischten UTXOs unter Verwendung getrennter Sätze kryptografischer Schlüssel oder sogar getrennter Wallets. Auf diese Weise wird die "Pre-Mix"-Wallet, die für Münzen vor der Vermischung bestimmt ist, von der "Post-Mix"-Wallet unterschieden, die für gemischte Münzen reserviert ist.

![BTC204](assets/fr/128.webp)

Diese strikte Trennung von UTXOs dient in erster Linie dazu, versehentliche Verbindungen zwischen einem gemischten und einem unvermischten UTXO zu verhindern. Kommt es nämlich zu solchen Verbindungen, wird die Wirksamkeit von Coinjoin auf dem gemischten UTXO ohne Wissen des Benutzers zunichte gemacht und damit die Vertraulichkeit eines UTXO gefährdet, von dem man annahm, dass er gebrochen wurde. Diese Verbindungen können entweder durch die Wiederverwendung von Adressen entstehen, um einen gemischten UTXO mit einem nicht gemischten zu sichern, oder durch die Anwendung der Common Input Ownership Heuristik (CIOH), wenn der Nutzer gemischte und nicht gemischte UTXOs als Inputs für dieselbe Transaktion verwendet. Durch die Trennung der Portfolios vor und nach der Vermischung werden diese zufälligen Verbindungen vermieden und der Nutzer vor unbeabsichtigten Fehlern geschützt.

![BTC204](assets/fr/129.webp)

Diese Trennung bietet auch die Möglichkeit, auf der Ebene der Portfoliosoftware unterschiedliche Regeln für Vormischungs- und Nachmischungsportfolios anzuwenden. Im Post-Mixing-Portfolio kann die Software beispielsweise die Zusammenführung von Eingangs-UTXOs verbieten, um die Anwendung von CIOH zu verhindern, die die Anonymität des Benutzers beeinträchtigen würde. Es ist auch möglich, die Verwendung von Skripten und Transaktionsoptionen (wie z. B. RBF-Signalisierung) zu standardisieren, um eine Identifizierung durch Wallet Fingerprinting zu verhindern.

Derzeit ist Whirlpool die einzige Coinjoin-Implementierung, die das Zerolink-Protokoll strikt durchsetzt. Im folgenden Kapitel werden wir die verschiedenen bestehenden Coinjoin-Implementierungen sowie die Vor- und Nachteile der einzelnen Implementierungen untersuchen.

## Coinjoin-Implementierungen

<chapterId>e37ed073-9498-4e4f-820b-30951e829596</chapterId>

im Jahr 2024 sehen wir bedeutende Veränderungen bei den Tools, die Nutzern zur Verfügung stehen, die Coinjoins auf Bitcoin durchführen wollen. Wir befinden uns derzeit in einer entscheidenden Phase, und der Coinjoin-Markt erfährt eine große Umstrukturierung. Daher wird dieses Kapitel wahrscheinlich im Laufe der Zeit aktualisiert werden._

Zur Zeit gibt es hauptsächlich 3 verschiedene Implementierungen von coinjoin auf Bitcoin:


- Whirlpool;
- Wabisabi;
- JoinMarket.

Jede dieser Implementierungen zielt darauf ab, die Geschichte der UTXOs durch Coinjoin-Transaktionen zu durchbrechen. Ihre Mechanismen unterscheiden sich jedoch erheblich. Daher ist es wichtig zu verstehen, wie sie funktionieren, um die Option zu wählen, die Ihren Bedürfnissen am besten entspricht.

### JoinMarket

JoinMarket, 2015 von Adam Gibson und Chris Belcher gegründet, unterscheidet sich von anderen Coinjoin-Implementierungen durch sein einzigartiges Nutzer-Matching-Modell. Dieses System basiert auf einem P2P-Tauschmarktplatz, auf dem einige Nutzer, die "Maker", ihre Bitcoins zum Mischen zur Verfügung stellen, während andere, die "Taker", diese Mittel nutzen, um Coinjoins gegen eine Gebühr durchzuführen.

![BTC204](assets/fr/130.webp)

Bei diesem Modell stellen die "Maker" ihre Bitcoins den "Takern" zur Verfügung und erhalten im Gegenzug Gebühren für ihre Dienstleistung. Die "Taker" wiederum zahlen für die Nutzung der Bitcoins der "Maker", um ihre eigenen Coinjoin-Transaktionen durchzuführen. Die Gebühren für die Dienstleistungen variieren je nach Rolle: Die "Maker" erhalten Gebühren für ihre Liquiditätsangebote, während die "Taker" Provisionen zahlen. Dieser Marktplatz funktioniert frei und ohne Nutzungsbedingungen.

Ein großer Nachteil von JoinMarket ist seine Komplexität, die eine gewisse Vertrautheit mit Terminals voraussetzt, um es effektiv nutzen zu können. Obwohl diese Komplexität für einen erfahrenen Benutzer kein Hindernis darstellt, kann sie den Zugang für die breite Öffentlichkeit einschränken. Die kürzlich erfolgte Einführung einer Webschnittstelle namens JAM hat die Nutzung jedoch etwas erleichtert.

![BTC204](assets/fr/131.webp)

Quelle: [JAM](https://github.com/joinmarket-webui/jam/blob/devel/docs/assets/screenshot-dark.webp)

Die technische Barriere bleibt jedoch ein großes Hindernis. Im Coinjoin-Ökosystem, in dem die Vertraulichkeit durch die Anzahl der Teilnehmer erhöht wird, wirkt sich jede Einschränkung, die die Zugänglichkeit verringert, direkt auf die verfügbare Liquidität aus, die ein entscheidender Faktor für die Mischeffizienz ist. Bitcoin, das bereits eine Nische im Bereich der Finanztransaktionen darstellt, sieht die Verwendung von Coinjoin als eine Unternische an, und JoinMarket stellt einen noch spezielleren Teil dar, wodurch sein Potenzial, die Anonymität seiner Nutzer zu erhöhen, eingeschränkt wird.

Trotz seines innovativen P2P-Matching-Modells für Coinjoins hat JoinMarket einige erhebliche Nachteile, insbesondere im Hinblick auf die Transaktionsstruktur. Im Gegensatz zu anderen Implementierungen wie Whirlpool garantiert JoinMarket keine perfekte Gleichheit zwischen den Outputs, und es können deterministische Verbindungen zwischen Inputs und Outputs hergestellt werden. Außerdem fehlen Instrumente, die verhindern, dass bereits gemischte Münzen erneut gemischt werden, was die von den Nutzern gewünschte Vertraulichkeit beeinträchtigen könnte. Schließlich ist das Konzept von JoinMarket zwar attraktiv, insbesondere für diejenigen, die an einem dynamischen Liquiditätsmarkt interessiert sind, aber seine strukturellen Schwächen und seine technische Komplexität machen es meiner Meinung nach weniger attraktiv, sowohl für Anfänger als auch für Experten, die eine Coinjoin-Implementierung anstreben.

### Wabisabi

Wabisabi ist eine weitere Implementierung von coinjoin, mit einem Ansatz, der die Koordination von Transaktionen zentralisiert. Dieses Modell wurde von Ádám Ficsór (nopara73), Yuval Kogman, Lucas Ontivero und István András Seres im Jahr 2021 entwickelt und im darauffolgenden Jahr in die Software Wasabi 2.0 integriert. Wabisabi stellt genau genommen eine Weiterentwicklung des Coinjoin-Modells der 2018 eingeführten Wasabi-Software dar.

In den späten 2010er Jahren führte Wasabi eine Transaktionsstruktur für seine Coinjoin-Transaktionen ein, die sich grundlegend von derjenigen von Whirlpool unterschied. Um die Anonymität der Teilnehmer zu erhöhen, verwendete Wasabi sehr große Coinjoin-Transaktionen, die Dutzende von Teilnehmern zusammenfassten. Im Gegensatz dazu entschied sich Whirlpool für mehrere kleine Transaktionen, die einen exponentiellen Anstieg der Anonsets bei jedem Zyklus ermöglichten.

Auch die Methoden zur Behandlung des Restes unterschieden die beiden Implementierungen. Bei Whirlpool wurde der Rest vor Coinjoin-Zyklen durch TX0 ausgeschlossen und von UTXOs isoliert, ein Konzept, das ich im nächsten Kapitel näher erläutern werde. Bei Wasabi hingegen bildete der Rest einen der Ausgänge der Coinjoin-Transaktion, wobei deterministische Verknüpfungen zwischen einigen Eingängen und Ausgängen aufrechterhalten wurden.

Mit Wabisabi, Version 2.0 von Wasabi, wurde der Ansatz für Coinjoin-Transaktionen an den von Whirlpool angeglichen. Obwohl die Coinjoin-Transaktionen nach wie vor sehr groß sind, ist es nun möglich, mehrere aufeinanderfolgende Runden zu verketten und damit dem Modell von Whirlpool zu folgen. Besondere Anstrengungen wurden auch bei der Verwaltung des Wechselgeldes unternommen: Im Gegensatz zu Wasabi 1.0, wo das Wechselgeld direkt an die Benutzereingabe gekoppelt war, versucht Wabisabi, das Wechselgeld in mehrere kleine Beträge aufzuteilen, die in gleicher Stückelung an alle Teilnehmer verteilt werden.

Wir werden dies anhand eines vereinfachten Beispiels mit nur 2 Benutzern veranschaulichen: Alice möchte 115.000 Sats mischen und Bob 210.000 Sats. Ohne Berücksichtigung der Provisionen hätte eine Coinjoin-Transaktion mit Wasabi 1.0 drei Outputs von 100.000 Sats erzeugt, plus einen Rest von 15.000 Sats für Alice und einen Rest von 10.000 Sats für Bob. Die Restausgänge wären immer mit den Eingängen verknüpft:

Unter Wabisabi würde dieselbe Transaktion zu 3 Outputs von 100.000 Sats und 5 Outputs von 5.000 Sats führen, wodurch der Rest so verteilt wird, dass er nicht direkt auf einen bestimmten Input zurückzuführen ist:

Ich persönlich bin der Meinung, dass das Änderungsmanagement in Wabisabi mehrere Risiken birgt, die seine Wirksamkeit in Bezug auf den Datenschutz beeinträchtigen könnten:


- Wenn ein Nutzer einen UTXO beisteuert, der deutlich größer ist als der der anderen Teilnehmer, erhält er unweigerlich einen Änderungsbetrag, der mit seiner Eingabe in Verbindung gebracht wird. Dies widerspricht dem ursprünglichen Ziel des Protokolls, das darauf abzielt, jede identifizierbare Veränderung zu eliminieren;
- Die Vervielfachung von Bezeichnungen, um den Rest zu fragmentieren, kann paradoxerweise die Effizienz der Mischung beeinträchtigen. Dieser Prozess kann zu einem Rückgang der Anonsets für bestimmte Outputs führen, da diese leichter identifizierbar werden;
- Diese Methode erzeugt auch UTXOs von geringem Wert, die für den Nutzer ein Verwaltungsproblem darstellen. Diese kleinen UTXOs können, wenn sie im Verhältnis zu ihrem Wert zu teuer werden, zu "Staub" werden Dieses Phänomen veranlasst den Nutzer, mehrere Eingabe-UTXOs in seinen zukünftigen Transaktionen zusammenzuführen oder zu konsolidieren. In beiden Fällen kann dies aufgrund von COH die erzielten Anonsets verringern oder die durch den anfänglichen Coinjoin erzielten Datenschutzvorteile vollständig zunichte machen.

Im Gegensatz zu Whirlpool, das das ZeroLink-Protokoll umsetzt, indem es eine strikte Trennung zwischen UTXO Pre-Mix und Post-Mix sicherstellt, hält Wabisabi diese strikte Trennung nicht ein. Außerdem gab es Probleme mit der Wiederverwendung von Adressen durch einige Kunden von Wasabi, was für den Benutzer offensichtlich sehr schädlich ist.

In Version 2.0 von Wasabi wurde eine neue Preispolitik für Coinjoin eingeführt. Jetzt werden die Koordinationsgebühren für UTXOs, die größer als 0,01 Bitcoin sind, auf 0,3 Prozent festgesetzt, während diese Gebühren für kleinere UTXOs komplett entfallen. Darüber hinaus sind Remixes für diese kleineren UTXOs kostenlos, obwohl die Mining-Gebühren für alle Transaktionen, einschließlich Remixes, bestehen bleiben.

Diese Politik steht im Gegensatz zu der von Whirlpool, wo die Provisionen unabhängig von der Größe der erzielten Anonsets fest bleiben. Bei Wasabi 2.0 werden die Koordinatorprovisionen für kleine UTXOs zwar auf Null zurückgesetzt, aber der Nutzer muss dennoch für alle Transaktionen, einschließlich Remixes, Mining-Provisionen zahlen.

Zum Zeitpunkt der Erstellung dieses Artikels ist die Nutzung von Wasabi aufgrund der jüngsten Ereignisse erheblich komplexer geworden. Nach der Verhaftung der Gründer von Samourai Wallet kündigte zkSNACKs, das Unternehmen, das die Entwicklung von Wasabi finanziert und verwaltet, die Einstellung seines Coinjoin-Koordinationsdienstes am 1. Juni 2024 an. Dieser Koordinator, der standardmäßig auf Wasabi eingestellt war, verfügte über den Großteil der Liquidität.

Mit der Schließung dieses Hauptkoordinators müssen sich die Nutzer nun mit neuen unabhängigen Koordinatoren verbinden. Diese Änderung ist bedenklich: Einerseits verfügen die neuen Koordinatoren möglicherweise nicht über ausreichende Liquidität, was die Wirksamkeit von Coinjoins im Hinblick auf den Datenschutz verringert. Zum anderen besteht das Risiko, auf einen böswilligen Koordinator zu stoßen. Diese Situation birgt erhebliche neue Risiken für diejenigen, die Wabisabi nutzen wollen.

Die Entscheidung von zkSNACKs, dem Unternehmen hinter Wasabi, die Dienste eines Blockchain-Analyseunternehmens in Anspruch zu nehmen, um Teilnehmer an Coinjoins zu filtern, wirft nicht nur technische, sondern auch ethische und strategische Fragen auf. Die ursprüngliche Idee war, die Nutzung von Coinjoins auf Wasabi durch Kriminelle zu verhindern, was legitim erscheinen mag. Es wirft jedoch ein Paradoxon auf: die Zahlung von Gebühren an einen Koordinator, dessen Hauptaufgabe darin besteht, die Privatsphäre der Nutzer zu schützen, nur um dann ein Unternehmen zu finanzieren, dessen Ziel es ist, eben diese Privatsphäre zu gefährden.

Noch beunruhigender ist das Prinzip des Filterns, das in krassem Gegensatz zur Philosophie von Bitcoin steht, ein offenes und unzensiertes Finanzsystem anzubieten. Obwohl es gerechtfertigt erscheinen mag, kriminelle Aktivitäten auszuschließen, könnte diese Filterung auch Personen betreffen, deren Handlungen, obwohl sie in manchen Kontexten als illegal eingestuft werden, moralisch vertretbar oder gesellschaftlich nützlich sein könnten. Das Beispiel von Edward Snowden veranschaulicht diese Dichotomie perfekt: Von einigen Regierungen wird er wegen seiner Enthüllungen als Krimineller angesehen, von anderen als Whistleblower, der im öffentlichen Interesse gehandelt hat. Diese Komplexität unterstreicht die potenzielle Gefahr der Filterung, die zwar mit einer guten Absicht beginnt, aber letztlich den Rechten und der Sicherheit der rechtmäßigen Nutzer schaden könnte. Ich hätte auch verfolgte Aktivisten und Journalisten in bestimmten autoritären Regimen erwähnen können. Wie Sie vielleicht schon erraten haben, bevorzuge ich zweifellos das Whirlpool-Modell für die Durchführung von Coinjoins auf Bitcoin. Dieses System zeichnet sich durch seine Strenge aus und bietet bessere Garantien in Bezug auf den Datenschutz. Es ist auch das einzige, das eine Mischung vorschlägt, die in einem mathematischen Kontext als perfekt gilt. Meiner Meinung nach stellt dieses Modell die Zukunft von Coinjoins auf Bitcoin dar. Ich lade Sie daher ein, dieses Modell im nächsten Kapitel näher zu untersuchen.

## Der Betrieb von Whirlpool

<chapterId>bdbd7109-e36d-4b4f-a3c6-928df4e9bfda</chapterId>

Whirlpool unterscheidet sich von anderen Coinjoin-Methoden durch die Verwendung von "_ZeroLink_"-Transaktionen, die sicherstellen, dass es technisch keine mögliche Verbindung zwischen allen Inputs und allen Outputs gibt. Diese perfekte Vermischung wird durch eine Struktur erreicht, bei der jeder Teilnehmer einen identischen Betrag an Input (mit Ausnahme der Mining-Gebühren) beisteuert und somit Outputs in vollkommen gleicher Höhe erzeugt.

Dieser restriktive Ansatz bei den Inputs verleiht den Coinjoin-Transaktionen von Whirlpool ein einzigartiges Merkmal: das völlige Fehlen deterministischer Verbindungen zwischen Inputs und Outputs. Mit anderen Worten: Jeder Output hat die gleiche Wahrscheinlichkeit, einem beliebigen Teilnehmer zugeordnet zu werden, bezogen auf alle anderen Outputs in der Transaktion.

![BTC204](assets/fr/136.webp)

### Der allgemeine Betrieb von Whirlpool

Ursprünglich war die Anzahl der Teilnehmer an jedem Whirlpool-Coinjoin auf 5 begrenzt, mit 2 neuen Teilnehmern und 3 Remixern (wir werden diese Konzepte später erklären). Der im Jahr 2023 beobachtete Anstieg der Gebühren für On-Chain-Transaktionen veranlasste die Teams von Samourai jedoch, ihr Modell zu überdenken, um den Datenschutz zu verbessern und gleichzeitig die Kosten zu senken. Unter Berücksichtigung der Situation auf dem Provisionsmarkt und der Anzahl der Teilnehmer kann der Koordinator nun Coinjoins organisieren, die 6, 7 oder 8 Teilnehmer umfassen. Diese erweiterten Sitzungen werden unter dem Namen "_Surge Cycles_" bezeichnet Es ist wichtig zu beachten, dass es unabhängig von der Konfiguration immer nur 2 neue Teilnehmer in Whirlpool Coinjoins gibt.

Whirlpool-Transaktionen zeichnen sich also durch eine identische Anzahl von Ein- und Ausgängen aus, die sein können:


- 5 Eingänge und 5 Ausgänge;

![BTC204](assets/fr/137.webp)


- 6 Eingänge und 6 Ausgänge;

![BTC204](assets/fr/138.webp)


- 7 Eingänge und 7 Ausgänge;

![BTC204](assets/fr/139.webp)


- 8 Eingänge und 8 Ausgänge.

![BTC204](assets/fr/140.webp)

Das von Whirlpool vorgeschlagene Modell basiert also auf kleinen Coinjoin-Transaktionen. Im Gegensatz zu Wabisabi und JoinMarket, wo die Robustheit von Anonsets auf dem Volumen der Teilnehmer in einem einzigen Zyklus (oder einigen wenigen Zyklen) basiert, stützt sich Whirlpool auf die Verkettung mehrerer kleiner Zyklen. Bei diesem Modell entstehen den Nutzern nur bei ihrem ersten Eintritt in einen Pool Kosten, so dass sie ohne zusätzliche Kosten an einer Vielzahl von Remixen teilnehmen können. Es sind die Neueinsteiger, die die Schürfkosten für die Remixer decken.

Mit jedem weiteren Coinjoin, an dem eine Münze teilnimmt, wachsen die Anonsets exponentiell an, ebenso wie die Anonsets der anderen Münzen. Ziel ist es also, die Vorteile dieser kostenlosen Remixe zu nutzen, die bei jedem Auftreten dazu beitragen, die Dichte der mit jedem Coin-Mix verbundenen Anonsets zu erhöhen.

Bei der Entwicklung des Whirlpools wurden zwei wichtige Anforderungen berücksichtigt:


- Die Zugänglichkeit der Implementierung auf mobilen Geräten, da Samourai Wallet in erster Linie eine Smartphone-Anwendung ist;
- Die Geschwindigkeit der Remixing-Zyklen führt zu einem deutlichen Anstieg der Anonsets.

Diese Vorgaben leiteten die Samourai Wallet-Entwickler bei der Gestaltung von Whirlpool und veranlassten sie, die Anzahl der Teilnehmer pro Zyklus zu begrenzen. Zu wenige Teilnehmer hätten die Effektivität von Coinjoin beeinträchtigt und die in jedem Zyklus generierten Anonsets drastisch reduziert, während zu viele Teilnehmer Verwaltungsprobleme bei den mobilen Anwendungen verursacht und den Fluss der Zyklen behindert hätten.

Letztendlich ist es nicht notwendig, eine hohe Anzahl von Teilnehmern zu haben, um am Whirlpool zu coinjoinen, da Anonsets durch die Akkumulation von mehreren Coinjoin-Zyklen realisiert werden. Das wichtigste Prinzip hierbei ist die Homogenität der UTXOs aller Teilnehmer, da dies eine perfekte Mischung ermöglicht und somit die Vorteile der Misch- und Remixing-Zyklen voll ausgenutzt werden können.

### Pools und Tarife zusammenlegen

Damit diese mehrfachen Zyklen die Anonsets der gemischten Münzen effektiv erhöhen, muss ein Rahmen geschaffen werden, um die Menge des verwendeten UTXO zu begrenzen. Whirlpool definiert daher mehrere Pools.

Ein Pool stellt eine Gruppe von Nutzern dar, die sich zusammenschließen möchten und sich auf die Menge an UTXO einigen, die verwendet werden soll, um den Coinjoin-Prozess zu optimieren und gleichzeitig eine perfekte Münzhomogenität zu erhalten. Jeder Pool legt einen festen Betrag für UTXO fest, den der Nutzer erfüllen muss, um teilnehmen zu können. Um Coinjoins mit Whirlpool durchzuführen, muss also ein Pool ausgewählt werden. Derzeit sind die folgenden Pools verfügbar:


- 0.5 Bitcoin;
- 0.05 bitcoin;
- 0.01 Bitcoin;
- 0.001 Bitcoin (= 100.000 Sats).

Wenn Sie einem Pool mit Ihren Bitcoins beitreten, werden diese geteilt, um UTXOs zu erzeugen, die mit denen der anderen Teilnehmer des Pools vollkommen homogen sind. Jeder Pool hat eine Höchstgrenze; für Beträge, die diese Grenze überschreiten, sind Sie daher gezwungen, entweder zwei getrennte Einträge in denselben Pool vorzunehmen oder sich einem anderen Pool mit einem größeren Betrag zuzuwenden:

| Pool (Bitcoin) | Maximaler Betrag pro Eintrag (Bitcoin) |

|----------------|----------------------------------------|

| 0,5 | 35 |

| 0,05 | 3,5 |

| 0,01 | 0,7 |

| 0,001 | 0,025 |

Ein UTXO wird als zu einem Pool gehörig betrachtet, wenn er bereit ist, in einen Coinjoin integriert zu werden. Dies bedeutet jedoch nicht, dass der Nutzer den Besitz daran verliert. Wie wir in den ersten Kapiteln dieses Teils gesehen haben, behalten Sie während der verschiedenen Mischzyklen die volle Kontrolle über Ihre Schlüssel und damit auch über Ihre Bitcoins. Dadurch unterscheidet sich die Coinjoin-Technik von anderen zentralisierten Mischtechniken.

Um einem Coinjoin-Pool beizutreten, müssen sowohl Servicegebühren als auch Mining-Gebühren gezahlt werden. Die Servicegebühren sind für jeden Pool festgelegt und sollen die Teams entschädigen, die für die Entwicklung und Wartung von Whirlpool verantwortlich sind.

Die Servicegebühren für die Nutzung des Whirlpools sind einmalig beim Betreten des Pools zu entrichten. Sobald dieser Schritt abgeschlossen ist, haben Sie die Möglichkeit, an einer unbegrenzten Anzahl von Remixen ohne zusätzliche Gebühren teilzunehmen. Hier sind die aktuellen Festgebühren für jeden Pool:

| Pool (Bitcoin) | Eingabegebühr (Bitcoin) |

| -------------- | --------------------------------- |

| 0.5 | 0.0175 |

| 0.05 | 0.00175 |

| 0,01 | 0,0005 (50.000 Sats) |

| 0,001 | 0,00005 (5.000 Sats) |

Diese Gebühren fungieren im Wesentlichen als Eintrittskarte für den von Ihnen gewählten Pool, unabhängig von dem Betrag, den Sie in coinjoin eingeben. Ob Sie also mit genau 0,01 BTC in den 0,01-BTC-Pool einsteigen oder mit 0,5 BTC, die Gebühren bleiben in absoluten Zahlen gleich.

Bevor er mit Whirlpool-Coinjoins fortfährt, hat der Benutzer die Wahl zwischen 2 Strategien:


- Sie entscheiden sich für einen kleineren Pool, um die Servicegebühren zu minimieren, da sie wissen, dass sie im Gegenzug mehrere kleinere UTXOs erhalten werden;
- Oder sie bevorzugen einen größeren Pool und sind bereit, höhere Gebühren zu zahlen, um am Ende eine kleine Anzahl höherwertiger UTXOs zu haben.

Im Allgemeinen ist es nicht empfehlenswert, mehrere gemischte UTXOs nach Coinjoin-Zyklen zu fusionieren, da dies die gewonnene Privatsphäre gefährden könnte, insbesondere wegen der Heuristik des gemeinsamen Eigentums am Input (CIOH: _Common-Input-Ownership-Heuristic_). Daher könnte es ratsam sein, einen größeren Pool zu wählen, auch wenn dies bedeutet, mehr zu bezahlen, um zu vermeiden, dass zu viele UTXOs mit geringem Wert als Ausgabe vorhanden sind. Der Benutzer muss diese Kompromisse abwägen, um den von ihm bevorzugten Pool zu wählen.

Zusätzlich zu den Servicegebühren müssen auch die Mining-Gebühren berücksichtigt werden, die bei jeder Bitcoin-Transaktion anfallen. Als Whirlpool-Nutzer müssen Sie Mining-Gebühren für die Vorbereitungstransaktion (Tx0) sowie für den ersten Coinjoin zahlen. Alle nachfolgenden Remixes werden aufgrund des Whirlpool-Modells, neue Teilnehmer zu bezahlen, kostenlos sein.

In der Tat sind bei jedem Whirlpool-Coinjoin 2 Nutzer unter den Eingaben neue Teilnehmer. Die anderen Inputs stammen von Remixern. Infolgedessen werden die Mining-Gebühren für alle Teilnehmer an der Transaktion durch diese 2 neuen Teilnehmer gedeckt, die dann auch von kostenlosen Remixen profitieren:

![BTC204](assets/it/54/07.webp)

Aufgrund dieses Gebührensystems unterscheidet sich Whirlpool wirklich von anderen Coinjoin-Implementierungen, da die Anonymität von UTXOs nicht proportional zum Preis ist, den der Nutzer bezahlt. So kann ein beträchtliches Maß an Anonymität erreicht werden, indem man nur die Pool-Eintrittsgebühr und die Mining-Gebühren für 2 Transaktionen (die "Tx0" und den anfänglichen Mix) bezahlt.

Es ist wichtig zu beachten, dass der Nutzer auch die Mining-Gebühren für die Entnahme seiner UTXOs aus dem Pool nach der Durchführung seiner mehrfachen Coinjoins tragen muss, es sei denn, er hat die Option "Mix to" gewählt, die es ihm ermöglicht, eine externe Adresse anzugeben, die die Gelder direkt als Ergebnis eines Coinjoins erhält, ohne zusätzliche Transaktion.

### HD-Wallet-Konten

Um einen Coinjoin über Whirlpool durchzuführen, muss die Wallet mehrere separate Konten erstellen. Dies ist das Prinzip des ZeroLink-Protokolls. Ein Konto stellt im Rahmen einer HD (_Hierarchical Deterministic_)-Wallet einen von den anderen vollständig isolierten Bereich dar. Diese Trennung erfolgt auf der dritten Tiefenebene der Wallet-Hierarchie, d. h. auf der Ebene "xpub".

![BTC204](assets/it/54/08.webp)

Eine HD-Wallet kann theoretisch bis zu 2^(32/2)` verschiedene Konten ableiten. Das erste Konto, das standardmäßig bei allen Bitcoin-Wallets verwendet wird, entspricht dem Index "0".

Für Portfolios, die an Whirlpool angepasst sind, werden 4 Konten verwendet, um die Anforderungen des ZeroLink-Prozesses zu erfüllen:


- Das **Einlagenkonto**, gekennzeichnet durch den Index "0";
- Das **schlechte Bankkonto** (oder "toxische Börse"), gekennzeichnet durch den Index "2 147 483 644";
- Das **Premix-Konto**, identifiziert durch den Index `2 147 483 645'`;
- Das **Postmix-Konto**, gekennzeichnet durch den Index "2 147 483 646".

Jedes dieser Konten erfüllt eine bestimmte Funktion im Coinjoin-Prozess, die wir in den folgenden Abschnitten untersuchen werden.

Alle diese Konten sind mit einem einzigen Seed verknüpft, so dass der Nutzer mit seiner Recovery-Phrase und gegebenenfalls seiner Passphrase wieder Zugriff auf alle seine Bitcoins erhält. Es ist jedoch erforderlich, der Software während dieses Wiederherstellungsvorgangs die verschiedenen Indizes der verwendeten Konten anzugeben.

Untersuchen wir nun die verschiedenen Stadien eines Whirlpool-Coinjoints innerhalb dieser Konten.

### Der TX0

Der Ausgangspunkt eines jeden Whirlpool Coinjoin ist das **Einzahlungskonto**. Dieses Konto verwenden Sie automatisch, wenn Sie eine neue Bitcoin-Brieftasche erstellen. Auf diesem Konto müssen die Bitcoins, die Sie mischen möchten, gutgeschrieben sein.

Tx0" ist der erste Schritt im Whirlpool-Mischprozess. Er zielt darauf ab, die UTXOs für das Coinjoin vorzubereiten und auszugleichen, indem sie in Einheiten unterteilt werden, die der Menge des ausgewählten Pools entsprechen, um die Homogenität der Mischung zu gewährleisten. Die ausgeglichenen UTXOs werden dann an das **Premix-Konto** gesendet. Die Differenz, die nicht in den Pool gelangen kann, wird auf ein spezielles Konto überwiesen: die **Bad Bank** (oder "Giftbörse").

Diese erste "Tx0"-Transaktion dient auch dazu, die dem Coinjoin-Koordinator zustehenden Servicegebühren zu begleichen. Im Gegensatz zu den nachfolgenden Schritten ist diese Transaktion nicht gemeinschaftlich; daher muss der Nutzer die vollen Kosten für die Mining-Gebühren tragen:

![BTC204](assets/it/54/09.webp)

In diesem "Tx0"-Transaktionsbeispiel wird ein Input von "372 000 sats" von unserem **Einlagenkonto** in mehrere UTXOs Output aufgeteilt, die wie folgt verteilt werden:


- Ein Betrag von 5.000 Sitzen, der dem Koordinator für Dienstleistungsgebühren zugewiesen wird und der der Aufnahme in den Pool von 100.000 Sitzen entspricht;
- 3 UTXOs werden zum Mischen vorbereitet, auf unser **Premix-Konto** umgeleitet und beim Koordinator registriert. Diese UTXOs werden mit jeweils 108 000 Sats gleichgesetzt, um die Abbaugebühren für ihre künftige Erstmischung zu decken;
- Der Überschuss, der nicht in den Pool aufgenommen werden kann, weil er zu gering ist, wird als toxischer Tausch betrachtet. Er wird auf das entsprechende Konto überwiesen. In diesem Fall beläuft sich dieser Austausch auf 40 000 Sats;
- Schließlich gibt es "3.000 Sats", die keine Leistung darstellen, sondern die für die Bestätigung von "Tx0" erforderlichen Abbaugebühren sind.

Hier ist zum Beispiel ein echter Tx0 Whirlpool (nicht meiner):[edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/fr/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

![BTC204](assets/fr/145.webp)

### Die giftige Veränderung

Der Überschuss, der nicht in den Pool integriert werden konnte, was hier 40.000 Sats entspricht, wird auf das **Bad Bank**-Konto umgeleitet, das auch als "toxischer Umtausch" bezeichnet wird, um eine strikte Trennung von anderen UTXOs im Portfolio zu gewährleisten.

Dieser UTXO stellt eine Gefahr für die Privatsphäre der Nutzer dar, da er nicht nur mit der Vergangenheit des Nutzers und damit möglicherweise mit der Identität seines Besitzers verknüpft ist, sondern auch als Eigentum eines Nutzers gekennzeichnet ist, der an einem Coinjoin teilgenommen hat.

![BTC204](assets/fr/146.webp)

Wird dieser UTXO mit gemischten Outputs zusammengeführt, verlieren sie die gesamte Privatsphäre, die sie während der Coinjoin-Zyklen gewonnen haben, vor allem aufgrund der CIOH (_Common-Input-Ownership-Heuristik_). Wird sie mit anderen toxischen Änderungen zusammengeführt, besteht die Gefahr, dass der Benutzer seine Privatsphäre verliert, da dadurch die verschiedenen Eingaben aus Coinjoin-Zyklen miteinander verknüpft werden. Daher sollte sie mit Vorsicht behandelt werden. Wir werden die Verwaltung dieser toxischen UTXOs im letzten Abschnitt dieses Kapitels ausführlicher behandeln.

### Der anfängliche Mix

Nach Abschluss von "Tx0" werden die ausgeglichenen UTXOs an das **Premix**-Konto in unserem Portfolio gesendet, bereit, in ihren ersten Coinjoin-Zyklus, auch "Initial Mix" genannt, aufgenommen zu werden Wenn, wie in unserem Beispiel, `Tx0` mehrere UTXOs generiert, die für den Mix bestimmt sind, wird jeder von ihnen in einen separaten Initialmix integriert.

Am Ende dieses ersten Mixes wird das **Premix**-Konto leer sein, während unsere Münzen, nachdem wir die Mining-Gebühren für diesen ersten Coinjoin bezahlt haben, mit genau dem Betrag abgerechnet werden, der vom gewählten Pool festgelegt wurde. In unserem Beispiel werden unsere anfänglichen UTXOs von 108.000 sats auf genau 100.000 sats reduziert.

![BTC204](assets/fr/147.webp)

### Die Remixe

Nach der ersten Mischung werden die UTXOs auf das **Postmix**-Konto übertragen. Dieses Konto sammelt sowohl UTXOs, die bereits gemischt wurden, als auch solche, die auf einen Remix warten. Wenn der Whirlpool-Client aktiv ist, stehen die UTXOs im **Postmix**-Konto automatisch für den Remix zur Verfügung und werden nach dem Zufallsprinzip für die Teilnahme an diesen neuen Runden ausgewählt.

Zur Erinnerung: Remixe sind dann völlig kostenlos: Es fallen keine zusätzlichen Servicegebühren oder Mining-Gebühren an. Der Verbleib von UTXOs auf dem **Postmix**-Konto erhält somit ihren Wert und verbessert gleichzeitig ihre Anonsets. Deshalb ist es wichtig, diese Münzen an mehreren Coinjoin-Zyklen teilnehmen zu lassen. Es kostet Sie absolut nichts und erhöht ihren Anonset-Wert.

Wenn Sie sich entscheiden, gemischte UTXOs auszugeben, können Sie dies direkt von diesem **Postmix**-Konto aus tun. Es ist ratsam, gemischte UTXOs in diesem Konto aufzubewahren, um von kostenlosen Remixen zu profitieren und zu verhindern, dass sie den Whirlpool-Kreislauf verlassen, was ihre Privatsphäre beeinträchtigen könnte.

### Wie verwaltet man sein Postmix-Konto richtig?

Nach der Durchführung von Coinjoin-Zyklen ist es am besten, die UTXOs auf dem **Postmix**-Konto aufzubewahren, bis sie verwendet werden können. Es ist sogar ratsam, sie auf unbestimmte Zeit remixen zu lassen, bis Sie sie ausgeben müssen.

Einige Nutzer ziehen es in Betracht, ihre gemischten Bitcoins in eine geschützte Hardware-Wallet zu übertragen. Dies ist möglich, aber es ist wichtig, die Empfehlungen von Samourai Wallet genauestens zu befolgen, um die gewonnene Vertraulichkeit nicht zu gefährden.

Das Kombinieren von UTXOs ist der am häufigsten gemachte Fehler. Sie müssen es vermeiden, gemischte UTXOs mit nicht gemischten UTXOs in derselben Transaktion zu kombinieren, um eine Common-Input-Ownership (CIOH)-Heuristik zu vermeiden. Dies erfordert eine sorgfältige Verwaltung Ihrer UTXOs innerhalb Ihres Portfolios, insbesondere im Hinblick auf die Kennzeichnung.

![BTC204](assets/fr/148.webp)

Es ist auch wichtig, bei der Konsolidierung gemischter UTXOs vorsichtig zu sein. Moderate Konsolidierungen sind denkbar, wenn Ihre gemischten UTXOs signifikante Anonsets aufweisen, aber dies wird unweigerlich die Vertraulichkeit Ihrer Münzen verringern. Achten Sie darauf, dass die Konsolidierungen nicht zu umfangreich sind oder nach einer unzureichenden Anzahl von Remixes durchgeführt werden, auf die Gefahr hin, dass zwischen Ihren UTXOs vor und nach den Coinjoin-Zyklen abgeleitete Verbindungen hergestellt werden. Im Zweifelsfall ist es am besten, UTXOs nach dem Remix nicht zu konsolidieren, sondern sie einzeln in Ihre Hardware-Brieftasche zu übertragen, wobei jedes Mal eine neue leere Adresse erzeugt wird. Vergessen Sie nicht, jeden erhaltenen UTXO ordnungsgemäß zu kennzeichnen.

Es wird auch nicht empfohlen, Ihre UTXO-Postmixe auf eine Geldbörse zu übertragen, die ungewöhnliche Skripte verwendet. Wenn Sie zum Beispiel Whirlpool von einer Multisig-Wallet aus betreten, die `P2WSH`-Skripte verwendet, besteht eine geringe Chance, dass Sie mit anderen Nutzern gemischt werden, die ursprünglich die gleiche Art von Wallet haben. Wenn Sie Ihre Postmixes in derselben Multisig-Brieftasche abheben, wird die Privatsphäre Ihrer gemischten Bitcoins stark beeinträchtigt. Neben Skripten gibt es viele andere Wallet-Fingerprints, die Sie täuschen können.

Wie bei jeder Bitcoin-Transaktion ist es auch hier wichtig, die Empfängeradressen nicht wieder zu verwenden. Jede neue Transaktion sollte über eine neue, leere Adresse empfangen werden.

Die einfachste und sicherste Lösung besteht darin, Ihre gemischten UTXOs in ihrem **Postmix**-Konto ruhen zu lassen, damit sie neu gemischt und nur zum Ausgeben angefasst werden können. Die Samourai- und Sparrow-Portfolios verfügen über zusätzliche Schutzmechanismen gegen all diese Risiken der Kettenanalyse. Diese Schutzmaßnahmen helfen Ihnen, Fehler zu vermeiden.

### Wie geht man richtig mit dem toxischen Wandel um?

Als nächstes müssen Sie vorsichtig mit Ihrem toxischen Wechselgeld umgehen, dem Wechselgeld, das nicht in den Coinjoin-Pool gelangen konnte. Diese toxischen UTXOs, die aus der Nutzung des Whirlpools stammen, stellen ein Risiko für Ihre Privatsphäre dar, da sie eine Verbindung zwischen Ihnen und der Coinjoin-Nutzung herstellen. Daher ist es unerlässlich, mit ihnen vorsichtig umzugehen und sie nicht mit anderen UTXOs zu kombinieren, insbesondere nicht mit gemischten UTXOs.

Im Folgenden werden einige Strategien für ihre Verwendung vorgestellt:


- Mischen Sie sie in kleineren Becken:** Wenn Ihr giftiges UTXO groß genug ist, um allein in ein kleineres Becken zu passen, sollten Sie es mischen. Dies ist oft die beste Option. Es wird jedoch nicht empfohlen, mehrere toxische UTXOs zu mischen, um Zugang zu einem Pool zu erhalten, da dies Ihre verschiedenen Eingänge verbinden könnte.
- Markieren Sie sie als "nicht ausgabefähig":** Eine andere Möglichkeit besteht darin, sie nicht mehr zu verwenden, sie in ihrem speziellen Konto als "nicht ausgabefähig" zu markieren und einfach zu hodeln. Dies stellt sicher, dass Sie sie nicht versehentlich ausgeben. Wenn der Wert von Bitcoin steigt, können neue Pools auftauchen, die für Ihre toxischen UTXOs besser geeignet sind;
- Spenden:** Ziehen Sie in Erwägung, auch bescheidene Spenden an Entwickler, die an Bitcoin und der dazugehörigen Software arbeiten, zu tätigen. Sie können auch an Organisationen spenden, die BTC akzeptieren. Wenn Ihnen die Verwaltung Ihrer toxischen UTXOs zu kompliziert erscheint, können Sie sie einfach durch eine Spende loswerden.
- Geschenkkarten kaufen:** Plattformen wie [Bitrefill] (https://www.bitrefill.com/) ermöglichen es Ihnen, Bitcoins gegen Geschenkkarten einzutauschen, die bei verschiedenen Händlern verwendet werden können. Dies kann eine Möglichkeit sein, Ihre toxischen UTXOs loszuwerden, ohne den damit verbundenen Wert zu verlieren.
- Konsolidieren Sie sie in Monero:** Samourai Wallet bietet einen atomaren Swap-Service zwischen BTC und XMR. Dies ist ideal, um toxische UTXOs zu verwalten, indem sie auf Monero konsolidiert werden, ohne Ihre Privatsphäre durch KYC zu gefährden, bevor sie zurück nach Bitcoin gesendet werden. Diese Option kann jedoch aufgrund von Liquiditätsengpässen in Bezug auf Mining-Gebühren und Prämien teuer sein.
- Senden Sie sie an das Lightning Network:** Die Übertragung dieser UTXOs an das Lightning Network, um von reduzierten Transaktionsgebühren zu profitieren, ist eine attraktive Option. Allerdings kann diese Methode je nach Verwendung von Lightning einige Informationen preisgeben und sollte daher mit Vorsicht praktiziert werden.

### Wie verwendet man Whirlpool?

Nach der Verhaftung der Gründer von Samourai Wallet und der Beschlagnahmung ihrer Server am 24. April 2024 funktioniert das Whirlpool-Tool nicht mehr, auch nicht für diejenigen, die ihr eigenes Dojo haben. Zuvor war es auf Samourai Wallet und Sparrow Wallet verfügbar.

![BTC204](assets/fr/149.webp)

Es bleibt jedoch möglich, dass dieses Instrument in den kommenden Wochen wieder in Betrieb genommen wird, je nach Ausgang der Versuche, oder in einer anderen Form neu gestartet wird. In jedem Fall glaube ich, dass der Coinjoin-Markt auf Bitcoin nicht lange ohne Angebot bleiben wird, da es eine klare Nachfrage gibt. Außerdem wird das Whirlpool-Modell, das in Bezug auf den Datenschutz am fortschrittlichsten ist, in Zukunft sicherlich auch für andere Implementierungen verwendet werden.

Wir verfolgen die Entwicklung dieses Falles sowie die Entwicklungen in Bezug auf die damit verbundenen Instrumente genau. Seien Sie versichert, dass wir diese Schulung aktualisieren werden, sobald neue Informationen verfügbar sind.

Im nächsten Kapitel werden wir herausfinden, was "Anonsets" sind, wie diese Indikatoren berechnet werden und wie sie uns helfen können, die Wirksamkeit von Coinjoin-Zyklen einzuschätzen.

https://planb.network/tutorials/privacy/on-chain/coinjoin-sparrow-wallet-84def86d-faf5-4589-807a-83be60720c8b
https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef
https://planb.network/tutorials/privacy/on-chain/coinjoin-dojo-c4b20263-5b30-4c74-ae59-dc8d0f8715c2
## Anonymität einstellen

<chapterId>be1093dc-1a74-40e5-9545-2b97a7d7d431</chapterId>

Nachdem wir untersucht haben, wie Coinjoins funktionieren und welche Herausforderungen mit einer effektiven Vermischung verbunden sind, werden wir nun lernen, wie man diese Effektivität messen kann. Wie lässt sich feststellen, ob ein Coinjoin-Prozess effektiv war und welchen Grad an Anonymität eine Münze erlangt hat? Dies werden wir in diesem Kapitel anhand von Anonymitätssets (auf Englisch "anonsets") untersuchen.

### Zur Erinnerung an die Nützlichkeit von Coinjoin

Der Nutzen von CoinJoin liegt in seiner Fähigkeit, eine plausible Bestreitbarkeit zu erzeugen, indem es Ihre Münze in eine Gruppe von nicht unterscheidbaren Münzen eintaucht. Das Ziel dieser Aktion ist es, die Rückverfolgbarkeit zu unterbrechen, sowohl von der Vergangenheit zur Gegenwart als auch von der Gegenwart zur Vergangenheit.

Mit anderen Worten: Ein Analyst, der Ihre Anfangstransaktion (Tx0) beim Eintritt in die CoinJoin-Zyklen kennt, sollte nicht in der Lage sein, mit Sicherheit Ihr UTXO beim Austritt aus den Remix-Zyklen zu identifizieren (Analyse vom Eintritt in den Zyklus bis zum Austritt aus dem Zyklus).

![BTC204](assets/it/55/01.webp)

Im Gegensatz dazu sollte ein Analyst, der Ihren UTXO am Ausgang der CoinJoin-Zyklen kennt, nicht in der Lage sein, die ursprüngliche Transaktion am Eingang der Zyklen zu bestimmen (Analyse vom Zyklusausgang zum Zykluseingang).

![BTC204](assets/it/55/02.webp)

Um zu beurteilen, wie schwierig es für einen Analysten ist, die Vergangenheit mit der Gegenwart zu verknüpfen und umgekehrt, muss man die Größe der homogenen Münzgruppen quantifizieren, in denen Ihre Münze versteckt ist. Dieses Maß gibt die Anzahl der Analysen an, die eine identische Wahrscheinlichkeit haben. Wenn also die richtige Analyse unter 3 anderen Analysen mit gleicher Wahrscheinlichkeit untergeht, ist der Grad der Verschleierung sehr gering. Befindet sich die richtige Analyse jedoch in einer Menge von 20.000 Analysen, die alle gleich wahrscheinlich sind, ist Ihre Münze sehr gut versteckt. Und gerade die Größe dieser Mengen stellt Indikatoren dar, die Anonsets genannt werden.

### Die Anonsets verstehen

Anonsets dienen als Indikatoren zur Bewertung des Grades der Vertraulichkeit eines bestimmten UTXO. Genauer gesagt messen sie die Anzahl der ununterscheidbaren UTXOs innerhalb der Menge, die die untersuchte Münze enthält. Die Forderung nach einer homogenen UTXO-Menge bedeutet, dass Anonsets in der Regel auf CoinJoin-Zyklen berechnet werden. Die Verwendung dieser Indikatoren ist für Whirlpool CoinJoins aufgrund ihrer Homogenität besonders wichtig.

Anonsets ermöglichen es gegebenenfalls, die Qualität von CoinJoins zu beurteilen. Eine große Anonset-Größe bedeutet einen hohen Grad an Anonymität, da es schwierig wird, ein bestimmtes UTXO innerhalb der homogenen Menge zu unterscheiden.

Es gibt 2 Arten von Anonsets:


- Der voraussichtliche Anonset;**
- Die Retrospektive anonset.**

### Der prospektive Anonset

Der vorausschauende Anonset gibt die Größe der Gruppe an, in der sich der untersuchte UTXO am Ende des Zyklus verbirgt, wenn man den UTXO am Anfang kennt, d. h. die Anzahl der ununterscheidbaren Münzen innerhalb dieser Gruppe. Im Englischen wird dieser Indikator "forward anonset" oder "forward-looking metrics" genannt

Dieser Indikator ist ein Maß für die Widerstandsfähigkeit der Privatsphäre gegenüber einer Analyse von Vergangenheit zu Gegenwart (Input zu Output).

![BTC204](assets/it/55/03.webp)

Diese Kennzahl gibt an, inwieweit Ihr UTXO vor Versuchen geschützt ist, seinen Verlauf von seinem Eintrittspunkt bis zu seinem Austrittspunkt im Coinjoin-Prozess zu rekonstruieren.

Wenn Ihre Transaktion beispielsweise an ihrem ersten Coinjoin-Zyklus teilgenommen hat und zwei weitere absteigende Zyklen abgeschlossen wurden, wäre der voraussichtliche Anonset Ihrer Münze `13`:

![BTC204](assets/fr/153.webp)

Stellen wir uns zum Beispiel vor, dass unsere Münze am Anfang des Coinjoin-Zyklus von einem voraussichtlichen Anonset von "86.871" profitiert. Praktisch bedeutet dies, dass sie zwischen 86.871` ununterscheidbaren Münzen versteckt ist. Ein außenstehender Beobachter, der diese Münze zu Beginn des Coinjoin-Zyklus kennt und versucht, ihren Ausgang zu verfolgen, würde mit "86.871" möglichen UTXOs konfrontiert werden, die alle die gleiche Wahrscheinlichkeit haben, die gesuchte Münze zu sein.

![BTC204](assets/it/55/05.webp)

### Der retrospektive Anonset

Retrospektiver Anonset zeigt die Anzahl der möglichen Quellen für eine bestimmte Münze an, wenn man den UTXO am Ende des Zyklus kennt. Dieser Indikator misst die Resistenz der Münze gegenüber einer Gegenwartsanalyse (exit to entry), d. h. wie schwierig es für einen Analysten ist, den Ursprung Ihrer Münze vor den Coinjoin-Zyklen zurückzuverfolgen. Im Englischen heißt dieser Indikator "backward anonset" oder "retrospective metrics"

Wenn Sie Ihren UTXO am Ende der Zyklen kennen, können Sie mit dem retrospektiven Anonset die Anzahl der potenziellen Tx0-Transaktionen bestimmen, die Ihren Eintritt in die Coinjoin-Zyklen hätten darstellen können. Im nachstehenden Diagramm entspricht dies der Summe aller orangefarbenen Blasen.

Stellen wir uns zum Beispiel vor, dass unsere Münze am Ende des Coinjoin-Zyklus von einem retrospektiven Anonset von 42,185" profitiert. Praktisch bedeutet dies, dass es "42.185" mögliche Quellen für diesen UTXO gibt. Wenn ein außenstehender Beobachter diese Münze am Ende der Zyklen identifiziert und versucht, ihren Ursprung zu finden, wird er mit 42.185 möglichen Quellen konfrontiert, die alle die gleiche Wahrscheinlichkeit haben, der gesuchte Ursprung zu sein.

### Wie kann man Anonsets konkret berechnen?

Bei kleinen Mengen können Sie Ihre Anonsets manuell mit einem Block-Explorer berechnen. Für größere Anonsets ist jedoch die Verwendung eines spezialisierten Tools unumgänglich. Meines Wissens ist die einzige Software, die diese Aufgabe erfüllen kann, _Whirlpool Stats Tool_, ein Python-Tool, das von den Teams Samourai und OXT entwickelt wurde. Leider ist dieses Tool nach der Verhaftung der Gründer von Samourai und der Beendigung von OXT, das zur Extraktion von Daten aus der Blockchain verwendet wurde, derzeit nicht mehr in Betrieb.

Wie wir in diesem Kapitel gesehen haben, können Anonsets nur berechnet werden, wenn eine gewisse Homogenität in der Coinjoin-Struktur vorhanden ist. Und genau, im nächsten Kapitel werden wir herausfinden, wie man diese Homogenität in einer Bitcoin-Transaktion quantifizieren kann, egal ob es sich um einen Coinjoin oder eine traditionellere Transaktion handelt.

https://planb.network/tutorials/privacy/analysis/wst-anonsets-0354b793-c301-48af-af75-f87569756375
## Entropie

<chapterId>e4fe289d-618b-49a2-84c9-68c562e708b4</chapterId>

Wie wir in diesem Teil über Coinjoins gesehen haben, spielt die Homogenität von UTXOs in Inputs und Outputs eine wichtige Rolle bei der Verbesserung der Vertraulichkeit einer Bitcoin-Transaktion. Dieser Parameter ermöglicht eine plausible Bestreitbarkeit gegenüber einer Kettenanalyse. Mehrere Methoden können diese Homogenität messen, aber eine der effektivsten ist meiner Meinung nach die Verwendung von Indikatoren, die vom _Boltzmann_-Tool bereitgestellt werden, das von den OXT- und Samourai-Wallet-Teams entwickelt wurde, insbesondere die Transaktionsentropie. Dies werden wir in diesem Kapitel im Detail untersuchen.

Im Gegensatz zu Anonsets, die für eine Reihe von Transaktionen berechnet werden, konzentrieren sich die hier vorgestellten Indikatoren ausschließlich auf eine einzige Transaktion, sei es ein Coinjoin oder eine herkömmliche Transaktion.

### Die Anzahl der Interpretationen

Der erste Indikator, der bei einer Bitcoin-Transaktion beobachtet werden kann, ist die Gesamtzahl der möglichen Interpretationen in den Augen eines außenstehenden Beobachters, der die Transaktion analysiert. Unter Berücksichtigung der Werte der an der Transaktion beteiligten UTXOs gibt dieser Indikator die Anzahl der Möglichkeiten an, auf die Eingaben mit Ausgaben verbunden werden können. Mit anderen Worten, er bestimmt die Anzahl der möglichen Interpretationen, die eine Transaktion im Bitcoin-Stream aus der Sicht eines außenstehenden Beobachters, der sie analysiert, hervorrufen kann.

Für einen einfachen Zahlungsvorgang mit 1 Eingang und 2 Ausgängen gibt es beispielsweise nur eine Interpretation, nämlich dass Eingang Nr. 0 den Ausgang Nr. 0 und den Ausgang Nr. 1 finanziert. Es gibt keine anderen möglichen Interpretationen:

![BTC204](assets/fr/159.webp)

Im Gegensatz dazu hat ein Coinjoin, der nach dem Whirlpool 5x5-Modell strukturiert ist, 1.496 mögliche Kombinationen:

![BTC204](assets/fr/160.webp)

Ein Whirlpool Surge Cycle 8x8 Coinjoin kommt auf 9.934.563 $ mögliche Interpretationen:

![BTC204](assets/fr/161.webp)

### Entropie

Aus der Anzahl der Interpretationen einer Bitcoin-Transaktion können wir ihre Entropie berechnen.

Im allgemeinen Kontext der Kryptographie und Information ist die Entropie ein quantitatives Maß für die Unsicherheit oder Unvorhersehbarkeit einer Datenquelle oder eines Zufallsprozesses. Mit anderen Worten, die Entropie ist ein Maß dafür, wie schwierig es ist, Informationen vorherzusagen oder zu erraten.

Im spezifischen Kontext der Kettenanalyse ist Entropie auch der Name eines Indikators, der von Shannons Entropie abgeleitet ist und [von LaurentMT] (https://gist.github.com/LaurentMT/e758767ca4038ac40aaf) erfunden wurde, und der für eine Bitcoin-Transaktion berechnet werden kann.

Wenn eine Transaktion eine hohe Anzahl möglicher Interpretationen aufweist, ist es oft sinnvoller, sich auf ihre Entropie zu beziehen. Dieser Indikator ist ein Maß für den Mangel an Wissen der Analysten über die genaue Konfiguration der Transaktion. Mit anderen Worten: Je höher die Entropie, desto schwieriger ist es für Analysten, Bitcoin-Ströme zwischen Ein- und Ausgängen zu identifizieren.

In der Praxis gibt die Entropie Aufschluss darüber, ob eine Transaktion aus der Sicht eines außenstehenden Beobachters mehrere mögliche Interpretationen aufweist, die allein auf Ein- und Ausgangsgrößen beruhen, ohne andere externe oder interne Muster und Heuristiken zu berücksichtigen. Eine hohe Entropie ist somit gleichbedeutend mit einer höheren Vertraulichkeit der Transaktion.

Die Entropie ist definiert als der binäre Logarithmus der Anzahl der möglichen Kombinationen. Hier ist die verwendete Formel, wobei $E$ die Entropie der Transaktion und $C$ die Anzahl der möglichen Interpretationen darstellt:

$$
E = \log_2(C)
$$

In der Mathematik entspricht der binäre Logarithmus (Logarithmus zur Basis 2) der Umkehroperation der Potenzierung von 2. Mit anderen Worten: Der binäre Logarithmus von $x$ ist der Exponent, auf den $2$ erhöht werden muss, um $x$ zu erhalten. Dieser Indikator wird also in Bits ausgedrückt.

Nehmen wir das Beispiel der Entropieberechnung für eine Coinjoin-Transaktion, die nach dem 5x5-Whirlpool-Modell strukturiert ist, das, wie im vorherigen Abschnitt erwähnt, eine Anzahl möglicher Interpretationen von 1.496 $ aufweist:

$$
\begin{align*}
C &= 1.496 \\
E &= \log_2(1.496) \\
E &= 10.5469 \text{ bit}
\end{align*}
$$

Somit weist diese Coinjoin-Transaktion eine Entropie von $10,5469$ Bits auf, was als sehr zufriedenstellend angesehen wird. Je höher dieser Wert ist, desto mehr verschiedene Interpretationen lässt die Transaktion zu, was den Grad der Vertraulichkeit verbessert.

Für eine 8x8 Coinjoin-Transaktion mit 9.934.563 $ Interpretationen wäre die Entropie gleich:

$$
\begin{align*}
C &= 9.934.563 \\
E &= \log_2(9.934.563) \\
E &= 23,244 \text{ bit}
\end{align*}
$$

Nehmen wir ein weiteres Beispiel mit einer Standard-Zahlungstransaktion, mit 1 Eingang und 2 Ausgängen: [1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce](https://mempool.space/tx/1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce)

![BTC204](assets/fr/162.webp)

Im Falle dieser Transaktion ist die einzig mögliche Interpretation: `(In.0) > (Out.0 ; Out.1)`. Folglich wird ihre Entropie auf $0$ gesetzt:

$$
\begin{align*}
C &= 1 \\
E &= \log_2(1) \\
E &= 0 \text{ bit}
\end{align*}
$$

### Effizienz

Anhand der Entropie der Transaktion lässt sich auch die Effizienz des Datenschutzes berechnen. Dieser Indikator bewertet die Effizienz der Transaktion, indem er sie mit der optimalen Transaktion vergleicht, die in einer identischen Konfiguration denkbar wäre.

Dies führt uns zur Diskussion des Konzepts der maximalen Entropie, die der höchsten Entropie entspricht, die eine bestimmte Transaktionsstruktur theoretisch erreichen könnte. Die Effizienz der Transaktion wird dann durch den Vergleich dieser maximalen Entropie mit der tatsächlichen Entropie der analysierten Transaktion berechnet.

Die verwendete Formel lautet wie folgt:


- $E_R$: die tatsächliche Entropie der Transaktion, ausgedrückt in Bits;
- $E_M$: die maximal mögliche Entropie für eine Transaktionsstruktur, ebenfalls ausgedrückt in Bits;
- $Ef$: die Effizienz der Transaktion in Bits:

$$
Ef = E_R - E_M
$$

Für eine Coinjoin-Struktur vom Typ Whirlpool 5x5 beträgt die maximale Entropie beispielsweise $10,5469$:

$$
\begin{align*}
E_R &= 10,5469 \\
E_M &= 10,5469 \\
Ef &= E_R - E_M \\
Ef &= 10,5469 - 10,5469 \\
Ef &= 0 \text{ bit}
\end{align*}
$$

Dieser Indikator wird ebenfalls als Prozentsatz ausgedrückt. Die verwendete Formel lautet wie folgt:


- $C_R$: die Anzahl der möglichen realen Interpretationen;
- $C_M$: die maximale Anzahl der möglichen Interpretationen mit derselben Struktur;
- $Ef$: Wirkungsgrad ausgedrückt in Prozent:

$$
\begin{align*}
E_f &= \frac{C_R}{C_M} \\
E_f &= \frac{1.496}{1.496} \\
E_f &= 100\%
\end{align*}
$$

Eine Effizienz von $100\%$ bedeutet also, dass die Transaktion aufgrund ihrer Struktur ihr Potenzial für den Datenschutz maximiert.

### Die Entropie-Dichte

Die Entropie ist ein guter Indikator zur Messung der Vertraulichkeit einer Transaktion, hängt aber zum Teil von der Anzahl der Ein- und Ausgänge in der Transaktion ab. Um die Entropie von zwei verschiedenen Transaktionen zu vergleichen, die nicht die gleiche Anzahl von Eingängen und Ausgängen haben, kann die Entropiedichte berechnet werden. Dieser Indikator gibt einen Überblick über die Entropie im Verhältnis zu jedem Input oder Output in der Transaktion. Die Dichte erweist sich als nützlich, um die Effizienz von Transaktionen unterschiedlicher Größe zu bewerten und zu vergleichen.

Um sie zu berechnen, dividieren Sie einfach die Gesamtentropie der Transaktion durch die Gesamtzahl der an der Transaktion beteiligten Ein- und Ausgänge:


- $E_D$: die Entropiedichte, ausgedrückt in Bits;
- $E$: die Entropie der Transaktion, ausgedrückt in Bits;
- $T$: die Gesamtzahl der Ein- und Ausgänge in der Transaktion:

$$
E_D = \frac{E}{T}
$$

Nehmen Sie das Beispiel eines 5x5 Whirlpool-Coinjoin:

$$
\begin{align*}
T &= 5 + 5 = 10 \\
E &= 10.5469 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{10.5469}{10} \\
E_D &= 1.054 \text{ bit}
\end{align*}
$$

Wir berechnen auch die Entropiedichte eines 8x8 Whirlpool-Coinjoin:

$$
\begin{align*}
T &= 8 + 8 = 16 \\
E &= 23.244 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{23.244}{16} \\
E_D &= 1.453 \text{ bit}
\end{align*}
$$

Bei der Analyse der Entropiedichte dieser beiden Arten von Coinjoins wird deutlich, dass selbst bei einer Normalisierung der Entropie für die Anzahl der Elemente der "Surge Cycle 8x8"-Coinjoin mehr Unsicherheit für die Analyse erzeugt.

### Die Boltzmann-Note

Eine weitere Information, die in einer Transaktion analysiert wird, ist der Boltzmann-Score jedes Elements im Verhältnis zu einem anderen. Dabei handelt es sich um eine Tabelle mit den Wahrscheinlichkeiten der Übereinstimmung zwischen Inputs und Outputs. Diese Tabelle gibt über den Boltzmann-Score die bedingte Wahrscheinlichkeit an, dass ein bestimmter Input mit einem bestimmten Output verbunden ist. Es handelt sich also um ein quantitatives Maß für die bedingte Wahrscheinlichkeit, dass eine Assoziation zwischen einem Input und einem Output in einer Transaktion auftritt, bestimmt durch das Verhältnis zwischen der Anzahl der günstigen Fälle dieses Ereignisses und der Gesamtzahl der möglichen Fälle in einer Reihe von Interpretationen.

Am Beispiel eines Whirlpool-Coinjoin würde die Tabelle der bedingten Wahrscheinlichkeiten die Möglichkeiten einer Verbindung zwischen jedem Input und Output aufzeigen und ein quantitatives Maß für die Mehrdeutigkeit der Assoziationen in der Transaktion liefern:

| % | Ausgang 0 | Ausgang 1 | Ausgang 2 | Ausgang 3 | Ausgang 4 |

| ------- | -------- | -------- | -------- | -------- | -------- |

Hier wird deutlich, dass jede Eingabe mit der gleichen Wahrscheinlichkeit mit jeder Ausgabe verbunden ist, was die Vertraulichkeit der Transaktion erhöht.

Zur Berechnung des Boltzmann-Scores wird die Anzahl der Interpretationen, in denen ein bestimmtes Ereignis auftritt, durch die Gesamtzahl der verfügbaren Interpretationen geteilt. Um die Punktzahl zu bestimmen, indem die Eingabe #0 mit der Ausgabe #3 (ein Ereignis, das in $512$ Interpretationen vorkommt) verknüpft wird, ist das Verfahren wie folgt:

$$
\begin{align*}
\text{Interpretazioni (IN.0 > OUT.3)} &= 512 \\
\text{Interpretazioni Totali} &= 1496 \\
\text{Punteggio} &= \frac{512}{1496} \\
\text{Punteggio} &= 34\%
\end{align*}
$$

Wenn wir das Beispiel eines Surge 8x8 Whirlpool Coinjoin-Zyklus erneut betrachten, würde die Boltzmann-Tabelle wie folgt aussehen:

| OUT.0 | OUT.1 | OUT.2 | OUT.3 | OUT.4 | OUT.5 | OUT.6 | OUT.7 | OUT.7 |

| ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |

| IN.0 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.1 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.2 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.3 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.4 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.5 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.6 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

| IN.7 | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% | 23% |

Im Falle einer einfachen Transaktion mit einer einzigen Eingabe und 2 Ausgaben ist die Situation jedoch anders:

| % | Ausgabe 0 | Ausgabe 1 |

| ------- | -------- | -------- |

| Eingabe 0 | 100% | 100% |

In diesem Fall beträgt die Wahrscheinlichkeit, dass jede Ausgabe von Eingabe Nr. 0 stammt, 100 %. Eine geringere Wahrscheinlichkeit führt also zu einer größeren Privatsphäre, da die direkten Verbindungen zwischen Eingaben und Ausgaben verwässert werden.

### Deterministische Links

Es ist auch möglich, die Anzahl der deterministischen Verbindungen in einer Transaktion zu berechnen. Dieser Indikator gibt an, wie viele Verbindungen zwischen Inputs und Outputs in der analysierten Transaktion mit 100-prozentiger Wahrscheinlichkeit unbestreitbar sind. Dieser Indikator kann dann durch die Berechnung des Verhältnisses der deterministischen Verbindungen ergänzt werden. Das Verhältnis gibt Aufschluss über das Gewicht dieser deterministischen Verbindungen innerhalb aller Verbindungen in der Transaktion.

Eine Coinjoin-Transaktion von Whirlpool beispielsweise zeigt keine deterministische Verknüpfung zwischen Inputs und Outputs und damit einen Indikator von 0 Verknüpfungen und ein Verhältnis von 0 %. Bei der zweiten untersuchten einfachen Zahlungstransaktion (mit einem Eingang und zwei Ausgängen) hingegen zeigt der Indikator an, dass es zwei deterministische Verknüpfungen gibt, und das Verhältnis erreicht 100 %. Ein Null-Indikator signalisiert also eine ausgezeichnete Privatsphäre, da es keine direkten und unbestreitbaren Verbindungen zwischen Inputs und Outputs gibt.

### Wie sind diese Indikatoren zu berechnen?

Die manuelle Berechnung dieser Indikatoren anhand der von mir angegebenen Gleichungen ist relativ einfach. Die Hauptschwierigkeit besteht darin, die Anzahl der möglichen Interpretationen einer Transaktion zu bestimmen. Für eine Standardtransaktion kann diese Berechnung von Hand durchgeführt werden. Bei einem Coinjoin ist die Aufgabe jedoch wesentlich komplexer.

Zuvor gab es ein Python-Tool namens _Boltzmann Calculator_, das von den Teams bei OXT und Samourai entwickelt wurde und die automatische Berechnung all dieser Indikatoren für eine Bitcoin-Transaktion ermöglichte:

![BTC204](assets/fr/163.webp)

Für diese Analysen konnte auch die Website KYCP.org genutzt werden:

![BTC204](assets/fr/164.webp)

Leider sind diese Instrumente nach der Verhaftung der Gründer von Samourai derzeit nicht einsatzfähig.

Nachdem wir nun Coinjoin im Detail besprochen haben, werden wir im letzten Abschnitt unseres Trainings andere Techniken zur Wahrung der Privatsphäre untersuchen, die auf Bitcoin verfügbar sind. Wir werden Payjoin-Transaktionen, spezielle Pseudo-Coinjoin-Transaktionstypen, statische Adressprotokolle sowie Maßnahmen zur Verbesserung der Privatsphäre nicht auf der Transaktionsebene, sondern auf der Ebene des Netzwerks der Knotenpunkte untersuchen.

https://planb.network/tutorials/privacy/analysis/boltzmann-entropy-738e45af-18a6-4ce6-af1a-1bf58e15f1fe
# Die Bedeutung anderer fortgeschrittener Datenschutztechniken verstehen

<partId>19989ae6-d608-4acf-b698-2cf1e7e5e6ae</partId>

## Payjoin-Transaktionen

<chapterId>c1e90b95-f709-4574-837b-2ec26b11286f</chapterId>

Derzeit ist die Coinjoin-Methode die effektivste Methode, um Unsicherheiten in die Münzverfolgung während einer Kettenanalyse einzubringen. Wie wir in den vorangegangenen Kapiteln gesehen haben, müssen die Inputs und Outputs so homogen wie möglich sein, um eine effektive Mischung zu erreichen. Darüber hinaus ist es entscheidend, dass Coinjoins in eine möglichst große Gruppe integriert werden, um die Anonsets zu maximieren. Damit Coinjoins effektiv sind, müssen sie also eine große Anzahl einheitlicher Münzen umfassen. Diese Vielzahl von Anforderungen bedeutet, dass Coinjoin-Transaktionen eine sehr starre Struktur haben: Die Beträge sind vorgegeben und alle Teilnehmer müssen sich daran halten, um die Einheitlichkeit des Prozesses zu gewährleisten. Darüber hinaus erfordern Coinjoin-Transaktionen eine Synchronisierung zwischen allen Teilnehmern und dem Koordinator während des Aufbaus der Transaktion.

Diese Anforderungen machen Coinjoin für direkte Zahlungen ungeeignet. Wenn Sie zum Beispiel ein 1-Millionen-Sats-Stück in einem Coinjoin-Pool besitzen, wäre es kompliziert, es direkt als Zahlung zu verwenden. Es würde eine Synchronisierung mit anderen Teilnehmern und dem Koordinator erfordern, um genau zu dem Zeitpunkt, zu dem Sie eine Zahlung leisten müssen, die gemeinsame Transaktion zu erstellen, und der Kaufbetrag müsste genau dem Wert Ihres Stücks entsprechen, was praktisch nicht machbar ist. Daher ist eine Coinjoin-Transaktion von Natur aus eine kollaborative Bereinigungstransaktion, was bedeutet, dass in der Regel die gleichen Eigentümer der Inputs auch die Outputs sind.

Es wäre jedoch interessant, Transaktionsstrukturen zu haben, die praktische Zahlungen ermöglichen, indem sie Zweifel in die Kettenanalyse einbringen. Genau das werden wir in diesem und im nächsten Kapitel untersuchen.

### Was ist eine Payjoin-Transaktion?

Payjoin ist eine spezielle Bitcoin-Transaktionsstruktur, die die Privatsphäre des Nutzers während einer Ausgabe verbessert, indem sie mit dem Zahlungsempfänger zusammenarbeitet.

Im Jahr 2015 erwähnte LaurentMT diese Methode erstmals unter dem Namen "steganografische Transaktionen", wie aus einem zugänglichen Papier [hier] hervorgeht (https://gist.githubusercontent.com/LaurentMT/e758767ca4038ac40aaf/raw/c8125f6a3c3d0e90246dc96d3b603690ab6f1dcc/gistfile1.txt). Diese Technik wurde später von Samourai Wallet übernommen, das sie 2018 als erster Client mit dem Stowaway-Tool implementierte. Das Konzept des Payjoin findet sich auch in [BIP79](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki) und [BIP78](https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki). Es werden also mehrere Begriffe verwendet, um einen Payjoin zu bezeichnen:


- Payjoin;
- Blinder Passagier;
- P2EP (_Pay-to-End-Point_);
- Steganografische Transaktion.

Die Einzigartigkeit des Payjoin liegt in seiner Fähigkeit, eine Transaktion zu generieren, die auf den ersten Blick gewöhnlich erscheint, aber tatsächlich ein Mini-Coinjoin zwischen zwei Personen ist. Die Struktur der Transaktion sieht dabei vor, dass neben dem eigentlichen Sender auch der Empfänger der Zahlung in den Inputs steht. Der Empfänger fügt dann in der Mitte der Transaktion eine Zahlung an sich selbst ein, die es ihm ermöglicht, bezahlt zu werden.

Nehmen wir ein Beispiel, um diesen Prozess besser zu verstehen. Alice kauft ein Baguette für 4.000 Sats mit einem UTXO von 10.000 Sats und entscheidet sich für einen Payjoin. Ihr Bäcker, Bob, fügt einen eigenen UTXO von 15.000 Sats als Input hinzu, den er vollständig als Output zurückerhält, zusätzlich zu den 4.000 Sats von Alice.

In diesem Beispiel gibt Bob, der Bäcker, 15.000 Sats ein und erhält 19.000 Sats, die Differenz beträgt genau 4.000 Sats, was dem Preis des Baguettes entspricht. Alice ihrerseits gibt 10.000 Sats ein und erhält 6.000 Sats, was einem Saldo von -4.000 Sats entspricht, was dem Preis des Baguettes entspricht. Um das Beispiel zu vereinfachen, habe ich bei dieser Transaktion absichtlich die Bergbaugebühren weggelassen.

### Was ist der Zweck des Payjoin?

Die payjoin-Transaktion erfüllt zwei Ziele, die es den Nutzern ermöglichen, die Privatsphäre ihrer Zahlung zu verbessern.

Erstens zielt das Payjoin darauf ab, einen außenstehenden Beobachter zu täuschen, indem es eine Ablenkung in der Kettenanalyse schafft. Dies wird durch die _Common Input Ownership Heuristic_ (CIOH) ermöglicht. Wie wir in Teil 3 gesehen haben, wird bei einer Transaktion auf der Blockchain mit mehreren Eingaben normalerweise davon ausgegangen, dass alle diese Eingaben demselben Unternehmen oder Nutzer gehören.

Wenn ein Analyst eine Payjoin-Transaktion untersucht, wird er zu der Annahme verleitet, dass alle Eingaben von ein und derselben Person stammen. Diese Annahme ist jedoch falsch, da neben dem eigentlichen Zahler auch der Zahlungsempfänger Inputs beisteuert. Die Kettenanalyse wird somit zu einer Interpretation verzerrt, die sich als falsch herausstellt.

Kehren wir zu unserem Beispiel einer Payjoin-Transaktion zurück, um ein Baguette zu bezahlen:

Wenn man diese Transaktion auf der Blockchain sieht, würde ein außenstehender Beobachter, der der üblichen Heuristik der Kettenanalyse folgt, sie so interpretieren: "Alice hat 2 UTXOs in die Transaktion eingegeben, um 19.000 Sats an Bob zu zahlen."

Diese Interpretation ist eindeutig falsch, denn wie Sie bereits wissen, gehören die beiden UTXOs in der Eingabe nicht zu ein und derselben Person. Der eine ist von Alice, der Baguettekäuferin, der andere von Bob, dem Bäcker.

Auf diese Weise wird die Analyse des externen Beobachters auf eine falsche Schlussfolgerung gelenkt, was die Wahrung der Vertraulichkeit für die Beteiligten gewährleistet.

### Die steganografische Transaktion

Das zweite Ziel des Payjoin besteht darin, einen außenstehenden Beobachter über die tatsächliche Höhe der geleisteten Zahlung zu täuschen. Wenn der Analyst die Struktur der Transaktion untersucht, könnte er glauben, dass die Zahlung dem Betrag einer der Ausgaben entspricht.

Nehmen wir unser Beispiel des Kaufs eines Baguettes, so wird der Analyst denken, dass der Zahlungsbetrag entweder dem UTXO von 6.000 Sats oder dem UTXO von 19.000 Sats entspricht. In diesem Fall ist es wahrscheinlicher, dass der Analyst der Meinung ist, dass der Zahlungsbetrag 19.000 Sats beträgt, da es zwei UTXOs in der Ausgabe gibt, von denen mindestens einer größer als 6.000 Sats ist (es gibt keinen logischen Grund, zwei UTXOs für die Zahlung von 6.000 Sats zu verwenden, wenn ein einziger UTXO für diese Zahlung ausreichend gewesen wäre).

In Wirklichkeit ist diese Analyse jedoch falsch. Der Zahlungsbetrag stimmt mit keinem der Outputs überein. Es handelt sich vielmehr um die Differenz zwischen dem UTXO des Ausgangsempfängers und dem UTXO des Eingangsempfängers.

Dabei fällt die Payjoin-Transaktion in den Bereich der Steganografie. Sie ermöglicht es, den echten Betrag einer Transaktion in einer gefälschten Transaktion zu verstecken, die als Ablenkung dient.

Steganografie ist eine Technik zum Verstecken von Informationen in anderen Daten oder Objekten, so dass das Vorhandensein der versteckten Informationen nicht erkennbar ist. So kann beispielsweise eine geheime Nachricht in einem Punkt in einem nicht verwandten Text versteckt werden, so dass sie mit bloßem Auge nicht zu erkennen ist (dies ist die [Mikropunkt](https://fr.wikipedia.org/wiki/Micropoint)-Technik).

Im Gegensatz zur Verschlüsselung, die Informationen ohne den Entschlüsselungscode unverständlich macht, werden bei der Steganografie die Informationen nicht verändert. Sie bleiben sichtbar. Sie zielt vielmehr darauf ab, die Existenz der geheimen Nachricht selbst zu verbergen, während die Kryptographie das Vorhandensein der versteckten Informationen klar erkennen lässt, obwohl sie ohne den Schlüssel nicht zugänglich sind. Aus diesem Grund war der ursprüngliche Name für Payjoin "steganographische Transaktionen"

Man könnte eine Analogie zwischen Kryptographie und Coinjoin sowie zwischen Steganographie und Payjoin herstellen. Tatsächlich hat Coinjoin ähnliche Eigenschaften wie die Kryptographie: die Methode ist erkennbar, aber die Information ist nicht entzifferbar. Payjoin hingegen ähnelt der Steganografie: Die Information ist theoretisch zugänglich, aber da die Methode der Verschleierung nicht erkennbar ist, wird sie unzugänglich.

### Wie benutzt man payjoin?

Bekannte Software, die payjoin unterstützt, sind Sparrow Wallet, Wasabi Wallet, Mutiny, BitMask, BlueWallet und JoinMarket sowie der Zahlungsprozessor BTCPay.

Die am weitesten fortgeschrittene Implementierung von payjoin war nur das Stowaway auf Samourai Wallet. Seit der Schließung der Software-Gründer funktioniert dieses Tool jedoch nur noch teilweise. Der Vorteil von Stowaway ist, dass es ein vollständiges und sehr einfach zu bedienendes Protokoll ist, das sowohl den Empfang als auch das Senden von Payjoin unterstützt. Teilweise signierte Transaktionen können manuell durch Scannen mehrerer QR-Codes oder automatisch über Tor via Soroban ausgetauscht werden. Die letztgenannte Kommunikationsoption ist derzeit nicht in Betrieb.

Die Schwierigkeit bei der Nutzung von payjoin liegt in der Abhängigkeit von der Teilnahme des Händlers. Als Kunde ist die Nutzung eines Payjoin unmöglich, wenn der Händler es nicht unterstützt. Dies führt zu einer zusätzlichen Schwierigkeit bei einem Kauf: Es ist nicht nur kompliziert, Händler zu finden, die Bitcoin akzeptieren, sondern wenn man auch noch nach solchen sucht, die Payjoin unterstützen, wird es noch komplizierter.

Eine Lösung könnte die Verwendung von Transaktionsstrukturen sein, die Mehrdeutigkeit in die Kettenanalyse einführen, ohne dass die Zusammenarbeit des Empfängers erforderlich ist. Dies würde es uns ermöglichen, den Datenschutz bei unseren Zahlungen zu verbessern, ohne auf die aktive Beteiligung der Händler angewiesen zu sein. Genau dies werden wir im nächsten Kapitel untersuchen.

https://planb.network/tutorials/privacy/on-chain/payjoin-sparrow-wallet-087a0e49-61cd-41f5-8440-ac7b157bdd62
https://planb.network/tutorials/privacy/on-chain/payjoin-samourai-wallet-48a5c711-ee3d-44db-b812-c55913080eab
## Mini-coinjoin Zahlung

<chapterId>300777ee-30ae-43d7-ab00-479dac3522c1</chapterId>

Wenn Sie eine Zahlungstransaktion unter Wahrung eines gewissen Maßes an Privatsphäre durchführen möchten, ist payjoin eine gute Option. Aber wie wir gesehen haben, erfordert payjoin die Beteiligung des Empfängers. Was also tun, wenn dieser sich weigert, an einem Payjoin teilzunehmen, oder wenn Sie es einfach vorziehen, ihn nicht einzubeziehen? Eine Alternative ist die Verwendung einer Stonewall- oder Stonewall x2-Transaktion. Schauen wir uns diese beiden Transaktionsarten einmal genauer an.

### Die Stonewall-Transaktion

Stonewall ist eine spezielle Form der Bitcoin-Transaktion, die darauf abzielt, die Privatsphäre der Nutzer während eines Einkaufsbummels zu erhöhen, indem sie einen Pseudo-Coinjoin zwischen zwei Personen imitiert, ohne jedoch tatsächlich einer zu sein. In der Tat ist diese Transaktion nicht gemeinschaftlich. Ein Benutzer kann sie selbst erstellen, indem er nur die UTXOs, die er besitzt, als Input verwendet. Sie können dann eine Stonewall-Transaktion für jede beliebige Gelegenheit erstellen, ohne sich mit einem anderen Benutzer oder dem Empfänger absprechen zu müssen.

Die Stonewall-Transaktion läuft folgendermaßen ab: Bei der Eingabe der Transaktion verwendet der Absender 2 UTXOs, die ihm gehören. Bei der Ausgabe produziert die Transaktion 4 UTXOs, von denen 2 genau den gleichen Betrag ausmachen werden. Die anderen 2 UTXOs bilden den Rest. Von den 2 Ausgaben mit gleichem Betrag geht nur eine tatsächlich an den Zahlungsempfänger.

Bei einer Stonewall-Transaktion gibt es nur 2 Rollen:


- Der Absender, der die Zahlung vornimmt;
- Der Empfänger, der möglicherweise nicht weiß, um welche Art von Transaktion es sich handelt und einfach auf die Zahlung des Absenders wartet.

Nehmen wir ein Beispiel, um diese Transaktionsstruktur zu verstehen. Alice ist beim Bäcker Bob, um ihr Baguette zu kaufen, das 4.000 Sats kostet. Sie möchte mit Bitcoin bezahlen und dabei ein gewisses Maß an Privatsphäre über ihre Zahlung wahren. Daher beschließt sie, eine Stonewall-Transaktion für die Zahlung zu konstruieren.

Wenn wir diese Transaktion analysieren, sehen wir, dass Bob, der Bäcker, tatsächlich 4.000 Sats als Bezahlung für das Baguette erhalten hat. Alice hat 2 UTXOs als Inputs verwendet: einen von 10.000 Sats und einen von 15.000 Sats. Als Outputs erhielt sie 3 UTXOs: einen von 4.000 Sats, einen von 6.000 Sats und einen von 11.000 Sats. Alice hat also einen Nettosaldo von -4.000 Sats bei dieser Transaktion, was genau dem Preis des Baguettes entspricht.

In diesem Beispiel habe ich die Mining-Gebühren absichtlich vernachlässigt, um das Verständnis zu erleichtern. In Wirklichkeit werden die Transaktionsgebühren vollständig vom Absender getragen.

### Was sind die Ziele einer Stonewall-Transaktion?

Die Stonewall-Struktur fügt der Transaktion viel Entropie hinzu und verwirrt die Spuren der Kettenanalyse. Von außen betrachtet, kann eine solche Transaktion als Mini-Münzverknüpfung zwischen zwei Personen interpretiert werden. In Wirklichkeit handelt es sich aber um eine Zahlung. Daher erzeugt diese Methode Unsicherheiten in der Kettenanalyse oder führt sogar zu falschen Spuren.

Kehren wir zu dem Beispiel von Alice bei Bob, dem Bäcker, zurück. Die Transaktion auf der Blockchain würde wie folgt aussehen:

![BTC204](assets/fr/174.webp)

Ein außenstehender Beobachter, der sich auf die übliche Heuristik der Kettenanalyse verlässt, könnte fälschlicherweise zu dem Schluss kommen, dass "_zwei Personen einen kleinen Coinjoin mit je einem UTXO als Input und zwei UTXOs als Output durchgeführt haben_" Die Analyse dieser Transaktion von außen führt nicht zur Anwendung der Common Ownership Heuristik of Input (CIOH), da das Vorhandensein von zwei Outputs in gleicher Höhe auf ein Coinjoin-Muster schließen lässt. Aus externer Sicht ist die CIOH in diesem speziellen Fall also nicht anwendbar.

![BTC204](assets/fr/175.webp)

Diese Interpretation ist ungenau, denn wie Sie wissen, wurde ein UTXO an Bob, den Bäcker, gesendet, die 2 UTXOs im Input kamen von Alice, und sie holte 3 restliche Outputs.

![BTC204](assets/fr/176.webp)

Besonders interessant an der Struktur der Stonewall-Transaktion ist, dass sie aus der Sicht eines außenstehenden Beobachters genau wie eine Stonewall x2-Transaktion aussieht.

### Die Stonewall-Transaktion x2

Stonewall x2 ist eine weitere spezielle Form der Bitcoin-Transaktion, die ebenfalls darauf abzielt, die Privatsphäre der Nutzer während einer Ausgabe zu erhöhen, aber dieses Mal durch die Zusammenarbeit mit einer dritten Partei, die nicht an der Ausgabe beteiligt ist. Diese Methode funktioniert wie ein Pseudo-Coinjoin zwischen zwei Teilnehmern, die eine Zahlung an eine dritte Partei vornehmen.

Die Funktionsweise der Stonewall x2-Transaktion ist relativ einfach: Man verwendet einen UTXO in seinem Besitz, um die Zahlung vorzunehmen, und nimmt die Hilfe einer dritten Partei in Anspruch, die ebenfalls einen UTXO beisteuert. Die Transaktion endet mit vier Ausgängen: zwei davon sind gleich groß, einer geht an die Adresse des Zahlungsempfängers, der andere an eine Adresse, die dem Einzahler gehört. Ein drittes UTXO wird an eine andere Adresse des Geldgebers geschickt, damit dieser den ursprünglichen Betrag zurückerhält (eine für ihn neutrale Aktion, abzüglich der Mining-Gebühren), und ein letztes UTXO kehrt an eine Adresse zurück, die uns gehört, was den Rest der Zahlung ausmacht.

So werden bei Stonewall x2-Transaktionen drei verschiedene Rollen definiert:


- Der Absender, der die eigentliche Zahlung vornimmt;
- Der Empfänger, der möglicherweise nicht weiß, um welche Art von Transaktion es sich handelt, und einfach auf die Zahlung des Absenders wartet;
- Der Mitarbeiter, der Bitcoin zur Verfügung stellt, um die Transaktionsanalyse in Zweifel zu ziehen, erhält sein Geld am Ende vollständig zurück (eine für ihn neutrale Aktion, abzüglich der Mining-Gebühren).

Kehren wir zu unserem Beispiel mit Alice zurück, die bei Bob, dem Bäcker, ihr Baguette kaufen möchte, das 4.000 Sats kostet. Sie möchte mit Bitcoin bezahlen und dabei ein gewisses Maß an Privatsphäre über ihre Zahlung wahren. Also ruft sie ihren Freund Charles an, der ihr bei diesem Vorgang helfen wird.

![BTC204](assets/fr/177.webp)

Die Analyse dieser Transaktion zeigt, dass Bob, der Bäcker, tatsächlich 4.000 Sats als Bezahlung für das Baguette erhalten hat. Alice verbrauchte 10.000 Sats als Input und erhielt 6.000 Sats als Output, was zu einem Nettosaldo von -4.000 Sats führt, was dem Preis des Baguettes entspricht. Charles hat 15.000 Sats als Input geliefert und zwei Outputs erhalten: einen von 4.000 Sats und einen von 11.000 Sats, was einen Saldo von 0 ergibt.

In diesem Beispiel habe ich die Provisionen absichtlich vernachlässigt, um das Verständnis zu erleichtern. In der Realität werden die Mining-Gebühren im Allgemeinen zu gleichen Teilen zwischen dem Emittenten der Zahlung und dem Beitragszahler aufgeteilt.

### Was sind die Ziele einer Stonewall x2-Transaktion?

Wie die Stonewall-Struktur fügt auch die Stonewall-x2-Struktur der Transaktion eine erhebliche Menge an Entropie hinzu und verwischt die Spuren der Kettenanalyse. Von außen betrachtet, könnte eine solche Transaktion als eine kleine Münzverknüpfung zwischen zwei Personen interpretiert werden. In Wirklichkeit handelt es sich aber um eine Zahlung. Diese Methode führt daher zu Unsicherheiten bei der Kettenanalyse, die auch zu falschen Spuren führen.

Betrachten wir das Beispiel von Alice, Bob dem Bäcker und Charles. Die Transaktion auf der Blockchain würde wie folgt aussehen:

![BTC204](assets/fr/178.webp)

Ein außenstehender Beobachter, der sich auf die übliche Heuristik der Kettenanalyse verlässt, könnte fälschlicherweise zu dem Schluss kommen: "_Alice und Charles haben einen kleinen Coinjoin durchgeführt, mit je einem UTXO als Input und zwei UTXOs als Output_" Auch hier führt eine Analyse dieser Transaktion von außen nicht zur Anwendung der Common Ownership Heuristik of Input (CIOH), da das Vorhandensein von zwei Outputs in gleicher Höhe auf ein Coinjoin-Muster schließen lässt. Aus externer Sicht findet die CIOH in diesem speziellen Fall also keine Anwendung.

![BTC204](assets/fr/179.webp)

Diese Interpretation ist ungenau, da, wie Sie wissen, ein UTXO an Bob, den Bäcker, gesendet wurde, Alice nur einen Restausgang hat und Charles zwei hat.

![BTC204](assets/fr/180.webp)

Besonders interessant an der Transaktionsstruktur von Stonewall x2 ist, dass sie aus der Sicht eines außenstehenden Beobachters genau wie eine Stonewall-Transaktion aussieht.

### Was ist der Unterschied zwischen Stonewall und Stonewall x2?

Eine StonewallX2-Transaktion funktioniert genau wie eine Stonewall-Transaktion, mit dem Unterschied, dass erstere gemeinschaftlich erfolgt, während letztere nicht gemeinschaftlich ist. Wie wir gesehen haben, ist an einer StonewallX2-Transaktion eine dritte Partei (Charles) beteiligt, die nicht an der Zahlung beteiligt ist und die ihre Bitcoins zur Verfügung stellt, um die Vertraulichkeit der Transaktion zu erhöhen. Bei einer klassischen Stonewall-Transaktion wird die Rolle des Beitragszahlers vom Sender übernommen.

![BTC204](assets/fr/181.webp)

Von außen betrachtet ist das Transaktionsmodell also genau dasselbe.

Die Tatsache, dass diese beiden Transaktionsstrukturen genau das gleiche Muster aufweisen, bedeutet, dass ein außenstehender Beobachter, selbst wenn er ein "Stonewall(x2)-Muster" erkennen kann, nicht über alle Informationen verfügt. Er wird nicht in der Lage sein zu bestimmen, welche der beiden UTXOs mit den gleichen Beträgen der Zahlung entspricht. Er wird auch nicht feststellen können, ob die beiden eingegebenen UTXOs von zwei verschiedenen Personen stammen (Stonewall x2) oder ob sie zu einer einzigen Person gehörten, die sich ihnen anschloss (Stonewall).

Dieser letzte Punkt ist darauf zurückzuführen, dass Stonewall x2-Transaktionen genau demselben Muster folgen wie Stonewall-Transaktionen. Von außen und ohne zusätzliche Kontextinformationen ist es unmöglich, eine Stonewall-Transaktion von einer Stonewall x2-Transaktion zu unterscheiden. Allerdings handelt es sich bei ersteren nicht um kollaborative Transaktionen, bei letzteren hingegen schon. Dies lässt noch mehr Zweifel an der Analyse einer solchen Transaktion aufkommen.

### Wann sind Stonewall und Stonewall x2 Transaktionen zu verwenden?

Die Logik sollte wie folgt aussehen, wenn Sie ein Datenschutzinstrument für eine Transaktion verwenden möchten:


- Sie können sich vorrangig für einen Payjoin entscheiden;
- Wenn der Händler Payjoins nicht unterstützt, kann eine gemeinschaftliche Transaktion mit einer anderen Person außerhalb der Zahlung unter Verwendung der Stonewall x2-Struktur durchgeführt werden;
- Wenn Sie niemanden finden, mit dem Sie eine Stonewall x2-Transaktion durchführen können, können Sie selbst eine Stonewall-Transaktion durchführen, die das Verhalten einer Stonewall x2-Transaktion nachahmt.

### Wie verwendet man Stonewall und Stonewall x2 Transaktionen?

Stonewall- und Stonewall x2-Transaktionen sind sowohl über die Samourai Wallet-App als auch über die Sparrow Wallet-Software möglich.

Genau wie bei Payjoins funktionieren Stonewall x2-Transaktionen nach der Verhaftung der Samourai-Gründer jedoch nur noch durch den manuellen Austausch von PSBTs zwischen den beteiligten Parteien. Ein automatischer Austausch über Soroban ist derzeit leider nicht möglich.

Sie können diese Art von Transaktion auch manuell mit jeder Bitcoin-Wallet-Software durchführen.

Im nächsten Kapitel werden wir eine weitere, relativ unbekannte, aber sehr nützliche Technik zum Schutz der Privatsphäre untersuchen.

https://planb.network/tutorials/privacy/on-chain/stonewall-033daa45-d42c-40e1-9511-cea89751c3d4
https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b
## Abpraller

<chapterId>db9a20ac-a149-443d-884b-ea6c03f28499</chapterId>

Die Verwendung von Bitcoin-Transaktionsstrukturen, die bei der Kettenanalyse zu Mehrdeutigkeit führen, wie z. B. Coinjoin, ist für den Schutz der Privatsphäre besonders vorteilhaft. Wie wir jedoch im Kapitel über Payjoins besprochen haben, sind Coinjoin-Transaktionen natürlich in der Kette identifizierbar. Erinnern Sie sich an die Analogie, die wir zwischen Kryptographie und Coinjoin hergestellt haben: Wenn eine Datei verschlüsselt wird, kann ein Dritter, der diese verschlüsselte Datei entdeckt, nicht auf ihren Inhalt zugreifen, aber er kann eindeutig erkennen, dass die Datei verändert wurde, um ihren Inhalt zu verbergen. Das Gleiche gilt für Coinjoin: Wenn ein Analyst eine Coinjoin-Transaktion untersucht, kann er, auch wenn er keine direkten Verbindungen zwischen Eingaben und Ausgaben (und umgekehrt) herstellen kann, erkennen, dass es sich bei der beobachteten Transaktion um einen Coinjoin handelt.

Je nach der beabsichtigten Verwendung Ihrer Münze nach dem Coinjoin-Zyklus kann die Tatsache, dass sie diesen Prozess durchlaufen hat, problematisch sein. Wenn Sie Ihren Coin beispielsweise auf einer regulierten Börsenplattform verkaufen wollen, er aber vor kurzem einen Coinjoin durchlaufen hat, wird das Kettenanalysetool der Plattform diese Tatsache feststellen. Die Plattform kann sich dann weigern, Ihren UTXO, bei dem ein Coinjoin stattgefunden hat, zu akzeptieren, oder sogar Erklärungen von Ihnen verlangen, mit dem Risiko, dass Ihr Konto gesperrt oder Ihr Geld eingefroren wird. In einigen Fällen kann die Plattform Ihr Verhalten auch den staatlichen Behörden melden (dies wird z. B. von TRACFIN in Frankreich von den Dienstleistern für digitale Vermögenswerte (PSANs) verlangt).

Um dies zu vermeiden, bräuchten wir ein Werkzeug, das die Spuren der Vergangenheit einer Bitcoin-Münze verwischt, um eine Form der Fungibilität wiederherzustellen. Genau das ist das Ziel von Ricochet.

### Was ist ein Querschläger?

Ricochet ist eine Technik, bei der man mehrere Dummy-Transaktionen an sich selbst durchführt (Sweeping), um eine Übertragung von Bitcoin-Eigentum zu simulieren. Dieses Werkzeug unterscheidet sich von anderen Transaktionsstrukturen, die wir erörtert haben, weil es keine prospektive Anonymität, sondern eher eine Form der retrospektiven Anonymität ermöglicht. Tatsächlich ermöglicht Ricochet die Verwischung von Besonderheiten, die die Fungibilität einer Bitcoin-Münze aufgrund ihrer Vergangenheit beeinträchtigen könnten.

Um die Spuren zu verwischen, die ein vergangenes Ereignis auf einer Münze hinterlässt, wie z. B. Coinjoin-Zyklen, führt Ricochet vier aufeinanderfolgende Transaktionen durch, bei denen der Nutzer sich selbst Geld an verschiedene Adressen überweist.

Nach dieser Abfolge von Transaktionen leitet das Ricochet-Tool die Bitcoins schließlich an ihr endgültiges Ziel, eine Tauschplattform, weiter.

Ziel ist es, einen Abstand zu schaffen, der sich auf die Fungibilität der Münze auswirkt, z. B. eine Coinjoin-Transaktion, und die endgültige Ausgabe, die diese Münze aufgrund ihrer Vergangenheit ablehnen könnte. So könnten Kettenanalysetools zu dem Schluss kommen, dass es nach dem Ereignis wahrscheinlich einen Eigentümerwechsel gegeben hat, und diese Münze als fungibel einstufen. Im Falle eines Coinjoin könnten die Kettenanalysetools dann davon ausgehen, dass es sich nicht um dieselbe Person handelt, die die Bitcoins verschickt und den Coinjoin durchgeführt hat, und dass es daher sinnlos ist, Maßnahmen gegen den Absender einzuleiten.

### Warum funktioniert es?

Angesichts dieser Querschläger-Methode könnte man annehmen, dass die Software zur Kettenanalyse ihre Untersuchung über vier Sprünge hinaus vertiefen würde. Allerdings stehen diese Plattformen bei der Optimierung der Erkennungsschwelle vor einem Dilemma. Sie müssen eine Grenze für die Anzahl der Hops festlegen, nach der sie zugeben, dass wahrscheinlich ein Eigentümerwechsel stattgefunden hat und dass die Verbindung zu einem früheren Ereignis (z. B. einem Coinjoin) ignoriert werden sollte.

Die Bestimmung dieses Schwellenwerts erweist sich jedoch als riskant: Mit jeder Erhöhung der beobachteten Zahl der Überspringer steigt die Zahl der Falschmeldungen exponentiell an, d. h. Personen, die fälschlicherweise als Teilnehmer eines Ereignisses markiert werden, obwohl die Transaktion von einer anderen Person durchgeführt wurde. Dieses Szenario stellt ein größeres Risiko für diese Unternehmen dar, da falsch positive Ergebnisse zu Unzufriedenheit führen, die die betroffenen Kunden zur Konkurrenz treiben kann. Langfristig führt eine zu hohe Erkennungsschwelle dazu, dass eine Plattform mehr Kunden als ihre Konkurrenten verliert, was ihr Überleben gefährden könnte. Daher ist es für diese Plattformen kompliziert, die Zahl der beobachteten Sprünge zu erhöhen, und 4 ist oft eine ausreichende Zahl, um ihre Analyse zu widerlegen.

Das hier beobachtete Phänomen ist in gewisser Weise mit der Theorie der sechs Trennungsgrade vergleichbar.

Die Theorie von den sechs Graden der Trennung besagt, dass jeder Mensch auf der Erde mit jedem anderen durch eine Kette von Wissen verbunden ist, die nicht mehr als sechs Zwischenpersonen umfasst. Es würde genügen, eine Reihe von sechs Personen zu durchlaufen, von denen jede die nächste persönlich kennt, um jeden Menschen auf der Welt zu erreichen.

Bei Bitcoin-Transaktionen ist ein ähnliches Phänomen zu beobachten. Wenn man eine ausreichende Anzahl von Bitcoin-Transaktionen zurückverfolgt, stößt man unweigerlich auf einen Coinjoin. Die Ricochet-Methode nutzt dieses Prinzip aus, indem sie mehr Hops verwendet, als die Börsenplattformen vernünftigerweise verfolgen können. Wenn die Plattformen beschließen, mehr Transaktionen zu verfolgen, ist es möglich, einfach einen zusätzlichen Hop hinzuzufügen, um diese Maßnahme zu umgehen.

### Wann und wie wird der Querschläger eingesetzt?

Der häufigste Anwendungsfall für Querschläger ist die Notwendigkeit, eine frühere Teilnahme an einem Coinjoin auf einem UTXO, den Sie besitzen, zu verbergen. Idealerweise sollte man es vermeiden, Bitcoins, die einem Coinjoin unterzogen wurden, an regulierte Einrichtungen zu übertragen. Für den Fall, dass man jedoch keine anderen Optionen hat, insbesondere wenn man Bitcoin dringend in Fiat-Währung umwandeln muss, bietet Ricochet eine effektive Lösung.

Diese Methode eignet sich nicht nur für Münzverbindungen, sondern auch für alle anderen Merkmale, die die Fungibilität einer Münze beeinträchtigen könnten.

Die Idee für diese Querschläger-Methode stammt ursprünglich von den Samourai-Wallet-Teams, die sie in ihre Anwendung integriert haben, um den Prozess zu automatisieren. Der Service auf Samourai ist kostenpflichtig, da für einen Ricochet zusätzlich zu den Mining-Gebühren eine Servicegebühr von 100.000 Sats anfällt. Daher wird die Nutzung dieses Dienstes eher für Überweisungen von größeren Beträgen empfohlen.

Die Samourai-Anwendung bietet zwei Varianten des Querschlägers:


- Advanced Ricochet oder "gestaffelte Zustellung", die den Vorteil hat, dass die Servicegebühren von Samourai auf fünf aufeinander folgende Transaktionen verteilt werden. Diese Option stellt auch sicher, dass jede Transaktion zu einem separaten Zeitpunkt übermittelt und in einem anderen Block aufgezeichnet wird, wodurch das Verhalten eines Eigentümerwechsels so gut wie möglich nachgeahmt werden kann. Obwohl diese Methode langsamer ist, ist sie für diejenigen, die es nicht eilig haben, vorzuziehen, da sie die Effizienz des Abprallers maximiert, indem sie seine Widerstandsfähigkeit gegen Kettenanalysen verstärkt;
- Der klassische Querschläger, der darauf ausgelegt ist, den Vorgang schnell durchzuführen, indem er alle Transaktionen in kurzer Zeit überträgt. Diese Methode bietet daher weniger Schutz der Privatsphäre und weniger Widerstand gegen Analysen als die erweiterte Methode. Sie sollte nur für dringende Übermittlungen verwendet werden.

Ein Ricochet besteht einfach darin, Bitcoin an sich selbst zu senden. Es ist durchaus möglich, einen Ricochet manuell mit jeder Wallet-Software durchzuführen, ohne ein spezielles Tool zu verwenden. Übertragen Sie einfach dieselbe Münze später an sich selbst, wobei Sie jedes Mal eine neue leere Adresse verwenden.

Im folgenden Kapitel werden wir verschiedene Techniken für geheime Eigentumsübertragungen untersuchen. Diese Methoden unterscheiden sich grundlegend von den bisher untersuchten, sowohl was ihre Funktionsweise als auch ihre Ergebnisse betrifft.

https://planb.network/tutorials/privacy/on-chain/ricochet-e0bb1afe-becd-44a6-a940-88a463756589
## Geheime Eigentumsübertragungen

<chapterId>a2067036-849c-4d6b-87d2-44235cfae7a1</chapterId>

Zu den Techniken zur Wahrung der Privatsphäre bei bitcoin gehört die geheime Übertragung von Eigentum. Diese Methode zielt darauf ab, das Eigentum an Bitcoins von einer Person auf eine andere zu übertragen und umgekehrt, ohne dass diese Transaktion ausdrücklich in der Blockchain sichtbar ist. Lassen Sie uns gemeinsam die verschiedenen verfügbaren Techniken sowie ihre Vor- und Nachteile untersuchen.

### Der CoinSwap

CoinSwap basiert auf einem relativ einfachen Konzept: Es verwendet intelligente Verträge, um eine Übertragung von Bitcoin-Eigentum zwischen zwei Nutzern zu ermöglichen, ohne dass Vertrauen erforderlich ist und ohne dass diese Übertragung ausdrücklich auf der Blockchain sichtbar ist.

Stellen wir uns ein vereinfachtes Beispiel mit Alice und Bob vor. Alice besitzt 1 BTC, gesichert mit dem privaten Schlüssel $A$, und Bob besitzt ebenfalls 1 BTC, gesichert mit dem privaten Schlüssel $B$. Theoretisch könnten sie ihre privaten Schlüssel über einen externen Kommunikationskanal austauschen, um eine geheime Übertragung durchzuführen.

Diese naive Methode birgt jedoch ein hohes Risiko in Bezug auf das Vertrauen. Nichts hindert Alice daran, nach dem Austausch eine Kopie des privaten Schlüssels $A$ aufzubewahren und sie später zu benutzen, um Bitcoins zu stehlen, sobald der Schlüssel in Bobs Besitz ist.

Außerdem gibt es keine Garantie, die Alice daran hindert, Bobs privaten Schlüssel $B$ zu erhalten und im Gegenzug niemals seinen privaten Schlüssel $A$ zu senden. Dieser Austausch beruht daher auf übermäßigem Vertrauen zwischen den Parteien und erweist sich als ineffizient, wenn es darum geht, eine geheime Übertragung von Eigentum auf sichere Weise zu gewährleisten.

Um diese Probleme zu lösen und den Austausch zwischen Parteien zu ermöglichen, die sich nicht gegenseitig vertrauen, können wir stattdessen intelligente Vertragssysteme verwenden. Ein intelligenter Vertrag ist ein Programm, das automatisch abläuft, wenn vordefinierte Bedingungen erfüllt sind, was in unserem Fall gewährleistet, dass der Austausch von Eigentum automatisch erfolgt, ohne dass gegenseitiges Vertrauen erforderlich ist.

Zu diesem Zweck können wir HTLC (_Hash Time-Locked Contracts_) oder PTLC (_Point Time-Locked Contracts_) verwenden. Diese beiden Protokolle funktionieren ähnlich und verwenden ein Zeitsperrsystem, das sicherstellt, dass der Austausch erfolgreich abgeschlossen oder vollständig abgebrochen wird, wodurch die Integrität der Gelder beider Parteien geschützt wird. Der Hauptunterschied zwischen HTLC und PTLC besteht darin, dass HTLCs Hashes und Preimages verwenden, um die Transaktion zu sichern, während PTLCs adaptive Signaturen verwenden.

In einem CoinSwap-Szenario mit einem HTLC oder einem PTLC zwischen Alice und Bob findet der Austausch auf sichere Weise statt: Entweder ist er erfolgreich, und jeder erhält die BTC des anderen, oder er scheitert, und jeder behält seine eigenen BTC. Daher ist es für keine der beiden Parteien möglich, zu betrügen oder die BTC der anderen Partei zu stehlen.

> die HTLCs sind auch der Mechanismus, der verwendet wird, um Zahlungen sicher durch die Zwei-Wege-Kanäle des Lightning-Netzwerks zu leiten
> Die Verwendung adaptiver Signaturen ist in diesem Zusammenhang besonders interessant, da sie die Umgehung herkömmlicher Skripte ermöglicht (ein Mechanismus, der manchmal als "_skriptlose Skripte_" bezeichnet wird). Diese Funktion trägt dazu bei, die mit dem Austausch verbundenen Gebühren zu senken. Ein weiterer großer Vorteil der adaptiven Signaturen besteht darin, dass sie keinen gemeinsamen Hash für beide Seiten der Transaktion erfordern, so dass bei bestimmten Arten des Austauschs keine direkte Verbindung zwischen ihnen aufgedeckt werden kann.
### Adaptive Signaturen

Adaptive Signaturen sind eine kryptografische Methode, bei der eine gültige Signatur mit einer zusätzlichen Signatur, "_adaptive Signatur_" genannt, kombiniert wird, um ein geheimes Datenelement zu enthüllen. Dieser Mechanismus ist so konzipiert, dass bei Kenntnis von 2 der folgenden 3 Elemente: der gültigen Signatur, der adaptiven Signatur und des Geheimnisses, das dritte fehlende Element abgeleitet werden kann. Eine interessante Eigenschaft dieser Methode ist, dass wir, wenn wir die adaptive Signatur unseres Gegenübers und den spezifischen Punkt auf der elliptischen Kurve kennen, der mit dem Geheimnis verbunden ist, das zur Berechnung dieser adaptiven Signatur verwendet wurde, unsere eigene adaptive Signatur ableiten können, die mit demselben Geheimnis kompatibel ist, ohne jemals direkten Zugang zum Geheimnis selbst zu haben.

Bei Münzbörsen ermöglicht die Verwendung von adaptiven Signaturen die gleichzeitige Offenlegung von zwei sensiblen Informationen zwischen den Teilnehmern, so dass kein gegenseitiges Vertrauen erforderlich ist. Nehmen wir zur Veranschaulichung dieses Prozesses ein Beispiel mit Alice und Bob, die das Eigentum an jeweils 1 BTC tauschen möchten, sich aber gegenseitig nicht vertrauen. Sie verwenden Adaptive Signaturen, um die Notwendigkeit von Vertrauen bei diesem Austausch zu vermeiden. So gehen sie vor:


- Alice leitet den Austausch ein, indem sie eine Transaktion $m_A$ erstellt, die 1 BTC an Bob sendet. Mit ihrem privaten Schlüssel $p_A$ ($P_A = p_A \cdot G$), einem Nonce $n_A$ ($N_A = n_A \cdot G$) und einem Geheimnis $t$ ($T = t \cdot G$) erzeugt sie eine Signatur $s_A$, die diese Transaktion bestätigt:

$$s_A = n_A + t + H(N_A + T \parallel P_A \parallel m_A) \cdot p_A$$


- Alice berechnet die adaptive Signatur $s_A'$, indem sie das Geheimnis $t$ von ihrer echten Signatur $s_A$ subtrahiert:

$$s_A' = s_A - t$$


- Alice sendet Bob ihre adaptive Signatur $s'_A$, ihre unsignierte Transaktion $m_A$, den Punkt, der dem Geheimnis ($T$) entspricht, und den Punkt, der der Nonce ($N_A$) entspricht. Diese Elemente bilden einen so genannten "_Adapter_" Es ist wichtig zu wissen, dass Bob mit diesen Informationen allein Alices BTC nicht abrufen kann.
- Bob hat jedoch die Möglichkeit zu überprüfen, ob Alice nicht versucht, ihn zu bestehlen. Dazu prüft er, ob die adaptive Signatur $s_A'$ von Alice tatsächlich mit der vorgeschlagenen Transaktion $m_A$ übereinstimmt. Wenn die folgende Gleichung korrekt ist, kann er sicher sein, dass die adaptive Signatur von Alice gültig ist:

$$s_A' \cdot G = N_A + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A$$


- Diese Überprüfung gibt Bob genügend Sicherheit, um den Austausch vertrauensvoll durchzuführen. Er erstellt dann seine eigene Transaktion $m_B$, mit der er 1 BTC an Alice senden will, und generiert seine adaptive Signatur $s_B'$, die ebenfalls mit demselben Geheimnis $t$ verknüpft wird. Zu diesem Zeitpunkt kennt nur Alice den Wert von $t$; Bob kennt nur den entsprechenden Punkt $T$, den Alice ihm übermittelt hat:

$$s_B' = n_B + H(N_B + T \parallel P_B \parallel m_B) \cdot p_B$$


- Bob übermittelt Alice seine adaptive Signatur $s_B'$, seine unsignierte Transaktion $m_B$ sowie den Punkt, der dem Geheimnis ($T$) entspricht, und den Punkt, der der Nonce ($N_B$) entspricht. Alice, die das Geheimnis $t$ kennt, kann nun Bobs adaptive Signatur $s_B'$ mit diesem Geheimnis kombinieren, um eine gültige Signatur $s_B$ für die Transaktion $m_B$ zu erzeugen, mit der Bobs BTC an sie übertragen wird:

$$s_B = s_B' + t$$

$$(s_B' + t) \cdot G = N_B + T + H(N_B + T \parallel P_B \parallel m_B) \cdot P_B$$


- Alice überträgt diese signierte Transaktion $m_B$ an die Bitcoin-Blockchain, um die von Bob versprochenen BTC zu erhalten. Wenn Bob diese Transaktion in der Blockchain sieht, kann er die Signatur $s_B = s_B' + t$ extrahieren. Mit dieser Information ist Bob dann in der Lage, das berühmte Geheimnis $t$, das er brauchte, zu isolieren:

$$t = (s_B' + t) - s_B' = s_B - s_B'$$


- Und tatsächlich war dieses Geheimnis $t$ das einzige fehlende Element für Bob, um aus Alices Adapter-Signatur $s_A'$ die gültige Signatur $s_A$ zu erzeugen. Mit dieser Signatur kann die Transaktion $m_A$, die einen BTC von Alice an Bob sendet, validiert werden. Bob berechnet daraufhin $s_A$ und überträgt seinerseits die Transaktion $m_A$ auf der Blockchain:

$$s_A = s_A' + t$$

$$(s_A' + t) \cdot G = N_A + T + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A$$

Lassen Sie uns zusammenfassen, wie ein Signaturadapter in einer Münzbörse funktioniert. Zu Beginn schickt Alice Bob eine unsignierte Transaktion zusammen mit einem Adapter, mit dem Bob überprüfen kann, ob das später enthüllte Geheimnis ihm Zugang zu Bitcoins verschafft. Im Gegenzug schickt Bob Alice seine unsignierte Transaktion und den Adapter. Alice kann dann Bobs Transaktion abschließen und die Bitcoins zurückerhalten, indem sie eine gültige Transaktion unter Verwendung des Geheimnisses überträgt. Wenn diese Transaktion auf der Blockchain veröffentlicht wird, hat Bob die Möglichkeit, das Geheimnis zu extrahieren und somit die Transaktion von Alice zu entsperren. Wenn Alice also eine Übertragung von Bobs Bitcoins veranlasst, kann er seinerseits auf Alices Bitcoins zugreifen, ohne dass gegenseitiges Vertrauen erforderlich ist.

Es ist wichtig anzumerken, dass Münzbörsen erstmals von [Gregory Maxwell im Oktober 2013 auf BitcoinTalk] (https://bitcointalk.org/index.php?topic=321228.0) vorgeschlagen wurden.

### Die Atombörse

Ähnlich wie beim Coin-Tausch und unter Verwendung der gleichen Arten von Smart Contracts ist es auch möglich, einen atomaren Tausch durchzuführen. Ein atomarer Austausch ermöglicht einen direkten Austausch verschiedener Kryptowährungen, wie BTC und XMR, zwischen zwei Nutzern, ohne dass Vertrauen oder die Einschaltung eines Vermittlers erforderlich ist. Diese Tauschvorgänge werden als "atomarer" Tausch bezeichnet, weil es nur zwei mögliche Ergebnisse gibt: Entweder der Tausch ist erfolgreich und beide Parteien sind zufrieden, oder er scheitert und beide behalten ihre ursprünglichen Kryptowährungen, so dass kein Vertrauen in die andere Partei erforderlich ist.

![BTC204](assets/fr/197.webp)

Atomtausch und Münztausch haben eine ähnliche Funktionsweise und bieten die gleichen Vor- und Nachteile in Bezug auf den Datenschutz. Aus der Sicht von Bitcoin ist ein atomarer Tausch mit einem Münztausch vergleichbar, der in zwei Schritten durchgeführt wird. Zunächst tauschen wir unsere BTC gegen eine andere Kryptowährung, und dann kann diese Kryptowährung gegen andere BTC getauscht werden. Schließlich holen wir uns die BTC eines anderen Nutzers zurück. Aus diesem Grund fasse ich diese beiden Protokolle bei der Analyse von Datenschutzfragen unter der Kategorie des geheimen Austauschs von Eigentum zusammen.

![BTC204](assets/fr/198.webp)

Im Gegensatz zum Coin-Austausch kann es beim Atom-Austausch jedoch zu Ungleichgewichten in Bezug auf die verfügbare Liquidität kommen, insbesondere beim BTC/XMR-Austausch. Im Allgemeinen ist es einfacher, Bitcoin in Altcoin zu tauschen, weil es eine große Nachfrage nach Bitcoin gibt, die die Prämien für diese Richtung der Umwandlung niedrig hält. Der Handel mit Altcoin, um BTC zu erhalten, kann jedoch aufgrund der geringeren Nachfrage komplexer sein, was oft zu sehr hohen Prämien führt.

Wenn ein atomarer Tausch Onchain-Bitcoin und Bitcoin im Lightning-Netzwerk umfasst, bezeichnen wir ihn als "_submersible exchange_"

### Ist es wirklich nützlich?

Geheime Eigentumsübertragungen, wie z. B. Münztausch und Atomtausch, haben den Vorteil, dass sie die Heuristik der Kettenanalyse täuschen. Diese Methoden können den Eindruck erwecken, dass es sich bei den Transaktionen um denselben Nutzer handelt, auch wenn der tatsächliche Eigentümer den Besitzer gewechselt hat. Der größte Nachteil dieser Methoden ist jedoch, dass sie ohne den Einsatz einer zusätzlichen Technik zur Unterbrechung der Münzhistorie sehr riskant sind.

Wenn Alice mit Bob einen Coin-Tausch oder Atomic Swap durchführt, tauscht sie das Eigentum an ihren Bitcoins gegen Bobs Bitcoins aus. Bei einem atomaren Tausch umfasst der Tausch einen Altcoin, aber das Prinzip bleibt das gleiche. Am Ende hat Alice also Münze $B$ und Bob Münze $A$. Dies führt zu Zweifeln bei der Kettenanalyse, aber die Geschichte der Münzen bleibt nachvollziehbar. Wenn ein Analyst die Münze $A$ untersucht, kann er Alices frühere Aktivitäten zurückverfolgen, und umgekehrt für Münze $B$.

Aus Sicht von Alice besteht das Risiko darin, dass die Geschichte der $B$-Münze von bestimmten Stellen als verdächtig angesehen werden könnte. Wenn Bob die $B$-Münze beispielsweise durch eine kriminelle Handlung wie einen Hack erworben hat, würde diese Münze mit seinen illegalen Aktivitäten in Verbindung gebracht werden. Alice könnte dann in den Besitz einer Münze gelangen, die sie nicht auf regulierte Handelsplattformen übertragen kann, ohne zu riskieren, dass ihre Gelder eingefroren werden oder sie sogar der Verbrechen von Bob beschuldigt wird, obwohl sie nichts damit zu tun hat.

Und natürlich werden Methoden zum Schutz der Privatsphäre wie Coin-Swapping oder Atomic Swapping von Kriminellen bevorzugt, deren Gelder von den Behörden überwacht werden. Diese Protokolle geben ihnen die Möglichkeit, ihre überwachten Bitcoins im Austausch gegen vollkommen fungible Bitcoins zu veräußern. Auf diese Weise können sie auch für Ablenkung sorgen, indem sie die Behörden auf andere Nutzer verweisen. Für diese Personen ergibt sich somit ein doppelter Nutzen.

Bei Coinjoin ist die Historie des Coins gebrochen, selbst wenn Ihr Coin mit überwachten Bitcoins gemischt wird, was eine Form der plausiblen Bestreitbarkeit bietet, die es bei geheimen Eigentumsübertragungsprotokollen wie Coin Exchange oder Atomic Swap nicht gibt.

Wenn Alice jegliches Risiko vermeiden will, muss sie zwangsläufig eine Methode anwenden, um die Geschichte der $B$-Münze zu unterbrechen, z. B. indem sie sie durch Coinjoin laufen lässt. Dies wirft die Frage auf, ob eine Kombination aus geheimer Eigentumsübertragung und Coinjoin sinnvoll ist. Der Coinjoin unterbricht die Geschichte einer Münze und bietet Alice damit bereits ein ausreichendes Maß an Privatsphäre. Wenn Alice ihre Privatsphäre schützen will, wäre es meiner Meinung nach sinnvoller, direkt mit einem Coinjoin fortzufahren als einen Münztausch mit anschließendem Coinjoin vorzunehmen.

Damit Methoden der geheimen Eigentumsübertragung wirklich effektiv sind und das Risiko einer Verbindung zwischen der Geschichte eines $A$-Nutzers und eines $B$-Nutzers vermeiden, wäre es paradoxerweise notwendig, dass ihre Verwendung weithin bekannt ist. Wenn der Münztausch in großem Umfang genutzt wird und die Behörden über diese gängige Praxis informiert sind, könnte eine plausible Form der Bestreitbarkeit geschaffen werden. Solange diese Transfers jedoch nur in geringem Umfang genutzt werden, bleiben diese Methoden meiner Meinung nach für die Nutzer zu riskant.

Bisher haben wir hauptsächlich Methoden zum Schutz der Privatsphäre auf der Transaktionsebene selbst untersucht. Im nächsten Kapitel werden wir uns mit Fragen der Netzebene und der Verbreitung von Transaktionen befassen.

## Datenschutz im P2P-Netzwerk

<chapterId>04a2467b-db84-4076-a9ff-919be5135106</chapterId>

In Teil 4 haben wir besprochen, wie wichtig es ist, einen Full Node zu verwenden, um die Privatsphäre Ihrer Transaktionen zu schützen. Es ist jedoch wichtig zu verstehen, dass Ihr Node selbst Angriffen ausgesetzt sein kann, die versuchen, Informationen über Ihre Aktivitäten zu extrahieren. In diesem Kapitel werden wir daher verschiedene Maßnahmen zum Schutz der Privatsphäre betrachten, und zwar nicht auf der Ebene der Transaktionen selbst oder der Bitcoin-Streams, sondern auf der Ebene des Netzwerks.

### Löwenzahn

Eine Möglichkeit, verschiedene Angriffe zur Deanonymisierung zu vermeiden, ist die Verwendung des vorgeschlagenen Dandelion. Dieses Übertragungsprotokoll wurde in BIP156 formalisiert, wurde aber nie in Bitcoin implementiert. Die Idee von Dandelion ist es, die Privatsphäre des Transaktionsroutings im Bitcoin-Netzwerk zu verbessern, um verschiedene Formen von Angriffen zu vereiteln. Sein Hauptziel ist es, den Quellknoten zu verbergen, der eine Transaktion ursprünglich an das Netzwerk weiterleitet. Die Offenlegung dieses Knotens könnte eine Bitcoin-Transaktion mit einer bestimmten IP-Adresse in Verbindung bringen (wenn der Knoten im unverschlüsselten Netzwerk arbeitet) und damit einen Einstiegspunkt für die Analyse der Kette bieten.

Diese Verbindung zwischen einer Aktivität auf Bitcoin und einer IP-Adresse stellt ein erhebliches Risiko für die Privatsphäre der Nutzer dar. In der Tat können zahlreiche Einrichtungen eine IP-Adresse leicht mit einer persönlichen Identität verknüpfen. Dazu gehören insbesondere Regierungen und Internetdienstanbieter. Darüber hinaus können diese Informationen öffentlich zugänglich werden, zum Beispiel wenn Ihre IP-Adresse und Ihre persönlichen Daten durch ein Datenleck bei einem Website-Datenbank-Hack offengelegt werden.

Im Standardbetrieb von Bitcoin werden Transaktionen, die ein Nutzer in seiner Software-Wallet erstellt hat, an seinen persönlichen Knoten übermittelt. Dieser Knoten überträgt die neue Transaktion sofort an alle Peers, mit denen er verbunden ist.

Diese Peers überprüfen dann die Transaktion, um sicherzustellen, dass sie den Konsensregeln und lokalen Standardisierungsregeln entspricht. Nach der Überprüfung leitet jeder Peer die Transaktion wiederum an seine Peers weiter, und so weiter.

Die Verteilung der Transaktionen, die zur Integration in einen Block anstehen, erfolgt auf recht ausgewogene und statistisch vorhersehbare Weise. Diese Schwachstelle kann von geheimen Spionageknoten ausgenutzt werden, die zusammenarbeiten, um das Netzwerk zu überwachen und zu analysieren, um den ersten Knoten zu identifizieren, der eine Transaktion übermittelt. Wenn ein Beobachter den Quellknoten ausfindig machen kann, kann er davon ausgehen, dass die Transaktion von dem Betreiber dieses Knotens stammt. Durch diese Art der Beobachtung können Transaktionen, die normalerweise anonym sind, mit bestimmten IP-Adressen in Verbindung gebracht werden.

Das Ziel von BIP156 ist es, dieses Problem zu lösen. Zu diesem Zweck führt es eine zusätzliche Phase bei der Übertragung einer neuen Transaktion ein, um die Anonymität vor einer groß angelegten öffentlichen Verbreitung zu wahren. Dandelion verwendet zunächst eine "Stamm"-Phase, in der die Transaktion durch einen zufälligen Pfad von Knoten gesendet wird.

Die Transaktion wird dann in der "Fluff"-Phase (Blowhole) an das gesamte Netz übermittelt.

Der Stängel und die Pusteblume verweisen auf das Verhalten bei der Ausbreitung der Transaktion durch das Netz, das der Form einer Pusteblume ähnelt.

Somit können die Spionageknoten die Transaktion möglicherweise zu dem Knoten zurückverfolgen, der die Blow-Phase (die massive Übertragung) eingeleitet hat, aber dieser Knoten ist nicht derjenige, der die Transaktion zuerst übertragen hat, da er sie vom letzten Knoten im Stamm erhalten hat. Wenn die Spionageknoten den Stamm nicht zurückverfolgen können, können sie auch den Ursprungsknoten nicht identifizieren.

Selbst bei Anwesenheit von Spionageknoten während der Stammphase bleiben immer Zweifel, denn sobald sie auf einen ehrlichen Knoten im Diffusionsgraphen treffen, können die Spione nicht feststellen, ob dieser Knoten die ursprüngliche Quelle oder nur ein Vermittler ist.

Diese Routing-Methode erschwert die Rückverfolgung zum Ursprungsknoten, was die Rückverfolgung einer Transaktion durch das Netz zu ihrem Ursprung erschwert. Dandelion verbessert somit den Schutz der Privatsphäre, indem es die Möglichkeiten von Angreifern einschränkt, das Netzwerk zu deanonymisieren. Diese Methode ist noch effektiver, wenn die Transaktion während der "Stamm"-Phase einen Knoten durchläuft, der seine Netzwerkkommunikation verschlüsselt, wie bei Tor oder P2P Transport V2.

BIP156 wurde nicht in Bitcoin Core integriert und ist derzeit mit dem Status "abgelehnt" klassifiziert Ein Hauptproblem dieses Protokolls liegt in der Tatsache, dass Transaktionen während der Stem-Phase von Zwischenknoten weitergeleitet werden müssen, bevor sie verifiziert werden. Wie wir gesehen haben, verifiziert im normalen Bitcoin-Modell jeder Knoten die Transaktion zuerst, bevor er sie an seine Kollegen weiterleitet. Wenn eine Transaktion nicht den Konsens- oder lokalen Standardisierungsregeln des Knotens entspricht, wird sie ignoriert und nicht weitergeleitet. Dieser Prozess ist wichtig, um DoS-Angriffe zu vereiteln, da nur gültige Transaktionen an das gesamte Netzwerk weitergeleitet werden. Ungültige Transaktionen, die möglicherweise massenhaft generiert werden, um das Netzwerk zu überlasten, werden beim ersten angetroffenen Knoten gestoppt und werden nicht weitergeleitet. Das Hauptrisiko bei Dandelion besteht darin, dass dieses neue Protokoll neue Vektoren für DoS-Angriffe einführen könnte, da ungültige Transaktionen über einen Teil des Netzes übertragen werden können.

### P2P-Transport V2

P2P Transport V2 ist ein weiteres in BIP324 vorgestelltes Netzwerkprotokoll. Es ist eine neue Version des P2P-Transportprotokolls von Bitcoin, das opportunistische Kryptographie beinhaltet, um die Vertraulichkeit und Sicherheit der Kommunikation zwischen den Knotenpunkten zu verbessern.

Diese Verbesserung zielt darauf ab, mehrere Probleme mit der Basisversion des P2P-Protokolls zu lösen. Zum einen macht es die ausgetauschten Daten für einen passiven Beobachter ununterscheidbar von anderen Arten von Daten, die im Internet zirkulieren. Damit soll vor allem verhindert werden, dass Regierungen, Internetdienstleister oder VPN-Anbieter Bitcoin-Nutzer massiv überwachen können. Dies erschwert diesen Stellen auch die Aufgabe, festzustellen, ob ein Internetnutzer auch ein Bitcoin-Nutzer ist, d.h. ob er einen vollständigen Knoten betreibt.

P2P V2 trägt auch dazu bei, die Risiken von Zensur und Angriffen zu verringern, indem bestimmte Muster in Datenpaketen erkannt werden. Es erschwert und verteuert die Durchführung verschiedener Arten von Sybil-Angriffen auf Netzwerkebene. Ein Sybil-Angriff liegt vor, wenn ein Akteur mehrere falsche Identitäten erstellt, um sich einen ungerechtfertigten Vorteil zu verschaffen. Im Kontext des Bitcoin-Netzwerks manifestiert sich dies oft als ein Akteur, der eine große Anzahl vollständiger Knoten kontrolliert und sie aggressiv nutzt, um Verbindungen zu vervielfachen. Sybil-Angriffe können passiv sein und darauf abzielen, Informationen zu sammeln und die Vertraulichkeit der Nutzer zu gefährden, oder aktiv, in Form von Eclipse-Angriffen. Letztere isolieren einen bestimmten Knoten vom Rest des Netzes und ermöglichen es ihm, den Benutzer zu zensieren oder die empfangenen Daten zu verändern. Schließlich macht P2P V2 _Man-In-The-Middle_ (MITM)-Angriffe teurer und leichter zu entdecken.

Die von P2P V2 implementierte Verschlüsselung beinhaltet keine Authentifizierung, um die Komplexität nicht unnötig zu erhöhen und den erlaubnisfreien Charakter der Netzverbindung nicht zu gefährden. Dieses neue P2P-Transportprotokoll bietet jedoch eine bessere Sicherheit gegen passive Angriffe und macht aktive Angriffe wesentlich kostspieliger und aufspürbarer. Die Einführung eines pseudozufälligen Datenstroms in die Netznachrichten erschwert Angreifern, die die Kommunikation zensieren oder manipulieren wollen, die Arbeit.

Der P2P-V2-Transport wurde als Option (standardmäßig deaktiviert) in Version 26.0 von Bitcoin Core aufgenommen, die im Dezember 2023 bereitgestellt wurde. Er wurde dann standardmäßig in Version 27.0 im April 2024 aktiviert. Er kann mit der Option `v2transport=` in der Konfigurationsdatei geändert werden.

### Tor

Eine relativ einfache Lösung zur Vermeidung des Risikos eines Vertraulichkeitsverlustes für einen Knoten auf Netzebene besteht darin, ihn vollständig unter Tor zu betreiben. Tor ist ein Netz von Relay-Servern (Knoten), das den Ursprung von TCP-Verbindungen über das Internet anonymisiert. Es funktioniert, indem es Daten in mehrere Verschlüsselungsebenen einkapselt. Jeder Relaisknoten entfernt eine Schicht, um die Adresse des nächsten Knotens zu enthüllen, bis das endgültige Ziel erreicht ist. Das Tor-Netzwerk gewährleistet Anonymität, indem es verhindert, dass die Zwischenknoten sowohl den Ursprung als auch das Ziel der Daten kennen.

Tor verschlüsselt also nicht nur die übermittelten Daten, sondern ermöglicht auch die Verschleierung von Herkunft und Ziel der Kommunikation. Durch die Verwendung von Tor für die persönliche Knotenkommunikation verbessern wir die Privatsphäre unserer Transaktionen: der Internet Service Provider (ISP) kann die Kommunikation nicht entschlüsseln, und andere Knoten im Bitcoin-Netzwerk können die IP-Adresse des Quellknotens nicht identifizieren. Darüber hinaus verbirgt Tor auch die Verwendung von Bitcoin vor dem eigenen ISP.

Das Hauptrisiko bei dieser Methode ist, dass Tor ein Bitcoin-unabhängiges Protokoll ist. Wenn Sie einen Bitcoin-Knoten unter Tor haben und Tor nicht mehr funktioniert, dann kann Ihr Bitcoin-Knoten nicht mehr kommunizieren.

Es ist auch wichtig zu wissen, dass die Kommunikation auf Tor langsamer ist. Diese Latenz ist besonders problematisch während des ersten Starts eines Knotens, da der Initial Block Download (IBD) eine Menge Kommunikation erfordert. Daher kann die anfängliche Synchronisation mit dem Bitcoin-Netzwerk über Tor deutlich länger dauern. Es ist auch möglich, IBD im offenen Netzwerk durchzuführen und Tor später zu aktivieren. Obwohl diese Methode die Existenz deines Bitcoin-Knotens deinem ISP offenbart, schützt sie deine persönlichen Transaktionsinformationen, sobald du zu Tor wechselst.

Nachdem ich die verschiedenen Methoden zum Schutz der Privatsphäre auf Netzebene untersucht habe, möchte ich in den nächsten Kapiteln auch zwei elegante Lösungen zur Vermeidung der Wiederverwendung von Adressen vorstellen: BIP47 und Silent Payments.

## BIP47 und wiederverwendbare Zahlungscodes

<chapterId>ad88e076-a04b-4aec-b3b2-7b4760175504</chapterId>

Wie wir in Teil 3 gesehen haben, ist die Wiederverwendung von Adressen ein ernsthaftes Hindernis für die Privatsphäre der Nutzer des Bitcoin-Protokolls. Um diese Risiken zu vermindern, wird dringend empfohlen, für jede neue Zahlung, die in einer Wallet eingeht, eine neue Empfängeradresse zu generieren. Obwohl heutzutage die Generierung einer neuen Adresse durch den Einsatz moderner Software und hierarchischer deterministischer Wallets vereinfacht wird, mag diese Praxis kontraintuitiv erscheinen.

Im traditionellen Bankensystem sind wir zum Beispiel daran gewöhnt, unsere IBAN mitzuteilen, die immer gleich bleibt. Sobald wir dies jemandem mitteilen, kann er uns mehrere Zahlungen schicken, ohne erneut mit uns in Kontakt treten zu müssen. Neo-Banken bieten auch modernere Möglichkeiten wie die Verwendung von eindeutigen E-Mail-Adressen bei PayPal oder RevTags bei Revolut. Auch außerhalb des Finanzbereichs sind unsere täglichen Identifikatoren wie Postanschrift, Telefonnummer und E-Mail-Adresse eindeutig und dauerhaft. Wir müssen sie nicht bei jeder neuen Interaktion erneuern.

Die Funktionsweise von Bitcoin ist jedoch anders: Für jede eingehende Transaktion muss zwingend eine neue Empfängeradresse generiert werden. Dieser Zielkonflikt zwischen Benutzerfreundlichkeit und Datenschutz geht auf die Ursprünge des Bitcoin-Weißbuchs zurück. Seit der Veröffentlichung der ersten Version seines Papiers Ende 2008 hatte Satoshi Nakamoto bereits vor diesem Risiko gewarnt:

**Als zusätzliche Firewall könnte für jede Transaktion ein neues Schlüsselpaar verwendet werden, damit sie nicht mit einem gemeinsamen Eigentümer verknüpft sind."

Es gibt zahlreiche Methoden, um mehrere Zahlungen für eine einzige Kennung zu erhalten, ohne dass es zu einer Wiederverwendung von Adressen kommt. Jede dieser Methoden hat ihre eigenen Kompromisse und Nachteile. Zu diesen Methoden gehört BIP47, ein von Justus Ranvier entwickelter und 2015 veröffentlichter Vorschlag. Dieser Vorschlag zielt darauf ab, wiederverwendbare Zahlungscodes zu schaffen, die mehrere Transaktionen an dieselbe Person ermöglichen und gleichzeitig die Wiederverwendung von Adressen vermeiden. BIP47 zielt im Wesentlichen darauf ab, ein intuitives Zahlungssystem als eindeutige Kennung anzubieten und gleichzeitig die Privatsphäre der Transaktionen zu wahren.

![BTC204](assets/fr/212.webp)

BIP47 verbessert nicht direkt die Privatsphäre der Nutzer, da eine BIP47-Zahlung das gleiche Maß an Privatsphäre bietet wie eine klassische Bitcoin-Transaktion mit neuen Adressen. Es macht jedoch die Nutzung von Bitcoin bequemer und intuitiver, eine Bequemlichkeit, die normalerweise die Privatsphäre beeinträchtigen müsste. Dank BIP47 erreicht diese Benutzerfreundlichkeit das gleiche Maß an Privatsphäre wie bei einer klassischen Transaktion. Aus diesem Grund ist BIP47 ein wertvolles Instrument zur Wahrung der Privatsphäre.

Ursprünglich war BIP47 ein Vorschlag, der in den Bitcoin Core integriert werden sollte, aber nie angenommen wurde. Einige Software hat sich jedoch dafür entschieden, es unabhängig auf der Anwendungsebene zu implementieren. So entwickelten die Samourai-Wallet-Teams ihre eigene Implementierung von BIP47 namens "PayNym"

### Allgemeines Prinzip von BIP47 und PayNym

Das Ziel von BIP47 ist es, den Empfang zahlreicher Zahlungen zu ermöglichen, ohne dass es zu einer Wiederverwendung von Adressen kommt. Es basiert auf der Verwendung eines wiederverwendbaren Zahlungscodes, der es verschiedenen Absendern ermöglicht, mehrere Zahlungen an einen einzigen Code zu senden, der einem anderen Nutzer gehört. Auf diese Weise muss der Empfänger nicht für jede Transaktion eine neue Adresse angeben, was den Datenaustausch erheblich erleichtert und gleichzeitig seine Privatsphäre schützt.

![BTC204](assets/it/66/4.webp)

Ein Nutzer kann dann seinen Zahlungscode in sozialen Netzwerken oder auf seiner eigenen Website weitergeben, ohne den Verlust seiner Privatsphäre zu riskieren, wie dies bei einer klassischen Empfangsadresse oder einem öffentlichen Schlüssel der Fall wäre.

Um eine Transaktion durchzuführen, müssen beide Parteien über eine Bitcoin-Wallet mit einer Implementierung von BIP47 verfügen, wie z. B. PayNym auf Samourai Wallet oder Sparrow Wallet. Die gemeinsame Nutzung ihrer Zahlungscodes schafft einen geheimen Kanal zwischen ihnen. Um diesen Kanal effizient zu etablieren, muss der Absender eine bestimmte Transaktion auf der Bitcoin-Blockchain durchführen, die als "Benachrichtigungstransaktion" bekannt ist (ich werde später mehr Details dazu geben).

Die Kombination der Zahlungscodes beider Nutzer erzeugt gemeinsame Geheimnisse, die wiederum die Schaffung einer großen Anzahl einzigartiger Bitcoin-Empfangsadressen ermöglichen (genau 2^32, also etwa 4 Milliarden). Somit sind Zahlungen, die über BIP47 getätigt werden, eigentlich nicht an den Zahlungscode selbst adressiert, sondern an klassische Empfängeradressen, die aus den Zahlungscodes der beteiligten Nutzer abgeleitet werden.

Der Zahlungscode dient dann als virtuelle Kennung, die aus dem Seed der Brieftasche abgeleitet wird. In der hierarchischen Ableitungsstruktur des Portfolios befindet sich der Zahlungscode auf Ebene 3, d. h. auf der Ebene des Kontos.

![BTC204](assets/it/66/5.webp)

Das Ableitungsziel für BIP47 wird durch den Index `47' (`0x8000002F') identifiziert, der sich auf BIP47 bezieht. Ein Beispiel für einen Ableitungspfad für einen wiederverwendbaren Zahlungscode wäre wie folgt:

```plaintext
m/47'/0'/0'/
```

Damit Sie sich ein Bild davon machen können, wie ein Zahlungscode aussieht, hier ist meiner:

```plaintext
M8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Dieser Code kann auch in einen QR-Code kodiert werden, um eine einfache Kommunikation zu ermöglichen, genau wie eine klassische Empfangsadresse.

Was PayNym Bots angeht, so handelt es sich bei diesen Robotern, die man manchmal auf Twitter sieht, um visuelle Darstellungen von Zahlungscodes, die von Samourai Wallet erstellt wurden. Sie werden durch eine Hashing-Funktion generiert, die ihnen fast Einzigartigkeit verleiht. Sie erscheinen als eine kleine Zeichenkette, die mit "+" beginnt:

```plaintext
+throbbingpond8B1
+twilightresonance487
+billowingfire340
```

Diese Avatare können auch als Bilder dargestellt werden:

![BTC204](assets/fr/215.webp)

Obwohl diese Roboter im Rahmen von BIP47 keine spezifische technische Funktion haben, spielen sie eine Rolle bei der Erleichterung der Interaktion zwischen den Benutzern, indem sie eine leicht erkennbare visuelle Identität bieten.

---
*In den folgenden Abschnitten dieses Kapitels, die BIP47 gewidmet sind, werden wir seine Funktionsweise im Detail untersuchen und uns dabei insbesondere auf die verwendeten kryptografischen Methoden konzentrieren. Um diese eher technischen Erklärungen vollständig zu verstehen, ist es zunächst wichtig, die Struktur von HD-Wallets, Schlüsselableitungsprozesse und die Grundprinzipien der auf elliptischen Kurven basierenden Kryptografie zu verstehen. Wenn Sie mehr über diese Konzepte erfahren möchten, steht Ihnen ein weiterer kostenloser Kurs vom Plan ₿ Network zur Verfügung:*

https://planb.network/courses/cyp201
*Ich empfehle Ihnen dringend, ihn zu verfolgen, denn wenn Sie die technische Funktionsweise von BIP47 verstehen, werden Sie andere ähnliche Vorschläge, die wir in den kommenden Kapiteln besprechen werden, viel leichter verstehen

---
### Wiederverwendbarer Zahlungscode

Wie bereits erwähnt, befindet sich der wiederverwendbare Zahlungscode auf Ebene 3 der HD-Wallet und ist damit sowohl in seiner Position innerhalb der Wallet-Struktur als auch in seiner Rolle mit einem "xpub" vergleichbar.

Der 80-Byte-Zahlungscode ist wie folgt aufgeteilt:


- Byte `0`: Version**. Für die erste Version von BIP47 ist dieses Byte auf "0x01" gesetzt;
- Byte "1": Das Bitfeld**. Dieser Platz ist für die Aufnahme zusätzlicher Angaben bei bestimmten Verwendungen reserviert. Für die Standardverwendung mit PayNym ist dieses Byte als "0x00" definiert;
- Byte "2": Die Parität von `y`**. Dieses Byte ist `0x02` oder `0x03` und gibt an, ob die Ordinate des öffentlichen Schlüssels gerade oder ungerade ist, da ein komprimierter öffentlicher Schlüssel verwendet wird;
- Von Byte `3` bis Byte `34`: Der Wert von `x`**. Diese Bytes stellen die Abszisse des öffentlichen Schlüssels dar. Die Verkettung von `x` und der Parität von `y` bildet den vollständigen komprimierten öffentlichen Schlüssel;
- Von Byte `35` bis Byte `66`: Kettencode**. Dieser Bereich enthält den mit dem öffentlichen Schlüssel verbundenen Kettencode;
- Von Byte `67` bis Byte `79`: Füllen**. Dieser Bereich ist für eine mögliche zukünftige Entwicklung vorgesehen. In der derzeitigen Version werden hier einfach Nullen eingefügt, um die für eine "OP_RETURN"-Ausgabe erforderliche Größe von 80 Byte zu erreichen.

Hier ist die hexadezimale Darstellung meines wiederverwendbaren Zahlungscodes, der bereits im vorherigen Abschnitt vorgestellt wurde:

```plaintext
0x010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

![BTC204](assets/it/66/7.webp)

Zunächst einmal muss das Präfixbyte "P" am Anfang hinzugefügt werden, um deutlich zu machen, dass es sich um einen Zahlungscode handelt. Dieses Byte wird durch "0x47" dargestellt:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

Um die Integrität des Zahlungscodes zu gewährleisten, wird schließlich eine Prüfsummenberechnung mit `HASH256` durchgeführt, die aus einem doppelten Hashing mit der Funktion `SHA256` besteht. Die ersten vier Bytes, die sich aus diesem Hash ergeben, werden dann am Ende des Zahlungscodes aneinandergereiht:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000567080c4
```

Sobald diese Schritte abgeschlossen sind, ist der Zahlungscode fertig. Der einzige verbleibende Schritt ist die Konvertierung in Base 58, um die endgültige Version zu erhalten:

```plaintext
PM8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

Bei diesem Prozess der Erstellung des Zahlungscodes verwenden wir einen komprimierten öffentlichen Schlüssel und einen Kettencode. Beide werden durch deterministische und hierarchische Ableitung aus dem Wallet-Seed abgeleitet. Der dafür verwendete Ableitungspfad lautet:

```plaintext
m/47'/0'/0'/
```

Um den komprimierten öffentlichen Schlüssel und den zugehörigen Kettencode für den wiederverwendbaren Zahlungscode zu erzeugen, berechnen wir zunächst den privaten Hauptschlüssel aus dem Wallet-Seed. Dann leiten wir ein Tochterschlüsselpaar mit dem Index "47 + 2^31" ab (verstärkte Ableitung). Diesem Schritt folgen zwei weitere Ableitungen von Tochterschlüsselpaaren, jeweils mit dem Index "2^31" (verstärkte Ableitung).

### Der Elliptic-Curve Diffie-Hellman-Schlüsselaustausch (ECDH)

Das kryptographische Protokoll, das BIP47 zugrunde liegt, wird mit dem Akronym ECDH bezeichnet, das für _Elliptic-Curve Diffie-Hellman_ steht. Diese Methode ist eine Variante des ursprünglichen Diffie-Hellman-Schlüsselaustauschs.

Das 1976 eingeführte Diffie-Hellman-Protokoll ist ein Schlüsselvereinbarungsprotokoll, das es zwei Parteien, die jeweils über ein Schlüsselpaar (öffentlich und privat) verfügen, ermöglicht, sich auf ein gemeinsames Geheimnis zu einigen, auch wenn sie ausschließlich über einen öffentlichen, unsicheren Kanal kommunizieren.

![BTC204](assets/it/66/10.webp)

Dieses gemeinsame Geheimnis (hier der blaue Schlüssel) kann dann für andere Operationen verwendet werden. In der Regel kann dieses gemeinsame Geheimnis zur Ver- und Entschlüsselung der Kommunikation über ein unsicheres Netz verwendet werden:

![BTC204](assets/fr/220.webp)

Um diesen Austausch zu bewerkstelligen, verwendet Diffie-Hellman modulare Arithmetik, um das gemeinsame Geheimnis zu berechnen. Hier ist eine vereinfachte Erklärung, wie das funktioniert:


- Alice und Bob einigen sich auf eine gemeinsame Farbe, hier gelb, die öffentliche Daten darstellt (Angreifer kennen diese Farbe);
- Alice wählt eine geheime Farbe, hier Rot, und mischt die beiden Farben, um Orange zu erhalten;
- Bob wählt auch eine geheime Farbe, hier Blau, und mischt sie mit Gelb, um Grün zu erhalten;
- Dann tauschen sie die erhaltenen Farben, Orange und Grün, aus. Dieser Austausch kann über ein unsicheres, beobachtetes Netz erfolgen;
- Wenn Alice Bobs Grün mit seiner geheimen Farbe mischt, erhält sie Braun;
- Bob, der dasselbe mit Alices Orange und ihrem geheimen Blau macht, erhält ebenfalls Braun.

![BTC204](assets/it/66/12.webp)

In dieser Vereinfachung steht die Farbe Braun für das zwischen Alice und Bob geteilte Geheimnis. Es ist wichtig zu verstehen, dass es in der Realität für den Angreifer unmöglich ist, die Farben Orange und Grün zu trennen, um die geheimen Farben von Alice oder Bob zu entdecken.

Nun wollen wir untersuchen, wie dieses Protokoll tatsächlich funktioniert, und zwar nicht mit Farbanalogien, sondern mit reellen Zahlen und modularer Arithmetik!

Bevor ich auf die Diffie-Hellman-Mechanismen eingehe, möchte ich Sie kurz an zwei wesentliche mathematische Konzepte erinnern, die wir benötigen:


- Eine **Primzahl** ist eine natürliche Zahl, die nur zwei Teiler hat: $1$ und sich selbst. Zum Beispiel ist $7$ eine Primzahl, weil sie nur durch $1$ und $7$ teilbar ist. Andererseits ist $8$ keine Primzahl, da sie durch $1$, $2$, $4$ und $8$ teilbar ist. Sie hat also vier positive ganzzahlige Teiler statt zwei;
- Der **mod** (bezeichnet als $mod$ oder $\%$) ist eine mathematische Operation, die zwischen zwei ganzen Zahlen den Rest der euklidischen Division der ersten durch die zweite ergibt. Zum Beispiel: $16 \bmod 5 = 1$.

**Der Diffie-Hellman-Schlüsselaustausch zwischen Alice und Bob läuft wie folgt ab:**


- Alice und Bob einigen sich auf zwei gemeinsame Zahlen: $p$ und $g$. $p$ ist eine Primzahl, und je größer diese Zahl ist, desto sicherer wird Diffie-Hellman sein. $g$ ist eine Urwurzel von $p$. Diese beiden Zahlen können offen über ein ungesichertes Netz kommuniziert werden. Sie stellen das Äquivalent der **gelben Farbe** in der obigen Vereinfachung dar. Es ist daher wichtig, dass Alice und Bob genau die gleichen Werte für $p$ und $g$ verwenden.

Sobald diese Parameter festgelegt sind, wählen Alice und Bob jeweils eine zufällige Geheimzahl. Alice nennt ihre zufällige Geheimzahl $a$ (entspricht **der Farbe Rot**) und Bob nennt seine $b$ (entspricht **der Farbe Blau**). Diese Zahlen müssen streng vertraulich bleiben.

Anstatt die Zahlen $a$ und $b$ direkt auszutauschen, berechnet jede Seite $A$ und $B$ wie folgt:

$A$ ist gleich $g$ erhöht mit der Potenz von $a$ modulo $p$:

$$
A = g^a \bmod p
$$

$B$ ist gleich $g$ erhöht mit der Potenz $b$ modulo $p$:

$$
B = g^b \bmod p
$$

Die Werte $A$ (entspricht **der Farbe Orange**) und $B$ (entspricht **der Farbe Grün**) werden zwischen den beiden Parteien ausgetauscht. Dieser Austausch kann offen über ein ungesichertes Netz erfolgen;

Alice, die $B$ erhalten hat, berechnet den Wert von $z$ wie folgt:

$z$ ist gleich $B$ erhöht mit der Potenz von $a$ modulo $p$:

$$
z = B^a \bmod p
$$

Rückruf:

$$
B = g^b \bmod p
$$

Wir erhalten also:

$$
z = B^a \bmod p
$$

$$
z = (g^b)^a \bmod p
$$

Anwendung der Regeln für Exponenten:

$$
(x^n)^m = x^{nm}
$$

Wir erhalten also:

$$
z = g^{ba} \bmod p
$$


- Bob, der $A$ erhalten hat, berechnet seinerseits den Wert von $z$ auf folgende Weise:

$z$ ist gleich $A$ erhöht mit der Potenz von $b$ modulo $p$:

$$
z = A^b \bmod p
$$

Wir erhalten also:

$$
z = (g^a)^b \bmod p
$$

$$
z = g^{ab} \bmod p
$$

$$
z = g^{ba} \bmod p
$$

Aufgrund der Distributivität des Modulo-Operators erhalten Alice und Bob genau denselben Wert $z$. Diese Zahl stellt ihr gemeinsames Geheimnis dar, das der **Farbe Braun** in der vorherigen Vereinfachung mit Farbtöpfen entspricht. Sie können nun dieses gemeinsame Geheimnis verwenden, um ihre Kommunikation über ein ungesichertes Netz symmetrisch zu verschlüsseln.

Selbst wenn ein Angreifer im Besitz von $p$, $g$, $A$ und $B$ (den öffentlichen Werten) ist, kann er nicht $a$, $b$ oder $z$ (die privaten Werte) berechnen. Dazu müsste man die Potenzierung umkehren, eine unmögliche Aufgabe, ohne alle Möglichkeiten einzeln auszuprobieren, denn das ist gleichbedeutend mit der Berechnung des diskreten Logarithmus, d. h. der Umkehrung der Exponentialfunktion in einer endlichen zyklischen Gruppe.

Solange die Werte von $a$, $b$ und $p$ ausreichend groß sind, ist das Diffie-Hellman-Protokoll also sicher. Bei 2048-Bit-Parametern (eine Zahl mit 600 Dezimalstellen) wäre es in der Regel unpraktisch, alle Möglichkeiten für $a$ und $b$ zu testen. Bislang gilt dieser Algorithmus bei solchen Zahlen als sicher.

Genau hier liegt der größte Nachteil des Diffie-Hellman-Protokolls. Um sicher zu sein, muss der Algorithmus große Zahlen verwenden. Deshalb bevorzugt man heute den ECDH-Algorithmus (_Elliptic Curve Diffie-Hellman_), eine Variante von Diffie-Hellman, die auf einer algebraischen Kurve, genauer gesagt einer elliptischen Kurve, basiert. Dieser Ansatz ermöglicht es, bei gleicher Sicherheit mit viel kleineren Zahlen zu arbeiten und so die für die Berechnung und Speicherung erforderlichen Ressourcen zu reduzieren.

Das allgemeine Prinzip des Algorithmus bleibt das gleiche. Anstelle einer Zufallszahl $a$ und einer aus $a$ durch modulare Potenzierung berechneten Zahl $A$ verwenden wir jedoch ein auf einer elliptischen Kurve festgelegtes Schlüsselpaar. Anstatt sich auf die Distributivität des Modulo-Operators zu verlassen, verwenden wir das Gruppengesetz auf elliptischen Kurven, und zwar die Assoziativität dieses Gesetzes.

Um das Prinzip der Kryptographie mit elliptischen Kurven kurz zu erklären: Ein privater Schlüssel wird durch eine Zufallszahl zwischen $1$ und $n-1$ dargestellt, wobei $n$ die Ordnung der Kurve darstellt. Der öffentliche Schlüssel hingegen ist ein bestimmter Punkt auf dieser Kurve, der aus dem privaten Schlüssel durch Addition und Verdopplung von Punkten ausgehend vom Erzeugungspunkt gemäß der Gleichung gewonnen wird:

$$
K = k \cdot G
$$

In dieser Formel bezeichnet $K$ den öffentlichen Schlüssel, $k$ den privaten Schlüssel und $G$ den Erzeugungspunkt.

Eines der wesentlichen Merkmale dieser Schlüssel ist, dass $K$ leicht aus $k$ und $G$ berechnet werden kann, während es praktisch unmöglich ist, $k$ aus $K$ und $G$ zu ermitteln. Diese Asymmetrie schafft eine Einwegfunktion. Mit anderen Worten: Es ist einfach, den öffentlichen Schlüssel zu berechnen, wenn man den privaten Schlüssel kennt, aber es ist unmöglich, den privaten Schlüssel anhand des öffentlichen Schlüssels zu ermitteln. Diese Sicherheit beruht immer noch auf der Schwierigkeit der Berechnung des diskreten Logarithmus.

Wir werden diese Eigenschaft nutzen, um unseren Diffie-Hellman-Algorithmus anzupassen. **Das Funktionsprinzip von ECDH ist wie folgt:**


- Alice und Bob einigen sich gemeinsam auf eine kryptographisch sichere elliptische Kurve und deren Parameter. Diese Informationen sind öffentlich;
- Alice erzeugt eine Zufallszahl $ka$, die ihr privater Schlüssel sein wird. Dieser private Schlüssel muss geheim bleiben. Sie bestimmt ihren öffentlichen Schlüssel $Ka$ durch Addition und Verdopplung von Punkten auf der gewählten elliptischen Kurve:

$$
K_a = k_a \cdot G
$$


- Bob erzeugt außerdem eine Zufallszahl $kb$, die sein privater Schlüssel sein wird. Er errechnet den zugehörigen öffentlichen Schlüssel $kb$:

$$
K_b = k_b \cdot G
$$


- Alice und Bob tauschen ihre öffentlichen Schlüssel $Ka$ und $Kb$ in einem ungesicherten öffentlichen Netz aus.
- Alice berechnet einen Punkt $(x,y)$ auf der Kurve, indem sie ihren privaten Schlüssel $ka$ auf Bobs öffentlichen Schlüssel $Kb$ anwendet:

$$
(x,y) = k_a \cdot K_b
$$


- Bob berechnet einen Punkt $(x,y)$ auf der Kurve, indem er seinen privaten Schlüssel $kb$ auf Alices öffentlichen Schlüssel $Ka$ anwendet:

$$
(x,y) = k_b \cdot K_a
$$


- Alice und Bob erhalten denselben Punkt auf der elliptischen Kurve. Das gemeinsame Geheimnis wird die $x$-Koordinate dieses Punktes sein.

Sie erhalten nämlich das gleiche gemeinsame Geheimnis:

(x,y) = k_a \cdot K_b = k_a \cdot (k_b \cdot G) = (k_a \cdot k_b) \cdot G = (k_b \cdot k_a) \cdot G = k_b \cdot (k_a \cdot G) = k_b \cdot K_a

$$
Un attaccante che osserva la rete pubblica non protetta può ottenere solo le chiavi pubbliche di ciascuna parte e i parametri della curva ellittica scelta. Come precedentemente spiegato, queste informazioni da sole non sono sufficienti per determinare le chiavi private. Pertanto, l'attaccante non può trovare il segreto condiviso tra Alice e Bob.
ECDH è quindi un algoritmo che consente lo scambio di chiavi. È spesso utilizzato in combinazione con altri metodi crittografici per stabilire un protocollo completo. Ad esempio, ECDH è integrato nel nucleo di TLS (_Transport Layer Security_), un protocollo di crittografia e autenticazione utilizzato per il livello di trasporto di Internet. TLS utilizza ECDHE per lo scambio di chiavi, una variante di ECDH dove le chiavi sono effimere, per garantire la confidenzialità persistente. Inoltre, TLS utilizza algoritmi di autenticazione come ECDSA, algoritmi di crittografia come AES e funzioni hash come SHA256.
TLS è notevolmente responsabile della `s` in `https` così come del lucchetto visibile nella barra degli indirizzi del tuo browser, simboli delle comunicazioni criptate. Seguendo questo corso, stai quindi utilizzando ECDH, ed è molto probabile che lo usi quotidianamente senza nemmeno saperlo.
### La Transazione di Notifica
Come abbiamo visto nella sezione precedente, ECDH è una variante dello scambio Diffie-Hellman che utilizza coppie di chiavi stabilite su una curva ellittica. Convenientemente, possediamo già molte coppie di chiavi aderenti a questo standard nei nostri portafogli Bitcoin! L'idea di BIP47 è di utilizzare le coppie di chiavi dei portafogli Bitcoin gerarchici deterministici di entrambe le parti per stabilire segreti condivisi ed effimeri tra di loro. Nel contesto di BIP47, viene utilizzato ECDHE (_Elliptic Curve Diffie-Hellman Ephemeral_).
ECDHE viene utilizzato per la prima volta in BIP47 per trasmettere il codice di pagamento dal mittente al destinatario. Questo è il famoso **notification transaction**. Questo passaggio è essenziale perché affinché BIP47 funzioni efficacemente, entrambe le parti coinvolte (il mittente e il destinatario) devono conoscere il codice di pagamento dell'altro. Questa conoscenza consente la derivazione di chiavi pubbliche effimere e, di conseguenza, indirizzi di ricezione vuoti associati.
Prima di questo scambio, il mittente è logicamente già a conoscenza del codice di pagamento del destinatario poiché lo ha recuperato off-chain, ad esempio, dal loro sito web, una fattura o i loro social media. Tuttavia, il destinatario potrebbe non conoscere necessariamente il codice di pagamento del mittente. Eppure, questo codice deve essere trasmesso a loro; altrimenti, non saranno in grado di derivare le chiavi effimere necessarie per identificare gli indirizzi dove sono conservati i loro bitcoin, né accedere ai loro fondi. Sebbene questa trasmissione del codice del mittente possa tecnicamente essere effettuata off-chain attraverso altri mezzi di comunicazione, ciò pone un problema se il portafoglio deve essere recuperato solo dal seme.
Infatti, a differenza degli indirizzi convenzionali, gli indirizzi BIP47 non sono derivati direttamente dal seed del destinatario—utilizzare un `xpub` sarebbe più semplice in questo caso—ma risultano da un calcolo che combina i codici di pagamento di entrambi: quello del mittente e quello del destinatario. Pertanto, se il destinatario perde il proprio portafoglio e tenta di ripristinarlo dal proprio seed, recupererà il proprio codice di pagamento, che è derivato direttamente dal loro seed. Tuttavia, per trovare gli indirizzi effimeri, sarà essenziale per loro avere anche i codici di pagamento di tutti coloro che hanno inviato loro bitcoin tramite BIP47. Da qui l'importanza della transazione di notifica, che consente di salvare queste informazioni sulla blockchain di Bitcoin, pur essendo in grado di trovarle molto facilmente senza dover cercare tra il miliardo di transazioni eseguite dal suo lancio nel 2009.
![BTC204](assets/it/66/15.webp)
Pertanto, sarebbe possibile implementare BIP47 senza ricorrere alla transazione di notifica, a condizione che ogni utente conservi un backup dei codici di pagamento dei propri pari. Tuttavia, questo metodo si rivela complesso da gestire finché non viene sviluppata una soluzione semplice, robusta ed efficiente per creare, conservare e aggiornare questi backup. Nello stato attuale delle cose, la transazione di notifica diventa quasi indispensabile.
Nei capitoli seguenti, studieremo altri protocolli con obiettivi simili a quelli di BIP47, ma che non richiedono una transazione di notifica. Queste alternative, tuttavia, introducono i propri compromessi.
Oltre al suo ruolo nel backup dei codici di pagamento, la transazione di notifica serve anche una funzione di notifica per il destinatario, come suggerisce il suo nome. Segnala al client del destinatario che è stato stabilito un nuovo canale di pagamento e suggerisce quindi di monitorare gli indirizzi effimeri risultanti.
### Il Modello di Privacy di BIP47
Prima di dettagliare il funzionamento tecnico della transazione di notifica, è importante discutere il modello di privacy associato a BIP47, che giustifica alcune misure prese durante la creazione di questa transazione iniziale.
Il codice di pagamento, di per sé, non rappresenta un rischio diretto per la privacy. A differenza del modello Bitcoin tradizionale, che mira a rompere il collegamento tra l'identità di un utente e le sue transazioni (che sono pubbliche) preservando l'anonimato di chiavi e indirizzi, il codice di pagamento può essere apertamente associato a un'identità senza rappresentare una minaccia.
Infatti, il codice di pagamento non è utilizzato per derivare direttamente gli indirizzi che ricevono pagamenti BIP47. Questi indirizzi sono invece generati attraverso l'applicazione di ECDH tra le chiavi derivate dai codici di pagamento delle due parti coinvolte.
Così, un codice di pagamento di per sé non porta direttamente a una perdita di privacy, poiché solo l'indirizzo di notifica è derivato da esso. Sebbene questo indirizzo possa rivelare alcune informazioni, normalmente non consente di scoprire le parti con cui si stanno conducendo transazioni, a meno che non si effettui un'analisi approfondita della catena. Infatti, se il mittente utilizza UTXO che possono essere collegati alla loro identità per eseguire la transazione di notifica, allora diventa possibile dedurre che la loro identità è probabilmente collegata ai pagamenti BIP47 al tuo codice di pagamento. Questo non rivelerà le transazioni sottostanti, ma indicherà la loro probabile esistenza.
Pertanto, è essenziale mantenere questa stretta separazione tra i codici di pagamento degli utenti. Verso questo obiettivo, il passo iniziale di comunicazione del codice è un momento critico per la privacy del pagamento, ma obbligatorio per il corretto funzionamento del protocollo. Se uno dei codici di pagamento può essere ottenuto pubblicamente (come su un sito web), il secondo codice, quello del mittente, non deve essere collegato al primo in nessun caso.
Prendiamo un esempio concreto: voglio fare una donazione a un movimento politico tramite BIP47:
- L'organizzazione ha reso pubblico il suo codice di pagamento sul suo sito web o tramite i suoi social network;
- Questo codice è quindi collegato al movimento politico;
- Recupero questo codice di pagamento;
- Prima di procedere con un invio, devo assicurarmi che conoscano il mio codice di pagamento, che è anche collegato alla mia identità poiché lo uso per ricevere transazioni sui miei social network.
Come trasmettere il mio codice senza rischi? L'uso di mezzi di comunicazione convenzionali potrebbe portare a una fuga di informazioni e, di conseguenza, associarmi a questo movimento politico. La transazione di notifica offre una soluzione grazie a uno strato di crittografia che impedisce precisamente questa associazione tra due codici. Sebbene questo non sia l'unico metodo per trasmettere segretamente il codice di pagamento del mittente, si dimostra molto efficace.
Nel diagramma sottostante, le linee arancioni indicano i punti in cui il flusso di informazioni deve essere interrotto, e le frecce nere mostrano le connessioni che potrebbero potenzialmente essere osservate da terze parti:
![BTC204](assets/it/66/16.webp)
In realtà, all'interno del modello tradizionale di privacy di Bitcoin, è spesso complesso dissociare completamente il flusso di informazioni tra la coppia di chiavi e l'utente, specialmente durante le transazioni a distanza. Ad esempio, nel contesto di una campagna di donazione, il destinatario deve inevitabilmente divulgare un indirizzo o una chiave pubblica tramite il loro sito web o social network. L'uso corretto di BIP47, in particolare con la transazione di notifica, permette di aggirare questo problema grazie a ECDHE e allo strato di crittografia che studieremo ulteriormente.
Ovviamente, il modello classico di privacy di Bitcoin si applica ancora alle chiavi pubbliche effimere, che sono derivate dalla combinazione dei due codici di pagamento. I due modelli sono in realtà complementari. Quello che voglio evidenziare qui è che, contrariamente all'uso abituale di una chiave pubblica per ricevere bitcoin, il codice di pagamento può essere collegato a una specifica identità, perché l'informazione "_Alice effettua una transazione con Bob_" viene interrotta in un'altra fase. Il codice di pagamento viene utilizzato per generare indirizzi di pagamento, ma basandosi unicamente sull'osservazione della blockchain, è impossibile collegare una transazione di pagamento BIP47 ai codici di pagamento utilizzati per eseguirla, a meno che gli UTXO coinvolti non fossero già collegati a un'identità precedentemente e gli utenti non abbiano associato i loro codici di pagamento alle rispettive identità.
Per riassumere, il modello di privacy offerto dai pagamenti BIP47 potrebbe essere considerato superiore a quello della base di Bitcoin, anche se non è magico in alcun modo.
### Costruzione della Transazione di Notifica
Ora, vediamo come funziona questa transazione di notifica. Immaginiamo che Alice voglia inviare fondi a Bob con BIP47. Nel mio esempio, Alice agisce come mittente e Bob come destinatario. Quest'ultimo ha pubblicato il suo codice di pagamento sul suo sito web. Pertanto, Alice è già a conoscenza del codice di pagamento di Bob.
**1- Alice calcola un segreto condiviso con ECDH:**
- Seleziona una coppia di chiavi dal suo portafoglio HD situato su un ramo diverso dal suo codice di pagamento. Nota, questa coppia non dovrebbe essere facilmente associata all'indirizzo di notifica di Alice, né all'identità di Alice (vedi sezione precedente);
- Alice seleziona la chiave privata da questa coppia. La chiamiamo $a$ (minuscolo);
$$

a

$$
```text
- Alice recupera la chiave pubblica associata all'indirizzo di notifica di Bob. Questa chiave è la prima figlia derivata dal codice di pagamento di Bob (indice $/0$). Chiamiamo questa chiave pubblica $B$ (maiuscolo). La chiave privata associata a questa chiave pubblica è chiamata $b$ (minuscolo). $B$ è determinata dall'addizione e dal raddoppio dei punti sulla curva ellittica da $G$ (il punto generatore) con $b$ (la chiave privata):
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ (maiuscolo) sulla curva ellittica tramite l'addizione e il raddoppio dei punti applicando la sua chiave privata $a$ dalla chiave pubblica di Bob $B$.
$$ S = a \cdot B $$
- Alice calcola il fattore di oscuramento $f$ che le permetterà di criptare il suo codice di pagamento. Per fare ciò, determinerà un numero pseudo-casuale con la funzione HMAC-SHA512. Nel secondo input di questa funzione, utilizza un valore che solo Bob potrà recuperare: $x$ che è l'ascissa del punto segreto precedentemente calcolato. Il primo input è $o$ che è l'UTXO consumato in input di questa transazione (outpoint).
$$ f = \text{HMAC-SHA512}(o, x) $$
**2- Alice converte il suo codice di pagamento personale in base 2 (binario).**
**3- Utilizza questo fattore di oscuramento come chiave per eseguire la crittografia simmetrica sul payload del suo codice di pagamento.** L'algoritmo di crittografia utilizzato è semplicemente un `XOR`. L'operazione eseguita è paragonabile alla cifratura di Vernam, anche denominata "One-Time Pad".
- Alice prima divide il suo fattore di oscuramento in due: i primi 32 byte sono denominati $f1$ e gli ultimi 32 byte sono denominati $f2$. Quindi, abbiamo:
$$ f = f1 || f2 $$
- Alice calcola l'$x'$ criptato dell'ascissa della chiave pubblica $x$ del suo codice di pagamento, e il $c'$ criptato del suo codice catena $c$ separatamente. $f1$ e $f2$ agiscono rispettivamente come chiavi di crittografia. L'operazione utilizzata è il `XOR` (o esclusivo).
$$ x' = x \oplus f1 $$
$$ c' = c \oplus f2 $$
- Alice sostituisce i valori reali dell'ascissa della chiave pubblica $x$ e del codice catena $c$ nel suo codice di pagamento con i valori criptati $x'$ e $c'$.
**4-** Alice ora ha il suo codice di pagamento con un payload criptato. Costruirà e trasmetterà una transazione che coinvolge la sua chiave pubblica $A$ come input, un output all'indirizzo di notifica di Bob, e un output `OP_RETURN` contenente il suo codice di pagamento con il payload criptato. **Questa transazione è la transazione di notifica**.
Un `OP_RETURN` è un opcode che segna un output di una transazione Bitcoin come non valido. Oggi, è utilizzato per trasmettere o ancorare informazioni sulla blockchain di Bitcoin. Fino a 80 byte di dati possono essere memorizzati, che sono scritti sulla catena e quindi visibili a tutti gli altri utenti.
Come abbiamo visto nelle sezioni precedenti, ECDH è utilizzato per generare un segreto condiviso tra due utenti che comunicano su una rete non sicura, potenzialmente osservata da attaccanti. In BIP47, ECDH è utilizzato per la comunicazione sulla rete Bitcoin, che per sua natura è una rete di comunicazione trasparente osservata da molti attaccanti. Il segreto condiviso calcolato tramite lo scambio di chiavi ECDH è poi utilizzato per criptare le informazioni segrete da trasmettere: il codice di pagamento del mittente (di Alice).
Ricapitoliamo i passaggi che abbiamo appena esaminato insieme per eseguire una transazione di notifica:
- Alice recupera il codice di pagamento e l'indirizzo di notifica di Bob;
- Alice seleziona un UTXO che possiede nel suo portafoglio HD con la corrispondente coppia di chiavi;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH;
- Utilizza questo punto segreto per calcolare un HMAC, che è il fattore di oscuramento;
- Utilizza questo fattore di oscuramento per criptare il payload del suo codice di pagamento personale.
- Lei utilizza un output di transazione `OP_RETURN` per comunicare il codice di pagamento mascherato a Bob.
![BTC204](assets/it/66/17.webp)
### Transazione di Notifica: Studio Concreto
Per comprendere meglio il suo funzionamento, in particolare l'uso di `OP_RETURN`, esaminiamo insieme una vera transazione di notifica. Ho eseguito tale transazione sulla testnet, che potete trovare [cliccando qui](https://mempool.space/fr/testnet/tx/0e2e4695a3c49272ef631426a9fd2dae6ec3a469e3a39a3db51aa476cd09de2e).
![BTC204](assets/fr/227.webp)
Osservando questa transazione, possiamo vedere che ha un singolo input e 4 output:
- Il primo output è l'`OP_RETURN` che contiene il mio codice di pagamento mascherato;
- Il secondo output di 546 sats punta all'indirizzo di notifica del mio destinatario;
- Il terzo output di 15.000 sats rappresenta le commissioni di servizio, poiché ho utilizzato Samourai Wallet per costruire questa transazione;
- Il quarto output di 2 milioni di sats rappresenta il resto, ovvero la differenza rimanente dal mio input che ritorna a un altro indirizzo che mi appartiene.
Il più interessante da studiare è ovviamente l'output 0 che utilizza l'`OP_RETURN`. Vediamo più da vicino cosa contiene. Ecco lo `scriptPubKey` in esadecimale:
6a4c50010002b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d800000000000000000000000000
```

```text
In questo script, possiamo sezionare diverse parti. Prima di tutto, gli opcode:
6a4c
```

```text
Tra gli opcode, possiamo riconoscere `0x6a` che designa l'`OP_RETURN` e `0x4c` che designa l'`OP_PUSHDATA1`.
Il byte seguente questo ultimo opcode indica la dimensione del payload che segue. Indica `0x50`, ovvero 80 byte:
6a4c50
```

```text
Poi, abbiamo i metadati del mio codice di pagamento in chiaro:
010002
```

```text
La coordinata x criptata della chiave pubblica del mio codice di pagamento:
b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164
```

```text
Il codice catena criptato del mio codice di pagamento:
927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d8
```

```text
E infine, il padding per raggiungere 80 byte, la dimensione standard di un `OP_RETURN`:
00000000000000000000000000
```

```
Per capire meglio, ecco il mio codice di pagamento in chiaro in base 58:
````text
PM8TJQCyt6ovbozreUCBrfKqmSVmTzJ5vjqse58LnBzKFFZTwny3KfCDdwTqAEYVasn11tTMPc2FJsFygFd3YzsHvwNXLEQNADgxeGnMK8Ugmin62TZU
Quando si confronta il mio codice di pagamento in chiaro con l'`OP_RETURN`, è evidente che l'HRP (`0x47`) e il checksum (`0x8604e4db`) non vengono trasmessi. Questo è previsto, poiché queste informazioni sono destinate agli esseri umani.
Successivamente, possiamo identificare la versione (`0x01`), il campo di bit (`0x00`) e la parità della chiave pubblica (`0x02`). E, alla fine del codice di pagamento, i byte vuoti (`0x00000000000000000000000000`) sono utilizzati per riempire il codice fino a un totale di 80 byte. Tutti questi metadati vengono trasmessi in chiaro (non criptati).
Infine, si può osservare che la coordinata x della chiave pubblica (`0x77507c9c17a89cfca2d3af554745d6c2db0e7f6b2721a3941a504933103cc42a`) e il codice catena (`0xdd94881210d6e752a9abc8a9fa0070e85184993c4f643f1121dd807dd556d1dc`) sono stati criptati. Questo costituisce il payload del codice di pagamento.
### Cos'è XOR?
Nelle sezioni precedenti, abbiamo visto che il codice di pagamento è stato trasmesso criptato utilizzando l'operazione XOR. Prendiamoci un momento per capire come funziona questo operatore, poiché è ampiamente utilizzato nella crittografia.
XOR è un operatore logico bit a bit basato sull'algebra booleana. Con due operandi bit, restituisce `1` se i bit dello stesso rango sono diversi, e restituisce `0` se i bit dello stesso rango sono uguali. Ecco la tabella di verità di XOR basata sui valori degli operandi `D` e `E`:
| D   | E   | D XOR E |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |
Per esempio:
$$

$$
0110 \oplus 1110 = 1000
Oppure:
$$

$$
010011 \oplus 110110 = 100101
Con ECDH, l'uso di XOR come strato di crittografia è particolarmente adatto. Innanzitutto, a causa di questo operatore, la crittografia è simmetrica. Questo consente al destinatario di decifrare il codice di pagamento con la stessa chiave utilizzata per la crittografia. La chiave di crittografia e decrittografia viene calcolata dal segreto condiviso grazie a ECDH. Questa simmetria è resa possibile dalle proprietà commutativa e associativa dell'operatore XOR:
- Altre proprietà:
$$

$$
D \oplus D = 0
D ⊕ 0 = D
- Commutatività:
$$

$$
D \oplus E = E \oplus D
- Associatività:
$$

$$
D \oplus (E \oplus Z) = (D \oplus E) \oplus Z = D \oplus E \oplus Z
Se:
$$

$$
D \oplus E = L
Allora:
$$

$$
D \oplus L = D \oplus (D \oplus E) = D \oplus D \oplus E = 0 \oplus E = E \\
\therefore D \oplus L = E
Successivamente, questo metodo di cifratura assomiglia molto al cifrario di Vernam (One-Time Pad), l'unico algoritmo di cifratura conosciuto fino ad oggi che possiede sicurezza incondizionata (o assoluta). Affinché il cifrario di Vernam abbia questa caratteristica, la chiave di cifratura deve essere perfettamente casuale, deve essere della stessa dimensione del messaggio e deve essere utilizzata una sola volta. Nel metodo di cifratura utilizzato qui per BIP47, la chiave è effettivamente della stessa dimensione del messaggio, il fattore di offuscamento è esattamente della stessa dimensione della concatenazione della coordinata x della chiave pubblica con il codice catena del codice di pagamento. Questa chiave di cifratura è effettivamente utilizzata una sola volta. Tuttavia, questa chiave non è il risultato di una casualità perfetta poiché è un HMAC. È piuttosto pseudo-casuale. Pertanto, non si tratta di un cifrario di Vernam, ma il metodo è simile.
### Ricezione della Transazione di Notifica
Ora che Alice ha inviato la transazione di notifica a Bob, vediamo come lui la interpreta. Come promemoria, Bob deve essere in grado di accedere al codice di pagamento di Alice. Senza queste informazioni, come vedremo nella sezione seguente, non sarà in grado di derivare le coppie di chiavi create da Alice e, quindi, non sarà in grado di accedere ai suoi bitcoin ricevuti tramite BIP47. Per ora, il payload del codice di pagamento di Alice è criptato. Vediamo come Bob lo decifra.
**1-** Bob monitora le transazioni che creano output con il suo indirizzo di notifica.
**2-** Quando una transazione ha un output sul suo indirizzo di notifica, Bob la analizza per vedere se contiene un output OP_RETURN che segue lo standard BIP47.
**3-** Se il primo byte del payload OP_RETURN è `0x01`, Bob inizia la sua ricerca di un possibile segreto condiviso con ECDH:
- Bob seleziona la chiave pubblica nell'input della transazione. Ovvero, la chiave pubblica di Alice denominata $A$ con:
$$ A = a \cdot G $$
- Bob seleziona la chiave privata $b$ associata al suo indirizzo di notifica personale:
$$ b $$
- Bob calcola il punto segreto $S$ (segreto condiviso ECDH) sulla curva ellittica sommando e raddoppiando i punti, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$:
$$ S = b \cdot A $$
- Bob determina il fattore di offuscamento $f$ che gli permetterà di decifrare il payload del codice di pagamento di Alice. Nello stesso modo in cui Alice aveva precedentemente calcolato, Bob troverà $f$ applicando HMAC-SHA512 su $x$ la coordinata x del punto segreto $S$, e su $o$ l'UTXO consumato come input in questa transazione di notifica:
$$ f = \text{HMAC-SHA512}(o, x) $$
**4-** Bob interpreta i dati nell'OP_RETURN della transazione di notifica come un codice di pagamento. Egli semplicemente decifra il payload di questo potenziale codice di pagamento usando il fattore di offuscamento $f$:
- Bob divide il fattore di offuscamento $f$ in 2 parti: i primi 32 byte di $f$ saranno $f1$ e gli ultimi 32 byte saranno $f2$;
- Bob decifra la coordinata x cifrata $x'$ della chiave pubblica dal codice di pagamento di Alice:
$$ x = x' \oplus f1 $$
- Bob decifra il valore del codice catena cifrato $c'$ dal codice di pagamento di Alice:
$$ c = c' \oplus f2 $$
**5-** Bob verifica se il valore della chiave pubblica dal codice di pagamento di Alice è effettivamente parte del gruppo secp256k1. Se è così, lo interpreta come un codice di pagamento valido. Altrimenti, ignora questa transazione.
Ora che Bob è a conoscenza del codice di pagamento di Alice, lei può inviargli fino a `2^32` pagamenti, senza mai dover effettuare un'altra transazione di notifica di questo tipo.
Perché funziona? Come fa Bob a determinare lo stesso fattore di offuscamento di Alice, e quindi a decifrare il suo codice di pagamento? Esaminiamo più da vicino il ruolo di ECDH in quello che abbiamo appena descritto.
Prima di tutto, stiamo trattando con la crittografia simmetrica. Questo significa che la chiave di cifratura e la chiave di decifratura sono lo stesso valore. Questa chiave nella transazione di notifica è il fattore di offuscamento:
$$ f = f1 || f2 $$
Pertanto, Alice e Bob devono ottenere lo stesso valore per $f$, senza trasmetterlo direttamente poiché un attaccante potrebbe rubarlo e decifrare le informazioni segrete. Questo fattore di offuscamento si ottiene applicando HMAC-SHA512 su 2 valori:
- la coordinata x di un punto segreto;
- e l'UTXO consumato come input nella transazione.
Bob, quindi, ha bisogno di queste due informazioni per decifrare il payload del codice di pagamento di Alice. Per l'UTXO come input, Bob può semplicemente recuperarlo osservando la transazione di notifica. Per il punto segreto, Bob dovrà usare ECDH. Come visto nella sezione precedente su Diffie-Hellman, semplicemente scambiando le rispettive chiavi pubbliche e applicando segretamente le proprie chiavi private alla chiave pubblica dell'altro, Alice e Bob possono trovare un punto specifico e segreto sulla curva ellittica. La transazione di notifica si basa su questo meccanismo:
- Coppia di chiavi di Bob:
$$ B = b \cdot G $$
- Coppia di chiavi di Alice:
$$ A = a \cdot G $$
- Per un segreto $S (x, y)$:
$$ S = a \cdot B = a \cdot (b \cdot G) = (b \cdot a) \cdot G = b \cdot A $$
Ora che Bob conosce il codice di pagamento di Alice, sarà in grado di rilevare i suoi pagamenti BIP47, e può derivare le chiavi private che bloccano i bitcoin ricevuti.
Ricapitoliamo i passaggi che abbiamo appena esaminato per ricevere e interpretare una transazione di notifica:
- Bob monitora gli output delle transazioni al suo indirizzo di notifica;
- Quando ne rileva uno, recupera le informazioni contenute nell'OP_RETURN;
- Bob seleziona la chiave pubblica in input e calcola un punto segreto usando ECDH;
- Usa questo punto segreto per calcolare un HMAC che è il fattore di offuscamento;
- Usa questo fattore di offuscamento per decifrare il payload del codice di pagamento di Alice contenuto nell'OP_RETURN.
### La Transazione di Pagamento BIP47
Studiamo ora insieme il processo di pagamento con BIP47. Per ricordarvi lo stato attuale delle cose:
- Alice conosce il codice di pagamento di Bob, che ha semplicemente recuperato dal suo sito web;
- Bob conosce il codice di pagamento di Alice grazie alla transazione di notifica;
- Alice effettuerà un primo pagamento a Bob. Potrà effettuarne molti altri allo stesso modo.
Prima di spiegare questo processo, penso sia importante ricordare gli indici su cui stiamo attualmente lavorando. Il percorso di derivazione di un codice di pagamento è descritto come segue: `m/47'/0'/0'`. La profondità successiva distribuisce gli indici in questo modo:
- La prima coppia di chiavi figlio normali (non rinforzate) è quella utilizzata per generare l'indirizzo di notifica di cui abbiamo parlato nella parte precedente: `m/47'/0'/0'/0`;
- Le coppie di chiavi figlio normali sono utilizzate all'interno di ECDH per generare indirizzi di ricezione dei pagamenti BIP47 come vedremo in questa sezione: da `m/47'/0'/0'/0` a `m/47'/0'/0'/2 147 483 647`;
- Le coppie di chiavi figlio rinforzate sono codici di pagamento effimeri: da `m/47'/0'/0'/0'` a `m/47'/0'/0'/2 147 483 647'`.
Ogni volta che Alice desidera inviare un pagamento a Bob, deriva un nuovo indirizzo vergine unico, grazie ancora al protocollo ECDH:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale riutilizzabile:
$$ a $$
- Alice seleziona la prima chiave pubblica inutilizzata derivata dal codice di pagamento di Bob. Questa chiave pubblica, la chiameremo $B$. È associata alla chiave privata $b$ che solo Bob conosce:
$$ B = b \cdot G $$
- Alice calcola un punto segreto $S$ sulla curva ellittica tramite addizione e raddoppio di punti applicando la sua chiave privata $a$ alla chiave pubblica $B$ di Bob:
$$ S = a \cdot B $$
- Da questo punto segreto, Alice calcolerà il segreto condiviso $s$ (minuscolo). Per fare ciò, seleziona la coordinata x del punto segreto $S$ denominata $Sx$, e passa questo valore attraverso la funzione hash SHA256:
$$ S = (Sx, Sy) $$
$$ s = \text{SHA256}(Sx) $$
- Alice utilizza questo segreto condiviso $s$ per calcolare un indirizzo Bitcoin di ricezione dei pagamenti. Inizialmente, verifica che $s$ sia contenuto nell'ordine della curva secp256k1. In caso contrario, incrementa l'indice della chiave pubblica di Bob per derivare un altro segreto condiviso;
- In secondo luogo, calcola una chiave pubblica $K0$ aggiungendo sulla curva ellittica i punti $B$ e $s·G$. In altre parole, Alice aggiunge la chiave pubblica derivata dal codice di pagamento di Bob $B$ con un altro punto calcolato sulla curva ellittica tramite addizione e raddoppio con il segreto condiviso $s$ dal punto generatore della curva secp256k1 $G$. Questo nuovo punto rappresenta una chiave pubblica, e lo chiamiamo $K0$:
$$ K0 = B + s \cdot G $$
- Con questa chiave pubblica $K0$, Alice può derivare un indirizzo vergine standard di ricezione (per esempio, SegWit V0 in bech32).
Una volta che Alice ha ottenuto l'indirizzo di ricezione di Bob $K0$, può eseguire una transazione Bitcoin in modo standard. Per fare ciò, seleziona un UTXO di sua proprietà, assicurato da una coppia di chiavi di un ramo diverso del suo portafoglio HD, e lo spende per soddisfare un output all'indirizzo di Bob $K0$. È importante notare che questo pagamento, una volta derivato l'indirizzo, segue un processo convenzionale e non dipende più dalle chiavi associate a BIP47.
Ricapitoliamo i passaggi che abbiamo appena eseguito insieme per inviare un pagamento BIP47:
- Alice seleziona la prima chiave privata derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica utilizzando ECDH dalla prima chiave pubblica derivata non utilizzata dal codice di pagamento di Bob;
- Utilizza questo punto segreto per calcolare un segreto condiviso con SHA256;
- Utilizza questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla chiave pubblica di Bob;
- Ottiene una nuova chiave pubblica effimera per la quale solo Bob ha la chiave privata associata;
- Alice può effettuare una transazione standard a Bob con l'indirizzo di ricezione effimero derivato.
![BTC204](assets/it/66/21.webp)
Se Alice desidera effettuare un secondo pagamento, seguirà gli stessi passaggi di prima, eccetto che questa volta selezionerà la seconda chiave pubblica derivata dal codice di pagamento di Bob. Specificamente, utilizzerà la prossima chiave non utilizzata. Otterrà così un nuovo indirizzo di ricezione appartenente a Bob, designato $K1$:
![BTC204](assets/it/66/22.webp)
Può continuare in questo modo e derivare fino a `2^32` indirizzi non utilizzati appartenenti a Bob.
Da un punto di vista esterno, osservando la blockchain, è teoricamente impossibile differenziare un pagamento BIP47 da un pagamento standard. Ecco un esempio di transazione di pagamento BIP47 sul Testnet:
```

94b2e59510f2e1fa78411634c98a77bbb638e28fb2da00c9f359cd5fc8f87254
````
Questo sembra una transazione standard con un input consumato, un output di pagamento e un resto:
![BTC204](assets/fr/232.webp)
### Ricevere il Pagamento BIP47 e Derivare la Chiave Privata
Alice ha appena effettuato il suo primo pagamento a un nuovo indirizzo BIP47 appartenente a Bob. Ora vediamo come Bob riceve questo pagamento. Vedremo anche perché Alice non ha accesso alla chiave privata dell'indirizzo che ha appena generato da sola, e come Bob recupera questa chiave per spendere i bitcoin che ha appena ricevuto.
Non appena Bob riceve la transazione di notifica da Alice, deriva la chiave pubblica BIP47 $K0$ anche prima che lei abbia inviato qualsiasi pagamento. Poi monitora qualsiasi pagamento all'indirizzo associato. Infatti, deriva immediatamente diversi indirizzi che monitorerà ($K0$, $K1$, $K2$, $K3$...). Ecco come deriva questa chiave pubblica $K0$:
- Bob seleziona la prima chiave privata derivata dal suo codice di pagamento. Questa chiave privata è denominata $b$. È associata alla chiave pubblica $B$ con cui Alice aveva fatto i suoi calcoli nel passaggio precedente:
$$ b $$
- Bob seleziona la prima chiave pubblica di Alice derivata dal suo codice di pagamento. Questa chiave è denominata $A$. È associata alla chiave privata $a$ con cui Alice aveva fatto i suoi calcoli, e di cui solo Alice è a conoscenza. Bob può eseguire questo processo poiché è a conoscenza del codice di pagamento di Alice che le è stato trasmesso con la transazione di notifica:
$$ A = a \cdot G $$
- Bob calcola il punto segreto $S$, mediante addizione e raddoppio di punti sulla curva ellittica, applicando la sua chiave privata $b$ alla chiave pubblica di Alice $A$. Qui troviamo l'uso di ECDH che garantisce che questo punto $S$ sarà lo stesso sia per Bob che per Alice:
$$ S = b \cdot A $$
- Proprio come ha fatto Alice, Bob isola la coordinata x di questo punto $S$. Abbiamo chiamato questo valore $Sx$. Egli passa questo valore attraverso la funzione SHA256 per trovare il segreto condiviso $s$ (minuscolo):
$$ s = \text{SHA256}(Sx) $$
- Proprio come Alice, Bob calcola il punto $s·G$ sulla curva ellittica. Poi, aggiunge questo punto segreto alla sua chiave pubblica $B$. Ottiene così un nuovo punto sulla curva ellittica che interpreta come una chiave pubblica $K0$:
$$ K0 = B + s \cdot G $$
Una volta che Bob ha questa chiave pubblica $K0$, può derivare la chiave privata associata per essere in grado di spendere i suoi bitcoin. È l'unico che può generare questa chiave privata:
- Bob aggiunge la sua chiave privata figlio $b$ derivata dal suo codice di pagamento personale. È l'unico che può ottenere il valore di $b$. Poi, aggiunge $b$ con il segreto condiviso $s$ per ottenere $k0$, la chiave privata di $K0$:
$$ k0 = b + s $$
Grazie alla legge di gruppo della curva ellittica, Bob ottiene esattamente la chiave privata corrispondente alla chiave pubblica usata da Alice. Abbiamo quindi:
$$ K0 = k0 \cdot G $$
Riassumerò i passaggi che abbiamo appena esaminato insieme per ricevere un pagamento BIP47 e calcolare la chiave privata corrispondente:
- Bob seleziona la prima chiave privata figlio derivata dal suo codice di pagamento personale;
- Calcola un punto segreto sulla curva ellittica usando ECDH dalla prima chiave pubblica figlio derivata dal codice catena di Alice;
- Usa questo punto segreto per calcolare un segreto condiviso con SHA256;
- Usa questo segreto condiviso per calcolare un nuovo punto segreto sulla curva ellittica;
- Aggiunge questo nuovo punto segreto alla sua chiave pubblica personale;
- Ottiene una nuova chiave pubblica effimera, alla quale Alice invierà il suo primo pagamento;
- Bob calcola la chiave privata associata a questa chiave pubblica effimera aggiungendo la sua chiave privata figlio derivata dal suo codice di pagamento e il segreto condiviso.
![BTC204](assets/it/66/24.webp)
Poiché Alice non può ottenere $b$ (la chiave privata di Bob), lei non è in grado di determinare $k0$ (la chiave privata associata all'indirizzo di ricezione BIP47 di Bob). Schematicamente, possiamo rappresentare il calcolo del segreto condiviso $S$ così:
![BTC204](assets/it/66/19.webp)
Una volta trovato il segreto condiviso con ECDH, Alice e Bob calcolano la chiave pubblica di pagamento BIP47 $K0$, e Bob calcola anche la chiave privata associata $k0$:
![BTC204](assets/it/66/25.webp)
### Rimborsare il Pagamento BIP47
Poiché Bob è a conoscenza del codice di pagamento riutilizzabile di Alice, ha già tutte le informazioni necessarie per inviarle un rimborso. Non avrà bisogno di contattare nuovamente Alice per chiedere informazioni. Dovrà semplicemente notificarla con una transazione di notifica, specialmente affinché lei possa recuperare i suoi indirizzi BIP47 con il suo seed, e poi potrà anche inviarle fino a `2^32` pagamenti.
La funzionalità di rimborso è specifica per BIP47 ed è uno dei suoi vantaggi rispetto ad altri metodi che studieremo nei prossimi capitoli, come i Pagamenti Silenziosi.
Bob può quindi rimborsare Alice nello stesso modo in cui lei gli ha inviato i pagamenti. I ruoli si invertono:
![BTC204](assets/it/66/26.webp)
_Un grande ringraziamento a [Fanis Michalakis](https://x.com/FanisMichalakis) per la sua revisione e preziosi consigli esperti sull'articolo che ha ispirato la scrittura di questo capitolo!_
https://planb.network/tutorials/privacy/on-chain/paynym-bip47-a492a70b-50eb-4f95-a766-bae2c5535093
## Pagamenti Silenziosi
<chapterId>2871d594-414e-4598-a830-91c9eb84dfb8</chapterId>
Il BIP47 è stato criticato per la sua inefficienza sulla blockchain. Come spiegato nel capitolo precedente, richiede una transazione di notifica per ogni nuovo destinatario. Questo vincolo diventa trascurabile se si prevede di stabilire un canale di pagamento duraturo con questo destinatario. Infatti, una singola transazione di notifica apre la strada a un numero quasi infinito di pagamenti BIP47 successivi.
Tuttavia, in determinate situazioni, la transazione di notifica può rappresentare un ostacolo per l'utente. Prendiamo l'esempio di una donazione una tantum a un destinatario: con un indirizzo Bitcoin classico, una singola transazione è sufficiente per effettuare la donazione. Ma con il BIP47, sono necessarie due transazioni: una per la notifica e un'altra per il pagamento effettivo. Quando la domanda di spazio nel blocco è bassa e le commissioni di transazione sono minime, questo passaggio aggiuntivo generalmente non rappresenta un problema. Tuttavia, durante i periodi di congestione, le commissioni di transazione possono diventare esorbitanti per un singolo pagamento, potenzialmente raddoppiando il costo per l'utente rispetto a una transazione Bitcoin standard, il che può essere inaccettabile per l'utente.
Per situazioni in cui l'utente prevede di effettuare solo pochi pagamenti a un identificatore statico, sono state sviluppate altre soluzioni. Tra queste ci sono i Pagamenti Silenziosi, descritti nel [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki). Questo protocollo consente l'uso di un identificatore statico per ricevere pagamenti senza generare riutilizzo dell'indirizzo e senza richiedere l'uso di transazioni di notifica. Esaminiamo come funziona questo protocollo.
---
_Per comprendere appieno questo capitolo, è essenziale essere familiari con il funzionamento di ECDH (Elliptic Curve Diffie-Hellman) e la derivazione delle chiavi crittografiche in un portafoglio HD. Questi concetti sono stati dettagliati nel capitolo precedente sul BIP47. Non li ripeterò qui. Se non sei ancora familiare con queste nozioni, ti consiglio di consultare il capitolo precedente prima di continuare con questo. Non riprenderò nemmeno i rischi associati al riutilizzo degli indirizzi di ricezione, né l'importanza di avere un identificatore unico per ricevere pagamenti._
---
### Perché non spostare la notifica?
Come discusso nel capitolo sul BIP47, la transazione di notifica svolge principalmente due funzioni:
- Notifica il destinatario;
- Trasmette il codice di pagamento del mittente.
Si potrebbe ingenuamente pensare che questo processo di notifica potrebbe essere effettuato off-chain. In teoria, ciò è completamente fattibile: sarebbe sufficiente per il destinatario indicare un mezzo di comunicazione per ricevere i codici di pagamento BIP47 dai mittenti. Tuttavia, questo approccio presenta due problemi principali:
- Primo, ciò sposterebbe il processo di trasmissione del codice su un altro protocollo di comunicazione. Le questioni relative ai costi e alla privacy dello scambio rimarrebbero, ma sarebbero semplicemente trasferite a questo nuovo protocollo. In termini di privacy, ciò potrebbe anche creare un collegamento tra l'identità di un utente e l'attività sulla blockchain, cosa che cerchiamo di evitare eseguendo la notifica direttamente sulla blockchain. Inoltre, effettuare la notifica fuori dalla blockchain introdurrebbe rischi di censura (come il blocco dei fondi) che non esistono su Bitcoin;
Successivamente, ciò porrebbe un problema di recupero. Con BIP47, il destinatario deve assolutamente conoscere i codici di pagamento dei mittenti per accedere ai fondi. Questo è vero al momento della ricezione, ma anche in caso di recupero dei fondi tramite il seed in caso di perdita del portafoglio. Con le notifiche onchain, questo rischio viene evitato, poiché l'utente può trovare e decifrare le transazioni di notifica semplicemente conoscendo il proprio seed. Tuttavia, se la notifica viene eseguita fuori dalla blockchain, l'utente dovrebbe mantenere un backup dinamico di tutti i codici di pagamento ricevuti, il che è impraticabile per l'utente medio.
Tutti questi vincoli rendono l'uso della notifica onchain indispensabile nel contesto di BIP47. Eppure, i Pagamenti Silenziosi cercano specificamente di evitare questo passaggio di notifica onchain a causa del suo costo. Pertanto, la soluzione adottata non è spostare la notifica, ma eliminarla completamente. Per raggiungere questo obiettivo, deve essere accettato un compromesso: quello della scansione. A differenza di BIP47, dove l'utente sa esattamente dove trovare i propri fondi grazie alle transazioni di notifica, nel contesto dei Pagamenti Silenziosi, l'utente deve esaminare tutte le transazioni Bitcoin esistenti per rilevare eventuali pagamenti che potrebbero essere destinati a loro. Per ridurre questo onere operativo, la ricerca di Pagamenti Silenziosi è limitata solo alle transazioni che probabilmente contengono tali pagamenti, ovvero quelle che includono almeno un output Taproot P2TR. La scansione si concentra esclusivamente anche sulle transazioni dalla data di creazione del portafoglio (non c'è bisogno di scandire transazioni risalenti al 2009 se il portafoglio è stato creato nel 2024).
Pertanto, potete vedere perché BIP47 e Pagamenti Silenziosi, sebbene mirino a un obiettivo simile, comportano compromessi diversi e **quindi si rivolgono effettivamente a casi d'uso distinti**. Per i pagamenti una tantum, come le donazioni occasionali, i Pagamenti Silenziosi sono più appropriati a causa del loro costo inferiore. Al contrario, per le transazioni regolari allo stesso destinatario, come nel caso delle piattaforme di scambio o dei pool di mining, BIP47 potrebbe essere preferito.
Esploriamo insieme il funzionamento tecnico dei Pagamenti Silenziosi per capirne meglio le implicazioni. Per fare ciò, suggerisco di adottare lo stesso approccio del documento esplicativo di BIP352. Scomporremo gradualmente i calcoli da eseguire, elemento per elemento, giustificando ogni nuova aggiunta.
### Alcuni concetti da comprendere
Prima di iniziare, è importante chiarire che i Pagamenti Silenziosi si basano esclusivamente sull'uso di tipi di script P2TR (_Pay to Taproot_). A differenza di BIP47, non è necessario derivare gli indirizzi di ricezione dalle chiavi pubbliche figlie tramite hashing. Infatti, nello standard P2TR, la chiave pubblica modificata viene utilizzata direttamente e apertamente nell'indirizzo. Così, un indirizzo di ricezione Taproot è essenzialmente una chiave pubblica accompagnata da alcuni metadati. Questa chiave pubblica modificata è l'aggregazione di altre due chiavi pubbliche: una che consente la spesa diretta e tradizionale tramite una semplice firma, e l'altra che rappresenta la radice di Merkle del MAST, che autorizza la spesa soggetta alla soddisfazione di una delle condizioni potenzialmente iscritte nell'albero di Merkle.
![BTC204](assets/it/67/01.webp)
La decisione di limitare i Pagamenti Silenziosi esclusivamente a Taproot è motivata da due ragioni principali:
- Primo, facilita significativamente l'implementazione e gli aggiornamenti futuri nel software del portafoglio, poiché è necessario aderire a un solo standard;
- In secondo luogo, questo approccio aiuta a migliorare l'insieme di anonimato degli utenti incoraggiandoli a non disperdersi tra diversi tipi di script, che generano impronte di portafoglio distinte nell'analisi della catena (per maggiori informazioni su questo concetto, vi invito a consultare il capitolo 4 della parte 2).
### Derivazione naive di una chiave pubblica di Pagamenti Silenziosi
Iniziamo con un semplice esempio che ti aiuterà a comprendere il funzionamento di base dei Pagamenti Silenziosi (SP, Silent Payments). Prendiamo Alice e Bob, due utenti Bitcoin. Alice vuole inviare bitcoin a Bob su un nuovo indirizzo di ricezione. Tre obiettivi devono essere raggiunti in questo processo:
- Alice deve essere in grado di generare un nuovo indirizzo;
- Bob deve essere in grado di identificare un pagamento inviato a questo specifico indirizzo;
- Bob deve essere in grado di ottenere la chiave privata associata a questo indirizzo per poter spendere i suoi fondi.
Alice ha un UTXO nel suo portafoglio Bitcoin protetto con la seguente coppia di chiavi:
- $a$: la chiave privata;
- $A$: la chiave pubblica ($A = a \cdot G$)
Bob ha un indirizzo SP che ha pubblicato su internet con:
- $b$: la chiave privata;
- $B$: la chiave pubblica ($B = b \cdot G$)
Recuperando l'indirizzo di Bob, Alice è in grado di calcolare un nuovo indirizzo vuoto che appartiene a Bob usando ECDH. Chiamiamo questo indirizzo $P$:
$$ P = B + \text{hash}(a \cdot B) \cdot G $$
In questa equazione, Alice ha semplicemente calcolato il prodotto scalare della sua chiave privata $a$ e della chiave pubblica di Bob $B$. Ha passato questo risultato attraverso una funzione hash conosciuta da tutti. Il valore di output è poi moltiplicato scalarmente per il punto generatore $G$ della curva ellittica `secp256k1`. Infine, Alice aggiunge il punto ottenuto alla chiave pubblica di Bob $B$. Una volta che Alice ha questo indirizzo $P$, lo usa come output in una transazione, il che significa che invia bitcoin ad esso.
> _Nel contesto dei Pagamenti Silenziosi, la funzione "hash" corrisponde a una funzione hash SHA256 etichettata specificamente con `BIP0352/SharedSecret`, assicurando che gli hash generati siano unici per questo protocollo e non possano essere riutilizzati in altri contesti, fornendo anche una protezione aggiuntiva contro il riutilizzo di nonce nelle firme. Questo standard corrisponde a quello [specificato nel BIP340 per le firme Schnorr](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) su `secp256k1`._
Grazie alle proprietà della curva ellittica su cui si basa ECDH, sappiamo che:
$$ a \cdot B = b \cdot A $$
Bob sarà quindi in grado di calcolare l'indirizzo di ricezione su cui Alice ha inviato i bitcoin. Per fare ciò, monitora tutte le transazioni Bitcoin che soddisfano i criteri dei Pagamenti Silenziosi e applica il seguente calcolo a ciascuna di esse per vedere se il pagamento è indirizzato a lui (_scanning_):
$$ P' = B + \text{hash}(b \cdot A) \cdot G $$
Quando esamina la transazione di Alice, si rende conto che $P'$ è uguale a $P$. Sa quindi che questo pagamento è indirizzato a lui:
$$ P' = B + \text{hash}(b \cdot A) \cdot G = B + \text{hash}(a \cdot B) \cdot G = P $$
Da qui, Bob sarà in grado di calcolare la chiave privata $p$ che consente di spendere l'indirizzo $P$:
$$ p = (b + \text{hash}(b \cdot A)) \bmod n $$
Come puoi vedere, per calcolare questa chiave privata $p$, è necessario avere la chiave privata $b$. Solo Bob ha questa chiave privata $b$. Sarà quindi effettivamente l'unico in grado di spendere i bitcoin inviati al suo indirizzo di Pagamenti Silenziosi.
![BTC204](assets/fr/236.webp)
_Didascalia:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s$: Il segreto comune ECDH
- $P$: La chiave pubblica / indirizzo unico per il pagamento a Bob
Ecco un approccio inizialmente piuttosto ingenuo nell'uso dell'indirizzo statico di Bob, denotato $B$, per derivare un indirizzo unico $P$ per inviare bitcoin. Tuttavia, questo metodo è troppo semplicistico e presenta diversi difetti che necessitano di correzione. Il primo problema è che, in questo schema, Alice non può creare molteplici output per Bob all'interno della stessa transazione.
### Come creare molteplici output?
Nell'esempio della sezione precedente, Alice crea un singolo output che andrà a Bob al suo indirizzo unico $P$. Con lo stesso input selezionato, è impossibile per Alice creare due indirizzi vergini distinti per Bob, poiché il metodo utilizzato porterebbe sempre allo stesso risultato per $P$, quindi allo stesso indirizzo. Tuttavia, ci possono essere molte situazioni in cui Alice desidera dividere il suo pagamento a Bob in diverse piccole somme, creando così molteplici UTXO. È quindi necessario trovare un metodo che permetta di farlo.
Per raggiungere questo obiettivo, modificheremo leggermente il calcolo che Alice esegue per derivare $P$, in modo che possa generare due indirizzi distinti per Bob, ovvero $P_0$ e $P_1$.
Per modificare il calcolo e ottenere 2 indirizzi diversi, è sufficiente aggiungere un intero che modifica il risultato. Così, Alice aggiungerà $0$ nel suo calcolo per ottenere l'indirizzo $P_0$ e $1$ per ottenere l'indirizzo $P_1$. Chiamiamo questo intero $i$:
$$ P_i = B + \text{hash}(a \cdot B \text{ ‖ } i) \cdot G $$
Il processo di calcolo rimane invariato rispetto al metodo precedente, eccetto che questa volta Alice concatenerà $a \cdot B$ con $i$ prima di procedere al hash. È quindi sufficiente cambiare $i$ per avere un nuovo indirizzo appartenente a Bob. Ad esempio:
$$ P_0 = B + \text{hash}(a \cdot B \text{ ‖ } 0) \cdot G $$
$$ P_1 = B + \text{hash}(a \cdot B \text{ ‖ } 1) \cdot G $$
Quando Bob esamina la blockchain per i Pagamenti Silenziosi destinati a lui, inizia utilizzando $i = 0$ per l'indirizzo $P_0$. Se non trova nessun pagamento su $P_0$, conclude che questa transazione non contiene nessun Pagamento Silenzioso per lui e smette di analizzarla. Tuttavia, se $P_0$ è valido e contiene un pagamento per lui, procede con $P_1$ nella stessa transazione per verificare se Alice ha effettuato un secondo pagamento. Se $P_1$ risulta essere invalido, interrompe la sua ricerca per questa transazione; altrimenti, continua a testare valori successivi di $i$.
$$ P_1 = B + \text{hash}(b \cdot A \text{ ‖ } 1) \cdot G $$
Poiché Bob si ferma immediatamente a $i = 0$ se $P_0$ non produce risultati, l'uso di questo intero aggiunge quasi nessun onere operativo aggiuntivo a Bob per la fase di scansione delle transazioni.
Bob può quindi calcolare le chiavi private nello stesso modo:
$$

p_0 = (b + \text{hash}(b \cdot A \text{ ‖ } 0)) \bmod n

$$
p_1 = (b + \text{hash}(b \cdot A \text{ ‖ } 1)) \bmod n
$$

_Didascalia:_


- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $G$: Der Erzeugerpunkt der Ellipsenkurve `secp256k1`
- $\text{SHA256}$: Die Funktion des SHA256-Hashes wurde mit `BIP0352/SharedSecret` gelöscht
- $s_0$: Il primo segreto condiviso ECDH
- $s_1$: Il secondo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $P_1$: La seconda chiave pubblica / indirizzo unico per il pagamento a Bob

Mit dieser Methode beginnen wir, ein gutes Protokoll zu erstellen, aber es gibt noch einige andere Probleme, die gelöst werden müssen, insbesondere die Verhinderung der Nutzung von Indirekteintragungen.

### Come evitare il riutilizzo degli indirizzi?

Wie wir in den vorangegangenen Abschnitten gesehen haben, nutzt Alice die Kombination von Chiasmen, die ihren UTXO schützen, um das mit Bob vereinbarte ECDH-Segment zu berechnen. Questo segreto le permette di derivare l'indirizzo unico $P_0$. Allerdings kann die von Alice benutzte Chiffre ($a$, $A$) mehr UTXO schützen, wenn sie diese Indikation mehrfach verwendet. In dem Fall, in dem Alice mehrere Zahlungen an die statische Nummer $B$ von Bob unter Verwendung von zwei UTXO aus der gleichen Nummer $A$ vornimmt, entspricht dies einer Wiederverwendung der Nummer durch Bob.

> die Verwendung von Hinweisen ist eine für die Privatsphäre der Nutzer sehr negative Praxis. Per capire perché, vi consiglio di rivedere le prime parti di questa formazione._
Infatti, poiché l'indirizzo unico $P_0$ è derivato da $A$ e $B$, se Alice deriva un secondo indirizzo per un secondo pagamento a $B$, con la stessa chiave $A$, finirà per ottenere lo stesso indirizzo $P_0$. Um dieses Risiko zu vermeiden und die Verwendung von Indirektionen innerhalb der stillen Einzahlungen zu verhindern, müssen wir unsere Berechnungen ein wenig modifizieren.

Was wir wollen, ist, dass jeder UTXO, der von Alice als Input für eine Zahlung verbraucht wird, eine eindeutige Kennung auf dem Konto von Bob hat, auch wenn mehrere UTXO durch die gleiche Anzahl von Kennungen geschützt sind. Es reicht also aus, einen Verweis auf alle UTXO in die Berechnung der einzigen Kennung $P_0$ einzubauen. Questo riferimento sarà semplicemente l'hash dell'UTXO consumato come input:

$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$

Mit diesem Hinweis auf die Eingabe fügt Alice die Berechnung der eindeutigen Indikation $P_0$ hinzu:

Während des Scannens kann Bob auch $\text{inputHash}$ hinzufügen, denn alles, was er tun muss, ist, den Übergang zu überwachen, um $\text{outpoint}$ zu übertragen:

$$ P_0 = B + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0) \cdot G $$

Quando trova un valido $P_0$, può calcolare la corrispondente chiave privata $p_0$:

$$
p_0 = (b + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0)) \bmod n
$$

```text
_Legenda:_
- $B$: La chiave pubblica / indirizzo statico pubblicato da Bob
- $b$: La chiave privata di Bob
- $A$: La chiave pubblica dell'UTXO di Alice usata come input per la transazione
- $a$: La chiave privata di Alice
- $H$: L'hash dell'UTXO usato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hash SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
Al momento, i nostri calcoli presuppongono che Alice utilizzi un singolo input per la sua transazione. Tuttavia, dovrebbe essere in grado di utilizzare più input. Di conseguenza, da parte di Bob, per ogni transazione contenente più input, teoricamente avrebbe bisogno di calcolare l'ECDH per ogni input per determinare se un pagamento è destinato a lui. Questo metodo non è soddisfacente, quindi abbiamo bisogno di trovare una soluzione per ridurre il carico di lavoro!
### Modificare le chiavi pubbliche negli input
Per risolvere questo problema, invece di utilizzare la coppia di chiavi che protegge un input specifico da parte di Alice, useremo la somma di tutte le coppie di chiavi utilizzate negli input della transazione. Questa somma sarà quindi considerata come una nuova coppia di chiavi. Questa tecnica è nota come "tweak".
Per esempio, immagina che la transazione di Alice abbia 3 input, ognuno protetto con una coppia di chiavi diversa:
- $a_0$ protegge l'input #0;
- $a_1$ protegge l'input #1;
- $a_2$ protegge l'input #2.
Seguendo il metodo descritto sopra, Alice dovrebbe scegliere una singola coppia di chiavi tra $a_0$, $a_1$ e $a_2$ per calcolare il segreto ECDH e generare l'indirizzo di pagamento unico $P$ dall'indirizzo statico $B$ di Bob. Tuttavia, questo approccio richiede a Bob di testare ogni possibilità sequenzialmente, partendo da $a_0$, poi $a_1$, e così via, fino all'identificazione di una coppia che genera un indirizzo valido $P$. Questo processo richiede che Bob esegua il calcolo ECDH su tutti gli input di tutte le transazioni, aumentando significativamente il carico di lavoro operativo di scansione.
Per evitare ciò, chiederemo ad Alice di eseguire il suo calcolo di $P$ utilizzando la somma di tutte le chiavi in input. Prendendo il nostro esempio, la chiave privata modificata $a$ sarebbe calcolata come segue:
$$ a = a_0 + a_1 + a_2 $$
Allo stesso modo, Alice e Bob saranno in grado di calcolare la chiave pubblica modificata:
$$ A = A_0 + A_1 + A_2 $$
Grazie a questo metodo, a Bob basta calcolare la somma delle chiavi pubbliche della transazione, poi calcolare il segreto ECDH da $A$ soltanto, il che riduce notevolmente il numero di calcoli da fare per la fase di scansione. Tuttavia, ricorda dalla sezione precedente. Avevamo incluso nel nostro calcolo l'hash $\text{inputHash}$ che viene usato come nonce per prevenire il riutilizzo degli indirizzi:
$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$
Ma se ci sono più input in una transazione, è necessario determinare quale $\text{outpoint}$ viene scelto in questo calcolo. Secondo il BIP352, il criterio di selezione per $\text{outpoint}$ da usare è scegliere il più piccolo lessicograficamente, il che significa selezionare l'UTXO che appare per primo in ordine alfabetico. Questo metodo standardizza l'UTXO da scegliere in ogni transazione. Ad esempio, se questo $\text{outpoint}$ più piccolo lessicograficamente è $\text{outpoint}_L$, il calcolo di $\text{inputHash}$ sarà:
$$ \text{inputHash} = \text{hash}(\text{outpoint}\_L \text{ ‖ } A) $$
I calcoli rimangono quindi identici a quelli presentati nella sezione precedente, eccetto che la chiave privata $a$ e la sua corrispondente chiave pubblica $A$ non rappresentano più una coppia che protegge un singolo input, ma ora rappresentano la modifica di tutte le coppie di chiavi negli input.
### Separare le Chiavi di Spesa e di Scansione
Finora, abbiamo discusso dell'indirizzo statico di Pagamento Silenzioso $B$ come di una chiave pubblica unica. Ricorda, è questa chiave pubblica $B$ che viene usata da Alice per creare il segreto condiviso ECDH, che a sua volta viene usato per calcolare l'indirizzo di pagamento unico $P$. Bob usa questa chiave pubblica $B$ e la corrispondente chiave privata $b$ per la fase di scansione. Ma userà anche la chiave privata $b$ per calcolare la chiave privata $p$ che consente di spendere dall'indirizzo $P$.
Lo svantaggio di questo metodo è che la chiave privata $b$, che viene usata per calcolare tutte le chiavi private per gli indirizzi che ricevono Pagamenti Silenziosi, viene anche usata da Bob per scansionare le transazioni. Questo passaggio richiede che la chiave $b$ sia disponibile su un software di portafoglio connesso a Internet, il che la espone a un rischio maggiore di furto rispetto al mantenerla su un portafoglio freddo. Idealmente, sarebbe vantaggioso poter approfittare dei Pagamenti Silenziosi mantenendo la chiave privata $b$, che controlla l'accesso a tutte le altre chiavi private, al sicuro su un portafoglio hardware. Fortunatamente, il protocollo è stato adattato per permettere esattamente questo.
Per raggiungere questo obiettivo, il BIP352 specifica che il ricevente usa 2 diverse coppie di chiavi:
- $B_{\text{spend}}$: per calcolare le chiavi private degli indirizzi di pagamento unici;
- $B_{\text{scan}}$: per trovare indirizzi di pagamento unici.
In questo modo, Bob può mantenere la chiave privata $b_{\text{spend}}$ su un portafoglio hardware e usare la chiave privata $b_{\text{scan}}$ su software online per trovare i suoi Pagamenti Silenziosi, senza rivelare $b_{\text{spend}}$. Tuttavia, le chiavi pubbliche $B_{\text{scan}}$ e $B_{\text{spend}}$ sono entrambe pubblicamente rivelate, poiché si trovano nell'indirizzo statico di Bob $B$:
Per calcolare un indirizzo di pagamento unico $P_0$ appartenente a Bob, Alice eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot a \cdot B\_{\text{scan}} \text{ ‖ } 0) \cdot G $$
Per trovare i pagamenti indirizzati a lui, Bob eseguirà il seguente calcolo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Come puoi vedere, fino a questo momento, Bob non ha avuto bisogno di usare $b_{\text{spend}}$ che si trova sul suo portafoglio hardware. Quando desidera spendere $P_0$, può quindi eseguire il seguente calcolo per trovare la chiave privata $p_0$:
$$ p*0 = (b*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0)) \bmod n $$
_Didascalia:_
- $B_{\text{scan}}$: Chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: Chiave privata di scansione di Bob
- $B_{\text{spend}}$: Chiave pubblica di spesa di Bob (indirizzo statico)
- $b_{\text{spend}}$: Chiave privata di spesa di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash dell'UTXO più piccolo (lessicograficamente) usato in input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo di pagamento unico per Bob
### Utilizzando indirizzi SP con un'etichetta
Bob ha quindi un indirizzo statico $B$ per i Pagamenti Silenziosi come segue:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Il problema con questo metodo è che non permette di segregare i diversi pagamenti inviati a questo indirizzo. Ad esempio, se Bob ha 2 clienti diversi per la sua attività e vuole differenziare chiaramente i pagamenti da ciascuno, avrebbe bisogno di 2 indirizzi statici diversi. Una soluzione ingenua, con l'approccio attuale, sarebbe che Bob crei due portafogli separati, ognuno con il proprio indirizzo statico, o addirittura stabilisca due indirizzi statici diversi all'interno dello stesso portafoglio. Tuttavia, questa soluzione richiede la scansione dell'intera blockchain due volte (una per ciascun indirizzo) per rilevare rispettivamente i pagamenti destinati a ciascun indirizzo. Questa doppia scansione aumenta in modo irragionevole l'onere operativo per Bob.
Per risolvere questo problema, BIP352 utilizza un sistema di etichettatura che consente di avere diversi indirizzi statici senza aumentare in modo irragionevole il carico di lavoro per trovare Pagamenti Silenziosi sulla blockchain. Per fare ciò, viene aggiunto un intero $m$ alla chiave pubblica di spesa $B_{\text{spend}}$. Questo intero può assumere il valore di $1$ per il primo indirizzo statico, poi $2$ per il secondo, e così via. Le chiavi di spesa $B_{\text{spend}}$ saranno d'ora in poi chiamate $B_m$ e saranno costruite in questo modo:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Per esempio, per la prima chiave di spesa con l'etichetta $1$:
$$ B*1 = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } 1) \cdot G $$
L'indirizzo statico pubblicato da Bob consisterà ora di $B_{\text{scan}}$ e $B_m$. Per esempio, il primo indirizzo statico con l'etichetta $1$ sarà:
$$ B = B\_{\text{scan}} \text{ ‖ } B_1 $$
> _Iniziamo solo dall'etichetta 1 perché l'etichetta 0 è riservata per il resto._
Alice, da parte sua, deriverà l'indirizzo di pagamento unico $P$ nello stesso modo di prima, ma utilizzando il nuovo $B_1$ invece di $B_{\text{spend}}$.
$$ P*0 = B_1 + \text{hash}(\text{inputHash} \cdot a \cdot B*{\text{scan}} \text{ ‖ } 0) \cdot G $$
In realtà, Alice potrebbe non sapere nemmeno che Bob ha un indirizzo etichettato, poiché lei semplicemente utilizza la seconda parte dell'indirizzo statico che lui le ha fornito, che in questo caso, è il valore $B_1$ piuttosto che $B_{\text{spend}}$.
Per scansionare i pagamenti, Bob utilizzerà sempre il valore del suo indirizzo statico iniziale con $B_{\text{spend}}$ in questo modo:
$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$
Poi, semplicemente sottrae il valore che trova per $P_0$ da ogni output uno per uno. Poi controlla se uno dei risultati di queste sottrazioni corrisponde al valore di una delle etichette che usa nel suo portafoglio. Se corrisponde, per esempio, per l'output #4 con l'etichetta $1$, ciò significa che questo output è un Pagamento Silenzioso associato al suo indirizzo statico etichettato $B_1$:
$$ Out*4 - P_0 = \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Questo funziona perché:
$$ B*1 = B*{\text{spend}} + \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Grazie a questo metodo, Bob può utilizzare una moltitudine di indirizzi statici ($B_1$, $B_2$, $B_3$...), tutti derivati dal suo indirizzo statico base ($B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}}$), al fine di separare correttamente gli usi.
Tuttavia, questa separazione degli indirizzi statici è valida solo da una prospettiva di gestione personale del portafoglio e non consente la separazione delle identità. Poiché tutti hanno lo stesso $B*{\text{scan}}$, è molto facile associare tutti gli indirizzi statici insieme e dedurre che appartengono a una singola entità.
_Didascalia:_
- $B_{\text{scan}}$: chiave pubblica di scansione di Bob (indirizzo statico)
- $b_{\text{scan}}$: chiave privata di scansione di Bob
- $B_{\text{spend}}$: chiave pubblica di spesa di Bob (indirizzo iniziale)
- $B_m$: chiave pubblica di spesa etichettata di Bob (indirizzo statico)
- $b_m$: chiave privata di spesa etichettata di Bob
- $A$: La somma delle chiavi pubbliche in input (tweak)
- $a$: La chiave privata corrispondente alla chiave pubblica modificata
- $H$: L'hash del più piccolo UTXO (lessicograficamente) utilizzato come input
- $G$: Il punto generatore della curva ellittica `secp256k1`
- $\text{SHA256}$: La funzione di hashing SHA256 etichettata con `BIP0352/SharedSecret`
- $s_0$: Il primo segreto condiviso ECDH
- $P_0$: La prima chiave pubblica / indirizzo unico per il pagamento a Bob
- $p_0$: La chiave privata del primo indirizzo di pagamento unico a Bob
- $X$: L'hash della chiave privata di scansione con l'etichetta
### Come Costruire un Indirizzo per Pagamenti Silenziosi?
Per costruire un indirizzo dedicato ai Pagamenti Silenziosi, è necessario prima derivare 2 coppie di chiavi nel proprio portafoglio Bitcoin HD:
- La coppia $b_{\text{scan}}$, $B_{\text{scan}}$ per cercare i pagamenti indirizzati a noi;
- La coppia $b_{\text{spend}}$, $B_{\text{spend}}$ per spendere i bitcoin che abbiamo ricevuto.
Queste coppie sono derivate seguendo questi percorsi (_Bitcoin Mainnet_):
scan: m / 352' / 0' / 0' / 1' / 0
spend: m / 352' / 0' / 0' / 0' / 0
```

```text
Una volta disponibili queste 2 coppie di chiavi, si concatenano semplicemente (una di seguito all'altra) per creare il payload dell'indirizzo statico:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
Se si desidera utilizzare etichette, $B_{\text{spend}}$ viene sostituito con $B_m$:
$$ B = B\_{\text{scan}} \text{ ‖ } B_m $$
Con l'etichetta $m$:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$
Una volta disponibile questo payload, si aggiunge la HRP (_Human-Readable Part_) `sp` e la versione `q` (= versione 0). Viene anche aggiunto un checksum, e l'indirizzo è formattato in bech32m.
Ad esempio, ecco il mio indirizzo statico per i Pagamenti Silenziosi:
sp1qqvhjvsq2vz8zwrw372vuzle7472zup2ql3pz64yn5cpkw5ngv2n6jq4nl8cgm6zmu48yk3eq33ryc7aam6jrvrg0d0uuyzecfhx2wgsumcurv77e
```